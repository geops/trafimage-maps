(()=>{var i,e,KD=Object.create,lx=Object.defineProperty,QD=Object.getOwnPropertyDescriptor,XD=Object.getOwnPropertyNames,JD=Object.getPrototypeOf,eC=Object.prototype.hasOwnProperty,zl=(i,e,s)=>(s=null!=i?KD(JD(i)):{},((i,e,s,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let c of XD(e))!eC.call(i,c)&&undefined!==c&&lx(i,c,{get:()=>e[c],enumerable:!(r=QD(e,c))||r.enumerable});return i})(!e&&i&&i.__esModule?s:lx(s,"default",{value:i,enumerable:!0}),i)),sl=(i=(Av,Pv)=>{var i,e;i=Av,e=function(){"use strict";var i,e,s;function r(o,y){if(i)if(e){var x="var sharedChunk = {}; ("+i+")(sharedChunk); ("+e+")(sharedChunk);",I={};i(I),s=y(I),typeof window<"u"&&(s.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}else e=y;else i=y}return r(0,function(o){var y=x;function x(a,t,l,h){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=t,this.p2x=l,this.p2y=h}function I(a,t,l,h){let f=new y(a,t,l,h);return function(g){return f.solve(g)}}x.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,t){if(void 0===t&&(t=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,h=0;h<8;h++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<t)return l;var g=this.sampleCurveDerivativeX(l);if(Math.abs(g)<1e-6)break;l-=f/g}var v=0,w=1;for(l=a,h=0;h<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<t));h++)a>f?v=l:w=l,l=.5*(w-v)+v;return l},solve:function(a,t){return this.sampleCurveY(this.solveCurveX(a,t))}};let A=I(.25,.1,.25,1);function L(a,t,l){return Math.min(l,Math.max(t,a))}function G(a,t,l){let h=l-t,f=((a-t)%h+h)%h+t;return f===t?l:f}function re(a,...t){for(let l of t)for(let h in l)a[h]=l[h];return a}let le=1;function ve(a,t){a.forEach(l=>{t[l]&&(t[l]=t[l].bind(t))})}function Ie(a,t,l){let h={};for(let f in a)h[f]=t.call(l||this,a[f],f,a);return h}function je(a,t,l){let h={};for(let f in a)t.call(l||this,a[f],f,a)&&(h[f]=a[f]);return h}function Ae(a){return Array.isArray(a)?a.map(Ae):"object"==typeof a&&a?Ie(a,Ae):a}let yt={};function rt(a){yt[a]||(typeof console<"u"&&console.warn(a),yt[a]=!0)}function ot(a,t,l){return(l.y-a.y)*(t.x-a.x)>(t.y-a.y)*(l.x-a.x)}function ln(a){let t=0;for(let l,h,f=0,g=a.length,v=g-1;f<g;v=f++)l=a[f],h=a[v],t+=(h.x-l.x)*(l.y+h.y);return t}function kt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Cn,jn,Pn=null;function Lr(a){if(null==Pn){let t=a.navigator?a.navigator.userAgent:null;Pn=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Pn}function Mi(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}let si={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){let t=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(a,t=0){let l=window.document.createElement("canvas"),h=l.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,h.drawImage(a,0,0,a.width,a.height),h.getImageData(-t,-t,a.width+2*t,a.height+2*t)},resolveURL:a=>(Cn||(Cn=document.createElement("a")),Cn.href=a,Cn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==jn&&(jn=matchMedia("(prefers-reduced-motion: reduce)")),jn.matches)}};var st=Zi;function Zi(a,t){this.x=a,this.y=t}Zi.prototype={clone:function(){return new Zi(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,t){return this.clone()._rotateAround(a,t)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var t=a.x-this.x,l=a.y-this.y;return t*t+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult:function(a){var t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var t=Math.cos(a),l=Math.sin(a),h=l*this.x+t*this.y;return this.x=t*this.x-l*this.y,this.y=h,this},_rotateAround:function(a,t){var l=Math.cos(a),h=Math.sin(a),f=t.y+h*(this.x-t.x)+l*(this.y-t.y);return this.x=t.x+l*(this.x-t.x)-h*(this.y-t.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Zi.convert=function(a){return a instanceof Zi?a:Array.isArray(a)?new Zi(a[0],a[1]):a};let Je,Ge={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Xe="mapbox-tiles",fn=500,ti=50;let er,_r,Un=1/0,Ht={supported:!1,testSupport:function(a){!qt&&_r&&(Ei?Zn(a):er=a)}},qt=!1,Ei=!1;function Zn(a){let t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,_r),a.isContextLost())return;Ht.supported=!0}catch{}a.deleteTexture(t),qt=!0}typeof document<"u"&&(_r=document.createElement("img"),_r.onload=function(){er&&Zn(er),er=null,Ei=!0},_r.onerror=function(){qt=!0,er=null},_r.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Ii={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ii);class ni extends Error{constructor(t,l,h,f){super(`AJAXError: ${l} (${t}): ${h}`),this.status=t,this.statusText=l,this.url=h,this.body=f}}let na=kt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function ho(a,t){let l=new AbortController,h=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:na(),signal:l.signal}),f=!1,g=!1;return"json"===a.type&&h.headers.set("Accept","application/json"),g||(Date.now(),fetch(h).then(P=>{return P.ok?(O=P,void("arrayBuffer"===a.type?O.arrayBuffer():"json"===a.type?O.json():O.text()).then(j=>{g||(f=!0,t(null,j,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(j=>{g||t(new Error(j.message))})):P.blob().then(O=>t(new ni(P.status,P.statusText,a.url,O)));var O}).catch(P=>{20!==P.code&&t(new Error(P.message))})),{cancel:()=>{g=!0,f||l.abort()}}}let _s=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(kt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,t);if(!kt()){let h=a.url.substring(0,a.url.indexOf("://"));return(Ge.REGISTERED_PROTOCOLS[h]||ho)(a,t)}}if(!(/^file:/.test(l=a.url)||/^file:/.test(na())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ho(a,t);if(kt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var l;return function(h,f){let g=new XMLHttpRequest;g.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(g.responseType="arraybuffer");for(let v in h.headers)g.setRequestHeader(v,h.headers[v]);return"json"===h.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===h.credentials,g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let v=g.response;if("json"===h.type)try{v=JSON.parse(g.response)}catch(w){return f(w)}f(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else{let v=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});f(new ni(g.status,g.statusText,h.url,v))}},g.send(h.body),{cancel:()=>g.abort()}}(a,t)},vs=function(a,t){return _s(re(a,{type:"arrayBuffer"}),t)};function ia(a){let t=window.document.createElement("a");return t.href=a,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}let vr,po,Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";vr=[],po=0;let fo=function(a,t){if(Ht.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),po>=Ge.MAX_PARALLEL_IMAGE_REQUESTS){let g={requestParameters:a,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return vr.push(g),g}po++;let l=!1,h=()=>{if(!l)for(l=!0,po--;vr.length&&po<Ge.MAX_PARALLEL_IMAGE_REQUESTS;){let g=vr.shift(),{requestParameters:v,callback:w,cancelled:M}=g;M||(g.cancel=fo(v,w).cancel)}},f=vs(a,(g,v,w,M)=>{var C,P;h(),g?t(g):v&&(C=v,P=(C,P)=>{null!=C?t(C):null!=P&&t(null,P,{cacheControl:w,expires:M})},"function"==typeof createImageBitmap?function(O,F){let B=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(B).then(j=>{F(null,j)}).catch(j=>{F(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(C,P):function(O,F){let B=new Image;B.onload=()=>{F(null,B),URL.revokeObjectURL(B.src),B.onload=null,window.requestAnimationFrame(()=>{B.src=Nt})},B.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let j=new Blob([new Uint8Array(O)],{type:"image/png"});B.src=O.byteLength?URL.createObjectURL(j):Nt}(C,P))});return{cancel:()=>{f.cancel(),h()}}};function ra(a,t,l){l[a]&&-1!==l[a].indexOf(t)||(l[a]=l[a]||[],l[a].push(t))}function Or(a,t,l){if(l&&l[a]){let h=l[a].indexOf(t);-1!==h&&l[a].splice(h,1)}}class Nr{constructor(t,l={}){re(this,l),this.type=t}}class xs extends Nr{constructor(t,l={}){super("error",re({error:t},l))}}class Rr{on(t,l){return this._listeners=this._listeners||{},ra(t,l,this._listeners),this}off(t,l){return Or(t,l,this._listeners),Or(t,l,this._oneTimeListeners),this}once(t,l){return this._oneTimeListeners=this._oneTimeListeners||{},ra(t,l,this._oneTimeListeners),this}fire(t,l){"string"==typeof t&&(t=new Nr(t,l||{}));let h=t.type;if(this.listens(h)){t.target=this;let f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(let w of f)w.call(this,t);let g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(let w of g)Or(h,w,this._oneTimeListeners),w.call(this,t);let v=this._eventedParent;v&&(re(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof xs&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,l){return this._eventedParent=t,this._eventedParentData=l,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Pe{constructor(t,l,h,f){this.message=(t?`${t}: `:"")+h,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Bo(a){let t=a.value;return t?[new Pe(a.key,t,"constants have been deprecated as of v8")]:[]}function tr(a,...t){for(let l of t)for(let h in l)a[h]=l[h];return a}function Rt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function qi(a){if(Array.isArray(a))return a.map(qi);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){let t={};for(let l in a)t[l]=qi(a[l]);return t}return Rt(a)}class Oi extends Error{constructor(t,l){super(l),this.message=l,this.key=t}}class Ni{constructor(t,l=[]){this.parent=t,this.bindings={};for(let[h,f]of l)this.bindings[h]=f}concat(t){return new Ni(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let mo={kind:"null"},Ce={kind:"number"},_t={kind:"string"},mt={kind:"boolean"},ii={kind:"color"},go={kind:"object"},ht={kind:"value"},Fr={kind:"collator"},qn={kind:"formatted"},bs={kind:"padding"},Nn={kind:"resolvedImage"};function yi(a,t){return{kind:"array",itemType:a,N:t}}function Kt(a){if("array"===a.kind){let t=Kt(a.itemType);return"number"==typeof a.N?`array<${t}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${t}>`}return a.kind}let ws=[mo,Ce,_t,mt,ii,qn,go,yi(ht),bs,Nn];function xr(a,t){if("error"===t.kind)return null;if("array"===a.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!xr(a.itemType,t.itemType))&&("number"!=typeof a.N||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if("value"===a.kind)for(let l of ws)if(!xr(l,t))return null}return`Expected ${Kt(a)} but found ${Kt(t)} instead.`}function jo(a,t){return t.some(l=>l.kind===a.kind)}function Uo(a,t){return t.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var Ms,Vo={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function $(a){return(a=Math.round(a))<0?0:a>255?255:a}function T(a){return $("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function N(a){return(t="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:t>1?1:t;var t}function U(a,t,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(t-a)*l*6:2*l<1?t:3*l<2?a+(t-a)*(2/3-l)*6:a}try{Ms={}.parseCSSColor=function(a){var t,l=a.replace(/ /g,"").toLowerCase();if(l in Vo)return Vo[l].slice();if("#"===l[0])return 4===l.length?(t=parseInt(l.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===l.length&&(t=parseInt(l.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var h=l.indexOf("("),f=l.indexOf(")");if(-1!==h&&f+1===l.length){var g=l.substr(0,h),v=l.substr(h+1,f-(h+1)).split(","),w=1;switch(g){case"rgba":if(4!==v.length)return null;w=N(v.pop());case"rgb":return 3!==v.length?null:[T(v[0]),T(v[1]),T(v[2]),w];case"hsla":if(4!==v.length)return null;w=N(v.pop());case"hsl":if(3!==v.length)return null;var M=(parseFloat(v[0])%360+360)%360/360,C=N(v[1]),P=N(v[2]),O=P<=.5?P*(C+1):P+C-P*C,F=2*P-O;return[$(255*U(F,O,M+1/3)),$(255*U(F,O,M)),$(255*U(F,O,M-1/3)),w];default:return null}}return null}}catch{}class V{constructor(t,l,h,f=1){this.r=t,this.g=l,this.b=h,this.a=f}static parse(t){if(!t)return;if(t instanceof V)return t;if("string"!=typeof t)return;let l=Ms(t);return l?new V(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){let[t,l,h,f]=this.toArray();return`rgba(${Math.round(t)},${Math.round(l)},${Math.round(h)},${f})`}toArray(){let{r:t,g:l,b:h,a:f}=this;return 0===f?[0,0,0,0]:[255*t/f,255*l/f,255*h/f,f]}}V.black=new V(0,0,0,1),V.white=new V(1,1,1,1),V.transparent=new V(0,0,0,0),V.red=new V(1,0,0,1);class Q{constructor(t,l,h){this.sensitivity=t?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,l){return this.collator.compare(t,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class te{constructor(t,l,h,f,g){this.text=t,this.image=l,this.scale=h,this.fontStack=f,this.textColor=g}}class J{constructor(t){this.sections=t}static fromString(t){return new J([new te(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof J?t:J.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}}class X{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof X)return t;if("number"==typeof t)return new X([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let l of t)if("number"!=typeof l)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new X(t)}}toString(){return JSON.stringify(this.values)}}class ne{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ne({name:t,available:!1}):null}}function fe(a,t,l,h){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[a,t,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[a,t,l,h]:[a,t,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function we(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof V||a instanceof Q||a instanceof J||a instanceof X||a instanceof ne)return!0;if(Array.isArray(a)){for(let t of a)if(!we(t))return!1;return!0}if("object"==typeof a){for(let t in a)if(!we(a[t]))return!1;return!0}return!1}function pe(a){if(null===a)return mo;if("string"==typeof a)return _t;if("boolean"==typeof a)return mt;if("number"==typeof a)return Ce;if(a instanceof V)return ii;if(a instanceof Q)return Fr;if(a instanceof J)return qn;if(a instanceof X)return bs;if(a instanceof ne)return Nn;if(Array.isArray(a)){let l,t=a.length;for(let h of a){let f=pe(h);if(l){if(l===f)continue;l=ht;break}l=f}return yi(l||ht,t)}return go}function Ze(a){let t=typeof a;return null===a?"":"string"===t||"number"===t||"boolean"===t?String(a):a instanceof V||a instanceof J||a instanceof X||a instanceof ne?a.toString():JSON.stringify(a)}class We{constructor(t,l){this.type=t,this.value=l}static parse(t,l){if(2!==t.length)return l.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!we(t[1]))return l.error("invalid value");let h=t[1],f=pe(h),g=l.expectedType;return"array"!==f.kind||0!==f.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(f=g),new We(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Fe{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let nt={string:_t,number:Ce,boolean:mt,object:go};class lt{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let h,f=1,g=t[0];if("array"===g){let w,M;if(t.length>2){let C=t[1];if("string"!=typeof C||!(C in nt)||"object"===C)return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=nt[C],f++}else w=ht;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=t[2],f++}h=yi(w,M)}else{if(!nt[g])throw new Error(`Types doesn't contain name = ${g}`);h=nt[g]}let v=[];for(;f<t.length;f++){let w=l.parse(t[f],f,ht);if(!w)return null;v.push(w)}return new lt(h,v)}evaluate(t){for(let l=0;l<this.args.length;l++){let h=this.args[l].evaluate(t);if(!xr(this.type,pe(h)))return h;if(l===this.args.length-1)throw new Fe(`Expected value to be of type ${Kt(this.type)}, but found ${Kt(pe(h))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let Ft={"to-boolean":mt,"to-color":ii,"to-number":Ce,"to-string":_t};class ut{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let h=t[0];if(!Ft[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if(("to-boolean"===h||"to-string"===h)&&2!==t.length)return l.error("Expected one argument.");let f=Ft[h],g=[];for(let v=1;v<t.length;v++){let w=l.parse(t[v],v,ht);if(!w)return null;g.push(w)}return new ut(f,g)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let l,h;for(let f of this.args){if(l=f.evaluate(t),h=null,l instanceof V)return l;if("string"==typeof l){let g=t.parseColor(l);if(g)return g}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:fe(l[0],l[1],l[2],l[3]),!h))return new V(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Fe(h||`Could not parse color from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}if("padding"===this.type.kind){let l;for(let h of this.args){l=h.evaluate(t);let f=X.parse(l);if(f)return f}throw new Fe(`Could not parse padding from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}if("number"===this.type.kind){let l=null;for(let h of this.args){if(l=h.evaluate(t),null===l)return 0;let f=Number(l);if(!isNaN(f))return f}throw new Fe(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?J.fromString(Ze(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ne.fromString(Ze(this.args[0].evaluate(t))):Ze(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let vt=["Unknown","Point","LineString","Polygon"];class zt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?vt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let l=this._parseColorCache[t];return l||(l=this._parseColorCache[t]=V.parse(t)),l}}class rn{constructor(t,l,h,f){this.name=t,this.type=l,this._evaluate=h,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,l){let h=t[0],f=rn.definitions[h];if(!f)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);let g=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=v.filter(([C])=>!Array.isArray(C)||C.length===t.length-1),M=null;for(let[C,P]of w){M=new Ds(l.registry,l.path,null,l.scope);let O=[],F=!1;for(let B=1;B<t.length;B++){let j=t[B],K=Array.isArray(C)?C[B-1]:C.type,Y=M.parse(j,1+O.length,K);if(!Y){F=!0;break}O.push(Y)}if(!F)if(Array.isArray(C)&&C.length!==O.length)M.error(`Expected ${C.length} arguments, but found ${O.length} instead.`);else{for(let B=0;B<O.length;B++){let j=Array.isArray(C)?C[B]:C.type,K=O[B];M.concat(B+1).checkSubtype(j,K.type)}if(0===M.errors.length)return new rn(h,g,P,O)}}if(1===w.length)l.errors.push(...M.errors);else{let C=(w.length?w:v).map(([O])=>{return F=O,Array.isArray(F)?`(${F.map(Kt).join(", ")})`:`(${Kt(F.type)}...)`;var F}).join(" | "),P=[];for(let O=1;O<t.length;O++){let F=l.parse(t[O],1+P.length);if(!F)return null;P.push(Kt(F.type))}l.error(`Expected arguments of type ${C}, but found (${P.join(", ")}) instead.`)}return null}static register(t,l){rn.definitions=l;for(let h in l)t[h]=rn}}class Wn{constructor(t,l,h){this.type=Fr,this.locale=h,this.caseSensitive=t,this.diacriticSensitive=l}static parse(t,l){if(2!==t.length)return l.error("Expected one argument.");let h=t[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");let f=l.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,mt);if(!f)return null;let g=l.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,mt);if(!g)return null;let v=null;return h.locale&&(v=l.parse(h.locale,1,_t),!v)?null:new Wn(f,g,v)}evaluate(t){return new Q(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}let mn=8192;function ai(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function Es(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function oa(a,t){let l=(180+a[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(l*f*mn),Math.round(h*f*mn)]}function on(a,t,l){let h=a[0]-t[0],f=a[1]-t[1],g=a[0]-l[0],v=a[1]-l[1];return h*v-g*f==0&&h*g<=0&&f*v<=0}function kc(a,t){let l=!1;for(let v=0,w=t.length;v<w;v++){let M=t[v];for(let C=0,P=M.length;C<P-1;C++){if(on(a,M[C],M[C+1]))return!1;(f=M[C])[1]>(h=a)[1]!=(g=M[C+1])[1]>h[1]&&h[0]<(g[0]-f[0])*(h[1]-f[1])/(g[1]-f[1])+f[0]&&(l=!l)}}var h,f,g;return l}function Lc(a,t){for(let l=0;l<t.length;l++)if(kc(a,t[l]))return!0;return!1}function bh(a,t,l,h){let f=h[0]-l[0],g=h[1]-l[1],v=(a[0]-l[0])*g-f*(a[1]-l[1]),w=(t[0]-l[0])*g-f*(t[1]-l[1]);return v>0&&w<0||v<0&&w>0}function wh(a,t,l){for(let C of l)for(let P=0;P<C.length-1;++P)if((w=[(v=C[P+1])[0]-(g=C[P])[0],v[1]-g[1]])[0]*(M=[(f=t)[0]-(h=a)[0],f[1]-h[1]])[1]-w[1]*M[0]!=0&&bh(h,f,g,v)&&bh(g,v,h,f))return!0;var h,f,g,v,w,M;return!1}function Oc(a,t){for(let l=0;l<a.length;++l)if(!kc(a[l],t))return!1;for(let l=0;l<a.length-1;++l)if(wh(a[l],a[l+1],t))return!1;return!0}function rm(a,t){for(let l=0;l<t.length;l++)if(Oc(a,t[l]))return!0;return!1}function ll(a,t,l){let h=[];for(let f=0;f<a.length;f++){let g=[];for(let v=0;v<a[f].length;v++){let w=oa(a[f][v],l);ai(t,w),g.push(w)}h.push(g)}return h}function Nc(a,t,l){let h=[];for(let f=0;f<a.length;f++){let g=ll(a[f],t,l);h.push(g)}return h}function Mh(a,t,l,h){if(a[0]<l[0]||a[0]>l[2]){let f=.5*h,g=a[0]-l[0]>f?-h:l[0]-a[0]>f?h:0;0===g&&(g=a[0]-l[2]>f?-h:l[2]-a[0]>f?h:0),a[0]+=g}ai(t,a)}function Eh(a,t,l,h){let f=Math.pow(2,h.z)*mn,g=[h.x*mn,h.y*mn],v=[];for(let w of a)for(let M of w){let C=[M.x+g[0],M.y+g[1]];Mh(C,t,l,f),v.push(C)}return v}function Ih(a,t,l,h){let f=Math.pow(2,h.z)*mn,g=[h.x*mn,h.y*mn],v=[];for(let M of a){let C=[];for(let P of M){let O=[P.x+g[0],P.y+g[1]];ai(t,O),C.push(O)}v.push(C)}if(t[2]-t[0]<=f/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(let M of v)for(let C of M)Mh(C,t,l,f)}var w;return v}class $o{constructor(t,l){this.type=mt,this.geojson=t,this.geometries=l}static parse(t,l){if(2!==t.length)return l.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(we(t[1])){let h=t[1];if("FeatureCollection"===h.type)for(let f=0;f<h.features.length;++f){let g=h.features[f].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new $o(h,h.features[f].geometry)}else if("Feature"===h.type){let f=h.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new $o(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new $o(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(l,h){let f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if("Polygon"===h.type){let w=ll(h.coordinates,g,v),M=Eh(l.geometry(),f,g,v);if(!Es(f,g))return!1;for(let C of M)if(!kc(C,w))return!1}if("MultiPolygon"===h.type){let w=Nc(h.coordinates,g,v),M=Eh(l.geometry(),f,g,v);if(!Es(f,g))return!1;for(let C of M)if(!Lc(C,w))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(l,h){let f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if("Polygon"===h.type){let w=ll(h.coordinates,g,v),M=Ih(l.geometry(),f,g,v);if(!Es(f,g))return!1;for(let C of M)if(!Oc(C,w))return!1}if("MultiPolygon"===h.type){let w=Nc(h.coordinates,g,v),M=Ih(l.geometry(),f,g,v);if(!Es(f,g))return!1;for(let C of M)if(!rm(C,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function sa(a){if(a instanceof rn&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof $o)return!1;let t=!0;return a.eachChild(l=>{t&&!sa(l)&&(t=!1)}),t}function Is(a){if(a instanceof rn&&"feature-state"===a.name)return!1;let t=!0;return a.eachChild(l=>{t&&!Is(l)&&(t=!1)}),t}function cl(a,t){if(a instanceof rn&&t.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(h=>{l&&!cl(h,t)&&(l=!1)}),l}class ul{constructor(t,l){this.type=l.type,this.name=t,this.boundExpression=l}static parse(t,l){if(2!==t.length||"string"!=typeof t[1])return l.error("'var' expression requires exactly one string literal argument.");let h=t[1];return l.scope.has(h)?new ul(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ds{constructor(t,l=[],h,f=new Ni,g=[]){this.registry=t,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=f,this.errors=g,this.expectedType=h}parse(t,l,h,f,g={}){return l?this.concat(l,h,f)._parse(t,g):this._parse(t,g)}_parse(t,l){function h(f,g,v){return"assert"===v?new lt(g,[f]):"coerce"===v?new ut(g,[f]):f}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let f=t[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let g=this.registry[f];if(g){let v=g.parse(t,this);if(!v)return null;if(this.expectedType){let w=this.expectedType,M=v.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==M.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==M.kind&&"string"!==M.kind)if("padding"!==w.kind||"value"!==M.kind&&"number"!==M.kind&&"array"!==M.kind){if(this.checkSubtype(w,M))return null}else v=h(v,w,l.typeAnnotation||"coerce");else v=h(v,w,l.typeAnnotation||"coerce");else v=h(v,w,l.typeAnnotation||"assert")}if(!(v instanceof We)&&"resolvedImage"!==v.type.kind&&Rc(v)){let w=new zt;try{v=new We(v.type,v.evaluate(w))}catch(M){return this.error(M.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,l,h){let f="number"==typeof t?this.path.concat(t):this.path,g=h?this.scope.concat(h):this.scope;return new Ds(this.registry,f,l||null,g,this.errors)}error(t,...l){let h=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new Oi(h,t))}checkSubtype(t,l){let h=xr(t,l);return h&&this.error(h),h}}function Rc(a){if(a instanceof ul)return Rc(a.boundExpression);if(a instanceof rn&&"error"===a.name||a instanceof Wn||a instanceof $o)return!1;let t=a instanceof ut||a instanceof lt,l=!0;return a.eachChild(h=>{l=t?l&&Rc(h):l&&h instanceof We}),!!l&&sa(a)&&cl(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function hl(a,t){let h,f,l=a.length-1,g=0,v=l,w=0;for(;g<=v;)if(w=Math.floor((g+v)/2),h=a[w],f=a[w+1],h<=t){if(w===l||t<f)return w;g=w+1}else{if(!(h>t))throw new Fe("Input is not a number.");v=w-1}return 0}class aa{constructor(t,l,h){this.type=t,this.input=l,this.labels=[],this.outputs=[];for(let[f,g]of h)this.labels.push(f),this.outputs.push(g)}static parse(t,l){if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");let h=l.parse(t[1],1,Ce);if(!h)return null;let f=[],g=null;l.expectedType&&"value"!==l.expectedType.kind&&(g=l.expectedType);for(let v=1;v<t.length;v+=2){let w=1===v?-1/0:t[v],M=t[v+1],C=v,P=v+1;if("number"!=typeof w)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(f.length&&f[f.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);let O=l.parse(M,P,g);if(!O)return null;g=g||O.type,f.push([w,O])}return new aa(g,h,f)}evaluate(t){let l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(t);let f=this.input.evaluate(t);if(f<=l[0])return h[0].evaluate(t);let g=l.length;return f>=l[g-1]?h[g-1].evaluate(t):h[hl(l,f)].evaluate(t)}eachChild(t){t(this.input);for(let l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function gn(a,t,l){return a*(1-l)+t*l}var la=Object.freeze({__proto__:null,number:gn,color:function(a,t,l){return new V(gn(a.r,t.r,l),gn(a.g,t.g,l),gn(a.b,t.b,l),gn(a.a,t.a,l))},array:function(a,t,l){return a.map((h,f)=>gn(h,t[f],l))},padding:function(a,t,l){let h=a.values,f=t.values;return new X([gn(h[0],f[0],l),gn(h[1],f[1],l),gn(h[2],f[2],l),gn(h[3],f[3],l)])}});let Fc=4/29,dl=6/29,Sh=3*dl*dl,om=Math.PI/180,sm=180/Math.PI;function zc(a){return a>.008856451679035631?Math.pow(a,1/3):a/Sh+Fc}function Bc(a){return a>dl?a*a*a:Sh*(a-Fc)}function jc(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Uc(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ut(a){let t=Uc(a.r),l=Uc(a.g),h=Uc(a.b),f=zc((.4124564*t+.3575761*l+.1804375*h)/.95047),g=zc((.2126729*t+.7151522*l+.072175*h)/1);return{l:116*g-16,a:500*(f-g),b:200*(g-zc((.0193339*t+.119192*l+.9503041*h)/1.08883)),alpha:a.a}}function Th(a){let t=(a.l+16)/116,l=isNaN(a.a)?t:t+a.a/500,h=isNaN(a.b)?t:t-a.b/200;return t=1*Bc(t),l=.95047*Bc(l),h=1.08883*Bc(h),new V(jc(3.2404542*l-1.5371385*t-.4985314*h),jc(-.969266*l+1.8760108*t+.041556*h),jc(.0556434*l-.2040259*t+1.0572252*h),a.alpha)}function am(a,t,l){let h=t-a;return a+l*(h>180||h<-180?h-360*Math.round(h/360):h)}let ca={forward:Ut,reverse:Th,interpolate:function(a,t,l){return{l:gn(a.l,t.l,l),a:gn(a.a,t.a,l),b:gn(a.b,t.b,l),alpha:gn(a.alpha,t.alpha,l)}}},ua={forward:function(a){let{l:t,a:l,b:h}=Ut(a),f=Math.atan2(h,l)*sm;return{h:f<0?f+360:f,c:Math.sqrt(l*l+h*h),l:t,alpha:a.a}},reverse:function(a){let t=a.h*om,l=a.c;return Th({l:a.l,a:Math.cos(t)*l,b:Math.sin(t)*l,alpha:a.alpha})},interpolate:function(a,t,l){return{h:am(a.h,t.h,l),c:gn(a.c,t.c,l),l:gn(a.l,t.l,l),alpha:gn(a.alpha,t.alpha,l)}}};var Ah=Object.freeze({__proto__:null,lab:ca,hcl:ua});class Ri{constructor(t,l,h,f,g){this.type=t,this.operator=l,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(let[v,w]of g)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(t,l,h,f){let g=0;if("exponential"===t.name)g=Vc(l,t.base,h,f);else if("linear"===t.name)g=Vc(l,1,h,f);else if("cubic-bezier"===t.name){let v=t.controlPoints;g=new y(v[0],v[1],v[2],v[3]).solve(Vc(l,1,h,f))}return g}static parse(t,l){let[h,f,g,...v]=t;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){let C=f[1];if("number"!=typeof C)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:C}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{let C=f.slice(1);if(4!==C.length||C.some(P=>"number"!=typeof P||P<0||P>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(g=l.parse(g,2,Ce),!g)return null;let w=[],M=null;"interpolate-hcl"===h||"interpolate-lab"===h?M=ii:l.expectedType&&"value"!==l.expectedType.kind&&(M=l.expectedType);for(let C=0;C<v.length;C+=2){let P=v[C],O=v[C+1],F=C+3,B=C+4;if("number"!=typeof P)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=P)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);let j=l.parse(O,B,M);if(!j)return null;M=M||j.type,w.push([P,j])}return"number"===M.kind||"color"===M.kind||"padding"===M.kind||"array"===M.kind&&"number"===M.itemType.kind&&"number"==typeof M.N?new Ri(M,h,f,g,w):l.error(`Type ${Kt(M)} is not interpolatable.`)}evaluate(t){let l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(t);let f=this.input.evaluate(t);if(f<=l[0])return h[0].evaluate(t);let g=l.length;if(f>=l[g-1])return h[g-1].evaluate(t);let v=hl(l,f),w=Ri.interpolationFactor(this.interpolation,f,l[v],l[v+1]),M=h[v].evaluate(t),C=h[v+1].evaluate(t);return"interpolate"===this.operator?la[this.type.kind.toLowerCase()](M,C,w):"interpolate-hcl"===this.operator?ua.reverse(ua.interpolate(ua.forward(M),ua.forward(C),w)):ca.reverse(ca.interpolate(ca.forward(M),ca.forward(C),w))}eachChild(t){t(this.input);for(let l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Vc(a,t,l,h){let f=h-l,g=a-l;return 0===f?0:1===t?g/f:(Math.pow(t,g)-1)/(Math.pow(t,f)-1)}class pl{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expectected at least one argument.");let h=null,f=l.expectedType;f&&"value"!==f.kind&&(h=f);let g=[];for(let w of t.slice(1)){let M=l.parse(w,1+g.length,h,void 0,{typeAnnotation:"omit"});if(!M)return null;h=h||M.type,g.push(M)}if(!h)throw new Error("No output type");let v=f&&g.some(w=>xr(f,w.type));return new pl(v?ht:h,g)}evaluate(t){let l,h=null,f=0;for(let g of this.args)if(f++,h=g.evaluate(t),h&&h instanceof ne&&!h.available&&(l||(l=h.name),h=null,f===this.args.length&&(h=l)),null!==h)break;return h}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class fl{constructor(t,l){this.type=l.type,this.bindings=[].concat(t),this.result=l}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let l of this.bindings)t(l[1]);t(this.result)}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let h=[];for(let g=1;g<t.length-1;g+=2){let v=t[g];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",g);let w=l.parse(t[g+1],g+1);if(!w)return null;h.push([v,w])}let f=l.parse(t[t.length-1],t.length-1,l.expectedType,h);return f?new fl(h,f):null}outputDefined(){return this.result.outputDefined()}}class $c{constructor(t,l,h){this.type=t,this.index=l,this.input=h}static parse(t,l){if(3!==t.length)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let h=l.parse(t[1],1,Ce),f=l.parse(t[2],2,yi(l.expectedType||ht));return h&&f?new $c(f.type.itemType,h,f):null}evaluate(t){let l=this.index.evaluate(t),h=this.input.evaluate(t);if(l<0)throw new Fe(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Fe(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Fe(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Hc{constructor(t,l){this.type=mt,this.needle=t,this.haystack=l}static parse(t,l){if(3!==t.length)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let h=l.parse(t[1],1,ht),f=l.parse(t[2],2,ht);return h&&f?jo(h.type,[mt,_t,Ce,mo,ht])?new Hc(h,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(h.type)} instead`):null}evaluate(t){let l=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!h)return!1;if(!Uo(l,["boolean","string","number","null"]))throw new Fe(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(pe(l))} instead.`);if(!Uo(h,["string","array"]))throw new Fe(`Expected second argument to be of type array or string, but found ${Kt(pe(h))} instead.`);return h.indexOf(l)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ml{constructor(t,l,h){this.type=Ce,this.needle=t,this.haystack=l,this.fromIndex=h}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let h=l.parse(t[1],1,ht),f=l.parse(t[2],2,ht);if(!h||!f)return null;if(!jo(h.type,[mt,_t,Ce,mo,ht]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(h.type)} instead`);if(4===t.length){let g=l.parse(t[3],3,Ce);return g?new ml(h,f,g):null}return new ml(h,f)}evaluate(t){let l=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!Uo(l,["boolean","string","number","null"]))throw new Fe(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(pe(l))} instead.`);if(!Uo(h,["string","array"]))throw new Fe(`Expected second argument to be of type array or string, but found ${Kt(pe(h))} instead.`);if(this.fromIndex){let f=this.fromIndex.evaluate(t);return h.indexOf(l,f)}return h.indexOf(l)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Gc{constructor(t,l,h,f,g,v){this.inputType=t,this.type=l,this.input=h,this.cases=f,this.outputs=g,this.otherwise=v}static parse(t,l){if(t.length<5)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return l.error("Expected an even number of arguments.");let h,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);let g={},v=[];for(let C=2;C<t.length-1;C+=2){let P=t[C],O=t[C+1];Array.isArray(P)||(P=[P]);let F=l.concat(C);if(0===P.length)return F.error("Expected at least one branch label.");for(let j of P){if("number"!=typeof j&&"string"!=typeof j)return F.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return F.error("Numeric branch labels must be integer values.");if(h){if(F.checkSubtype(h,pe(j)))return null}else h=pe(j);if(void 0!==g[String(j)])return F.error("Branch labels must be unique.");g[String(j)]=v.length}let B=l.parse(O,C,f);if(!B)return null;f=f||B.type,v.push(B)}let w=l.parse(t[1],1,ht);if(!w)return null;let M=l.parse(t[t.length-1],t.length-1,f);return M?"value"!==w.type.kind&&l.concat(1).checkSubtype(h,w.type)?null:new Gc(h,f,w,g,v,M):null}evaluate(t){let l=this.input.evaluate(t);return(pe(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Zc{constructor(t,l,h){this.type=t,this.branches=l,this.otherwise=h}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);let f=[];for(let v=1;v<t.length-1;v+=2){let w=l.parse(t[v],v,mt);if(!w)return null;let M=l.parse(t[v+1],v+1,h);if(!M)return null;f.push([w,M]),h=h||M.type}let g=l.parse(t[t.length-1],t.length-1,h);if(!g)return null;if(!h)throw new Error("Can't infer output type");return new Zc(h,f,g)}evaluate(t){for(let[l,h]of this.branches)if(l.evaluate(t))return h.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[l,h]of this.branches)t(l),t(h);t(this.otherwise)}outputDefined(){return this.branches.every(([t,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class gl{constructor(t,l,h,f){this.type=t,this.input=l,this.beginIndex=h,this.endIndex=f}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let h=l.parse(t[1],1,ht),f=l.parse(t[2],2,Ce);if(!h||!f)return null;if(!jo(h.type,[yi(ht),_t,ht]))return l.error(`Expected first argument to be of type array or string, but found ${Kt(h.type)} instead`);if(4===t.length){let g=l.parse(t[3],3,Ce);return g?new gl(h.type,h,f,g):null}return new gl(h.type,h,f)}evaluate(t){let l=this.input.evaluate(t),h=this.beginIndex.evaluate(t);if(!Uo(l,["string","array"]))throw new Fe(`Expected first argument to be of type array or string, but found ${Kt(pe(l))} instead.`);if(this.endIndex){let f=this.endIndex.evaluate(t);return l.slice(h,f)}return l.slice(h)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ph(a,t){return"=="===a||"!="===a?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function kh(a,t,l,h){return 0===h.compare(t,l)}function Cs(a,t,l){let h="=="!==a&&"!="!==a;return class fE{constructor(g,v,w){this.type=mt,this.lhs=g,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===v.type.kind}static parse(g,v){if(3!==g.length&&4!==g.length)return v.error("Expected two or three arguments.");let w=g[0],M=v.parse(g[1],1,ht);if(!M)return null;if(!Ph(w,M.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${Kt(M.type)}'.`);let C=v.parse(g[2],2,ht);if(!C)return null;if(!Ph(w,C.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${Kt(C.type)}'.`);if(M.type.kind!==C.type.kind&&"value"!==M.type.kind&&"value"!==C.type.kind)return v.error(`Cannot compare types '${Kt(M.type)}' and '${Kt(C.type)}'.`);h&&("value"===M.type.kind&&"value"!==C.type.kind?M=new lt(C.type,[M]):"value"!==M.type.kind&&"value"===C.type.kind&&(C=new lt(M.type,[C])));let P=null;if(4===g.length){if("string"!==M.type.kind&&"string"!==C.type.kind&&"value"!==M.type.kind&&"value"!==C.type.kind)return v.error("Cannot use collator to compare non-string types.");if(P=v.parse(g[3],3,Fr),!P)return null}return new fE(M,C,P)}evaluate(g){let v=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(h&&this.hasUntypedArgument){let M=pe(v),C=pe(w);if(M.kind!==C.kind||"string"!==M.kind&&"number"!==M.kind)throw new Fe(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${M.kind}, ${C.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){let M=pe(v),C=pe(w);if("string"!==M.kind||"string"!==C.kind)return t(g,v,w)}return this.collator?l(g,v,w,this.collator.evaluate(g)):t(g,v,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}let lm=Cs("==",function(a,t,l){return t===l},kh),cm=Cs("!=",function(a,t,l){return t!==l},function(a,t,l,h){return!kh(0,t,l,h)}),um=Cs("<",function(a,t,l){return t<l},function(a,t,l,h){return h.compare(t,l)<0}),hm=Cs(">",function(a,t,l){return t>l},function(a,t,l,h){return h.compare(t,l)>0}),dm=Cs("<=",function(a,t,l){return t<=l},function(a,t,l,h){return h.compare(t,l)<=0}),pm=Cs(">=",function(a,t,l){return t>=l},function(a,t,l,h){return h.compare(t,l)>=0});class qc{constructor(t,l,h,f,g){this.type=_t,this.number=t,this.locale=l,this.currency=h,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(t,l){if(3!==t.length)return l.error("Expected two arguments.");let h=l.parse(t[1],1,Ce);if(!h)return null;let f=t[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=l.parse(f.locale,1,_t),!g))return null;let v=null;if(f.currency&&(v=l.parse(f.currency,1,_t),!v))return null;let w=null;if(f["min-fraction-digits"]&&(w=l.parse(f["min-fraction-digits"],1,Ce),!w))return null;let M=null;return f["max-fraction-digits"]&&(M=l.parse(f["max-fraction-digits"],1,Ce),!M)?null:new qc(h,g,v,w,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class yl{constructor(t){this.type=qn,this.sections=t}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let h=t[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");let f=[],g=!1;for(let v=1;v<=t.length-1;++v){let w=t[v];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let M=null;if(w["font-scale"]&&(M=l.parse(w["font-scale"],1,Ce),!M))return null;let C=null;if(w["text-font"]&&(C=l.parse(w["text-font"],1,yi(_t)),!C))return null;let P=null;if(w["text-color"]&&(P=l.parse(w["text-color"],1,ii),!P))return null;let O=f[f.length-1];O.scale=M,O.font=C,O.textColor=P}else{let M=l.parse(t[v],1,ht);if(!M)return null;let C=M.type.kind;if("string"!==C&&"value"!==C&&"null"!==C&&"resolvedImage"!==C)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:M,scale:null,font:null,textColor:null})}}return new yl(f)}evaluate(t){return new J(this.sections.map(l=>{let h=l.content.evaluate(t);return pe(h)===Nn?new te("",h,null,null,null):new te(Ze(h),null,l.scale?l.scale.evaluate(t):null,l.font?l.font.evaluate(t).join(","):null,l.textColor?l.textColor.evaluate(t):null)}))}eachChild(t){for(let l of this.sections)t(l.content),l.scale&&t(l.scale),l.font&&t(l.font),l.textColor&&t(l.textColor)}outputDefined(){return!1}}class Wc{constructor(t){this.type=Nn,this.input=t}static parse(t,l){if(2!==t.length)return l.error("Expected two arguments.");let h=l.parse(t[1],1,_t);return h?new Wc(h):l.error("No image name provided.")}evaluate(t){let l=this.input.evaluate(t),h=ne.fromString(l);return h&&t.availableImages&&(h.available=t.availableImages.indexOf(l)>-1),h}eachChild(t){t(this.input)}outputDefined(){return!1}}class Yc{constructor(t){this.type=Ce,this.input=t}static parse(t,l){if(2!==t.length)return l.error(`Expected 1 argument, but found ${t.length-1} instead.`);let h=l.parse(t[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${Kt(h.type)} instead.`):new Yc(h):null}evaluate(t){let l=this.input.evaluate(t);if("string"==typeof l||Array.isArray(l))return l.length;throw new Fe(`Expected value to be of type string or array, but found ${Kt(pe(l))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Ss={"==":lm,"!=":cm,">":hm,"<":um,">=":pm,"<=":dm,array:lt,at:$c,boolean:lt,case:Zc,coalesce:pl,collator:Wn,format:yl,image:Wc,in:Hc,"index-of":ml,interpolate:Ri,"interpolate-hcl":Ri,"interpolate-lab":Ri,length:Yc,let:fl,literal:We,match:Gc,number:lt,"number-format":qc,object:lt,slice:gl,step:aa,string:lt,"to-boolean":ut,"to-color":ut,"to-number":ut,"to-string":ut,var:ul,within:$o};function Lh(a,[t,l,h,f]){t=t.evaluate(a),l=l.evaluate(a),h=h.evaluate(a);let g=f?f.evaluate(a):1,v=fe(t,l,h,g);if(v)throw new Fe(v);return new V(t/255*g,l/255*g,h/255*g,g)}function Oh(a,t){return a in t}function _l(a,t){let l=t[a];return void 0===l?null:l}function Ho(a){return{type:a}}function Nh(a){return{result:"success",value:a}}function Ts(a){return{result:"error",value:a}}function dn(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function Rh(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function St(a){return!!a.expression&&a.expression.interpolated}function Vt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function cn(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function yn(a){return a}function ha(a,t){let v,w,M,l="color"===t.type,h=a.stops&&"object"==typeof a.stops[0][0],f=h||!(h||void 0!==a.property),g=a.type||(St(t)?"exponential":"interval");if(l||"padding"===t.type){let C=l?V.parse:X.parse;(a=tr({},a)).stops&&(a.stops=a.stops.map(P=>[P[0],C(P[1])])),a.default=C(a.default?a.default:t.default)}if(a.colorSpace&&"rgb"!==a.colorSpace&&!Ah[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);if("exponential"===g)v=Fh;else if("interval"===g)v=mm;else if("categorical"===g){v=fm,w=Object.create(null);for(let C of a.stops)w[C[0]]=C[1];M=typeof a.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);v=gm}if(h){let C={},P=[];for(let B=0;B<a.stops.length;B++){let j=a.stops[B],K=j[0].zoom;void 0===C[K]&&(C[K]={zoom:K,type:a.type,property:a.property,default:a.default,stops:[]},P.push(K)),C[K].stops.push([j[0].value,j[1]])}let O=[];for(let B of P)O.push([C[B].zoom,ha(C[B],t)]);let F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Ri.interpolationFactor.bind(void 0,F),zoomStops:O.map(B=>B[0]),evaluate:({zoom:B},j)=>Fh({stops:O,base:a.base},t,B).evaluate(B,j)}}if(f){let C="exponential"===g?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Ri.interpolationFactor.bind(void 0,C),zoomStops:a.stops.map(P=>P[0]),evaluate:({zoom:P})=>v(a,t,P,w,M)}}return{kind:"source",evaluate(C,P){let O=P&&P.properties?P.properties[a.property]:void 0;return void 0===O?As(a.default,t.default):v(a,t,O,w,M)}}}function As(a,t,l){return void 0!==a?a:void 0!==t?t:void 0!==l?l:void 0}function fm(a,t,l,h,f){return As(typeof l===f?h[l]:void 0,a.default,t.default)}function mm(a,t,l){if("number"!==Vt(l))return As(a.default,t.default);let h=a.stops.length;if(1===h||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[h-1][0])return a.stops[h-1][1];let f=hl(a.stops.map(g=>g[0]),l);return a.stops[f][1]}function Fh(a,t,l){let h=void 0!==a.base?a.base:1;if("number"!==Vt(l))return As(a.default,t.default);let f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];let g=hl(a.stops.map(P=>P[0]),l),v=function(P,O,F,B){let j=B-F,K=P-F;return 0===j?0:1===O?K/j:(Math.pow(O,K)-1)/(Math.pow(O,j)-1)}(l,h,a.stops[g][0],a.stops[g+1][0]),w=a.stops[g][1],M=a.stops[g+1][1],C=la[t.type]||yn;if(a.colorSpace&&"rgb"!==a.colorSpace){let P=Ah[a.colorSpace];C=(O,F)=>P.reverse(P.interpolate(P.forward(O),P.forward(F),v))}return"function"==typeof w.evaluate?{evaluate(...P){let O=w.evaluate.apply(void 0,P),F=M.evaluate.apply(void 0,P);if(void 0!==O&&void 0!==F)return C(O,F,v)}}:C(w,M,v)}function gm(a,t,l){switch(t.type){case"color":l=V.parse(l);break;case"formatted":l=J.fromString(l.toString());break;case"resolvedImage":l=ne.fromString(l.toString());break;case"padding":l=X.parse(l);break;default:Vt(l)===t.type||"enum"===t.type&&t.values[l]||(l=void 0)}return As(l,a.default,t.default)}rn.register(Ss,{error:[{kind:"error"},[_t],(a,[t])=>{throw new Fe(t.evaluate(a))}],typeof:[_t,[ht],(a,[t])=>Kt(pe(t.evaluate(a)))],"to-rgba":[yi(Ce,4),[ii],(a,[t])=>t.evaluate(a).toArray()],rgb:[ii,[Ce,Ce,Ce],Lh],rgba:[ii,[Ce,Ce,Ce,Ce],Lh],has:{type:mt,overloads:[[[_t],(a,[t])=>Oh(t.evaluate(a),a.properties())],[[_t,go],(a,[t,l])=>Oh(t.evaluate(a),l.evaluate(a))]]},get:{type:ht,overloads:[[[_t],(a,[t])=>_l(t.evaluate(a),a.properties())],[[_t,go],(a,[t,l])=>_l(t.evaluate(a),l.evaluate(a))]]},"feature-state":[ht,[_t],(a,[t])=>_l(t.evaluate(a),a.featureState||{})],properties:[go,[],a=>a.properties()],"geometry-type":[_t,[],a=>a.geometryType()],id:[ht,[],a=>a.id()],zoom:[Ce,[],a=>a.globals.zoom],"heatmap-density":[Ce,[],a=>a.globals.heatmapDensity||0],"line-progress":[Ce,[],a=>a.globals.lineProgress||0],accumulated:[ht,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Ce,Ho(Ce),(a,t)=>{let l=0;for(let h of t)l+=h.evaluate(a);return l}],"*":[Ce,Ho(Ce),(a,t)=>{let l=1;for(let h of t)l*=h.evaluate(a);return l}],"-":{type:Ce,overloads:[[[Ce,Ce],(a,[t,l])=>t.evaluate(a)-l.evaluate(a)],[[Ce],(a,[t])=>-t.evaluate(a)]]},"/":[Ce,[Ce,Ce],(a,[t,l])=>t.evaluate(a)/l.evaluate(a)],"%":[Ce,[Ce,Ce],(a,[t,l])=>t.evaluate(a)%l.evaluate(a)],ln2:[Ce,[],()=>Math.LN2],pi:[Ce,[],()=>Math.PI],e:[Ce,[],()=>Math.E],"^":[Ce,[Ce,Ce],(a,[t,l])=>Math.pow(t.evaluate(a),l.evaluate(a))],sqrt:[Ce,[Ce],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[Ce,[Ce],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[Ce,[Ce],(a,[t])=>Math.log(t.evaluate(a))],log2:[Ce,[Ce],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[Ce,[Ce],(a,[t])=>Math.sin(t.evaluate(a))],cos:[Ce,[Ce],(a,[t])=>Math.cos(t.evaluate(a))],tan:[Ce,[Ce],(a,[t])=>Math.tan(t.evaluate(a))],asin:[Ce,[Ce],(a,[t])=>Math.asin(t.evaluate(a))],acos:[Ce,[Ce],(a,[t])=>Math.acos(t.evaluate(a))],atan:[Ce,[Ce],(a,[t])=>Math.atan(t.evaluate(a))],min:[Ce,Ho(Ce),(a,t)=>Math.min(...t.map(l=>l.evaluate(a)))],max:[Ce,Ho(Ce),(a,t)=>Math.max(...t.map(l=>l.evaluate(a)))],abs:[Ce,[Ce],(a,[t])=>Math.abs(t.evaluate(a))],round:[Ce,[Ce],(a,[t])=>{let l=t.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Ce,[Ce],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[Ce,[Ce],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[mt,[_t,ht],(a,[t,l])=>a.properties()[t.value]===l.value],"filter-id-==":[mt,[ht],(a,[t])=>a.id()===t.value],"filter-type-==":[mt,[_t],(a,[t])=>a.geometryType()===t.value],"filter-<":[mt,[_t,ht],(a,[t,l])=>{let h=a.properties()[t.value],f=l.value;return typeof h==typeof f&&h<f}],"filter-id-<":[mt,[ht],(a,[t])=>{let l=a.id(),h=t.value;return typeof l==typeof h&&l<h}],"filter->":[mt,[_t,ht],(a,[t,l])=>{let h=a.properties()[t.value],f=l.value;return typeof h==typeof f&&h>f}],"filter-id->":[mt,[ht],(a,[t])=>{let l=a.id(),h=t.value;return typeof l==typeof h&&l>h}],"filter-<=":[mt,[_t,ht],(a,[t,l])=>{let h=a.properties()[t.value],f=l.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[mt,[ht],(a,[t])=>{let l=a.id(),h=t.value;return typeof l==typeof h&&l<=h}],"filter->=":[mt,[_t,ht],(a,[t,l])=>{let h=a.properties()[t.value],f=l.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[mt,[ht],(a,[t])=>{let l=a.id(),h=t.value;return typeof l==typeof h&&l>=h}],"filter-has":[mt,[ht],(a,[t])=>t.value in a.properties()],"filter-has-id":[mt,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[mt,[yi(_t)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[mt,[yi(ht)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[mt,[_t,yi(ht)],(a,[t,l])=>l.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[mt,[_t,yi(ht)],(a,[t,l])=>function(h,f,g,v){for(;g<=v;){let w=g+v>>1;if(f[w]===h)return!0;f[w]>h?v=w-1:g=w+1}return!1}(a.properties()[t.value],l.value,0,l.value.length-1)],all:{type:mt,overloads:[[[mt,mt],(a,[t,l])=>t.evaluate(a)&&l.evaluate(a)],[Ho(mt),(a,t)=>{for(let l of t)if(!l.evaluate(a))return!1;return!0}]]},any:{type:mt,overloads:[[[mt,mt],(a,[t,l])=>t.evaluate(a)||l.evaluate(a)],[Ho(mt),(a,t)=>{for(let l of t)if(l.evaluate(a))return!0;return!1}]]},"!":[mt,[mt],(a,[t])=>!t.evaluate(a)],"is-supported-script":[mt,[_t],(a,[t])=>{let l=a.globals&&a.globals.isSupportedScript;return!l||l(t.evaluate(a))}],upcase:[_t,[_t],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[_t,[_t],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[_t,Ho(ht),(a,t)=>t.map(l=>Ze(l.evaluate(a))).join("")],"resolved-locale":[_t,[Fr],(a,[t])=>t.evaluate(a).resolvedLocale()]});class vl{constructor(t,l){var h;this.expression=t,this._warningHistory={},this._evaluator=new zt,this._defaultValue=l?"color"===(h=l).type&&cn(h.default)?new V(0,0,0,0):"color"===h.type?V.parse(h.default)||null:"padding"===h.type?X.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(t,l,h,f,g,v){return this._evaluator.globals=t,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,l,h,f,g,v){this._evaluator.globals=t,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null;try{let w=this.expression.evaluate(this._evaluator);if(null==w||"number"==typeof w&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Fe(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function da(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Ss}function pa(a,t){let l=new Ds(Ss,[],t?function(f){let g={color:ii,string:_t,number:Ce,enum:_t,boolean:mt,formatted:qn,padding:bs,resolvedImage:Nn};return"array"===f.type?yi(g[f.value]||ht,f.length):g[f.type]}(t):void 0),h=l.parse(a,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return h?Nh(new vl(h,t)):Ts(l.errors)}class fa{constructor(t,l){this.kind=t,this._styleExpression=l,this.isStateDependent="constant"!==t&&!Is(l.expression)}evaluateWithoutErrorHandling(t,l,h,f,g,v){return this._styleExpression.evaluateWithoutErrorHandling(t,l,h,f,g,v)}evaluate(t,l,h,f,g,v){return this._styleExpression.evaluate(t,l,h,f,g,v)}}class Kc{constructor(t,l,h,f){this.kind=t,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==t&&!Is(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,l,h,f,g,v){return this._styleExpression.evaluateWithoutErrorHandling(t,l,h,f,g,v)}evaluate(t,l,h,f,g,v){return this._styleExpression.evaluate(t,l,h,f,g,v)}interpolationFactor(t,l,h){return this.interpolationType?Ri.interpolationFactor(this.interpolationType,t,l,h):0}}function zh(a,t){let l=pa(a,t);if("error"===l.result)return l;let h=l.value.expression,f=sa(h);if(!f&&!dn(t))return Ts([new Oi("","data expressions not supported")]);let g=cl(h,["zoom"]);if(!g&&!Rh(t))return Ts([new Oi("","zoom expressions not supported")]);let v=bl(h);return v||g?v instanceof Oi?Ts([v]):v instanceof Ri&&!St(t)?Ts([new Oi("",'"interpolate" expressions cannot be used with this property')]):Nh(v?new Kc(f?"camera":"composite",l.value,v.labels,v instanceof Ri?v.interpolation:void 0):new fa(f?"constant":"source",l.value)):Ts([new Oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xl{constructor(t,l){this._parameters=t,this._specification=l,tr(this,ha(this._parameters,this._specification))}static deserialize(t){return new xl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function bl(a){let t=null;if(a instanceof fl)t=bl(a.result);else if(a instanceof pl){for(let l of a.args)if(t=bl(l),t)break}else(a instanceof aa||a instanceof Ri)&&a.input instanceof rn&&"zoom"===a.input.name&&(t=a);return t instanceof Oi||a.eachChild(l=>{let h=bl(l);h instanceof Oi?t=h:!t&&h?t=new Oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&h&&t!==h&&(t=new Oi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function nr(a){let t=a.key,l=a.value,h=a.valueSpec||{},f=a.objectElementValidators||{},g=a.style,v=a.styleSpec,w=[],M=Vt(l);if("object"!==M)return[new Pe(t,l,`object expected, ${M} found`)];for(let C in l){let F,P=C.split(".")[0],O=h[P]||h["*"];if(f[P])F=f[P];else if(h[P])F=zi;else if(f["*"])F=f["*"];else{if(!h["*"]){w.push(new Pe(t,l[C],`unknown property "${C}"`));continue}F=zi}w=w.concat(F({key:(t&&`${t}.`)+C,value:l[C],valueSpec:O,style:g,styleSpec:v,object:l,objectKey:C},l))}for(let C in h)f[C]||h[C].required&&void 0===h[C].default&&void 0===l[C]&&w.push(new Pe(t,l,`missing required property "${C}"`));return w}function Bh(a){let t=a.value,l=a.valueSpec,h=a.style,f=a.styleSpec,g=a.key,v=a.arrayElementValidator||zi;if("array"!==Vt(t))return[new Pe(g,t,`array expected, ${Vt(t)} found`)];if(l.length&&t.length!==l.length)return[new Pe(g,t,`array length ${l.length} expected, length ${t.length} found`)];if(l["min-length"]&&t.length<l["min-length"])return[new Pe(g,t,`array length at least ${l["min-length"]} expected, length ${t.length} found`)];let w={type:l.value,values:l.values};f.$version<7&&(w.function=l.function),"object"===Vt(l.value)&&(w=l.value);let M=[];for(let C=0;C<t.length;C++)M=M.concat(v({array:t,arrayIndex:C,value:t[C],valueSpec:w,style:h,styleSpec:f,key:`${g}[${C}]`}));return M}function Qc(a){let t=a.key,l=a.value,h=a.valueSpec,f=Vt(l);return"number"===f&&l!=l&&(f="NaN"),"number"!==f?[new Pe(t,l,`number expected, ${f} found`)]:"minimum"in h&&l<h.minimum?[new Pe(t,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new Pe(t,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function jh(a){let h,f,g,t=a.valueSpec,l=Rt(a.value.type),v={},w="categorical"!==l&&void 0===a.value.property,M=!w,C="array"===Vt(a.value.stops)&&"array"===Vt(a.value.stops[0])&&"object"===Vt(a.value.stops[0][0]),P=nr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(B){if("identity"===l)return[new Pe(B.key,B.value,'identity function may not have a "stops" property')];let j=[],K=B.value;return j=j.concat(Bh({key:B.key,value:K,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:O})),"array"===Vt(K)&&0===K.length&&j.push(new Pe(B.key,K,"array must have at least one stop")),j},default:function(B){return zi({key:B.key,value:B.value,valueSpec:t,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===l&&w&&P.push(new Pe(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||P.push(new Pe(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!St(a.valueSpec)&&P.push(new Pe(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(M&&!dn(a.valueSpec)?P.push(new Pe(a.key,a.value,"property functions not supported")):w&&!Rh(a.valueSpec)&&P.push(new Pe(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!C||void 0!==a.value.property||P.push(new Pe(a.key,a.value,'"property" property is required')),P;function O(B){let j=[],K=B.value,Y=B.key;if("array"!==Vt(K))return[new Pe(Y,K,`array expected, ${Vt(K)} found`)];if(2!==K.length)return[new Pe(Y,K,`array length 2 expected, length ${K.length} found`)];if(C){if("object"!==Vt(K[0]))return[new Pe(Y,K,`object expected, ${Vt(K[0])} found`)];if(void 0===K[0].zoom)return[new Pe(Y,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new Pe(Y,K,"object stop key must have value")];if(g&&g>Rt(K[0].zoom))return[new Pe(Y,K[0].zoom,"stop zoom values must appear in ascending order")];Rt(K[0].zoom)!==g&&(g=Rt(K[0].zoom),f=void 0,v={}),j=j.concat(nr({key:`${Y}[0]`,value:K[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Qc,value:F}}))}else j=j.concat(F({key:`${Y}[0]`,value:K[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},K));return da(qi(K[1]))?j.concat([new Pe(`${Y}[1]`,K[1],"expressions are not allowed in function stops.")]):j.concat(zi({key:`${Y}[1]`,value:K[1],valueSpec:t,style:B.style,styleSpec:B.styleSpec}))}function F(B,j){let K=Vt(B.value),Y=Rt(B.value),se=null!==B.value?B.value:j;if(h){if(K!==h)return[new Pe(B.key,se,`${K} stop domain type must match previous stop domain type ${h}`)]}else h=K;if("number"!==K&&"string"!==K&&"boolean"!==K)return[new Pe(B.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==l){let de=`number expected, ${K} found`;return dn(t)&&void 0===l&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(B.key,se,de)]}return"categorical"!==l||"number"!==K||isFinite(Y)&&Math.floor(Y)===Y?"categorical"!==l&&"number"===K&&void 0!==f&&Y<f?[new Pe(B.key,se,"stop domain values must appear in ascending order")]:(f=Y,"categorical"===l&&Y in v?[new Pe(B.key,se,"stop domain values must be unique")]:(v[Y]=!0,[])):[new Pe(B.key,se,`integer expected, found ${Y}`)]}}function Go(a){let t=("property"===a.expressionContext?zh:pa)(qi(a.value),a.valueSpec);if("error"===t.result)return t.value.map(h=>new Pe(`${a.key}${h.key}`,a.value,h.message));let l=t.value.expression||t.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Pe(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!Is(l))return[new Pe(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext&&!Is(l))return[new Pe(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!cl(l,["zoom","feature-state"]))return[new Pe(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!sa(l))return[new Pe(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ma(a){let t=a.key,l=a.value,h=a.valueSpec,f=[];return Array.isArray(h.values)?-1===h.values.indexOf(Rt(l))&&f.push(new Pe(t,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(h.values).indexOf(Rt(l))&&f.push(new Pe(t,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function Ps(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(let t of a.slice(1))if(!Ps(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}let ym={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wl(a){if(null==a)return{filter:()=>!0,needGeometry:!1};Ps(a)||(a=ga(a));let t=pa(a,ym);if("error"===t.result)throw new Error(t.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,h,f)=>t.value.evaluate(l,h,{},f),needGeometry:Vh(a)}}function Uh(a,t){return a<t?-1:a>t?1:0}function Vh(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let t=1;t<a.length;t++)if(Vh(a[t]))return!0;return!1}function ga(a){if(!a)return!0;let t=a[0];return a.length<=1?"any"!==t:"=="===t?Xc(a[1],a[2],"=="):"!="===t?ks(Xc(a[1],a[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Xc(a[1],a[2],t):"any"===t?(l=a.slice(1),["any"].concat(l.map(ga))):"all"===t?["all"].concat(a.slice(1).map(ga)):"none"===t?["all"].concat(a.slice(1).map(ga).map(ks)):"in"===t?Ml(a[1],a.slice(2)):"!in"===t?ks(Ml(a[1],a.slice(2))):"has"===t?ya(a[1]):"!has"===t?ks(ya(a[1])):"within"!==t||a;var l}function Xc(a,t,l){switch(a){case"$type":return[`filter-type-${l}`,t];case"$id":return[`filter-id-${l}`,t];default:return[`filter-${l}`,a,t]}}function Ml(a,t){if(0===t.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(l=>typeof l!=typeof t[0])?["filter-in-large",a,["literal",t.sort(Uh)]]:["filter-in-small",a,["literal",t]]}}function ya(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ks(a){return["!",a]}function _a(a){return Ps(qi(a.value))?Go(tr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):$h(a)}function $h(a){let t=a.value,l=a.key;if("array"!==Vt(t))return[new Pe(l,t,`array expected, ${Vt(t)} found`)];let f,h=a.styleSpec,g=[];if(t.length<1)return[new Pe(l,t,"filter array must have at least 1 element")];switch(g=g.concat(ma({key:`${l}[0]`,value:t[0],valueSpec:h.filter_operator,style:a.style,styleSpec:a.styleSpec})),Rt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Rt(t[1])&&g.push(new Pe(l,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&g.push(new Pe(l,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=Vt(t[1]),"string"!==f&&g.push(new Pe(`${l}[1]`,t[1],`string expected, ${f} found`)));for(let v=2;v<t.length;v++)f=Vt(t[v]),"$type"===Rt(t[1])?g=g.concat(ma({key:`${l}[${v}]`,value:t[v],valueSpec:h.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&g.push(new Pe(`${l}[${v}]`,t[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)g=g.concat($h({key:`${l}[${v}]`,value:t[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=Vt(t[1]),2!==t.length?g.push(new Pe(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==f&&g.push(new Pe(`${l}[1]`,t[1],`string expected, ${f} found`));break;case"within":f=Vt(t[1]),2!==t.length?g.push(new Pe(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==f&&g.push(new Pe(`${l}[1]`,t[1],`object expected, ${f} found`))}return g}function va(a,t){let l=a.key,h=a.style,f=a.styleSpec,g=a.value,v=a.objectKey,w=f[`${t}_${a.layerType}`];if(!w)return[];let M=v.match(/^(.*)-transition$/);if("paint"===t&&M&&w[M[1]]&&w[M[1]].transition)return zi({key:l,value:g,valueSpec:f.transition,style:h,styleSpec:f});let P,C=a.valueSpec||w[v];if(!C)return[new Pe(l,g,`unknown property "${v}"`)];if("string"===Vt(g)&&dn(C)&&!C.tokens&&(P=/^{([^}]+)}$/.exec(g)))return[new Pe(l,g,`"${v}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];let O=[];return"symbol"===a.layerType&&("text-field"===v&&h&&!h.glyphs&&O.push(new Pe(l,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&cn(qi(g))&&"identity"===Rt(g.type)&&O.push(new Pe(l,g,'"text-font" does not support identity functions'))),O.concat(zi({key:a.key,value:g,valueSpec:C,style:h,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:v}))}function Hh(a){return va(a,"paint")}function Gh(a){return va(a,"layout")}function Zh(a){let t=[],l=a.value,h=a.key,f=a.style,g=a.styleSpec;l.type||l.ref||t.push(new Pe(h,l,'either "type" or "ref" is required'));let v=Rt(l.type),w=Rt(l.ref);if(l.id){let M=Rt(l.id);for(let C=0;C<a.arrayIndex;C++){let P=f.layers[C];Rt(P.id)===M&&t.push(new Pe(h,l.id,`duplicate layer id "${l.id}", previously used at line ${P.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach(C=>{C in l&&t.push(new Pe(h,l[C],`"${C}" is prohibited for ref layers`))}),f.layers.forEach(C=>{Rt(C.id)===w&&(M=C)}),M?M.ref?t.push(new Pe(h,l.ref,"ref cannot reference another ref layer")):v=Rt(M.type):t.push(new Pe(h,l.ref,`ref layer "${w}" not found`))}else if("background"!==v)if(l.source){let M=f.sources&&f.sources[l.source],C=M&&Rt(M.type);M?"vector"===C&&"raster"===v?t.push(new Pe(h,l.source,`layer "${l.id}" requires a raster source`)):"raster"===C&&"raster"!==v?t.push(new Pe(h,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==C||l["source-layer"]?"raster-dem"===C&&"hillshade"!==v?t.push(new Pe(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]||"geojson"===C&&M.lineMetrics||t.push(new Pe(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Pe(h,l,`layer "${l.id}" must specify a "source-layer"`)):t.push(new Pe(h,l.source,`source "${l.source}" not found`))}else t.push(new Pe(h,l,'missing required property "source"'));return t=t.concat(nr({key:h,value:l,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zi({key:`${h}.type`,value:l.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:_a,layout:M=>nr({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":C=>Gh(tr({layerType:v},C))}}),paint:M=>nr({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":C=>Hh(tr({layerType:v},C))}})}})),t}function Ls(a){let t=a.value,l=a.key,h=Vt(t);return"string"!==h?[new Pe(l,t,`string expected, ${h} found`)]:[]}let qh={promoteId:function({key:a,value:t}){if("string"===Vt(t))return Ls({key:a,value:t});{let l=[];for(let h in t)l.push(...Ls({key:`${a}.${h}`,value:t[h]}));return l}}};function xa(a){let t=a.value,l=a.key,h=a.styleSpec,f=a.style;if(!t.type)return[new Pe(l,t,'"type" is required')];let v,g=Rt(t.type);switch(g){case"vector":case"raster":case"raster-dem":return v=nr({key:l,value:t,valueSpec:h[`source_${g.replace("-","_")}`],style:a.style,styleSpec:h,objectElementValidators:qh}),v;case"geojson":if(v=nr({key:l,value:t,valueSpec:h.source_geojson,style:f,styleSpec:h,objectElementValidators:qh}),t.cluster)for(let w in t.clusterProperties){let[M,C]=t.clusterProperties[w],P="string"==typeof M?[M,["accumulated"],["get",w]]:M;v.push(...Go({key:`${l}.${w}.map`,value:C,expressionContext:"cluster-map"})),v.push(...Go({key:`${l}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return v;case"video":return nr({key:l,value:t,valueSpec:h.source_video,style:f,styleSpec:h});case"image":return nr({key:l,value:t,valueSpec:h.source_image,style:f,styleSpec:h});case"canvas":return[new Pe(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ma({key:`${l}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:h})}}function ba(a){let t=a.value,l=a.styleSpec,h=l.light,f=a.style,g=[],v=Vt(t);if(void 0===t)return g;if("object"!==v)return g=g.concat([new Pe("light",t,`object expected, ${v} found`)]),g;for(let w in t){let M=w.match(/^(.*)-transition$/);g=g.concat(M&&h[M[1]]&&h[M[1]].transition?zi({key:w,value:t[w],valueSpec:l.transition,style:f,styleSpec:l}):h[w]?zi({key:w,value:t[w],valueSpec:h[w],style:f,styleSpec:l}):[new Pe(w,t[w],`unknown property "${w}"`)])}return g}function Fi(a){let t=a.value,l=a.styleSpec,h=l.terrain,f=a.style,g=[],v=Vt(t);if(void 0===t)return g;if("object"!==v)return g=g.concat([new Pe("terrain",t,`object expected, ${v} found`)]),g;for(let w in t)g=g.concat(h[w]?zi({key:w,value:t[w],valueSpec:h[w],style:f,styleSpec:l}):[new Pe(w,t[w],`unknown property "${w}"`)]);return g}let wa={"*":()=>[],array:Bh,boolean:function(a){let t=a.value,l=a.key,h=Vt(t);return"boolean"!==h?[new Pe(l,t,`boolean expected, ${h} found`)]:[]},number:Qc,color:function(a){let t=a.key,l=a.value,h=Vt(l);return"string"!==h?[new Pe(t,l,`color expected, ${h} found`)]:null===Ms(l)?[new Pe(t,l,`color expected, "${l}" found`)]:[]},constants:Bo,enum:ma,filter:_a,function:jh,layer:Zh,object:nr,source:xa,light:ba,terrain:Fi,string:Ls,formatted:function(a){return 0===Ls(a).length?[]:Go(a)},resolvedImage:function(a){return 0===Ls(a).length?[]:Go(a)},padding:function(a){let t=a.key,l=a.value;if("array"===Vt(l)){if(l.length<1||l.length>4)return[new Pe(t,l,`padding requires 1 to 4 values; ${l.length} values found`)];let h={type:"number"},f=[];for(let g=0;g<l.length;g++)f=f.concat(zi({key:`${t}[${g}]`,value:l[g],valueSpec:h}));return f}return Qc({key:t,value:l,valueSpec:{}})}};function zi(a){let t=a.value,l=a.valueSpec,h=a.styleSpec;return l.expression&&cn(Rt(t))?jh(a):l.expression&&da(qi(t))?Go(a):l.type&&wa[l.type]?wa[l.type](a):nr(tr({},a,{valueSpec:l.type?h[l.type]:l}))}function _m(a){let t=a.value,l=a.key,h=Ls(a);return h.length||(-1===t.indexOf("{fontstack}")&&h.push(new Pe(l,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&h.push(new Pe(l,t,'"glyphs" url must include a "{range}" token'))),h}function yo(a,t=_e){let l=[];return l=l.concat(zi({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,objectElementValidators:{glyphs:_m,"*":()=>[]}})),a.constants&&(l=l.concat(Bo({key:"constants",value:a.constants,style:a,styleSpec:t}))),Wh(l)}function Wh(a){return[].concat(a).sort((t,l)=>t.line-l.line)}function zr(a){return function(...t){return Wh(a.apply(this,t))}}yo.source=zr(xa),yo.light=zr(ba),yo.terrain=zr(Fi),yo.layer=zr(Zh),yo.filter=zr(_a),yo.paintProperty=zr(Hh),yo.layoutProperty=zr(Gh);let Ma=yo,Jc=Ma.light,vm=Ma.paintProperty,xm=Ma.layoutProperty;function El(a,t){let l=!1;if(t&&t.length)for(let h of t)a.fire(new xs(new Error(h.message))),l=!0;return l}class Ea{constructor(t,l,h){let f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(l=v[1])+2*(h=v[2]);for(let M=0;M<this.d*this.d;M++){let C=v[3+M],P=v[3+M+1];f.push(C===P?null:v.subarray(C,P))}let w=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let v=0;v<this.d*this.d;v++)f.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=t,this.padding=h,this.scale=l/t,this.uid=0;let g=h/l*t;this.min=-g,this.max=t+g}insert(t,l,h,f,g){this._forEachCell(l,h,f,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,l,h,f,g,v){this.cells[g].push(v)}query(t,l,h,f,g){let v=this.min,w=this.max;if(t<=v&&l<=v&&w<=h&&w<=f&&!g)return Array.prototype.slice.call(this.keys);{let M=[];return this._forEachCell(t,l,h,f,this._queryCell,M,{},g),M}}_queryCell(t,l,h,f,g,v,w,M){let C=this.cells[g];if(null!==C){let P=this.keys,O=this.bboxes;for(let F=0;F<C.length;F++){let B=C[F];if(void 0===w[B]){let j=4*B;(M?M(O[j+0],O[j+1],O[j+2],O[j+3]):t<=O[j+2]&&l<=O[j+3]&&h>=O[j+0]&&f>=O[j+1])?(w[B]=!0,v.push(P[B])):w[B]=!1}}}}_forEachCell(t,l,h,f,g,v,w,M){let C=this._convertToCellCoord(t),P=this._convertToCellCoord(l),O=this._convertToCellCoord(h),F=this._convertToCellCoord(f);for(let B=C;B<=O;B++)for(let j=P;j<=F;j++){let K=this.d*j+B;if((!M||M(this._convertFromCellCoord(B),this._convertFromCellCoord(j),this._convertFromCellCoord(B+1),this._convertFromCellCoord(j+1)))&&g.call(this,t,l,h,f,K,v,w,M))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,l=3+this.cells.length+1+1,h=0;for(let v=0;v<this.cells.length;v++)h+=this.cells[v].length;let f=new Int32Array(l+h+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let g=l;for(let v=0;v<t.length;v++){let w=t[v];f[3+v]=g,f.set(w,g),g+=w.length}return f[3+t.length]=g,f.set(this.keys,g),g+=this.keys.length,f[3+t.length+1]=g,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer}static serialize(t,l){let h=t.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(t){return new Ea(t.buffer)}}let Br={};function $e(a,t,l={}){if(Br[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),Br[a]={klass:t,omit:l.omit||[],shallow:l.shallow||[]}}$e("Object",Object),$e("TransferableGridIndex",Ea),$e("Color",V),$e("Error",Error),$e("AJAXError",ni),$e("ResolvedImage",ne),$e("StylePropertyFunction",xl),$e("StyleExpression",vl,{omit:["_evaluator"]}),$e("ZoomDependentExpression",Kc),$e("ZoomConstantExpression",fa),$e("CompoundExpression",rn,{omit:["_evaluate"]});for(let a in Ss)Ss[a]._classRegistryKey||$e(`Expression_${a}`,Ss[a]);function Yh(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Zo(a,t){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(Yh(a)||Mi(a))return t&&t.push(a),a;if(ArrayBuffer.isView(a)){let l=a;return t&&t.push(l.buffer),l}if(a instanceof ImageData)return t&&t.push(a.data.buffer),a;if(Array.isArray(a)){let l=[];for(let h of a)l.push(Zo(h,t));return l}if("object"==typeof a){let l=a.constructor,h=l._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!Br[h])throw new Error(`${h} is not registered.`);let f=l.serialize?l.serialize(a,t):{};if(l.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let g in a){if(!a.hasOwnProperty(g)||Br[h].omit.indexOf(g)>=0)continue;let v=a[g];f[g]=Br[h].shallow.indexOf(g)>=0?v:Zo(v,t)}a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(f.$name=h),f}throw new Error("can't serialize object of type "+typeof a)}function _o(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||Yh(a)||Mi(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(_o);if("object"==typeof a){let t=a.$name||"Object";if(!Br[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:l}=Br[t];if(!l)throw new Error(`can't deserialize unregistered class ${t}`);if(l.deserialize)return l.deserialize(a);let h=Object.create(l.prototype);for(let f of Object.keys(a)){if("$name"===f)continue;let g=a[f];h[f]=Br[t].shallow.indexOf(f)>=0?g:_o(g)}return h}throw new Error("can't deserialize object of type "+typeof a)}class eu{constructor(){this.first=!0}update(t,l){let h=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=h,!0))}}let Oe={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Il(a){for(let t of a)if(nu(t.charCodeAt(0)))return!0;return!1}function bm(a){for(let t of a)if(!tu(t.charCodeAt(0)))return!1;return!0}function tu(a){return!(Oe.Arabic(a)||Oe["Arabic Supplement"](a)||Oe["Arabic Extended-A"](a)||Oe["Arabic Presentation Forms-A"](a)||Oe["Arabic Presentation Forms-B"](a))}function nu(a){return!(746!==a&&747!==a&&(a<4352||!(Oe["Bopomofo Extended"](a)||Oe.Bopomofo(a)||Oe["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Oe["CJK Compatibility Ideographs"](a)||Oe["CJK Compatibility"](a)||Oe["CJK Radicals Supplement"](a)||Oe["CJK Strokes"](a)||!(!Oe["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||Oe["CJK Unified Ideographs Extension A"](a)||Oe["CJK Unified Ideographs"](a)||Oe["Enclosed CJK Letters and Months"](a)||Oe["Hangul Compatibility Jamo"](a)||Oe["Hangul Jamo Extended-A"](a)||Oe["Hangul Jamo Extended-B"](a)||Oe["Hangul Jamo"](a)||Oe["Hangul Syllables"](a)||Oe.Hiragana(a)||Oe["Ideographic Description Characters"](a)||Oe.Kanbun(a)||Oe["Kangxi Radicals"](a)||Oe["Katakana Phonetic Extensions"](a)||Oe.Katakana(a)&&12540!==a||!(!Oe["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Oe["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Oe["Unified Canadian Aboriginal Syllabics"](a)||Oe["Unified Canadian Aboriginal Syllabics Extended"](a)||Oe["Vertical Forms"](a)||Oe["Yijing Hexagram Symbols"](a)||Oe["Yi Syllables"](a)||Oe["Yi Radicals"](a))))}function Kh(a){return!(nu(a)||(t=a,Oe["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Oe["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Oe["Letterlike Symbols"](t)||Oe["Number Forms"](t)||Oe["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Oe["Control Pictures"](t)&&9251!==t||Oe["Optical Character Recognition"](t)||Oe["Enclosed Alphanumerics"](t)||Oe["Geometric Shapes"](t)||Oe["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Oe["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Oe["CJK Symbols and Punctuation"](t)||Oe.Katakana(t)||Oe["Private Use Area"](t)||Oe["CJK Compatibility Forms"](t)||Oe["Small Form Variants"](t)||Oe["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function Qh(a){return a>=1424&&a<=2303||Oe["Arabic Presentation Forms-A"](a)||Oe["Arabic Presentation Forms-B"](a)}function wm(a,t){return!(!t&&Qh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Oe.Khmer(a))}function Xh(a){for(let t of a)if(Qh(t.charCodeAt(0)))return!0;return!1}let iu="deferred",ru="loading",ou="loaded",su=null,Di="unavailable",vo=null,Jh=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(Di="error"),su&&su(a)};function Os(){au.fire(new Nr("pluginStateChange",{pluginStatus:Di,pluginURL:vo}))}let au=new Rr,Ia=function(){return Di},ed=function(){if(Di!==iu||!vo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Di=ru,Os(),vo&&vs({url:vo},a=>{a?Jh(a):(Di=ou,Os())})},Wi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Di===ou||null!=Wi.applyArabicShaping,isLoading:()=>Di===ru,setState(a){if(!kt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Di=a.pluginStatus,vo=a.pluginURL},isParsed(){if(!kt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return null!=Wi.applyArabicShaping&&null!=Wi.processBidirectionalText&&null!=Wi.processStyledBidirectionalText},getPluginURL(){if(!kt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return vo}};class _n{constructor(t,l){this.zoom=t,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new eu,this.transition={})}isSupportedScript(t){return function(l,h){for(let f of l)if(!wm(f.charCodeAt(0),h))return!1;return!0}(t,Wi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,l=t-Math.floor(t),h=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}class Da{constructor(t,l){this.property=t,this.value=l,this.expression=function(h,f){if(cn(h))return new xl(h,f);if(da(h)){let g=zh(h,f);if("error"===g.result)throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=h;return"color"===f.type&&"string"==typeof h?g=V.parse(h):"padding"!==f.type||"number"!=typeof h&&!Array.isArray(h)||(g=X.parse(h)),{kind:"constant",evaluate:()=>g}}}(void 0===l?t.specification.default:l,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,l,h){return this.property.possiblyEvaluate(this,t,l,h)}}class Dl{constructor(t){this.property=t,this.value=new Da(t,void 0)}transitioned(t,l){return new nd(this.property,this.value,l,re({},t.transition,this.transition),t.now)}untransitioned(){return new nd(this.property,this.value,null,{},0)}}class td{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ae(this._values[t].value.value)}setValue(t,l){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Dl(this._values[t].property)),this._values[t].value=new Da(this._values[t].property,null===l?void 0:Ae(l))}getTransition(t){return Ae(this._values[t].transition)}setTransition(t,l){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Dl(this._values[t].property)),this._values[t].transition=Ae(l)||void 0}serialize(){let t={};for(let l of Object.keys(this._values)){let h=this.getValue(l);void 0!==h&&(t[l]=h);let f=this.getTransition(l);void 0!==f&&(t[`${l}-transition`]=f)}return t}transitioned(t,l){let h=new id(this._properties);for(let f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(t,l._values[f]);return h}untransitioned(){let t=new id(this._properties);for(let l of Object.keys(this._values))t._values[l]=this._values[l].untransitioned();return t}}class nd{constructor(t,l,h,f,g){this.property=t,this.value=l,this.begin=g+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(t,l,h){let f=t.now||0,g=this.value.possiblyEvaluate(t,l,h),v=this.prior;if(v){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return v.possiblyEvaluate(t,l,h);{let w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,l,h),g,function(M){if(M<=0)return 0;if(M>=1)return 1;let C=M*M,P=C*M;return 4*(M<.5?P:3*(M-C)+P-.75)}(w))}}return g}}class id{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,l,h){let f=new Ca(this._properties);for(let g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(t,l,h);return f}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Mm{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Ae(this._values[t].value)}setValue(t,l){this._values[t]=new Da(this._values[t].property,null===l?void 0:Ae(l))}serialize(){let t={};for(let l of Object.keys(this._values)){let h=this.getValue(l);void 0!==h&&(t[l]=h)}return t}possiblyEvaluate(t,l,h){let f=new Ca(this._properties);for(let g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(t,l,h);return f}}class br{constructor(t,l,h){this.property=t,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,l,h,f){return this.property.evaluate(this.value,this.parameters,t,l,h,f)}}class Ca{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ye{constructor(t){this.specification=t}possiblyEvaluate(t,l){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(l)}interpolate(t,l,h){let f=la[this.specification.type];return f?f(t,l,h):t}}class it{constructor(t,l){this.specification=t,this.overrides=l}possiblyEvaluate(t,l,h,f){return new br(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(l,null,{},h,f)}:t.expression,l)}interpolate(t,l,h){if("constant"!==t.value.kind||"constant"!==l.value.kind)return t;if(void 0===t.value.value||void 0===l.value.value)return new br(this,{kind:"constant",value:void 0},t.parameters);let f=la[this.specification.type];return f?new br(this,{kind:"constant",value:f(t.value.value,l.value.value,h)},t.parameters):t}evaluate(t,l,h,f,g,v){return"constant"===t.kind?t.value:t.evaluate(l,h,f,g,v)}}class Ns extends it{possiblyEvaluate(t,l,h,f){if(void 0===t.value)return new br(this,{kind:"constant",value:void 0},l);if("constant"===t.expression.kind){let g=t.expression.evaluate(l,null,{},h,f),v="resolvedImage"===t.property.specification.type&&"string"!=typeof g?g.name:g,w=this._calculate(v,v,v,l);return new br(this,{kind:"constant",value:w},l)}if("camera"===t.expression.kind){let g=this._calculate(t.expression.evaluate({zoom:l.zoom-1}),t.expression.evaluate({zoom:l.zoom}),t.expression.evaluate({zoom:l.zoom+1}),l);return new br(this,{kind:"constant",value:g},l)}return new br(this,t.expression,l)}evaluate(t,l,h,f,g,v){if("source"===t.kind){let w=t.evaluate(l,h,f,g,v);return this._calculate(w,w,w,l)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(l.zoom)-1},h,f),t.evaluate({zoom:Math.floor(l.zoom)},h,f),t.evaluate({zoom:Math.floor(l.zoom)+1},h,f),l):t.value}_calculate(t,l,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:l}:{from:h,to:l}}interpolate(t){return t}}class lu{constructor(t){this.specification=t}possiblyEvaluate(t,l,h,f){if(void 0!==t.value){if("constant"===t.expression.kind){let g=t.expression.evaluate(l,null,{},h,f);return this._calculate(g,g,g,l)}return this._calculate(t.expression.evaluate(new _n(Math.floor(l.zoom-1),l)),t.expression.evaluate(new _n(Math.floor(l.zoom),l)),t.expression.evaluate(new _n(Math.floor(l.zoom+1),l)),l)}}_calculate(t,l,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:l}:{from:h,to:l}}interpolate(t){return t}}class xo{constructor(t){this.specification=t}possiblyEvaluate(t,l,h,f){return!!t.expression.evaluate(l,null,{},h,f)}interpolate(){return!1}}class ri{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let l in t){let h=t[l];h.specification.overridable&&this.overridableProperties.push(l);let f=this.defaultPropertyValues[l]=new Da(h,void 0),g=this.defaultTransitionablePropertyValues[l]=new Dl(h);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate({})}}}$e("DataDrivenProperty",it),$e("DataConstantProperty",Ye),$e("CrossFadedDataDrivenProperty",Ns),$e("CrossFadedProperty",lu),$e("ColorRampProperty",xo);let bo="-transition";class wr extends Rr{constructor(t,l){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),l.layout&&(this._unevaluatedLayout=new Mm(l.layout)),l.paint)){this._transitionablePaint=new td(l.paint);for(let h in t.paint)this.setPaintProperty(h,t.paint[h],{validate:!1});for(let h in t.layout)this.setLayoutProperty(h,t.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ca(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,l,h={}){null!=l&&this._validate(xm,`layers.${this.id}.layout.${t}`,t,l,h)||("visibility"!==t?this._unevaluatedLayout.setValue(t,l):this.visibility=l)}getPaintProperty(t){return t.endsWith(bo)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,l,h={}){if(null!=l&&this._validate(vm,`layers.${this.id}.paint.${t}`,t,l,h))return!1;if(t.endsWith(bo))return this._transitionablePaint.setTransition(t.slice(0,-11),l||void 0),!1;{let f=this._transitionablePaint._values[t],g="cross-faded-data-driven"===f.property.specification["property-type"],v=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(t,l),this._handleSpecialPaintPropertyUpdate(t);let M=this._transitionablePaint._values[t].value;return M.isDataDriven()||v||g||this._handleOverridablePaintPropertyUpdate(t,w,M)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,l,h){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,l){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,l)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),je(t,(l,h)=>!(void 0===l||"layout"===h&&!Object.keys(l).length||"paint"===h&&!Object.keys(l).length))}_validate(t,l,h,f,g={}){return(!g||!1!==g.validate)&&El(this,t.call(Ma,{key:l,layerType:this.type,objectKey:h,value:f,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let l=this.paint.get(t);if(l instanceof br&&dn(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}let rd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wo{constructor(t,l){this._structArray=t,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Sn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,l){return t._trim(),l&&(t.isTransferred=!0,l.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let l=Object.create(this.prototype);return l.arrayBuffer=t.arrayBuffer,l.length=t.length,l.capacity=t.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Rn(a,t=1){let l=0,h=0;return{members:a.map(f=>{let g=rd[f.type].BYTES_PER_ELEMENT,v=l=cu(l,Math.max(t,g)),w=f.components||1;return h=Math.max(h,g),l+=g*w,{name:f.name,type:f.type,components:w,offset:v}}),size:cu(l,Math.max(h,t)),alignment:t}}function cu(a,t){return Math.ceil(a/t)*t}class qo extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l){let h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){let f=2*t;return this.int16[f+0]=l,this.int16[f+1]=h,t}}qo.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",qo);class p extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,f){let g=this.length;return this.resize(g+1),this.emplace(g,t,l,h,f)}emplace(t,l,h,f,g){let v=4*t;return this.int16[v+0]=l,this.int16[v+1]=h,this.int16[v+2]=f,this.int16[v+3]=g,t}}p.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",p);class n extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g,v){let w=this.length;return this.resize(w+1),this.emplace(w,t,l,h,f,g,v)}emplace(t,l,h,f,g,v,w){let M=6*t;return this.int16[M+0]=l,this.int16[M+1]=h,this.int16[M+2]=f,this.int16[M+3]=g,this.int16[M+4]=v,this.int16[M+5]=w,t}}n.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",n);class u extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g,v){let w=this.length;return this.resize(w+1),this.emplace(w,t,l,h,f,g,v)}emplace(t,l,h,f,g,v,w){let M=4*t,C=8*t;return this.int16[M+0]=l,this.int16[M+1]=h,this.uint8[C+4]=f,this.uint8[C+5]=g,this.uint8[C+6]=v,this.uint8[C+7]=w,t}}u.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",u);class d extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l){let h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){let f=2*t;return this.float32[f+0]=l,this.float32[f+1]=h,t}}d.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",d);class m extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g,v,w,M,C,P){let O=this.length;return this.resize(O+1),this.emplace(O,t,l,h,f,g,v,w,M,C,P)}emplace(t,l,h,f,g,v,w,M,C,P,O){let F=10*t;return this.uint16[F+0]=l,this.uint16[F+1]=h,this.uint16[F+2]=f,this.uint16[F+3]=g,this.uint16[F+4]=v,this.uint16[F+5]=w,this.uint16[F+6]=M,this.uint16[F+7]=C,this.uint16[F+8]=P,this.uint16[F+9]=O,t}}m.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",m);class _ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g,v,w,M,C,P,O,F){let B=this.length;return this.resize(B+1),this.emplace(B,t,l,h,f,g,v,w,M,C,P,O,F)}emplace(t,l,h,f,g,v,w,M,C,P,O,F,B){let j=12*t;return this.int16[j+0]=l,this.int16[j+1]=h,this.int16[j+2]=f,this.int16[j+3]=g,this.uint16[j+4]=v,this.uint16[j+5]=w,this.uint16[j+6]=M,this.uint16[j+7]=C,this.int16[j+8]=P,this.int16[j+9]=O,this.int16[j+10]=F,this.int16[j+11]=B,t}}_.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",_);class b extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h){let f=this.length;return this.resize(f+1),this.emplace(f,t,l,h)}emplace(t,l,h,f){let g=3*t;return this.float32[g+0]=l,this.float32[g+1]=h,this.float32[g+2]=f,t}}b.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",b);class E extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint32[1*t+0]=l,t}}E.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",E);class D extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g,v,w,M,C){let P=this.length;return this.resize(P+1),this.emplace(P,t,l,h,f,g,v,w,M,C)}emplace(t,l,h,f,g,v,w,M,C,P){let O=10*t,F=5*t;return this.int16[O+0]=l,this.int16[O+1]=h,this.int16[O+2]=f,this.int16[O+3]=g,this.int16[O+4]=v,this.int16[O+5]=w,this.uint32[F+3]=M,this.uint16[O+8]=C,this.uint16[O+9]=P,t}}D.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",D);class S extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g,v){let w=this.length;return this.resize(w+1),this.emplace(w,t,l,h,f,g,v)}emplace(t,l,h,f,g,v,w){let M=6*t;return this.int16[M+0]=l,this.int16[M+1]=h,this.int16[M+2]=f,this.int16[M+3]=g,this.int16[M+4]=v,this.int16[M+5]=w,t}}S.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",S);class k extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g){let v=this.length;return this.resize(v+1),this.emplace(v,t,l,h,f,g)}emplace(t,l,h,f,g,v){let w=4*t,M=8*t;return this.float32[w+0]=l,this.float32[w+1]=h,this.float32[w+2]=f,this.int16[M+6]=g,this.int16[M+7]=v,t}}k.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",k);class R extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,f){let g=this.length;return this.resize(g+1),this.emplace(g,t,l,h,f)}emplace(t,l,h,f,g){let v=12*t,w=3*t;return this.uint8[v+0]=l,this.uint8[v+1]=h,this.float32[w+1]=f,this.float32[w+2]=g,t}}R.prototype.bytesPerElement=12,$e("StructArrayLayout2ub2f12",R);class z extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h){let f=this.length;return this.resize(f+1),this.emplace(f,t,l,h)}emplace(t,l,h,f){let g=3*t;return this.uint16[g+0]=l,this.uint16[g+1]=h,this.uint16[g+2]=f,t}}z.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",z);class q extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g,v,w,M,C,P,O,F,B,j,K,Y,se){let de=this.length;return this.resize(de+1),this.emplace(de,t,l,h,f,g,v,w,M,C,P,O,F,B,j,K,Y,se)}emplace(t,l,h,f,g,v,w,M,C,P,O,F,B,j,K,Y,se,de){let oe=24*t,ue=12*t,be=48*t;return this.int16[oe+0]=l,this.int16[oe+1]=h,this.uint16[oe+2]=f,this.uint16[oe+3]=g,this.uint32[ue+2]=v,this.uint32[ue+3]=w,this.uint32[ue+4]=M,this.uint16[oe+10]=C,this.uint16[oe+11]=P,this.uint16[oe+12]=O,this.float32[ue+7]=F,this.float32[ue+8]=B,this.uint8[be+36]=j,this.uint8[be+37]=K,this.uint8[be+38]=Y,this.uint32[ue+10]=se,this.int16[oe+22]=de,t}}q.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",q);class H extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,f,g,v,w,M,C,P,O,F,B,j,K,Y,se,de,oe,ue,be,xe,Ve,qe,Ne,Te,De,Re){let ke=this.length;return this.resize(ke+1),this.emplace(ke,t,l,h,f,g,v,w,M,C,P,O,F,B,j,K,Y,se,de,oe,ue,be,xe,Ve,qe,Ne,Te,De,Re)}emplace(t,l,h,f,g,v,w,M,C,P,O,F,B,j,K,Y,se,de,oe,ue,be,xe,Ve,qe,Ne,Te,De,Re,ke){let Ee=34*t,tt=17*t;return this.int16[Ee+0]=l,this.int16[Ee+1]=h,this.int16[Ee+2]=f,this.int16[Ee+3]=g,this.int16[Ee+4]=v,this.int16[Ee+5]=w,this.int16[Ee+6]=M,this.int16[Ee+7]=C,this.uint16[Ee+8]=P,this.uint16[Ee+9]=O,this.uint16[Ee+10]=F,this.uint16[Ee+11]=B,this.uint16[Ee+12]=j,this.uint16[Ee+13]=K,this.uint16[Ee+14]=Y,this.uint16[Ee+15]=se,this.uint16[Ee+16]=de,this.uint16[Ee+17]=oe,this.uint16[Ee+18]=ue,this.uint16[Ee+19]=be,this.uint16[Ee+20]=xe,this.uint16[Ee+21]=Ve,this.uint16[Ee+22]=qe,this.uint32[tt+12]=Ne,this.float32[tt+13]=Te,this.float32[tt+14]=De,this.float32[tt+15]=Re,this.float32[tt+16]=ke,t}}H.prototype.bytesPerElement=68,$e("StructArrayLayout8i15ui1ul4f68",H);class Z extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.float32[1*t+0]=l,t}}Z.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",Z);class ee extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h){let f=this.length;return this.resize(f+1),this.emplace(f,t,l,h)}emplace(t,l,h,f){let g=3*t;return this.int16[g+0]=l,this.int16[g+1]=h,this.int16[g+2]=f,t}}ee.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",ee);class ie extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h){let f=this.length;return this.resize(f+1),this.emplace(f,t,l,h)}emplace(t,l,h,f){let g=4*t;return this.uint32[2*t+0]=l,this.uint16[g+2]=h,this.uint16[g+3]=f,t}}ie.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",ie);class ae extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l){let h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){let f=2*t;return this.uint16[f+0]=l,this.uint16[f+1]=h,t}}ae.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",ae);class W extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint16[1*t+0]=l,t}}W.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",W);class he extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,f){let g=this.length;return this.resize(g+1),this.emplace(g,t,l,h,f)}emplace(t,l,h,f,g){let v=4*t;return this.float32[v+0]=l,this.float32[v+1]=h,this.float32[v+2]=f,this.float32[v+3]=g,t}}he.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",he);class ce extends wo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new st(this.anchorPointX,this.anchorPointY)}}ce.prototype.size=20;class ge extends D{get(t){return new ce(this,t)}}$e("CollisionBoxArray",ge);class ye extends wo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ye.prototype.size=48;class Me extends q{get(t){return new ye(this,t)}}$e("PlacedSymbolArray",Me);class me extends wo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}me.prototype.size=68;class ze extends H{get(t){return new me(this,t)}}$e("SymbolInstanceArray",ze);class Se extends Z{getoffsetX(t){return this.float32[1*t+0]}}$e("GlyphOffsetArray",Se);class Ue extends ee{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}$e("SymbolLineVertexArray",Ue);class gt extends wo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}gt.prototype.size=8;class xt extends ie{get(t){return new gt(this,t)}}$e("FeatureIndexArray",xt);class et extends qo{}class Wt extends qo{}class Yt extends qo{}class Lt extends n{}class Bt extends u{}class Qt extends d{}class Yn extends m{}class Mr extends _{}class ir extends b{}class Er extends E{}class Mo extends S{}class Yi extends R{}class Ci extends z{}class jr extends ae{}let Cl=Rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vn}=Cl;class It{constructor(t=[]){this.segments=t}prepareSegment(t,l,h,f){let g=this.segments[this.segments.length-1];return t>It.MAX_VERTEX_ARRAY_LENGTH&&rt(`Max vertices per segment is ${It.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>It.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==f&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(let t of this.segments)for(let l in t.vaos)t.vaos[l].destroy()}static simpleSegment(t,l,h,f){return new It([{vertexOffset:t,primitiveOffset:l,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}function Gt(a,t){return 256*(a=L(Math.floor(a),0,255))+L(Math.floor(t),0,255)}It.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",It);let Kn=Rn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Qn={exports:{}},vn={exports:{}};vn.exports=function(a,t){var l,h,f,g,v,w,M,C;for(h=a.length-(l=3&a.length),f=t,v=3432918353,w=461845907,C=0;C<h;)M=255&a.charCodeAt(C)|(255&a.charCodeAt(++C))<<8|(255&a.charCodeAt(++C))<<16|(255&a.charCodeAt(++C))<<24,++C,f=27492+(65535&(g=5*(65535&(f=(f^=M=(65535&(M=(M=(65535&M)*v+(((M>>>16)*v&65535)<<16)&4294967295)<<15|M>>>17))*w+(((M>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&a.charCodeAt(C+2))<<16;case 2:M^=(255&a.charCodeAt(C+1))<<8;case 1:f^=M=(65535&(M=(M=(65535&(M^=255&a.charCodeAt(C)))*v+(((M>>>16)*v&65535)<<16)&4294967295)<<15|M>>>17))*w+(((M>>>16)*w&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Ki={exports:{}};Ki.exports=function(a,t){for(var l,h=a.length,f=t^h,g=0;h>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(g)|(255&a.charCodeAt(++g))<<8|(255&a.charCodeAt(++g))<<16|(255&a.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:f^=(255&a.charCodeAt(g+2))<<16;case 2:f^=(255&a.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var Wo=vn.exports,uu=Ki.exports;Qn.exports=Wo,Qn.exports.murmur3=Wo,Qn.exports.murmur2=uu;class Rs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,l,h,f){this.ids.push(od(t)),this.positions.push(l,h,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let l=od(t),h=0,f=this.ids.length-1;for(;h<f;){let v=h+f>>1;this.ids[v]>=l?f=v:h=v+1}let g=[];for(;this.ids[h]===l;)g.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return g}static serialize(t,l){let h=new Float64Array(t.ids),f=new Uint32Array(t.positions);return hu(h,f,0,h.length-1),l&&l.push(h.buffer,f.buffer),{ids:h,positions:f}}static deserialize(t){let l=new Rs;return l.ids=t.ids,l.positions=t.positions,l.indexed=!0,l}}function od(a){let t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Qn.exports(String(a))}function hu(a,t,l,h){for(;l<h;){let f=a[l+h>>1],g=l-1,v=h+1;for(;;){do{g++}while(a[g]<f);do{v--}while(a[v]>f);if(g>=v)break;Eo(a,g,v),Eo(t,3*g,3*v),Eo(t,3*g+1,3*v+1),Eo(t,3*g+2,3*v+2)}v-l<h-v?(hu(a,t,l,v),l=v+1):(hu(a,t,v+1,h),h=v)}}function Eo(a,t,l){let h=a[t];a[t]=a[l],a[l]=h}$e("FeaturePositionMap",Rs);class Yo{constructor(t,l){this.gl=t.gl,this.location=l}}class Ko extends Yo{constructor(t,l){super(t,l),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Sl extends Yo{constructor(t,l){super(t,l),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class jv extends Yo{constructor(t,l){super(t,l),this.current=V.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let lI=new Float32Array(16);function Em(a){return[Gt(255*a.r,255*a.g),Gt(255*a.b,255*a.a)]}class du{constructor(t,l,h){this.value=t,this.uniformNames=l.map(f=>`u_${f}`),this.type=h}setUniform(t,l,h){t.set(h.constantOr(this.value))}getBinding(t,l,h){return"color"===this.type?new jv(t,l):new Ko(t,l)}}class Tl{constructor(t,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=t.tlbr}setUniform(t,l,h,f){let g="u_pattern_to"===f?this.patternTo:"u_pattern_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,l,h){return"u_pattern"===h.substr(0,9)?new Sl(t,l):new Ko(t,l)}}class Qo{constructor(t,l,h,f){this.expression=t,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,l,h,f,g){let v=this.paintVertexArray.length,w=this.expression.evaluate(new _n(0),l,{},f,[],g);this.paintVertexArray.resize(t),this._setPaintValue(v,t,w)}updatePaintArray(t,l,h,f){let g=this.expression.evaluate({zoom:0},h,f);this._setPaintValue(t,l,g)}_setPaintValue(t,l,h){if("color"===this.type){let f=Em(h);for(let g=t;g<l;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=t;f<l;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ur{constructor(t,l,h,f,g,v){this.expression=t,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,l,h,f,g){let v=this.expression.evaluate(new _n(this.zoom),l,{},f,[],g),w=this.expression.evaluate(new _n(this.zoom+1),l,{},f,[],g),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,v,w)}updatePaintArray(t,l,h,f){let g=this.expression.evaluate({zoom:this.zoom},h,f),v=this.expression.evaluate({zoom:this.zoom+1},h,f);this._setPaintValue(t,l,g,v)}_setPaintValue(t,l,h,f){if("color"===this.type){let g=Em(h),v=Em(f);for(let w=t;w<l;w++)this.paintVertexArray.emplace(w,g[0],g[1],v[0],v[1])}else{for(let g=t;g<l;g++)this.paintVertexArray.emplace(g,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,l){let h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,f=L(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,l,h){return new Ko(t,l)}}class Fs{constructor(t,l,h,f,g,v){this.expression=t,this.type=l,this.useIntegerZoom=h,this.zoom=f,this.layerId=v,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,l,h){let f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(t,l,h,f,g){this._setPaintValues(t,l,h.patterns&&h.patterns[this.layerId],g)}_setPaintValues(t,l,h,f){if(!f||!h)return;let{min:g,mid:v,max:w}=h,M=f[g],C=f[v],P=f[w];if(M&&C&&P)for(let O=t;O<l;O++)this.zoomInPaintVertexArray.emplace(O,C.tl[0],C.tl[1],C.br[0],C.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],C.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,C.tl[0],C.tl[1],C.br[0],C.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],C.pixelRatio,P.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Kn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Kn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Uv{constructor(t,l,h){this.binders={},this._buffers=[];let f=[];for(let g in t.paint._values){if(!h(g))continue;let v=t.paint.get(g);if(!(v instanceof br&&dn(v.property.specification)))continue;let w=cI(g,t.type),M=v.value,C=v.property.specification.type,P=v.property.useIntegerZoom,O=v.property.specification["property-type"],F="cross-faded"===O||"cross-faded-data-driven"===O;if("constant"===M.kind)this.binders[g]=F?new Tl(M.value,w):new du(M.value,w,C),f.push(`/u_${g}`);else if("source"===M.kind||F){let B=Vv(g,C,"source");this.binders[g]=F?new Fs(M,C,P,l,B,t.id):new Qo(M,w,C,B),f.push(`/a_${g}`)}else{let B=Vv(g,C,"composite");this.binders[g]=new Ur(M,w,C,P,l,B),f.push(`/z_${g}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){let l=this.binders[t];return l instanceof Qo||l instanceof Ur?l.maxValue:0}populatePaintArrays(t,l,h,f,g){for(let v in this.binders){let w=this.binders[v];(w instanceof Qo||w instanceof Ur||w instanceof Fs)&&w.populatePaintArray(t,l,h,f,g)}}setConstantPatternPositions(t,l){for(let h in this.binders){let f=this.binders[h];f instanceof Tl&&f.setConstantPatternPositions(t,l)}}updatePaintArrays(t,l,h,f,g){let v=!1;for(let w in t){let M=l.getPositions(w);for(let C of M){let P=h.feature(C.index);for(let O in this.binders){let F=this.binders[O];if((F instanceof Qo||F instanceof Ur||F instanceof Fs)&&!0===F.expression.isStateDependent){let B=f.paint.get(O);F.expression=B.value,F.updatePaintArray(C.start,C.end,P,t[w],g),v=!0}}}}return v}defines(){let t=[];for(let l in this.binders){let h=this.binders[l];(h instanceof du||h instanceof Tl)&&t.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){let t=[];for(let l in this.binders){let h=this.binders[l];if(h instanceof Qo||h instanceof Ur)for(let f=0;f<h.paintVertexAttributes.length;f++)t.push(h.paintVertexAttributes[f].name);else if(h instanceof Fs)for(let f=0;f<Kn.members.length;f++)t.push(Kn.members[f].name)}return t}getBinderUniforms(){let t=[];for(let l in this.binders){let h=this.binders[l];if(h instanceof du||h instanceof Tl||h instanceof Ur)for(let f of h.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,l){let h=[];for(let f in this.binders){let g=this.binders[f];if(g instanceof du||g instanceof Tl||g instanceof Ur)for(let v of g.uniformNames)if(l[v]){let w=g.getBinding(t,l[v],v);h.push({name:v,property:f,binding:w})}}return h}setUniforms(t,l,h,f){for(let{name:g,property:v,binding:w}of l)this.binders[v].setUniform(w,f,h.get(v),g)}updatePaintBuffers(t){this._buffers=[];for(let l in this.binders){let h=this.binders[l];if(t&&h instanceof Fs){let f=2===t.fromScale?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(h instanceof Qo||h instanceof Ur)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(t){for(let l in this.binders){let h=this.binders[l];(h instanceof Qo||h instanceof Ur||h instanceof Fs)&&h.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let l=this.binders[t];(l instanceof Qo||l instanceof Ur||l instanceof Fs)&&l.destroy()}}}class Sa{constructor(t,l,h=(()=>!0)){this.programConfigurations={};for(let f of t)this.programConfigurations[f.id]=new Uv(f,l,h);this.needsUpload=!1,this._featureMap=new Rs,this._bufferOffset=0}populatePaintArrays(t,l,h,f,g,v){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,l,f,g,v);void 0!==l.id&&this._featureMap.add(l.id,h,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,l,h,f){for(let g of h)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,l,g,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let l in this.programConfigurations)this.programConfigurations[l].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function cI(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function Vv(a,t,l){let f={"line-pattern":{source:Yn,composite:Yn},"fill-pattern":{source:Yn,composite:Yn},"fill-extrusion-pattern":{source:Yn,composite:Yn}}[a];return f&&f[l]||{color:{source:d,composite:he},number:{source:Z,composite:d}}[t][l]}$e("ConstantBinder",du),$e("CrossFadedConstantBinder",Tl),$e("SourceExpressionBinder",Qo),$e("CrossFadedCompositeBinder",Fs),$e("CompositeExpressionBinder",Ur),$e("ProgramConfiguration",Uv,{omit:["_buffers"]}),$e("ProgramConfigurationSet",Sa);var $n=8192;let Im=Math.pow(2,14)-1,$v=-Im-1;function Ta(a){let t=$n/a.extent,l=a.loadGeometry();for(let h=0;h<l.length;h++){let f=l[h];for(let g=0;g<f.length;g++){let v=f[g],w=Math.round(v.x*t),M=Math.round(v.y*t);v.x=L(w,$v,Im),v.y=L(M,$v,Im),(w<v.x||w>v.x+1||M<v.y||M>v.y+1)&&rt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Aa(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Ta(a):[]}}function sd(a,t,l,h,f){a.emplaceBack(2*t+(h+1)/2,2*l+(f+1)/2)}class Dm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Wt,this.indexArray=new Ci,this.segments=new It,this.programConfigurations=new Sa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h){let f=this.layers[0],g=[],v=null,w=!1;"circle"===f.type&&(v=f.layout.get("circle-sort-key"),w=!v.isConstant());for(let{feature:M,id:C,index:P,sourceLayerIndex:O}of t){let F=this.layers[0]._featureFilter.needGeometry,B=Aa(M,F);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),B,h))continue;let j=w?v.evaluate(B,{},h):void 0,K={id:C,properties:M.properties,type:M.type,sourceLayerIndex:O,index:P,geometry:F?B.geometry:Ta(M),patterns:{},sortKey:j};g.push(K)}w&&g.sort((M,C)=>M.sortKey-C.sortKey);for(let M of g){let{geometry:C,index:P,sourceLayerIndex:O}=M,F=t[P].feature;this.addFeature(M,C,P,h),l.featureIndex.insert(F,C,P,O,this.index)}}update(t,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,l,h,f){for(let g of l)for(let v of g){let w=v.x,M=v.y;if(w<0||w>=$n||M<0||M>=$n)continue;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),P=C.vertexLength;sd(this.layoutVertexArray,w,M,-1,-1),sd(this.layoutVertexArray,w,M,1,-1),sd(this.layoutVertexArray,w,M,1,1),sd(this.layoutVertexArray,w,M,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,{},f)}}function Hv(a,t){for(let l=0;l<a.length;l++)if(Al(t,a[l]))return!0;for(let l=0;l<t.length;l++)if(Al(a,t[l]))return!0;return!!Cm(a,t)}function uI(a,t,l){return!!Al(a,t)||!!Sm(t,a,l)}function Gv(a,t){if(1===a.length)return qv(t,a[0]);for(let l=0;l<t.length;l++){let h=t[l];for(let f=0;f<h.length;f++)if(Al(a,h[f]))return!0}for(let l=0;l<a.length;l++)if(qv(t,a[l]))return!0;for(let l=0;l<t.length;l++)if(Cm(a,t[l]))return!0;return!1}function hI(a,t,l){if(a.length>1){if(Cm(a,t))return!0;for(let h=0;h<t.length;h++)if(Sm(t[h],a,l))return!0}for(let h=0;h<a.length;h++)if(Sm(a[h],t,l))return!0;return!1}function Cm(a,t){if(0===a.length||0===t.length)return!1;for(let l=0;l<a.length-1;l++){let h=a[l],f=a[l+1];for(let g=0;g<t.length-1;g++)if(dI(h,f,t[g],t[g+1]))return!0}return!1}function dI(a,t,l,h){return ot(a,l,h)!==ot(t,l,h)&&ot(a,t,l)!==ot(a,t,h)}function Sm(a,t,l){let h=l*l;if(1===t.length)return a.distSqr(t[0])<h;for(let f=1;f<t.length;f++)if(Zv(a,t[f-1],t[f])<h)return!0;return!1}function Zv(a,t,l){let h=t.distSqr(l);if(0===h)return a.distSqr(t);let f=((a.x-t.x)*(l.x-t.x)+(a.y-t.y)*(l.y-t.y))/h;return a.distSqr(f<0?t:f>1?l:l.sub(t)._mult(f)._add(t))}function qv(a,t){let l,h,f,g=!1;for(let v=0;v<a.length;v++){l=a[v];for(let w=0,M=l.length-1;w<l.length;M=w++)h=l[w],f=l[M],h.y>t.y!=f.y>t.y&&t.x<(f.x-h.x)*(t.y-h.y)/(f.y-h.y)+h.x&&(g=!g)}return g}function Al(a,t){let l=!1;for(let h=0,f=a.length-1;h<a.length;f=h++){let g=a[h],v=a[f];g.y>t.y!=v.y>t.y&&t.x<(v.x-g.x)*(t.y-g.y)/(v.y-g.y)+g.x&&(l=!l)}return l}function pI(a,t,l){let h=l[0],f=l[2];if(a.x<h.x&&t.x<h.x||a.x>f.x&&t.x>f.x||a.y<h.y&&t.y<h.y||a.y>f.y&&t.y>f.y)return!1;let g=ot(a,t,l[0]);return g!==ot(a,t,l[1])||g!==ot(a,t,l[2])||g!==ot(a,t,l[3])}function pu(a,t,l){let h=t.paint.get(a).value;return"constant"===h.kind?h.value:l.programConfigurations.get(t.id).getMaxValue(a)}function ad(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ld(a,t,l,h,f){if(!t[0]&&!t[1])return a;let g=st.convert(t)._mult(f);"viewport"===l&&g._rotate(-h);let v=[];for(let w=0;w<a.length;w++)v.push(a[w].sub(g));return v}$e("CircleBucket",Dm,{omit:["layers"]});let fI=new ri({"circle-sort-key":new it(_e.layout_circle["circle-sort-key"])});var mI={paint:new ri({"circle-radius":new it(_e.paint_circle["circle-radius"]),"circle-color":new it(_e.paint_circle["circle-color"]),"circle-blur":new it(_e.paint_circle["circle-blur"]),"circle-opacity":new it(_e.paint_circle["circle-opacity"]),"circle-translate":new Ye(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new it(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new it(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new it(_e.paint_circle["circle-stroke-opacity"])}),layout:fI},Si=1e-6,Ti=typeof Float32Array<"u"?Float32Array:Array;function Wv(){var a=new Ti(9);return Ti!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Tm(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Yv(a,t,l){var h=t[0],f=t[1],g=t[2],v=t[3],w=t[4],M=t[5],C=t[6],P=t[7],O=t[8],F=t[9],B=t[10],j=t[11],K=t[12],Y=t[13],se=t[14],de=t[15],oe=l[0],ue=l[1],be=l[2],xe=l[3];return a[0]=oe*h+ue*w+be*O+xe*K,a[1]=oe*f+ue*M+be*F+xe*Y,a[2]=oe*g+ue*C+be*B+xe*se,a[3]=oe*v+ue*P+be*j+xe*de,a[4]=(oe=l[4])*h+(ue=l[5])*w+(be=l[6])*O+(xe=l[7])*K,a[5]=oe*f+ue*M+be*F+xe*Y,a[6]=oe*g+ue*C+be*B+xe*se,a[7]=oe*v+ue*P+be*j+xe*de,a[8]=(oe=l[8])*h+(ue=l[9])*w+(be=l[10])*O+(xe=l[11])*K,a[9]=oe*f+ue*M+be*F+xe*Y,a[10]=oe*g+ue*C+be*B+xe*se,a[11]=oe*v+ue*P+be*j+xe*de,a[12]=(oe=l[12])*h+(ue=l[13])*w+(be=l[14])*O+(xe=l[15])*K,a[13]=oe*f+ue*M+be*F+xe*Y,a[14]=oe*g+ue*C+be*B+xe*se,a[15]=oe*v+ue*P+be*j+xe*de,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var fu,a,gI=Yv;function Kv(){var a=new Ti(3);return Ti!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Qv(a,t,l){var h=new Ti(3);return h[0]=a,h[1]=t,h[2]=l,h}function cd(a,t,l){var h=t[0],f=t[1],g=t[2],v=t[3];return a[0]=l[0]*h+l[4]*f+l[8]*g+l[12]*v,a[1]=l[1]*h+l[5]*f+l[9]*g+l[13]*v,a[2]=l[2]*h+l[6]*f+l[10]*g+l[14]*v,a[3]=l[3]*h+l[7]*f+l[11]*g+l[15]*v,a}function Xv(){var a=new Ti(4);return Ti!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Jv(a,t){let l=cd([],[a.x,a.y,0,1],t);return new st(l[0]/l[3],l[1]/l[3])}Kv(),fu=new Ti(4),Ti!=Float32Array&&(fu[0]=0,fu[1]=0,fu[2]=0,fu[3]=0),Kv(),Qv(1,0,0),Qv(0,1,0),Xv(),Xv(),Wv(),a=new Ti(2),Ti!=Float32Array&&(a[0]=0,a[1]=0);class e0 extends Dm{}$e("HeatmapBucket",e0,{omit:["layers"]});var yI={paint:new ri({"heatmap-radius":new it(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new it(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xo(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(_e.paint_heatmap["heatmap-opacity"])})};function Am(a,{width:t,height:l},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*l*h)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*l*h}`)}else f=new Uint8Array(t*l*h);return a.width=t,a.height=l,a.data=f,a}function t0(a,{width:t,height:l},h){if(t===a.width&&l===a.height)return;let f=Am({},{width:t,height:l},h);Pm(a,f,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,l)},h),a.width=t,a.height=l,a.data=f.data}function Pm(a,t,l,h,f,g){if(0===f.width||0===f.height)return t;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||h.x>t.width-f.width||h.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");let v=a.data,w=t.data;if(v===w)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<f.height;M++){let C=((l.y+M)*a.width+l.x)*g,P=((h.y+M)*t.width+h.x)*g;for(let O=0;O<f.width*g;O++)w[P+O]=v[C+O]}return t}class mu{constructor(t,l){Am(this,t,1,l)}resize(t){t0(this,t,1)}clone(){return new mu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,h,f,g){Pm(t,l,h,f,g,1)}}class rr{constructor(t,l){Am(this,t,4,l)}resize(t){t0(this,t,4)}replace(t,l){l?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new rr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,h,f,g){Pm(t,l,h,f,g,4)}}function n0(a){let t={},l=a.resolution||256,h=a.clips?a.clips.length:1,f=a.image||new rr({width:l,height:h});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);let g=(v,w,M)=>{t[a.evaluationKey]=M;let C=a.expression.evaluate(t);f.data[v+w+0]=Math.floor(255*C.r/C.a),f.data[v+w+1]=Math.floor(255*C.g/C.a),f.data[v+w+2]=Math.floor(255*C.b/C.a),f.data[v+w+3]=Math.floor(255*C.a)};if(a.clips)for(let v=0,w=0;v<h;++v,w+=4*l)for(let M=0,C=0;M<l;M++,C+=4){let P=M/(l-1),{start:O,end:F}=a.clips[v];g(w,C,O*(1-P)+F*P)}else for(let v=0,w=0;v<l;v++,w+=4)g(0,w,v/(l-1));return f}$e("AlphaImage",mu),$e("RGBAImage",rr);var _I={paint:new ri({"hillshade-illumination-direction":new Ye(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ye(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(_e.paint_hillshade["hillshade-accent-color"])})};let vI=Rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:xI}=vI;var ud={exports:{}};function hd(a,t,l){l=l||2;var h,f,g,v,w,M,C,P=t&&t.length,O=P?t[0]*l:a.length,F=i0(a,0,O,l,!0),B=[];if(!F||F.next===F.prev)return B;if(P&&(F=function(K,Y,se,de){var oe,ue,be,xe=[];for(oe=0,ue=Y.length;oe<ue;oe++)(be=i0(K,Y[oe]*de,oe<ue-1?Y[oe+1]*de:K.length,de,!1))===be.next&&(be.steiner=!0),xe.push(SI(be));for(xe.sort(II),oe=0;oe<xe.length;oe++)se=DI(xe[oe],se);return se}(a,t,F,l)),a.length>80*l){h=g=a[0],f=v=a[1];for(var j=l;j<O;j+=l)(w=a[j])<h&&(h=w),(M=a[j+1])<f&&(f=M),w>g&&(g=w),M>v&&(v=M);C=0!==(C=Math.max(g-h,v-f))?32767/C:0}return gu(F,B,l,h,f,C,0),B}function i0(a,t,l,h,f){var g,v;if(f===Om(a,t,l,h)>0)for(g=t;g<l;g+=h)v=s0(g,a[g],a[g+1],v);else for(g=l-h;g>=t;g-=h)v=s0(g,a[g],a[g+1],v);return v&&dd(v,v.next)&&(_u(v),v=v.next),v}function Pa(a,t){if(!a)return a;t||(t=a);var l,h=a;do{if(l=!1,h.steiner||!dd(h,h.next)&&0!==kn(h.prev,h,h.next))h=h.next;else{if(_u(h),(h=t=h.prev)===h.next)break;l=!0}}while(l||h!==t);return t}function gu(a,t,l,h,f,g,v){if(a){!v&&g&&function(P,O,F,B){var j=P;do{0===j.z&&(j.z=km(j.x,j.y,O,F,B)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==P);j.prevZ.nextZ=null,j.prevZ=null,function(K){var Y,se,de,oe,ue,be,xe,Ve,qe=1;do{for(se=K,K=null,ue=null,be=0;se;){for(be++,de=se,xe=0,Y=0;Y<qe&&(xe++,de=de.nextZ);Y++);for(Ve=qe;xe>0||Ve>0&&de;)0!==xe&&(0===Ve||!de||se.z<=de.z)?(oe=se,se=se.nextZ,xe--):(oe=de,de=de.nextZ,Ve--),ue?ue.nextZ=oe:K=oe,oe.prevZ=ue,ue=oe;se=de}ue.nextZ=null,qe*=2}while(be>1)}(j)}(a,h,f,g);for(var w,M,C=a;a.prev!==a.next;)if(w=a.prev,M=a.next,g?wI(a,h,f,g):bI(a))t.push(w.i/l|0),t.push(a.i/l|0),t.push(M.i/l|0),_u(a),a=M.next,C=M.next;else if((a=M)===C){v?1===v?gu(a=MI(Pa(a),t,l),t,l,h,f,g,2):2===v&&EI(a,t,l,h,f,g):gu(Pa(a),t,l,h,f,g,1);break}}}function bI(a){var t=a.prev,l=a,h=a.next;if(kn(t,l,h)>=0)return!1;for(var f=t.x,g=l.x,v=h.x,w=t.y,M=l.y,C=h.y,P=f<g?f<v?f:v:g<v?g:v,O=w<M?w<C?w:C:M<C?M:C,F=f>g?f>v?f:v:g>v?g:v,B=w>M?w>C?w:C:M>C?M:C,j=h.next;j!==t;){if(j.x>=P&&j.x<=F&&j.y>=O&&j.y<=B&&Pl(f,w,g,M,v,C,j.x,j.y)&&kn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function wI(a,t,l,h){var f=a.prev,g=a,v=a.next;if(kn(f,g,v)>=0)return!1;for(var w=f.x,M=g.x,C=v.x,P=f.y,O=g.y,F=v.y,B=w<M?w<C?w:C:M<C?M:C,j=P<O?P<F?P:F:O<F?O:F,K=w>M?w>C?w:C:M>C?M:C,Y=P>O?P>F?P:F:O>F?O:F,se=km(B,j,t,l,h),de=km(K,Y,t,l,h),oe=a.prevZ,ue=a.nextZ;oe&&oe.z>=se&&ue&&ue.z<=de;){if(oe.x>=B&&oe.x<=K&&oe.y>=j&&oe.y<=Y&&oe!==f&&oe!==v&&Pl(w,P,M,O,C,F,oe.x,oe.y)&&kn(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ue.x>=B&&ue.x<=K&&ue.y>=j&&ue.y<=Y&&ue!==f&&ue!==v&&Pl(w,P,M,O,C,F,ue.x,ue.y)&&kn(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;oe&&oe.z>=se;){if(oe.x>=B&&oe.x<=K&&oe.y>=j&&oe.y<=Y&&oe!==f&&oe!==v&&Pl(w,P,M,O,C,F,oe.x,oe.y)&&kn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ue&&ue.z<=de;){if(ue.x>=B&&ue.x<=K&&ue.y>=j&&ue.y<=Y&&ue!==f&&ue!==v&&Pl(w,P,M,O,C,F,ue.x,ue.y)&&kn(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function MI(a,t,l){var h=a;do{var f=h.prev,g=h.next.next;!dd(f,g)&&r0(f,h,h.next,g)&&yu(f,g)&&yu(g,f)&&(t.push(f.i/l|0),t.push(h.i/l|0),t.push(g.i/l|0),_u(h),_u(h.next),h=a=g),h=h.next}while(h!==a);return Pa(h)}function EI(a,t,l,h,f,g){var v=a;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&TI(v,w)){var M=o0(v,w);return v=Pa(v,v.next),M=Pa(M,M.next),gu(v,t,l,h,f,g,0),void gu(M,t,l,h,f,g,0)}w=w.next}v=v.next}while(v!==a)}function II(a,t){return a.x-t.x}function DI(a,t){var l=function(f,g){var v,w=g,M=f.x,C=f.y,P=-1/0;do{if(C<=w.y&&C>=w.next.y&&w.next.y!==w.y){var O=w.x+(C-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=M&&O>P&&(P=O,v=w.x<w.next.x?w:w.next,O===M))return v}w=w.next}while(w!==g);if(!v)return null;var F,B=v,j=v.x,K=v.y,Y=1/0;w=v;do{M>=w.x&&w.x>=j&&M!==w.x&&Pl(C<K?M:P,C,j,K,C<K?P:M,C,w.x,w.y)&&(F=Math.abs(C-w.y)/(M-w.x),yu(w,f)&&(F<Y||F===Y&&(w.x>v.x||w.x===v.x&&CI(v,w)))&&(v=w,Y=F)),w=w.next}while(w!==B);return v}(a,t);if(!l)return t;var h=o0(l,a);return Pa(h,h.next),Pa(l,l.next)}function CI(a,t){return kn(a.prev,a,t.prev)<0&&kn(t.next,a,a.next)<0}function km(a,t,l,h,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-h)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function SI(a){var t=a,l=a;do{(t.x<l.x||t.x===l.x&&t.y<l.y)&&(l=t),t=t.next}while(t!==a);return l}function Pl(a,t,l,h,f,g,v,w){return(f-v)*(t-w)>=(a-v)*(g-w)&&(a-v)*(h-w)>=(l-v)*(t-w)&&(l-v)*(g-w)>=(f-v)*(h-w)}function TI(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(l,h){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==h.i&&f.next.i!==h.i&&r0(f,f.next,l,h))return!0;f=f.next}while(f!==l);return!1}(a,t)&&(yu(a,t)&&yu(t,a)&&function(l,h){var f=l,g=!1,v=(l.x+h.x)/2,w=(l.y+h.y)/2;do{f.y>w!=f.next.y>w&&f.next.y!==f.y&&v<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next}while(f!==l);return g}(a,t)&&(kn(a.prev,a,t.prev)||kn(a,t.prev,t))||dd(a,t)&&kn(a.prev,a,a.next)>0&&kn(t.prev,t,t.next)>0)}function kn(a,t,l){return(t.y-a.y)*(l.x-t.x)-(t.x-a.x)*(l.y-t.y)}function dd(a,t){return a.x===t.x&&a.y===t.y}function r0(a,t,l,h){var f=fd(kn(a,t,l)),g=fd(kn(a,t,h)),v=fd(kn(l,h,a)),w=fd(kn(l,h,t));return f!==g&&v!==w||!(0!==f||!pd(a,l,t))||!(0!==g||!pd(a,h,t))||!(0!==v||!pd(l,a,h))||!(0!==w||!pd(l,t,h))}function pd(a,t,l){return t.x<=Math.max(a.x,l.x)&&t.x>=Math.min(a.x,l.x)&&t.y<=Math.max(a.y,l.y)&&t.y>=Math.min(a.y,l.y)}function fd(a){return a>0?1:a<0?-1:0}function yu(a,t){return kn(a.prev,a,a.next)<0?kn(a,t,a.next)>=0&&kn(a,a.prev,t)>=0:kn(a,t,a.prev)<0||kn(a,a.next,t)<0}function o0(a,t){var l=new Lm(a.i,a.x,a.y),h=new Lm(t.i,t.x,t.y),f=a.next,g=t.prev;return a.next=t,t.prev=a,l.next=f,f.prev=l,h.next=l,l.prev=h,g.next=h,h.prev=g,h}function s0(a,t,l,h){var f=new Lm(a,t,l);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function _u(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Lm(a,t,l){this.i=a,this.x=t,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Om(a,t,l,h){for(var f=0,g=t,v=l-h;g<l;g+=h)f+=(a[v]-a[g])*(a[g+1]+a[v+1]),v=g;return f}function AI(a,t,l,h,f){a0(a,t,l||0,h||a.length-1,f||PI)}function a0(a,t,l,h,f){for(;h>l;){if(h-l>600){var g=h-l+1,v=t-l+1,w=Math.log(g),M=.5*Math.exp(2*w/3),C=.5*Math.sqrt(w*M*(g-M)/g)*(v-g/2<0?-1:1);a0(a,t,Math.max(l,Math.floor(t-v*M/g+C)),Math.min(h,Math.floor(t+(g-v)*M/g+C)),f)}var P=a[t],O=l,F=h;for(vu(a,l,t),f(a[h],P)>0&&vu(a,l,h);O<F;){for(vu(a,O,F),O++,F--;f(a[O],P)<0;)O++;for(;f(a[F],P)>0;)F--}0===f(a[l],P)?vu(a,l,F):vu(a,++F,h),F<=t&&(l=F+1),t<=F&&(h=F-1)}}function vu(a,t,l){var h=a[t];a[t]=a[l],a[l]=h}function PI(a,t){return a<t?-1:a>t?1:0}function Nm(a,t){let l=a.length;if(l<=1)return[a];let f,g,h=[];for(let v=0;v<l;v++){let w=ln(a[v]);0!==w&&(a[v].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(f&&h.push(f),f=[a[v]]):f.push(a[v]))}if(f&&h.push(f),t>1)for(let v=0;v<h.length;v++)h[v].length<=t||(AI(h[v],t,1,h[v].length-1,kI),h[v]=h[v].slice(0,t));return h}function kI(a,t){return t.area-a.area}function Rm(a,t,l){let h=l.patternDependencies,f=!1;for(let g of t){let v=g.paint.get(`${a}-pattern`);v.isConstant()||(f=!0);let w=v.constantOr(null);w&&(f=!0,h[w.to]=!0,h[w.from]=!0)}return f}function Fm(a,t,l,h,f){let g=f.patternDependencies;for(let v of t){let w=v.paint.get(`${a}-pattern`).value;if("constant"!==w.kind){let M=w.evaluate({zoom:h-1},l,{},f.availableImages),C=w.evaluate({zoom:h},l,{},f.availableImages),P=w.evaluate({zoom:h+1},l,{},f.availableImages);M=M&&M.name?M.name:M,C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,g[M]=!0,g[C]=!0,g[P]=!0,l.patterns[v.id]={min:M,mid:C,max:P}}}return l}ud.exports=hd,ud.exports.default=hd,hd.deviation=function(a,t,l,h){var f=t&&t.length,g=Math.abs(Om(a,0,f?t[0]*l:a.length,l));if(f)for(var v=0,w=t.length;v<w;v++)g-=Math.abs(Om(a,t[v]*l,v<w-1?t[v+1]*l:a.length,l));var M=0;for(v=0;v<h.length;v+=3){var C=h[v]*l,P=h[v+1]*l,O=h[v+2]*l;M+=Math.abs((a[C]-a[O])*(a[P+1]-a[C+1])-(a[C]-a[P])*(a[O+1]-a[C+1]))}return 0===g&&0===M?0:Math.abs((M-g)/g)},hd.flatten=function(a){for(var t=a[0][0].length,l={vertices:[],holes:[],dimensions:t},h=0,f=0;f<a.length;f++){for(var g=0;g<a[f].length;g++)for(var v=0;v<t;v++)l.vertices.push(a[f][g][v]);f>0&&l.holes.push(h+=a[f-1].length)}return l};class zm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yt,this.indexArray=new Ci,this.indexArray2=new jr,this.programConfigurations=new Sa(t.layers,t.zoom),this.segments=new It,this.segments2=new It,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h){this.hasPattern=Rm("fill",this.layers,l);let f=this.layers[0].layout.get("fill-sort-key"),g=!f.isConstant(),v=[];for(let{feature:w,id:M,index:C,sourceLayerIndex:P}of t){let O=this.layers[0]._featureFilter.needGeometry,F=Aa(w,O);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),F,h))continue;let B=g?f.evaluate(F,{},h,l.availableImages):void 0,j={id:M,properties:w.properties,type:w.type,sourceLayerIndex:P,index:C,geometry:O?F.geometry:Ta(w),patterns:{},sortKey:B};v.push(j)}g&&v.sort((w,M)=>w.sortKey-M.sortKey);for(let w of v){let{geometry:M,index:C,sourceLayerIndex:P}=w;if(this.hasPattern){let O=Fm("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(w,M,C,h,{});l.featureIndex.insert(t[C].feature,M,C,P,this.index)}}update(t,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h)}addFeatures(t,l,h){for(let f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xI),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,l,h,f,g){for(let v of Nm(l,500)){let w=0;for(let B of v)w+=B.length;let M=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),C=M.vertexLength,P=[],O=[];for(let B of v){if(0===B.length)continue;B!==v[0]&&O.push(P.length/2);let j=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),K=j.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(K+B.length-1,K),P.push(B[0].x),P.push(B[0].y);for(let Y=1;Y<B.length;Y++)this.layoutVertexArray.emplaceBack(B[Y].x,B[Y].y),this.indexArray2.emplaceBack(K+Y-1,K+Y),P.push(B[Y].x),P.push(B[Y].y);j.vertexLength+=B.length,j.primitiveLength+=B.length}let F=ud.exports(P,O);for(let B=0;B<F.length;B+=3)this.indexArray.emplaceBack(C+F[B],C+F[B+1],C+F[B+2]);M.vertexLength+=w,M.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,g,f)}}$e("FillBucket",zm,{omit:["layers","patternFeatures"]});let LI=new ri({"fill-sort-key":new it(_e.layout_fill["fill-sort-key"])});var OI={paint:new ri({"fill-antialias":new Ye(_e.paint_fill["fill-antialias"]),"fill-opacity":new it(_e.paint_fill["fill-opacity"]),"fill-color":new it(_e.paint_fill["fill-color"]),"fill-outline-color":new it(_e.paint_fill["fill-outline-color"]),"fill-translate":new Ye(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ns(_e.paint_fill["fill-pattern"])}),layout:LI};let NI=Rn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),RI=Rn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:FI}=NI;var zs={},zI=st,l0=kl;function kl(a,t,l,h,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=h,this._values=f,a.readFields(BI,this,t)}function BI(a,t,l){1==a?t.id=l.readVarint():2==a?function(h,f){for(var g=h.readVarint()+h.pos;h.pos<g;){var v=f._keys[h.readVarint()],w=f._values[h.readVarint()];f.properties[v]=w}}(l,t):3==a?t.type=l.readVarint():4==a&&(t._geometry=l.pos)}function jI(a){for(var t,l,h=0,f=0,g=a.length,v=g-1;f<g;v=f++)h+=((l=a[v]).x-(t=a[f]).x)*(t.y+l.y);return h}kl.types=["Unknown","Point","LineString","Polygon"],kl.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var t,l=a.readVarint()+a.pos,h=1,f=0,g=0,v=0,w=[];a.pos<l;){if(f<=0){var M=a.readVarint();h=7&M,f=M>>3}if(f--,1===h||2===h)g+=a.readSVarint(),v+=a.readSVarint(),1===h&&(t&&w.push(t),t=[]),t.push(new zI(g,v));else{if(7!==h)throw new Error("unknown command "+h);t&&t.push(t[0].clone())}}return t&&w.push(t),w},kl.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var t=a.readVarint()+a.pos,l=1,h=0,f=0,g=0,v=1/0,w=-1/0,M=1/0,C=-1/0;a.pos<t;){if(h<=0){var P=a.readVarint();l=7&P,h=P>>3}if(h--,1===l||2===l)(f+=a.readSVarint())<v&&(v=f),f>w&&(w=f),(g+=a.readSVarint())<M&&(M=g),g>C&&(C=g);else if(7!==l)throw new Error("unknown command "+l)}return[v,M,w,C]},kl.prototype.toGeoJSON=function(a,t,l){var h,f,g=this.extent*Math.pow(2,l),v=this.extent*a,w=this.extent*t,M=this.loadGeometry(),C=kl.types[this.type];function P(B){for(var j=0;j<B.length;j++){var K=B[j];B[j]=[360*(K.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(h=0;h<M.length;h++)O[h]=M[h][0];P(M=O);break;case 2:for(h=0;h<M.length;h++)P(M[h]);break;case 3:for(M=function(B){var j=B.length;if(j<=1)return[B];for(var K,Y,se=[],de=0;de<j;de++){var oe=jI(B[de]);0!==oe&&(void 0===Y&&(Y=oe<0),Y===oe<0?(K&&se.push(K),K=[B[de]]):K.push(B[de]))}return K&&se.push(K),se}(M),h=0;h<M.length;h++)for(f=0;f<M[h].length;f++)P(M[h][f])}1===M.length?M=M[0]:C="Multi"+C;var F={type:"Feature",geometry:{type:C,coordinates:M},properties:this.properties};return"id"in this&&(F.id=this.id),F};var UI=l0,c0=u0;function u0(a,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(VI,this,t),this.length=this._features.length}function VI(a,t,l){15===a?t.version=l.readVarint():1===a?t.name=l.readString():5===a?t.extent=l.readVarint():2===a?t._features.push(l.pos):3===a?t._keys.push(l.readString()):4===a&&t._values.push(function(h){for(var f=null,g=h.readVarint()+h.pos;h.pos<g;){var v=h.readVarint()>>3;f=1===v?h.readString():2===v?h.readFloat():3===v?h.readDouble():4===v?h.readVarint64():5===v?h.readVarint():6===v?h.readSVarint():7===v?h.readBoolean():null}return f}(l))}u0.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var t=this._pbf.readVarint()+this._pbf.pos;return new UI(this._pbf,t,this.extent,this._keys,this._values)};var $I=c0;function HI(a,t,l){if(3===a){var h=new $I(l,l.readVarint()+l.pos);h.length&&(t[h.name]=h)}}zs.VectorTile=function(a,t){this.layers=a.readFields(HI,{},t)},zs.VectorTileFeature=l0,zs.VectorTileLayer=c0;let GI=zs.VectorTileFeature.types,Bm=Math.pow(2,13);function xu(a,t,l,h,f,g,v,w){a.emplaceBack(t,l,2*Math.floor(h*Bm)+v,f*Bm*2,g*Bm*2,Math.round(w))}class jm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Lt,this.centroidVertexArray=new et,this.indexArray=new Ci,this.programConfigurations=new Sa(t.layers,t.zoom),this.segments=new It,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h){this.features=[],this.hasPattern=Rm("fill-extrusion",this.layers,l);for(let{feature:f,id:g,index:v,sourceLayerIndex:w}of t){let M=this.layers[0]._featureFilter.needGeometry,C=Aa(f,M);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),C,h))continue;let P={id:g,sourceLayerIndex:w,index:v,geometry:M?C.geometry:Ta(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Fm("fill-extrusion",this.layers,P,this.zoom,l)):this.addFeature(P,P.geometry,v,h,{}),l.featureIndex.insert(f,P.geometry,v,w,this.index,!0)}}addFeatures(t,l,h){for(let f of this.features){let{geometry:g}=f;this.addFeature(f,g,f.index,l,h)}}update(t,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,FI),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,RI.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,l,h,f,g){let v={x:0,y:0,vertexCount:0};for(let w of Nm(l,500)){let M=0;for(let j of w)M+=j.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let j of w){if(0===j.length||qI(j))continue;let K=0;for(let Y=0;Y<j.length;Y++){let se=j[Y];if(Y>=1){let de=j[Y-1];if(!ZI(se,de)){C.vertexLength+4>It.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let oe=se.sub(de)._perp()._unit(),ue=de.dist(se);K+ue>32768&&(K=0),xu(this.layoutVertexArray,se.x,se.y,oe.x,oe.y,0,0,K),xu(this.layoutVertexArray,se.x,se.y,oe.x,oe.y,0,1,K),v.x+=2*se.x,v.y+=2*se.y,v.vertexCount+=2,K+=ue,xu(this.layoutVertexArray,de.x,de.y,oe.x,oe.y,0,0,K),xu(this.layoutVertexArray,de.x,de.y,oe.x,oe.y,0,1,K),v.x+=2*de.x,v.y+=2*de.y,v.vertexCount+=2;let be=C.vertexLength;this.indexArray.emplaceBack(be,be+2,be+1),this.indexArray.emplaceBack(be+1,be+2,be+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+M>It.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),"Polygon"!==GI[t.type])continue;let P=[],O=[],F=C.vertexLength;for(let j of w)if(0!==j.length){j!==w[0]&&O.push(P.length/2);for(let K=0;K<j.length;K++){let Y=j[K];xu(this.layoutVertexArray,Y.x,Y.y,0,0,1,1,0),v.x+=Y.x,v.y+=Y.y,v.vertexCount+=1,P.push(Y.x),P.push(Y.y)}}let B=ud.exports(P,O);for(let j=0;j<B.length;j+=3)this.indexArray.emplaceBack(F+B[j],F+B[j+2],F+B[j+1]);C.primitiveLength+=B.length/3,C.vertexLength+=M}for(let w=0;w<v.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(v.x/v.vertexCount),Math.floor(v.y/v.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,g,f)}}function ZI(a,t){return a.x===t.x&&(a.x<0||a.x>$n)||a.y===t.y&&(a.y<0||a.y>$n)}function qI(a){return a.every(t=>t.x<0)||a.every(t=>t.x>$n)||a.every(t=>t.y<0)||a.every(t=>t.y>$n)}$e("FillExtrusionBucket",jm,{omit:["layers","features"]});var WI={paint:new ri({"fill-extrusion-opacity":new Ye(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new it(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ns(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new it(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new it(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function bu(a,t){return a.x*t.x+a.y*t.y}function h0(a,t){if(1===a.length){let f,l=0,h=t[l++];for(;!f||h.equals(f);)if(f=t[l++],!f)return 1/0;for(;l<t.length;l++){let g=t[l],v=a[0],w=f.sub(h),M=g.sub(h),C=v.sub(h),P=bu(w,w),O=bu(w,M),F=bu(M,M),B=bu(C,w),j=bu(C,M),K=P*F-O*O,Y=(F*B-O*j)/K,se=(P*j-O*B)/K,de=h.z*(1-Y-se)+f.z*Y+g.z*se;if(isFinite(de))return de}return 1/0}{let l=1/0;for(let h of t)l=Math.min(l,h.z);return l}}let YI=Rn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:KI}=YI,QI=Rn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:XI}=QI,JI=zs.VectorTileFeature.types,eD=Math.cos(Math.PI/180*37.5),d0=Math.pow(2,14)/.5;class Um{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Bt,this.layoutVertexArray2=new Qt,this.indexArray=new Ci,this.programConfigurations=new Sa(t.layers,t.zoom),this.segments=new It,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h){this.hasPattern=Rm("line",this.layers,l);let f=this.layers[0].layout.get("line-sort-key"),g=!f.isConstant(),v=[];for(let{feature:w,id:M,index:C,sourceLayerIndex:P}of t){let O=this.layers[0]._featureFilter.needGeometry,F=Aa(w,O);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),F,h))continue;let B=g?f.evaluate(F,{},h):void 0,j={id:M,properties:w.properties,type:w.type,sourceLayerIndex:P,index:C,geometry:O?F.geometry:Ta(w),patterns:{},sortKey:B};v.push(j)}g&&v.sort((w,M)=>w.sortKey-M.sortKey);for(let w of v){let{geometry:M,index:C,sourceLayerIndex:P}=w;if(this.hasPattern){let O=Fm("line",this.layers,w,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(w,M,C,h,{});l.featureIndex.insert(t[C].feature,M,C,P,this.index)}}update(t,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h)}addFeatures(t,l,h){for(let f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,XI)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,KI),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,l,h,f,g){let v=this.layers[0].layout,w=v.get("line-join").evaluate(t,{}),M=v.get("line-cap"),C=v.get("line-miter-limit"),P=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let O of l)this.addLine(O,t,w,M,C,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,g,f)}addLine(t,l,h,f,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<t.length-1;se++)this.totalDistance+=t[se].dist(t[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let w="Polygon"===JI[l.type],M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let C=0;for(;C<M-1&&t[C].equals(t[C+1]);)C++;if(M<(w?3:2))return;"bevel"===h&&(g=1.05);let F,B,j,K,Y,P=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);this.e1=this.e2=-1,w&&(F=t[M-2],Y=t[C].sub(F)._unit()._perp());for(let se=C;se<M;se++){if(j=se===M-1?w?t[C+1]:void 0:t[se+1],j&&t[se].equals(j))continue;Y&&(K=Y),F&&(B=F),F=t[se],Y=j?j.sub(F)._unit()._perp():K,K=K||Y;let de=K.add(Y);0===de.x&&0===de.y||de._unit();let oe=K.x*Y.x+K.y*Y.y,ue=de.x*Y.x+de.y*Y.y,be=0!==ue?1/ue:1/0,xe=2*Math.sqrt(2-2*ue),Ve=ue<eD&&B&&j,qe=K.x*Y.y-K.y*Y.x>0;if(Ve&&se>C){let De=F.dist(B);if(De>2*P){let Re=F.sub(F.sub(B)._mult(P/De)._round());this.updateDistance(B,Re),this.addCurrentVertex(Re,K,0,0,O),B=Re}}let Ne=B&&j,Te=Ne?h:w?"butt":f;if(Ne&&"round"===Te&&(be<v?Te="miter":be<=2&&(Te="fakeround")),"miter"===Te&&be>g&&(Te="bevel"),"bevel"===Te&&(be>2&&(Te="flipbevel"),be<g&&(Te="miter")),B&&this.updateDistance(B,F),"miter"===Te)de._mult(be),this.addCurrentVertex(F,de,0,0,O);else if("flipbevel"===Te){if(be>100)de=Y.mult(-1);else{let De=be*K.add(Y).mag()/K.sub(Y).mag();de._perp()._mult(De*(qe?-1:1))}this.addCurrentVertex(F,de,0,0,O),this.addCurrentVertex(F,de.mult(-1),0,0,O)}else if("bevel"===Te||"fakeround"===Te){let De=-Math.sqrt(be*be-1),Re=qe?De:0,ke=qe?0:De;if(B&&this.addCurrentVertex(F,K,Re,ke,O),"fakeround"===Te){let Ee=Math.round(180*xe/Math.PI/20);for(let tt=1;tt<Ee;tt++){let Qe=tt/Ee;if(.5!==Qe){let pn=Qe-.5;Qe+=Qe*pn*(Qe-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*pn*pn+(.848013+oe*(.215638*oe-1.06021)))}let bt=Y.sub(K)._mult(Qe)._add(K)._unit()._mult(qe?-1:1);this.addHalfVertex(F,bt.x,bt.y,!1,qe,0,O)}}j&&this.addCurrentVertex(F,Y,-Re,-ke,O)}else if("butt"===Te)this.addCurrentVertex(F,de,0,0,O);else if("square"===Te){let De=B?1:-1;this.addCurrentVertex(F,de,De,De,O)}else"round"===Te&&(B&&(this.addCurrentVertex(F,K,0,0,O),this.addCurrentVertex(F,K,1,1,O,!0)),j&&(this.addCurrentVertex(F,Y,-1,-1,O,!0),this.addCurrentVertex(F,Y,0,0,O)));if(Ve&&se<M-1){let De=F.dist(j);if(De>2*P){let Re=F.add(j.sub(F)._mult(P/De)._round());this.updateDistance(F,Re),this.addCurrentVertex(Re,Y,0,0,O),F=Re}}}}addCurrentVertex(t,l,h,f,g,v=!1){let w=l.y*f-l.x,M=-l.y-l.x*f;this.addHalfVertex(t,l.x+l.y*h,l.y-l.x*h,v,!1,h,g),this.addHalfVertex(t,w,M,v,!0,-f,g),this.distance>d0/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,l,h,f,g,v))}addHalfVertex({x:t,y:l},h,f,g,v,w,M){let C=.5*(this.lineClips?this.scaledDistance*(d0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(l<<1)+(v?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(0===w?0:w<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let P=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),M.primitiveLength++),v?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,l){this.distance+=t.dist(l),this.updateScaledDistance()}}$e("LineBucket",Um,{omit:["layers","patternFeatures"]});let tD=new ri({"line-cap":new Ye(_e.layout_line["line-cap"]),"line-join":new it(_e.layout_line["line-join"]),"line-miter-limit":new Ye(_e.layout_line["line-miter-limit"]),"line-round-limit":new Ye(_e.layout_line["line-round-limit"]),"line-sort-key":new it(_e.layout_line["line-sort-key"])});var p0={paint:new ri({"line-opacity":new it(_e.paint_line["line-opacity"]),"line-color":new it(_e.paint_line["line-color"]),"line-translate":new Ye(_e.paint_line["line-translate"]),"line-translate-anchor":new Ye(_e.paint_line["line-translate-anchor"]),"line-width":new it(_e.paint_line["line-width"]),"line-gap-width":new it(_e.paint_line["line-gap-width"]),"line-offset":new it(_e.paint_line["line-offset"]),"line-blur":new it(_e.paint_line["line-blur"]),"line-dasharray":new lu(_e.paint_line["line-dasharray"]),"line-pattern":new Ns(_e.paint_line["line-pattern"]),"line-gradient":new xo(_e.paint_line["line-gradient"])}),layout:tD};let f0=new class extends it{possiblyEvaluate(a,t){return t=new _n(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(a,t)}evaluate(a,t,l,h){return t=re({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(a,t,l,h)}}(p0.paint.properties["line-width"].specification);function m0(a,t){return t>0?t+2*a:a}f0.useIntegerZoom=!0;let nD=Rn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iD=Rn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Rn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let rD=Rn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Rn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let g0=Rn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),oD=Rn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function sD(a,t,l){return a.sections.forEach(h=>{h.text=function(f,g,v){let w=g.layout.get("text-transform").evaluate(v,{});return"uppercase"===w?f=f.toLocaleUpperCase():"lowercase"===w&&(f=f.toLocaleLowerCase()),Wi.applyArabicShaping&&(f=Wi.applyArabicShaping(f)),f}(h.text,t,l)}),a}Rn([{name:"triangle",components:3,type:"Uint16"}]),Rn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Rn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Rn([{type:"Float32",name:"offsetX"}]),Rn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);let wu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var oi=24,Vm=sn,y0=function(a,t,l,h,f){var g,v,w=8*f-h-1,M=(1<<w)-1,C=M>>1,P=-7,O=l?f-1:0,F=l?-1:1,B=a[t+O];for(O+=F,g=B&(1<<-P)-1,B>>=-P,P+=w;P>0;g=256*g+a[t+O],O+=F,P-=8);for(v=g&(1<<-P)-1,g>>=-P,P+=h;P>0;v=256*v+a[t+O],O+=F,P-=8);if(0===g)g=1-C;else{if(g===M)return v?NaN:1/0*(B?-1:1);v+=Math.pow(2,h),g-=C}return(B?-1:1)*v*Math.pow(2,g-h)},_0=function(a,t,l,h,f,g){var v,w,M,C=8*g-f-1,P=(1<<C)-1,O=P>>1,F=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,B=h?0:g-1,j=h?1:-1,K=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,v=P):(v=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-v))<1&&(v--,M*=2),(t+=v+O>=1?F/M:F*Math.pow(2,1-O))*M>=2&&(v++,M/=2),v+O>=P?(w=0,v=P):v+O>=1?(w=(t*M-1)*Math.pow(2,f),v+=O):(w=t*Math.pow(2,O-1)*Math.pow(2,f),v=0));f>=8;a[l+B]=255&w,B+=j,w/=256,f-=8);for(v=v<<f|w,C+=f;C>0;a[l+B]=255&v,B+=j,v/=256,C-=8);a[l+B-j]|=128*K};function sn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}sn.Varint=0,sn.Fixed64=1,sn.Bytes=2,sn.Fixed32=5;var Bs,$m=4294967296,v0=1/$m,x0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Xo(a){return a.type===sn.Bytes?a.readVarint()+a.pos:a.pos+1}function b0(a,t,l){var h=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));l.realloc(h);for(var f=l.pos-1;f>=a;f--)l.buf[f+h]=l.buf[f]}function aD(a,t){for(var l=0;l<a.length;l++)t.writeVarint(a[l])}function lD(a,t){for(var l=0;l<a.length;l++)t.writeSVarint(a[l])}function cD(a,t){for(var l=0;l<a.length;l++)t.writeFloat(a[l])}function uD(a,t){for(var l=0;l<a.length;l++)t.writeDouble(a[l])}function hD(a,t){for(var l=0;l<a.length;l++)t.writeBoolean(a[l])}function dD(a,t){for(var l=0;l<a.length;l++)t.writeFixed32(a[l])}function pD(a,t){for(var l=0;l<a.length;l++)t.writeSFixed32(a[l])}function fD(a,t){for(var l=0;l<a.length;l++)t.writeFixed64(a[l])}function mD(a,t){for(var l=0;l<a.length;l++)t.writeSFixed64(a[l])}function md(a,t){return(a[t]|a[t+1]<<8|a[t+2]<<16)+16777216*a[t+3]}function Ol(a,t,l){a[l]=t,a[l+1]=t>>>8,a[l+2]=t>>>16,a[l+3]=t>>>24}function w0(a,t){return(a[t]|a[t+1]<<8|a[t+2]<<16)+(a[t+3]<<24)}function gD(a,t,l){1===a&&l.readMessage(yD,t)}function yD(a,t,l){if(3===a){let{id:h,bitmap:f,width:g,height:v,left:w,top:M,advance:C}=l.readMessage(_D,{});t.push({id:h,bitmap:new mu({width:g+6,height:v+6},f),metrics:{width:g,height:v,left:w,top:M,advance:C}})}}function _D(a,t,l){1===a?t.id=l.readVarint():2===a?t.bitmap=l.readBytes():3===a?t.width=l.readVarint():4===a?t.height=l.readVarint():5===a?t.left=l.readSVarint():6===a?t.top=l.readSVarint():7===a&&(t.advance=l.readVarint())}function M0(a){let t=0,l=0;for(let v of a)t+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,w)=>w.h-v.h);let h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),l),h:1/0}],f=0,g=0;for(let v of a)for(let w=h.length-1;w>=0;w--){let M=h[w];if(!(v.w>M.w||v.h>M.h)){if(v.x=M.x,v.y=M.y,g=Math.max(g,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===M.w&&v.h===M.h){let C=h.pop();w<h.length&&(h[w]=C)}else v.h===M.h?(M.x+=v.w,M.w-=v.w):v.w===M.w?(M.y+=v.h,M.h-=v.h):(h.push({x:M.x+v.w,y:M.y,w:M.w-v.w,h:v.h}),M.y+=v.h,M.h-=v.h);break}}return{w:f,h:g,fill:t/(f*g)||0}}sn.prototype={destroy:function(){this.buf=null},readFields:function(a,t,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),f=h>>3,g=this.pos;this.type=7&h,a(f,t,this),this.pos===g&&this.skip(h)}return t},readMessage:function(a,t){return this.readFields(a,t,this.readVarint()+this.pos)},readFixed32:function(){var a=md(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=w0(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=md(this.buf,this.pos)+md(this.buf,this.pos+4)*$m;return this.pos+=8,a},readSFixed64:function(){var a=md(this.buf,this.pos)+w0(this.buf,this.pos+4)*$m;return this.pos+=8,a},readFloat:function(){var a=y0(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=y0(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var t,l,h=this.buf;return t=127&(l=h[this.pos++]),l<128?t:(t|=(127&(l=h[this.pos++]))<<7,l<128?t:(t|=(127&(l=h[this.pos++]))<<14,l<128?t:(t|=(127&(l=h[this.pos++]))<<21,l<128?t:function(f,g,v){var w,M,C=v.buf;if(w=(112&(M=C[v.pos++]))>>4,M<128||(w|=(127&(M=C[v.pos++]))<<3,M<128)||(w|=(127&(M=C[v.pos++]))<<10,M<128)||(w|=(127&(M=C[v.pos++]))<<17,M<128)||(w|=(127&(M=C[v.pos++]))<<24,M<128)||(w|=(1&(M=C[v.pos++]))<<31,M<128))return function(a,t,l){return l?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}(f,w,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(l=h[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,t=this.pos;return this.pos=a,a-t>=12&&x0?x0.decode(this.buf.subarray(t,a)):function(l,h,f){for(var g="",v=h;v<f;){var w,M,C,P=l[v],O=null,F=P>239?4:P>223?3:P>191?2:1;if(v+F>f)break;1===F?P<128&&(O=P):2===F?128==(192&(w=l[v+1]))&&(O=(31&P)<<6|63&w)<=127&&(O=null):3===F?(M=l[v+2],128==(192&(w=l[v+1]))&&128==(192&M)&&((O=(15&P)<<12|(63&w)<<6|63&M)<=2047||O>=55296&&O<=57343)&&(O=null)):4===F&&(M=l[v+2],C=l[v+3],128==(192&(w=l[v+1]))&&128==(192&M)&&128==(192&C)&&((O=(15&P)<<18|(63&w)<<12|(63&M)<<6|63&C)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,F=1):O>65535&&(O-=65536,g+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),g+=String.fromCharCode(O),v+=F}return g}(this.buf,t,a)},readBytes:function(){var a=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,a);return this.pos=a,t},readPackedVarint:function(a,t){if(this.type!==sn.Bytes)return a.push(this.readVarint(t));var l=Xo(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(t));return a},readPackedSVarint:function(a){if(this.type!==sn.Bytes)return a.push(this.readSVarint());var t=Xo(this);for(a=a||[];this.pos<t;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==sn.Bytes)return a.push(this.readBoolean());var t=Xo(this);for(a=a||[];this.pos<t;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==sn.Bytes)return a.push(this.readFloat());var t=Xo(this);for(a=a||[];this.pos<t;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==sn.Bytes)return a.push(this.readDouble());var t=Xo(this);for(a=a||[];this.pos<t;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==sn.Bytes)return a.push(this.readFixed32());var t=Xo(this);for(a=a||[];this.pos<t;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==sn.Bytes)return a.push(this.readSFixed32());var t=Xo(this);for(a=a||[];this.pos<t;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==sn.Bytes)return a.push(this.readFixed64());var t=Xo(this);for(a=a||[];this.pos<t;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==sn.Bytes)return a.push(this.readSFixed64());var t=Xo(this);for(a=a||[];this.pos<t;)a.push(this.readSFixed64());return a},skip:function(a){var t=7&a;if(t===sn.Varint)for(;this.buf[this.pos++]>127;);else if(t===sn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===sn.Fixed32)this.pos+=4;else{if(t!==sn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(a,t){this.writeVarint(a<<3|t)},realloc:function(a){for(var t=this.length||16;t<this.pos+a;)t*=2;if(t!==this.length){var l=new Uint8Array(t);l.set(this.buf),this.buf=l,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Ol(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Ol(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Ol(this.buf,-1&a,this.pos),Ol(this.buf,Math.floor(a*v0),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Ol(this.buf,-1&a,this.pos),Ol(this.buf,Math.floor(a*v0),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(t,l){var h,f,g,w;if(t>=0?(h=t%4294967296|0,f=t/4294967296|0):(f=~(-t/4294967296),4294967295^(h=~(-t%4294967296))?h=h+1|0:(h=0,f=f+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),g=h,(w=l).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,v){var w=(7&g)<<4;v.buf[v.pos++]|=w|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var t=this.pos;this.pos=function(h,f,g){for(var v,w,M=0;M<f.length;M++){if((v=f.charCodeAt(M))>55295&&v<57344){if(!w){v>56319||M+1===f.length?(h[g++]=239,h[g++]=191,h[g++]=189):w=v;continue}if(v<56320){h[g++]=239,h[g++]=191,h[g++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(h[g++]=239,h[g++]=191,h[g++]=189,w=null);v<128?h[g++]=v:(v<2048?h[g++]=v>>6|192:(v<65536?h[g++]=v>>12|224:(h[g++]=v>>18|240,h[g++]=v>>12&63|128),h[g++]=v>>6&63|128),h[g++]=63&v|128)}return g}(this.buf,a,this.pos);var l=this.pos-t;l>=128&&b0(t,l,this),this.pos=t-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),_0(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),_0(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var t=a.length;this.writeVarint(t),this.realloc(t);for(var l=0;l<t;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,t){this.pos++;var l=this.pos;a(t,this);var h=this.pos-l;h>=128&&b0(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(a,t,l){this.writeTag(a,sn.Bytes),this.writeRawMessage(t,l)},writePackedVarint:function(a,t){t.length&&this.writeMessage(a,aD,t)},writePackedSVarint:function(a,t){t.length&&this.writeMessage(a,lD,t)},writePackedBoolean:function(a,t){t.length&&this.writeMessage(a,hD,t)},writePackedFloat:function(a,t){t.length&&this.writeMessage(a,cD,t)},writePackedDouble:function(a,t){t.length&&this.writeMessage(a,uD,t)},writePackedFixed32:function(a,t){t.length&&this.writeMessage(a,dD,t)},writePackedSFixed32:function(a,t){t.length&&this.writeMessage(a,pD,t)},writePackedFixed64:function(a,t){t.length&&this.writeMessage(a,fD,t)},writePackedSFixed64:function(a,t){t.length&&this.writeMessage(a,mD,t)},writeBytesField:function(a,t){this.writeTag(a,sn.Bytes),this.writeBytes(t)},writeFixed32Field:function(a,t){this.writeTag(a,sn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(a,t){this.writeTag(a,sn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(a,t){this.writeTag(a,sn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(a,t){this.writeTag(a,sn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(a,t){this.writeTag(a,sn.Varint),this.writeVarint(t)},writeSVarintField:function(a,t){this.writeTag(a,sn.Varint),this.writeSVarint(t)},writeStringField:function(a,t){this.writeTag(a,sn.Bytes),this.writeString(t)},writeFloatField:function(a,t){this.writeTag(a,sn.Fixed32),this.writeFloat(t)},writeDoubleField:function(a,t){this.writeTag(a,sn.Fixed64),this.writeDouble(t)},writeBooleanField:function(a,t){this.writeVarintField(a,Boolean(t))}};class Hm{constructor(t,{pixelRatio:l,version:h,stretchX:f,stretchY:g,content:v}){this.paddedRect=t,this.pixelRatio=l,this.stretchX=f,this.stretchY=g,this.content=v,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class E0{constructor(t,l){let h={},f={};this.haveRenderCallbacks=[];let g=[];this.addImages(t,h,g),this.addImages(l,f,g);let{w:v,h:w}=M0(g),M=new rr({width:v||1,height:w||1});for(let C in t){let P=t[C],O=h[C].paddedRect;rr.copy(P.data,M,{x:0,y:0},{x:O.x+1,y:O.y+1},P.data)}for(let C in l){let P=l[C],O=f[C].paddedRect,F=O.x+1,B=O.y+1,j=P.data.width,K=P.data.height;rr.copy(P.data,M,{x:0,y:0},{x:F,y:B},P.data),rr.copy(P.data,M,{x:0,y:K-1},{x:F,y:B-1},{width:j,height:1}),rr.copy(P.data,M,{x:0,y:0},{x:F,y:B+K},{width:j,height:1}),rr.copy(P.data,M,{x:j-1,y:0},{x:F-1,y:B},{width:1,height:K}),rr.copy(P.data,M,{x:0,y:0},{x:F+j,y:B},{width:1,height:K})}this.image=M,this.iconPositions=h,this.patternPositions=f}addImages(t,l,h){for(let f in t){let g=t[f],v={x:0,y:0,w:g.data.width+2,h:g.data.height+2};h.push(v),l[f]=new Hm(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,l){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let h in t.updatedImages)this.patchUpdatedImage(this.iconPositions[h],t.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],t.getImage(h),l)}patchUpdatedImage(t,l,h){if(!t||!l||t.version===l.version)return;t.version=l.version;let[f,g]=t.tl;h.update(l.data,void 0,{x:f,y:g})}}$e("ImagePosition",Hm),$e("ImageAtlas",E0),o.WritingMode=void 0,(Bs=o.WritingMode||(o.WritingMode={}))[Bs.none=0]="none",Bs[Bs.horizontal=1]="horizontal",Bs[Bs.vertical=2]="vertical",Bs[Bs.horizontalOnly=3]="horizontalOnly";let gd=-17;class Mu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,l){let h=new Mu;return h.scale=t||1,h.fontStack=l,h}static forImage(t){let l=new Mu;return l.imageName=t,l}}class Nl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,l){let h=new Nl;for(let f=0;f<t.sections.length;f++){let g=t.sections[f];g.image?h.addImageSection(g):h.addTextSection(g,l)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let l="";for(let h=0;h<t.length;h++){let f=t.charCodeAt(h+1)||null,g=t.charCodeAt(h-1)||null;l+=f&&Kh(f)&&!wu[t[h+1]]||g&&Kh(g)&&!wu[t[h-1]]||!wu[t[h]]?t[h]:wu[t[h]]}return l}(this.text)}trim(){let t=0;for(let h=0;h<this.text.length&&_d[this.text.charCodeAt(h)];h++)t++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=t&&_d[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(t,l),this.sectionIndex=this.sectionIndex.slice(t,l)}substring(t,l){let h=new Nl;return h.text=this.text.substring(t,l),h.sectionIndex=this.sectionIndex.slice(t,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,l)=>Math.max(t,this.sections[l].scale),0)}addTextSection(t,l){this.text+=t.text,this.sections.push(Mu.forText(t.scale,t.fontStack||l));let h=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(h)}addImageSection(t){let l=t.image?t.image.name:"";if(0===l.length)return void rt("Can't add FormattedSection with an empty image.");let h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Mu.forImage(l)),this.sectionIndex.push(this.sections.length-1)):rt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yd(a,t,l,h,f,g,v,w,M,C,P,O,F,B,j,K){let se,Y=Nl.fromFeature(a,f);O===o.WritingMode.vertical&&Y.verticalizePunctuation();let{processBidirectionalText:de,processStyledBidirectionalText:oe}=Wi;if(de&&1===Y.sections.length){se=[];let xe=de(Y.toString(),Gm(Y,C,g,t,h,B,j));for(let Ve of xe){let qe=new Nl;qe.text=Ve,qe.sections=Y.sections;for(let Ne=0;Ne<Ve.length;Ne++)qe.sectionIndex.push(0);se.push(qe)}}else if(oe){se=[];let xe=oe(Y.text,Y.sectionIndex,Gm(Y,C,g,t,h,B,j));for(let Ve of xe){let qe=new Nl;qe.text=Ve[0],qe.sectionIndex=Ve[1],qe.sections=Y.sections,se.push(qe)}}else se=function(xe,Ve){let qe=[],Ne=xe.text,Te=0;for(let De of Ve)qe.push(xe.substring(Te,De)),Te=De;return Te<Ne.length&&qe.push(xe.substring(Te,Ne.length)),qe}(Y,Gm(Y,C,g,t,h,B,j));let ue=[],be={positionedLines:ue,text:Y.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(xe,Ve,qe,Ne,Te,De,Re,ke,Ee,tt,Qe,bt){let pn=0,xn=gd,Hn=0,sr=0,li="right"===ke?1:"left"===ke?0:.5,Fn=0;for(let zn of Te){zn.trim();let ui=zn.getMaxScale(),vi=(ui-1)*oi,Ai={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Fn]=Ai;let ji=Ai.positionedGlyphs,Ui=0;if(!zn.length()){xn+=De,++Fn;continue}for(let Jn=0;Jn<zn.length();Jn++){let Dt=zn.getSection(Jn),Qi=zn.getSectionIndex(Jn),hi=zn.getCharCode(Jn),xi=0,Ir=null,Vr=null,$r=null,es=oi,Dr=!(Ee===o.WritingMode.horizontal||!Qe&&!nu(hi)||Qe&&(_d[hi]||(Xn=hi,Oe.Arabic(Xn)||Oe["Arabic Supplement"](Xn)||Oe["Arabic Extended-A"](Xn)||Oe["Arabic Presentation Forms-A"](Xn)||Oe["Arabic Presentation Forms-B"](Xn))));if(Dt.imageName){let ar=Ne[Dt.imageName];if(!ar)continue;$r=Dt.imageName,xe.iconsInText=xe.iconsInText||!0,Vr=ar.paddedRect;let Vi=ar.displaySize;Dt.scale=Dt.scale*oi/bt,Ir={width:Vi[0],height:Vi[1],left:1,top:-3,advance:Dr?Vi[1]:Vi[0]},xi=vi+(oi-Vi[1]*Dt.scale),es=Ir.advance;let ts=Dr?Vi[0]*Dt.scale-oi*ui:Vi[1]*Dt.scale-oi*ui;ts>0&&ts>Ui&&(Ui=ts)}else{let ar=qe[Dt.fontStack],Vi=ar&&ar[hi];if(Vi&&Vi.rect)Vr=Vi.rect,Ir=Vi.metrics;else{let ts=Ve[Dt.fontStack],Du=ts&&ts[hi];if(!Du)continue;Ir=Du.metrics}xi=(ui-Dt.scale)*oi}Dr?(xe.verticalizable=!0,ji.push({glyph:hi,imageName:$r,x:pn,y:xn+xi,vertical:Dr,scale:Dt.scale,fontStack:Dt.fontStack,sectionIndex:Qi,metrics:Ir,rect:Vr}),pn+=es*Dt.scale+tt):(ji.push({glyph:hi,imageName:$r,x:pn,y:xn+xi,vertical:Dr,scale:Dt.scale,fontStack:Dt.fontStack,sectionIndex:Qi,metrics:Ir,rect:Vr}),pn+=Ir.advance*Dt.scale+tt)}0!==ji.length&&(Hn=Math.max(pn-tt,Hn),bD(ji,0,ji.length-1,li,Ui)),pn=0;let En=De*ui+Ui;Ai.lineOffset=Math.max(Ui,vi),xn+=En,sr=Math.max(En,sr),++Fn}var Xn;let ci=xn-gd,{horizontalAlign:_i,verticalAlign:Bi}=Zm(Re);(function(zn,ui,vi,Ai,ji,Ui,En,Jn,Dt){let Qi=(ui-vi)*ji,hi=0;hi=Ui!==En?-Jn*Ai-gd:(-Ai*Dt+.5)*En;for(let xi of zn)for(let Ir of xi.positionedGlyphs)Ir.x+=Qi,Ir.y+=hi})(xe.positionedLines,li,_i,Bi,Hn,sr,De,ci,Te.length),xe.top+=-Bi*ci,xe.bottom=xe.top+ci,xe.left+=-_i*Hn,xe.right=xe.left+Hn}(be,t,l,h,se,v,w,M,O,C,F,K),!function(xe){for(let Ve of xe)if(0!==Ve.positionedGlyphs.length)return!1;return!0}(ue)&&be}let _d={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vD={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function I0(a,t,l,h,f,g){if(t.imageName){let v=h[t.imageName];return v?v.displaySize[0]*t.scale*oi/g+f:0}{let v=l[t.fontStack],w=v&&v[a];return w?w.metrics.advance*t.scale+f:0}}function D0(a,t,l,h){let f=Math.pow(a-t,2);return h?a<t?f/2:2*f:f+Math.abs(l)*l}function xD(a,t,l){let h=0;return 10===a&&(h-=1e4),l&&(h+=150),40!==a&&65288!==a||(h+=50),41!==t&&65289!==t||(h+=50),h}function C0(a,t,l,h,f,g){let v=null,w=D0(t,l,f,g);for(let M of h){let C=D0(t-M.x,l,f,g)+M.badness;C<=w&&(v=M,w=C)}return{index:a,x:t,priorBreak:v,badness:w}}function S0(a){return a?S0(a.priorBreak).concat(a.index):[]}function Gm(a,t,l,h,f,g,v){if("point"!==g)return[];if(!a)return[];let w=[],M=function(F,B,j,K,Y,se){let de=0;for(let oe=0;oe<F.length();oe++){let ue=F.getSection(oe);de+=I0(F.getCharCode(oe),ue,K,Y,B,se)}return de/Math.max(1,Math.ceil(de/j))}(a,t,l,h,f,v),C=a.text.indexOf("\u200b")>=0,P=0;for(let F=0;F<a.length();F++){let B=a.getSection(F),j=a.getCharCode(F);if(_d[j]||(P+=I0(j,B,h,f,t,v)),F<a.length()-1){let K=!((O=j)<11904||!(Oe["Bopomofo Extended"](O)||Oe.Bopomofo(O)||Oe["CJK Compatibility Forms"](O)||Oe["CJK Compatibility Ideographs"](O)||Oe["CJK Compatibility"](O)||Oe["CJK Radicals Supplement"](O)||Oe["CJK Strokes"](O)||Oe["CJK Symbols and Punctuation"](O)||Oe["CJK Unified Ideographs Extension A"](O)||Oe["CJK Unified Ideographs"](O)||Oe["Enclosed CJK Letters and Months"](O)||Oe["Halfwidth and Fullwidth Forms"](O)||Oe.Hiragana(O)||Oe["Ideographic Description Characters"](O)||Oe["Kangxi Radicals"](O)||Oe["Katakana Phonetic Extensions"](O)||Oe.Katakana(O)||Oe["Vertical Forms"](O)||Oe["Yi Radicals"](O)||Oe["Yi Syllables"](O)));(vD[j]||K||B.imageName)&&w.push(C0(F+1,P,M,w,xD(j,a.getCharCode(F+1),K&&C),!1))}}var O;return S0(C0(a.length(),P,M,w,0,!0))}function Zm(a){let t=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:t,verticalAlign:l}}function bD(a,t,l,h,f){if(!h&&!f)return;let g=a[l],v=(a[l].x+g.metrics.advance*g.scale)*h;for(let w=t;w<=l;w++)a[w].x-=v,a[w].y+=f}function wD(a,t,l){let{horizontalAlign:h,verticalAlign:f}=Zm(l),g=t[0]-a.displaySize[0]*h,v=t[1]-a.displaySize[1]*f;return{image:a,top:v,bottom:v+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function T0(a,t,l,h,f,g){let w,v=a.image;if(v.content){let Y=v.content,se=v.pixelRatio||1;w=[Y[0]/se,Y[1]/se,v.displaySize[0]-Y[2]/se,v.displaySize[1]-Y[3]/se]}let P,O,F,B,M=t.left*g,C=t.right*g;"width"===l||"both"===l?(B=f[0]+M-h[3],O=f[0]+C+h[1]):(B=f[0]+(M+C-v.displaySize[0])/2,O=B+v.displaySize[0]);let j=t.top*g,K=t.bottom*g;return"height"===l||"both"===l?(P=f[1]+j-h[0],F=f[1]+K+h[2]):(P=f[1]+(j+K-v.displaySize[1])/2,F=P+v.displaySize[1]),{image:v,top:P,right:O,bottom:F,left:B,collisionPadding:w}}let Jo=128;function A0(a,t){let{expression:l}=t;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new _n(a+1))};if("source"===l.kind)return{kind:"source"};{let{zoomStops:h,interpolationType:f}=l,g=0;for(;g<h.length&&h[g]<=a;)g++;g=Math.max(0,g-1);let v=g;for(;v<h.length&&h[v]<a+1;)v++;v=Math.min(h.length-1,v);let w=h[g],M=h[v];return"composite"===l.kind?{kind:"composite",minZoom:w,maxZoom:M,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:M,minSize:l.evaluate(new _n(w)),maxSize:l.evaluate(new _n(M)),interpolationType:f}}}class js extends st{constructor(t,l,h,f){super(t,l),this.angle=h,void 0!==f&&(this.segment=f)}clone(){return new js(this.x,this.y,this.angle,this.segment)}}function P0(a,t,l,h,f){if(void 0===t.segment)return!0;let g=t,v=t.segment+1,w=0;for(;w>-l/2;){if(v--,v<0)return!1;w-=a[v].dist(g),g=a[v]}w+=a[v].dist(a[v+1]),v++;let M=[],C=0;for(;w<l/2;){let P=a[v],O=a[v+1];if(!O)return!1;let F=a[v-1].angleTo(P)-P.angleTo(O);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:w,angleDelta:F}),C+=F;w-M[0].distance>h;)C-=M.shift().angleDelta;if(C>f)return!1;v++,w+=P.dist(O)}return!0}function k0(a){let t=0;for(let l=0;l<a.length-1;l++)t+=a[l].dist(a[l+1]);return t}function L0(a,t,l){return a?.6*t*l:0}function O0(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function MD(a,t,l,h,f,g){let v=L0(l,f,g),w=O0(l,h)*g,M=0,C=k0(a)/2;for(let P=0;P<a.length-1;P++){let O=a[P],F=a[P+1],B=O.dist(F);if(M+B>C){let j=(C-M)/B,K=gn(O.x,F.x,j),Y=gn(O.y,F.y,j),se=new js(K,Y,F.angleTo(O),P);return se._round(),!v||P0(a,se,w,v,t)?se:void 0}M+=B}}function ED(a,t,l,h,f,g,v,w,M){let C=L0(h,g,v),P=O0(h,f),O=P*v,F=0===a[0].x||a[0].x===M||0===a[0].y||a[0].y===M;return t-O<t/4&&(t=O+t/4),N0(a,F?t/2*w%t:(P/2+2*g)*v*w%t,t,C,l,O,F,!1,M)}function N0(a,t,l,h,f,g,v,w,M){let C=g/2,P=k0(a),O=0,F=t-l,B=[];for(let j=0;j<a.length-1;j++){let K=a[j],Y=a[j+1],se=K.dist(Y),de=Y.angleTo(K);for(;F+l<O+se;){F+=l;let oe=(F-O)/se,ue=gn(K.x,Y.x,oe),be=gn(K.y,Y.y,oe);if(ue>=0&&ue<M&&be>=0&&be<M&&F-C>=0&&F+C<=P){let xe=new js(ue,be,de,j);xe._round(),h&&!P0(a,xe,g,h,f)||B.push(xe)}}O+=se}return w||B.length||v||(B=N0(a,O/2,l,h,f,g,v,!0,M)),B}function R0(a,t,l,h,f){let g=[];for(let v=0;v<a.length;v++){let M,w=a[v];for(let C=0;C<w.length-1;C++){let P=w[C],O=w[C+1];P.x<t&&O.x<t||(P.x<t?P=new st(t,P.y+(t-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x<t&&(O=new st(t,P.y+(t-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y<l&&O.y<l||(P.y<l?P=new st(P.x+(l-P.y)/(O.y-P.y)*(O.x-P.x),l)._round():O.y<l&&(O=new st(P.x+(l-P.y)/(O.y-P.y)*(O.x-P.x),l)._round()),P.x>=h&&O.x>=h||(P.x>=h?P=new st(h,P.y+(h-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x>=h&&(O=new st(h,P.y+(h-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y>=f&&O.y>=f||(P.y>=f?P=new st(P.x+(f-P.y)/(O.y-P.y)*(O.x-P.x),f)._round():O.y>=f&&(O=new st(P.x+(f-P.y)/(O.y-P.y)*(O.x-P.x),f)._round()),M&&P.equals(M[M.length-1])||(M=[P],g.push(M)),M.push(O)))))}}return g}function F0(a,t,l,h){let f=[],g=a.image,v=g.pixelRatio,w=g.paddedRect.w-2,M=g.paddedRect.h-2,C=a.right-a.left,P=a.bottom-a.top,O=g.stretchX||[[0,w]],F=g.stretchY||[[0,M]],B=(De,Re)=>De+Re[1]-Re[0],j=O.reduce(B,0),K=F.reduce(B,0),Y=w-j,se=M-K,de=0,oe=j,ue=0,be=K,xe=0,Ve=Y,qe=0,Ne=se;if(g.content&&h){let De=g.content;de=vd(O,0,De[0]),ue=vd(F,0,De[1]),oe=vd(O,De[0],De[2]),be=vd(F,De[1],De[3]),xe=De[0]-de,qe=De[1]-ue,Ve=De[2]-De[0]-oe,Ne=De[3]-De[1]-be}let Te=(De,Re,ke,Ee)=>{let tt=xd(De.stretch-de,oe,C,a.left),Qe=bd(De.fixed-xe,Ve,De.stretch,j),bt=xd(Re.stretch-ue,be,P,a.top),pn=bd(Re.fixed-qe,Ne,Re.stretch,K),xn=xd(ke.stretch-de,oe,C,a.left),Hn=bd(ke.fixed-xe,Ve,ke.stretch,j),sr=xd(Ee.stretch-ue,be,P,a.top),li=bd(Ee.fixed-qe,Ne,Ee.stretch,K),Fn=new st(tt,bt),Xn=new st(xn,bt),ci=new st(xn,sr),_i=new st(tt,sr),Bi=new st(Qe/v,pn/v),zn=new st(Hn/v,li/v),ui=t*Math.PI/180;if(ui){let ji=Math.sin(ui),Ui=Math.cos(ui),En=[Ui,-ji,ji,Ui];Fn._matMult(En),Xn._matMult(En),_i._matMult(En),ci._matMult(En)}let vi=De.stretch+De.fixed,Ai=Re.stretch+Re.fixed;return{tl:Fn,tr:Xn,bl:_i,br:ci,tex:{x:g.paddedRect.x+1+vi,y:g.paddedRect.y+1+Ai,w:ke.stretch+ke.fixed-vi,h:Ee.stretch+Ee.fixed-Ai},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bi,pixelOffsetBR:zn,minFontScaleX:Ve/v/C,minFontScaleY:Ne/v/P,isSDF:l}};if(h&&(g.stretchX||g.stretchY)){let De=z0(O,Y,j),Re=z0(F,se,K);for(let ke=0;ke<De.length-1;ke++){let Ee=De[ke],tt=De[ke+1];for(let Qe=0;Qe<Re.length-1;Qe++)f.push(Te(Ee,Re[Qe],tt,Re[Qe+1]))}}else f.push(Te({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:M+1}));return f}function vd(a,t,l){let h=0;for(let f of a)h+=Math.max(t,Math.min(l,f[1]))-Math.max(t,Math.min(l,f[0]));return h}function z0(a,t,l){let h=[{fixed:-1,stretch:0}];for(let[f,g]of a){let v=h[h.length-1];h.push({fixed:f-v.stretch,stretch:v.stretch}),h.push({fixed:f-v.stretch,stretch:v.stretch+(g-f)})}return h.push({fixed:t+1,stretch:l}),h}function xd(a,t,l,h){return a/t*l+h}function bd(a,t,l,h){return a-t*l/h}$e("Anchor",js);class wd{constructor(t,l,h,f,g,v,w,M,C,P){if(this.boxStartIndex=t.length,C){let O=v.top,F=v.bottom,B=v.collisionPadding;B&&(O-=B[1],F+=B[3]);let j=F-O;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let O=v.top*w-M[0],F=v.bottom*w+M[2],B=v.left*w-M[3],j=v.right*w+M[1],K=v.collisionPadding;if(K&&(B-=K[0]*w,O-=K[1]*w,j+=K[2]*w,F+=K[3]*w),P){let Y=new st(B,O),se=new st(j,O),de=new st(B,F),oe=new st(j,F),ue=P*Math.PI/180;Y._rotate(ue),se._rotate(ue),de._rotate(ue),oe._rotate(ue),B=Math.min(Y.x,se.x,de.x,oe.x),j=Math.max(Y.x,se.x,de.x,oe.x),O=Math.min(Y.y,se.y,de.y,oe.y),F=Math.max(Y.y,se.y,de.y,oe.y)}t.emplaceBack(l.x,l.y,B,O,j,F,h,f,g)}this.boxEndIndex=t.length}}class ID{constructor(t=[],l=DD){if(this.data=t,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let t=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:l,compare:h}=this,f=l[t];for(;t>0;){let g=t-1>>1,v=l[g];if(h(f,v)>=0)break;l[t]=v,t=g}l[t]=f}_down(t){let{data:l,compare:h}=this,f=this.length>>1,g=l[t];for(;t<f;){let v=1+(t<<1),w=l[v],M=v+1;if(M<this.length&&h(l[M],w)<0&&(v=M,w=l[M]),h(w,g)>=0)break;l[t]=w,t=v}l[t]=g}}function DD(a,t){return a<t?-1:a>t?1:0}function CD(a,t=1,l=!1){let h=1/0,f=1/0,g=-1/0,v=-1/0,w=a[0];for(let B=0;B<w.length;B++){let j=w[B];(!B||j.x<h)&&(h=j.x),(!B||j.y<f)&&(f=j.y),(!B||j.x>g)&&(g=j.x),(!B||j.y>v)&&(v=j.y)}let M=Math.min(g-h,v-f),C=M/2,P=new ID([],SD);if(0===M)return new st(h,f);for(let B=h;B<g;B+=M)for(let j=f;j<v;j+=M)P.push(new Rl(B+C,j+C,C,a));let O=function(B){let j=0,K=0,Y=0,se=B[0];for(let de=0,oe=se.length,ue=oe-1;de<oe;ue=de++){let be=se[de],xe=se[ue],Ve=be.x*xe.y-xe.x*be.y;K+=(be.x+xe.x)*Ve,Y+=(be.y+xe.y)*Ve,j+=3*Ve}return new Rl(K/j,Y/j,0,B)}(a),F=P.length;for(;P.length;){let B=P.pop();(B.d>O.d||!O.d)&&(O=B,l&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,F)),B.max-O.d<=t||(C=B.h/2,P.push(new Rl(B.p.x-C,B.p.y-C,C,a)),P.push(new Rl(B.p.x+C,B.p.y-C,C,a)),P.push(new Rl(B.p.x-C,B.p.y+C,C,a)),P.push(new Rl(B.p.x+C,B.p.y+C,C,a)),F+=4)}return l&&(console.log(`num probes: ${F}`),console.log(`best distance: ${O.d}`)),O.p}function SD(a,t){return t.max-a.max}function Rl(a,t,l,h){this.p=new st(a,t),this.h=l,this.d=function(f,g){let v=!1,w=1/0;for(let M=0;M<g.length;M++){let C=g[M];for(let P=0,O=C.length,F=O-1;P<O;F=P++){let B=C[P],j=C[F];B.y>f.y!=j.y>f.y&&f.x<(j.x-B.x)*(f.y-B.y)/(j.y-B.y)+B.x&&(v=!v),w=Math.min(w,Zv(f,B,j))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}let qm=Number.POSITIVE_INFINITY;function B0(a,t){return t[1]!==qm?function(l,h,f){let g=0,v=0;switch(h=Math.abs(h),f=Math.abs(f),l){case"top-right":case"top-left":case"top":v=f-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-f}switch(l){case"top-right":case"bottom-right":case"right":g=-h;break;case"top-left":case"bottom-left":case"left":g=h}return[g,v]}(a,t[0],t[1]):function(l,h){let f=0,g=0;h<0&&(h=0);let v=h/Math.sqrt(2);switch(l){case"top-right":case"top-left":g=v-7;break;case"bottom-right":case"bottom-left":g=7-v;break;case"bottom":g=7-h;break;case"top":g=h-7}switch(l){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=h;break;case"right":f=-h}return[f,g]}(a,t[0])}function Wm(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function TD(a,t,l,h,f,g,v,w,M,C,P){let O=g.textMaxSize.evaluate(t,{});void 0===O&&(O=v);let Re,F=a.layers[0].layout,B=F.get("icon-offset").evaluate(t,{},P),j=U0(l.horizontal),K=v/24,Y=a.tilePixelRatio*K,se=a.tilePixelRatio*O/24,de=a.tilePixelRatio*w,oe=a.tilePixelRatio*F.get("symbol-spacing"),ue=F.get("text-padding")*a.tilePixelRatio,be=function(Ee,tt,Qe,bt=1){let pn=Ee.get("icon-padding").evaluate(tt,{},Qe),xn=pn&&pn.values;return[xn[0]*bt,xn[1]*bt,xn[2]*bt,xn[3]*bt]}(F,t,P,a.tilePixelRatio),xe=F.get("text-max-angle")/180*Math.PI,Ve="viewport"!==F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),qe="map"===F.get("icon-rotation-alignment")&&"point"!==F.get("symbol-placement"),Ne=F.get("symbol-placement"),Te=oe/2,De=F.get("icon-text-fit");h&&"none"!==De&&(a.allowVerticalPlacement&&l.vertical&&(Re=T0(h,l.vertical,De,F.get("icon-text-fit-padding"),B,K)),j&&(h=T0(h,j,De,F.get("icon-text-fit-padding"),B,K)));let ke=(Ee,tt)=>{tt.x<0||tt.x>=$n||tt.y<0||tt.y>=$n||function(Qe,bt,pn,xn,Hn,sr,li,Fn,Xn,ci,_i,Bi,zn,ui,vi,Ai,ji,Ui,En,Jn,Dt,Qi,hi,xi,Ir){let $r,es,Dr,ar,Vr=Qe.addToLineVertexArray(bt,pn),Vi=0,ts=0,Du=0,ix=0,rg=-1,og=-1,ns={},rx=Qn.exports(""),sg=0,ag=0;if(void 0===Fn._unevaluatedLayout.getValue("text-radial-offset")?[sg,ag]=Fn.layout.get("text-offset").evaluate(Dt,{},xi).map($i=>$i*oi):(sg=Fn.layout.get("text-radial-offset").evaluate(Dt,{},xi)*oi,ag=qm),Qe.allowVerticalPlacement&&xn.vertical){let $i=Fn.layout.get("text-rotate").evaluate(Dt,{},xi)+90;Dr=new wd(Xn,bt,ci,_i,Bi,xn.vertical,zn,ui,vi,$i),li&&(ar=new wd(Xn,bt,ci,_i,Bi,li,ji,Ui,vi,$i))}if(Hn){let $i=Fn.layout.get("icon-rotate").evaluate(Dt,{}),Io="none"!==Fn.layout.get("icon-text-fit"),Cu=F0(Hn,$i,hi,Io),Su=li?F0(li,$i,hi,Io):void 0;es=new wd(Xn,bt,ci,_i,Bi,Hn,ji,Ui,!1,$i),Vi=4*Cu.length;let ax=Qe.iconSizeData,La=null;"source"===ax.kind?(La=[Jo*Fn.layout.get("icon-size").evaluate(Dt,{})],La[0]>Us&&rt(`${Qe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===ax.kind&&(La=[Jo*Qi.compositeIconSizes[0].evaluate(Dt,{},xi),Jo*Qi.compositeIconSizes[1].evaluate(Dt,{},xi)],(La[0]>Us||La[1]>Us)&&rt(`${Qe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Qe.addSymbols(Qe.icon,Cu,La,Jn,En,Dt,o.WritingMode.none,bt,Vr.lineStartIndex,Vr.lineLength,-1,xi),rg=Qe.icon.placedSymbolArray.length-1,Su&&(ts=4*Su.length,Qe.addSymbols(Qe.icon,Su,La,Jn,En,Dt,o.WritingMode.vertical,bt,Vr.lineStartIndex,Vr.lineLength,-1,xi),og=Qe.icon.placedSymbolArray.length-1)}let ox=Object.keys(xn.horizontal);for(let $i of ox){let Io=xn.horizontal[$i];if(!$r){rx=Qn.exports(Io.text);let Su=Fn.layout.get("text-rotate").evaluate(Dt,{},xi);$r=new wd(Xn,bt,ci,_i,Bi,Io,zn,ui,vi,Su)}let Cu=1===Io.positionedLines.length;if(Du+=j0(Qe,bt,Io,sr,Fn,vi,Dt,Ai,Vr,xn.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,Cu?ox:[$i],ns,rg,Qi,xi),Cu)break}xn.vertical&&(ix+=j0(Qe,bt,xn.vertical,sr,Fn,vi,Dt,Ai,Vr,o.WritingMode.vertical,["vertical"],ns,og,Qi,xi));let VD=$r?$r.boxStartIndex:Qe.collisionBoxArray.length,$D=$r?$r.boxEndIndex:Qe.collisionBoxArray.length,HD=Dr?Dr.boxStartIndex:Qe.collisionBoxArray.length,GD=Dr?Dr.boxEndIndex:Qe.collisionBoxArray.length,ZD=es?es.boxStartIndex:Qe.collisionBoxArray.length,qD=es?es.boxEndIndex:Qe.collisionBoxArray.length,WD=ar?ar.boxStartIndex:Qe.collisionBoxArray.length,YD=ar?ar.boxEndIndex:Qe.collisionBoxArray.length,Hr=-1,Cd=($i,Io)=>$i&&$i.circleDiameter?Math.max($i.circleDiameter,Io):Io;Hr=Cd($r,Hr),Hr=Cd(Dr,Hr),Hr=Cd(es,Hr),Hr=Cd(ar,Hr);let sx=Hr>-1?1:0;sx&&(Hr*=Ir/oi),Qe.glyphOffsetArray.length>=Fl.MAX_GLYPHS&&rt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Dt.sortKey&&Qe.addToSortKeyRanges(Qe.symbolInstances.length,Dt.sortKey),Qe.symbolInstances.emplaceBack(bt.x,bt.y,ns.right>=0?ns.right:-1,ns.center>=0?ns.center:-1,ns.left>=0?ns.left:-1,ns.vertical||-1,rg,og,rx,VD,$D,HD,GD,ZD,qD,WD,YD,ci,Du,ix,Vi,ts,sx,0,zn,sg,ag,Hr)}(a,tt,Ee,l,h,f,Re,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,Y,[ue,ue,ue,ue],Ve,M,de,be,qe,B,t,g,C,P,v)};if("line"===Ne)for(let Ee of R0(t.geometry,0,0,$n,$n)){let tt=ED(Ee,oe,xe,l.vertical||j,h,24,se,a.overscaling,$n);for(let Qe of tt)j&&AD(a,j.text,Te,Qe)||ke(Ee,Qe)}else if("line-center"===Ne){for(let Ee of t.geometry)if(Ee.length>1){let tt=MD(Ee,xe,l.vertical||j,h,24,se);tt&&ke(Ee,tt)}}else if("Polygon"===t.type)for(let Ee of Nm(t.geometry,0)){let tt=CD(Ee,16);ke(Ee[0],new js(tt.x,tt.y,0))}else if("LineString"===t.type)for(let Ee of t.geometry)ke(Ee,new js(Ee[0].x,Ee[0].y,0));else if("Point"===t.type)for(let Ee of t.geometry)for(let tt of Ee)ke([tt],new js(tt.x,tt.y,0))}let Us=32640;function j0(a,t,l,h,f,g,v,w,M,C,P,O,F,B,j){let K=function(de,oe,ue,be,xe,Ve,qe,Ne){let Te=be.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,De=[];for(let Re of oe.positionedLines)for(let ke of Re.positionedGlyphs){if(!ke.rect)continue;let Ee=ke.rect||{},tt=4,Qe=!0,bt=1,pn=0,xn=(xe||Ne)&&ke.vertical,Hn=ke.metrics.advance*ke.scale/2;if(Ne&&oe.verticalizable&&(pn=Re.lineOffset/2-(ke.imageName?-(oi-ke.metrics.width*ke.scale)/2:(ke.scale-1)*oi)),ke.imageName){let En=qe[ke.imageName];Qe=En.sdf,bt=En.pixelRatio,tt=1/bt}let sr=xe?[ke.x+Hn,ke.y]:[0,0],li=xe?[0,0]:[ke.x+Hn+ue[0],ke.y+ue[1]-pn],Fn=[0,0];xn&&(Fn=li,li=[0,0]);let Xn=(ke.metrics.left-tt)*ke.scale-Hn+li[0],ci=(-ke.metrics.top-tt)*ke.scale+li[1],_i=Xn+Ee.w*ke.scale/bt,Bi=ci+Ee.h*ke.scale/bt,zn=new st(Xn,ci),ui=new st(_i,ci),vi=new st(Xn,Bi),Ai=new st(_i,Bi);if(xn){let En=new st(-Hn,Hn-gd),Jn=-Math.PI/2,Dt=12-Hn,Qi=new st(22-Dt,-(ke.imageName?Dt:0)),hi=new st(...Fn);zn._rotateAround(Jn,En)._add(Qi)._add(hi),ui._rotateAround(Jn,En)._add(Qi)._add(hi),vi._rotateAround(Jn,En)._add(Qi)._add(hi),Ai._rotateAround(Jn,En)._add(Qi)._add(hi)}if(Te){let En=Math.sin(Te),Jn=Math.cos(Te),Dt=[Jn,-En,En,Jn];zn._matMult(Dt),ui._matMult(Dt),vi._matMult(Dt),Ai._matMult(Dt)}let ji=new st(0,0),Ui=new st(0,0);De.push({tl:zn,tr:ui,bl:vi,br:Ai,tex:Ee,writingMode:oe.writingMode,glyphOffset:sr,sectionIndex:ke.sectionIndex,isSDF:Qe,pixelOffsetTL:ji,pixelOffsetBR:Ui,minFontScaleX:0,minFontScaleY:0})}return De}(0,l,w,f,g,v,h,a.allowVerticalPlacement),Y=a.textSizeData,se=null;"source"===Y.kind?(se=[Jo*f.layout.get("text-size").evaluate(v,{})],se[0]>Us&&rt(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Y.kind&&(se=[Jo*B.compositeTextSizes[0].evaluate(v,{},j),Jo*B.compositeTextSizes[1].evaluate(v,{},j)],(se[0]>Us||se[1]>Us)&&rt(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,K,se,w,g,v,C,t,M.lineStartIndex,M.lineLength,F,j);for(let de of P)O[de]=a.text.placedSymbolArray.length-1;return 4*K.length}function U0(a){for(let t in a)return a[t];return null}function AD(a,t,l,h){let f=a.compareText;if(t in f){let g=f[t];for(let v=g.length-1;v>=0;v--)if(h.dist(g[v])<l)return!0}else f[t]=[];return f[t].push(h),!1}let PD=zs.VectorTileFeature.types,kD=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Md(a,t,l,h,f,g,v,w,M,C,P,O,F){let B=w?Math.min(Us,Math.round(w[0])):0,j=w?Math.min(Us,Math.round(w[1])):0;a.emplaceBack(t,l,Math.round(32*h),Math.round(32*f),g,v,(B<<1)+(M?1:0),j,16*C,16*P,256*O,256*F)}function Ym(a,t,l){a.emplaceBack(t.x,t.y,l),a.emplaceBack(t.x,t.y,l),a.emplaceBack(t.x,t.y,l),a.emplaceBack(t.x,t.y,l)}function LD(a){for(let t of a.sections)if(Xh(t.text))return!0;return!1}class Km{constructor(t){this.layoutVertexArray=new Mr,this.indexArray=new Ci,this.programConfigurations=t,this.segments=new It,this.dynamicLayoutVertexArray=new ir,this.opacityVertexArray=new Er,this.placedSymbolArray=new Me}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,l,h,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nD.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,iD.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,kD,!0),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",Km);class Qm{constructor(t,l,h){this.layoutVertexArray=new t,this.layoutAttributes=l,this.indexArray=new h,this.segments=new It,this.collisionVertexArray=new Yi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,rD.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",Qm);class Fl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Tm([]),this.placementViewportMatrix=Tm([]);let l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=A0(this.zoom,l["text-size"]),this.iconSizeData=A0(this.zoom,l["icon-size"]);let h=this.layers[0].layout,f=h.get("symbol-sort-key"),g=h.get("symbol-z-order");this.canOverlap="never"!==Jm(h,"text-overlap","text-allow-overlap")||"never"!==Jm(h,"icon-overlap","icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&!f.isConstant(),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===h.get("symbol-placement")&&(this.writingModes=h.get("text-writing-mode").map(v=>o.WritingMode[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new Km(new Sa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Km(new Sa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Se,this.lineVertexArray=new Ue,this.symbolInstances=new ze}calculateGlyphDependencies(t,l,h,f,g){for(let v=0;v<t.length;v++)if(l[t.charCodeAt(v)]=!0,(h||f)&&g){let w=wu[t.charAt(v)];w&&(l[w.charCodeAt(0)]=!0)}}populate(t,l,h){let f=this.layers[0],g=f.layout,v=g.get("text-font"),w=g.get("text-field"),M=g.get("icon-image"),C=("constant"!==w.value.kind||w.value.value instanceof J&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),P="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,O=g.get("symbol-sort-key");if(this.features=[],!C&&!P)return;let F=l.iconDependencies,B=l.glyphDependencies,j=l.availableImages,K=new _n(this.zoom);for(let{feature:Y,id:se,index:de,sourceLayerIndex:oe}of t){let xe,Ve,ue=f._featureFilter.needGeometry,be=Aa(Y,ue);if(!f._featureFilter.filter(K,be,h))continue;if(ue||(be.geometry=Ta(Y)),C){let Ne=f.getValueAndResolveTokens("text-field",be,h,j),Te=J.factory(Ne);LD(Te)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Ia()||this.hasRTLText&&Wi.isParsed())&&(xe=sD(Te,f,be))}if(P){let Ne=f.getValueAndResolveTokens("icon-image",be,h,j);Ve=Ne instanceof ne?Ne:ne.fromString(Ne)}if(!xe&&!Ve)continue;let qe=this.sortFeaturesByKey?O.evaluate(be,{},h):void 0;if(this.features.push({id:se,text:xe,icon:Ve,index:de,sourceLayerIndex:oe,geometry:be.geometry,properties:Y.properties,type:PD[Y.type],sortKey:qe}),Ve&&(F[Ve.name]=!0),xe){let Ne=v.evaluate(be,{},h).join(","),Te="viewport"!==g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(let De of xe.sections)if(De.image)F[De.image.name]=!0;else{let Re=Il(xe.toString()),ke=De.fontStack||Ne,Ee=B[ke]=B[ke]||{};this.calculateGlyphDependencies(De.text,Ee,Te,this.allowVerticalPlacement,Re)}}}"line"===g.get("symbol-placement")&&(this.features=function(Y){let se={},de={},oe=[],ue=0;function be(Ne){oe.push(Y[Ne]),ue++}function xe(Ne,Te,De){let Re=de[Ne];return delete de[Ne],de[Te]=Re,oe[Re].geometry[0].pop(),oe[Re].geometry[0]=oe[Re].geometry[0].concat(De[0]),Re}function Ve(Ne,Te,De){let Re=se[Te];return delete se[Te],se[Ne]=Re,oe[Re].geometry[0].shift(),oe[Re].geometry[0]=De[0].concat(oe[Re].geometry[0]),Re}function qe(Ne,Te,De){let Re=De?Te[0][Te[0].length-1]:Te[0][0];return`${Ne}:${Re.x}:${Re.y}`}for(let Ne=0;Ne<Y.length;Ne++){let Te=Y[Ne],De=Te.geometry,Re=Te.text?Te.text.toString():null;if(!Re){be(Ne);continue}let ke=qe(Re,De),Ee=qe(Re,De,!0);if(ke in de&&Ee in se&&de[ke]!==se[Ee]){let tt=Ve(ke,Ee,De),Qe=xe(ke,Ee,oe[tt].geometry);delete se[ke],delete de[Ee],de[qe(Re,oe[Qe].geometry,!0)]=Qe,oe[tt].geometry=null}else ke in de?xe(ke,Ee,De):Ee in se?Ve(ke,Ee,De):(be(Ne),se[ke]=ue-1,de[Ee]=ue-1)}return oe.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,se)=>Y.sortKey-se.sortKey)}update(t,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,l,this.layers,h),this.icon.programConfigurations.updatePaintArrays(t,l,this.layers,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,l){let h=this.lineVertexArray.length;if(void 0!==t.segment){let f=t.dist(l[t.segment+1]),g=t.dist(l[t.segment]),v={};for(let w=t.segment+1;w<l.length;w++)v[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:f},w<l.length-1&&(f+=l[w+1].dist(l[w]));for(let w=t.segment||0;w>=0;w--)v[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:g},w>0&&(g+=l[w-1].dist(l[w]));for(let w=0;w<l.length;w++){let M=v[w];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(t,l,h,f,g,v,w,M,C,P,O,F){let B=t.indexArray,j=t.layoutVertexArray,K=t.segments.prepareSegment(4*l.length,j,B,this.canOverlap?v.sortKey:void 0),Y=this.glyphOffsetArray.length,se=K.vertexLength,de=this.allowVerticalPlacement&&w===o.WritingMode.vertical?Math.PI/2:0,oe=v.text&&v.text.sections;for(let ue=0;ue<l.length;ue++){let{tl:be,tr:xe,bl:Ve,br:qe,tex:Ne,pixelOffsetTL:Te,pixelOffsetBR:De,minFontScaleX:Re,minFontScaleY:ke,glyphOffset:Ee,isSDF:tt,sectionIndex:Qe}=l[ue],bt=K.vertexLength,pn=Ee[1];Md(j,M.x,M.y,be.x,pn+be.y,Ne.x,Ne.y,h,tt,Te.x,Te.y,Re,ke),Md(j,M.x,M.y,xe.x,pn+xe.y,Ne.x+Ne.w,Ne.y,h,tt,De.x,Te.y,Re,ke),Md(j,M.x,M.y,Ve.x,pn+Ve.y,Ne.x,Ne.y+Ne.h,h,tt,Te.x,De.y,Re,ke),Md(j,M.x,M.y,qe.x,pn+qe.y,Ne.x+Ne.w,Ne.y+Ne.h,h,tt,De.x,De.y,Re,ke),Ym(t.dynamicLayoutVertexArray,M,de),B.emplaceBack(bt,bt+1,bt+2),B.emplaceBack(bt+1,bt+2,bt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),ue!==l.length-1&&Qe===l[ue+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,v,v.index,{},F,oe&&oe[Qe])}t.placedSymbolArray.emplaceBack(M.x,M.y,Y,this.glyphOffsetArray.length-Y,se,C,P,M.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],w,0,!1,0,O)}_addCollisionDebugVertex(t,l,h,f,g,v){return l.emplaceBack(0,0),t.emplaceBack(h.x,h.y,f,g,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,l,h,f,g,v,w){let M=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),C=M.vertexLength,P=g.layoutVertexArray,O=g.collisionVertexArray,F=w.anchorX,B=w.anchorY;this._addCollisionDebugVertex(P,O,v,F,B,new st(t,l)),this._addCollisionDebugVertex(P,O,v,F,B,new st(h,l)),this._addCollisionDebugVertex(P,O,v,F,B,new st(h,f)),this._addCollisionDebugVertex(P,O,v,F,B,new st(t,f)),M.vertexLength+=4;let j=g.indexArray;j.emplaceBack(C,C+1),j.emplaceBack(C+1,C+2),j.emplaceBack(C+2,C+3),j.emplaceBack(C+3,C),M.primitiveLength+=4}addDebugCollisionBoxes(t,l,h,f){for(let g=t;g<l;g++){let v=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,f?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qm(Mo,g0.members,jr),this.iconCollisionBox=new Qm(Mo,g0.members,jr);for(let t=0;t<this.symbolInstances.length;t++){let l=this.symbolInstances.get(t);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(t,l,h,f,g,v,w,M,C){let P={};for(let O=l;O<h;O++){let F=t.get(O);P.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},P.textFeatureIndex=F.featureIndex;break}for(let O=f;O<g;O++){let F=t.get(O);P.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},P.verticalTextFeatureIndex=F.featureIndex;break}for(let O=v;O<w;O++){let F=t.get(O);P.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},P.iconFeatureIndex=F.featureIndex;break}for(let O=M;O<C;O++){let F=t.get(O);P.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},P.verticalIconFeatureIndex=F.featureIndex;break}return P}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,l){let h=t.placedSymbolArray.get(l),f=h.vertexStartIndex+4*h.numGlyphs;for(let g=h.vertexStartIndex;g<f;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;let l=Math.sin(t),h=Math.cos(t),f=[],g=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);let M=this.symbolInstances.get(w);f.push(0|Math.round(l*M.anchorX+h*M.anchorY)),g.push(M.featureIndex)}return v.sort((w,M)=>f[w]-f[M]||g[M]-g[w]),v}addToSortKeyRanges(t,l){let h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let l of this.symbolInstanceIndexes){let h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((f,g,v)=>{f>=0&&v.indexOf(f)===g&&this.addIndicesForPlacedSymbol(this.text,f)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}$e("SymbolBucket",Fl,{omit:["layers","collisionBoxArray","features","compareText"]}),Fl.MAX_GLYPHS=65535,Fl.addDynamicAttributes=Ym;let OD=new ri({"symbol-placement":new Ye(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new it(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new it(_e.layout_symbol["icon-size"]),"icon-text-fit":new Ye(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new it(_e.layout_symbol["icon-image"]),"icon-rotate":new it(_e.layout_symbol["icon-rotate"]),"icon-padding":new it(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new it(_e.layout_symbol["icon-offset"]),"icon-anchor":new it(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(_e.layout_symbol["text-rotation-alignment"]),"text-field":new it(_e.layout_symbol["text-field"]),"text-font":new it(_e.layout_symbol["text-font"]),"text-size":new it(_e.layout_symbol["text-size"]),"text-max-width":new it(_e.layout_symbol["text-max-width"]),"text-line-height":new Ye(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new it(_e.layout_symbol["text-letter-spacing"]),"text-justify":new it(_e.layout_symbol["text-justify"]),"text-radial-offset":new it(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(_e.layout_symbol["text-variable-anchor"]),"text-anchor":new it(_e.layout_symbol["text-anchor"]),"text-max-angle":new Ye(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(_e.layout_symbol["text-writing-mode"]),"text-rotate":new it(_e.layout_symbol["text-rotate"]),"text-padding":new Ye(_e.layout_symbol["text-padding"]),"text-keep-upright":new Ye(_e.layout_symbol["text-keep-upright"]),"text-transform":new it(_e.layout_symbol["text-transform"]),"text-offset":new it(_e.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(_e.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(_e.layout_symbol["text-optional"])});var Xm={paint:new ri({"icon-opacity":new it(_e.paint_symbol["icon-opacity"]),"icon-color":new it(_e.paint_symbol["icon-color"]),"icon-halo-color":new it(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new it(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new it(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new it(_e.paint_symbol["text-opacity"]),"text-color":new it(_e.paint_symbol["text-color"],{runtimeType:ii,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new it(_e.paint_symbol["text-halo-color"]),"text-halo-width":new it(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new it(_e.paint_symbol["text-halo-blur"]),"text-translate":new Ye(_e.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(_e.paint_symbol["text-translate-anchor"])}),layout:OD};class V0{constructor(t){if(void 0===t.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:mo,this.defaultValue=t}evaluate(t){if(t.formattedSection){let l=this.defaultValue.property.overrides;if(l&&l.hasOverride(t.formattedSection))return l.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",V0,{omit:["defaultValue"]});class Ed extends wr{constructor(t){super(t,Xm)}recalculate(t,l){if(super.recalculate(t,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){let h=this.layout.get("text-writing-mode");if(h){let f=[];for(let g of h)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,l,h,f){let g=this.layout.get(t).evaluate(l,{},h,f),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||da(v.value)||!g?g:(w=l.properties,g.replace(/{([^{}]+)}/g,(C,P)=>P in w?String(w[P]):""));var w}createBucket(t){return new Fl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of Xm.paint.overridableProperties){if(!Ed.hasPaintOverride(this.layout,t))continue;let l=this.paint.get(t),h=new V0(l),f=new vl(h,l.property.specification),g=null;g="constant"===l.value.kind||"source"===l.value.kind?new fa("source",f):new Kc("composite",f,l.value.zoomStops),this.paint._values[t]=new br(l.property,g,l.parameters)}}_handleOverridablePaintPropertyUpdate(t,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Ed.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,l){let h=t.get("text-field"),f=Xm.paint.properties[l],g=!1,v=w=>{for(let M of w)if(f.overrides&&f.overrides.hasOverride(M))return void(g=!0)};if("constant"===h.value.kind&&h.value.value instanceof J)v(h.value.value.sections);else if("source"===h.value.kind){let w=C=>{g||(C instanceof We&&pe(C.value)===qn?v(C.value.sections):C instanceof yl?v(C.sections):C.eachChild(w))},M=h.value;M._styleExpression&&w(M._styleExpression.expression)}return g}}function Jm(a,t,l){let h="never",f=a.get(t);return f?h=f:a.get(l)&&(h="always"),h}var ND={paint:new ri({"background-color":new Ye(_e.paint_background["background-color"]),"background-pattern":new lu(_e.paint_background["background-pattern"]),"background-opacity":new Ye(_e.paint_background["background-opacity"])})},RD={paint:new ri({"raster-opacity":new Ye(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(_e.paint_raster["raster-saturation"]),"raster-contrast":new Ye(_e.paint_raster["raster-contrast"]),"raster-resampling":new Ye(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(_e.paint_raster["raster-fade-duration"])})};class FD extends wr{constructor(t){super(t,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}let zD={circle:class extends wr{constructor(a){super(a,mI)}createBucket(a){return new Dm(a)}queryRadius(a){let t=a;return pu("circle-radius",this,t)+pu("circle-stroke-width",this,t)+ad(this.paint.get("circle-translate"))}queryIntersectsFeature(a,t,l,h,f,g,v,w){let M=ld(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,v),C=this.paint.get("circle-radius").evaluate(t,l)+this.paint.get("circle-stroke-width").evaluate(t,l),P="map"===this.paint.get("circle-pitch-alignment"),O=P?M:(j=w,M.map(K=>Jv(K,j))),F=P?C*v:C;var j;for(let B of h)for(let j of B){let K=P?j:Jv(j,w),Y=F,se=cd([],[j.x,j.y,0,1],w);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?Y*=se[3]/g.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(Y*=g.cameraToCenterDistance/se[3]),uI(O,K,Y))return!0}return!1}},heatmap:class extends wr{constructor(a){super(a,yI),this._updateColorRamp()}createBucket(a){return new e0(a)}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=n0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends wr{constructor(a){super(a,_I)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends wr{constructor(a){super(a,OI)}recalculate(a,t){super.recalculate(a,t);let l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new zm(a)}queryRadius(){return ad(this.paint.get("fill-translate"))}queryIntersectsFeature(a,t,l,h,f,g,v){return Gv(ld(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,v),h)}isTileClipped(){return!0}},"fill-extrusion":class extends wr{constructor(a){super(a,WI)}createBucket(a){return new jm(a)}queryRadius(){return ad(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,t,l,h,f,g,v,w){let M=ld(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,v),C=this.paint.get("fill-extrusion-height").evaluate(t,l),P=this.paint.get("fill-extrusion-base").evaluate(t,l),O=function(B,j,K,Y){let se=[];for(let de of B){let oe=[de.x,de.y,0,1];cd(oe,oe,j),se.push(new st(oe[0]/oe[3],oe[1]/oe[3]))}return se}(M,w),F=function(B,j,K,Y){let se=[],de=[],oe=Y[8]*j,ue=Y[9]*j,be=Y[10]*j,xe=Y[11]*j,Ve=Y[8]*K,qe=Y[9]*K,Ne=Y[10]*K,Te=Y[11]*K;for(let De of B){let Re=[],ke=[];for(let Ee of De){let tt=Ee.x,Qe=Ee.y,bt=Y[0]*tt+Y[4]*Qe+Y[12],pn=Y[1]*tt+Y[5]*Qe+Y[13],xn=Y[2]*tt+Y[6]*Qe+Y[14],Hn=Y[3]*tt+Y[7]*Qe+Y[15],sr=xn+be,li=Hn+xe,Fn=bt+Ve,Xn=pn+qe,ci=xn+Ne,_i=Hn+Te,Bi=new st((bt+oe)/li,(pn+ue)/li);Bi.z=sr/li,Re.push(Bi);let zn=new st(Fn/_i,Xn/_i);zn.z=ci/_i,ke.push(zn)}se.push(Re),de.push(ke)}return[se,de]}(h,P,C,w);return function(B,j,K){let Y=1/0;Gv(K,j)&&(Y=h0(K,j[0]));for(let se=0;se<j.length;se++){let de=j[se],oe=B[se];for(let ue=0;ue<de.length-1;ue++){let be=de[ue],xe=[be,de[ue+1],oe[ue+1],oe[ue],be];Hv(K,xe)&&(Y=Math.min(Y,h0(K,xe)))}}return Y!==1/0&&Y}(F[0],F[1],O)}},line:class extends wr{constructor(a){super(a,p0),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){"line-gradient"===a&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof aa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,t){super.recalculate(a,t),this.paint._values["line-floorwidth"]=f0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Um(a)}queryRadius(a){let t=a,l=m0(pu("line-width",this,t),pu("line-gap-width",this,t)),h=pu("line-offset",this,t);return l/2+Math.abs(h)+ad(this.paint.get("line-translate"))}queryIntersectsFeature(a,t,l,h,f,g,v){let w=ld(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,v),M=v/2*m0(this.paint.get("line-width").evaluate(t,l),this.paint.get("line-gap-width").evaluate(t,l)),C=this.paint.get("line-offset").evaluate(t,l);return C&&(h=function(P,O){let F=[];for(let B=0;B<P.length;B++){let j=P[B],K=[];for(let Y=0;Y<j.length;Y++){let se=j[Y-1],de=j[Y],oe=j[Y+1],ue=0===Y?new st(0,0):de.sub(se)._unit()._perp(),be=Y===j.length-1?new st(0,0):oe.sub(de)._unit()._perp(),xe=ue._add(be)._unit(),Ve=xe.x*be.x+xe.y*be.y;0!==Ve&&xe._mult(1/Ve),K.push(xe._mult(O)._add(de))}F.push(K)}return F}(h,C*v)),function(P,O,F){for(let B=0;B<O.length;B++){let j=O[B];if(P.length>=3)for(let K=0;K<j.length;K++)if(Al(P,j[K]))return!0;if(hI(P,j,F))return!0}return!1}(w,h,M)}isTileClipped(){return!0}},symbol:Ed,background:class extends wr{constructor(a){super(a,ND)}},raster:class extends wr{constructor(a){super(a,RD)}}};class BD{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}let $0=6371008.8;class Tn{constructor(t,l){if(isNaN(t)||isNaN(l))throw new Error(`Invalid LngLat object: (${t}, ${l})`);if(this.lng=+t,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tn(G(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let l=Math.PI/180,h=this.lat*l,f=t.lat*l,g=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((t.lng-this.lng)*l);return $0*Math.acos(Math.min(g,1))}toBounds(t=0){let l=360*t/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new ka(new Tn(this.lng-h,this.lat-l),new Tn(this.lng+h,this.lat+l))}static convert(t){if(t instanceof Tn)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Tn(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Tn(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ka{constructor(t,l){t&&(l?this.setSouthWest(t).setNorthEast(l):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Tn?new Tn(t.lng,t.lat):Tn.convert(t),this}setSouthWest(t){return this._sw=t instanceof Tn?new Tn(t.lng,t.lat):Tn.convert(t),this}extend(t){let f,g,l=this._sw,h=this._ne;if(t instanceof Tn)f=t,g=t;else{if(!(t instanceof ka))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(ka.convert(t)):this.extend(Tn.convert(t)):this;if(f=t._sw,g=t._ne,!f||!g)return this}return l||h?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),h.lng=Math.max(g.lng,h.lng),h.lat=Math.max(g.lat,h.lat)):(this._sw=new Tn(f.lng,f.lat),this._ne=new Tn(g.lng,g.lat)),this}getCenter(){return new Tn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Tn(this.getWest(),this.getNorth())}getSouthEast(){return new Tn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:l,lat:h}=Tn.convert(t),f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(t){return t instanceof ka?t:t&&new ka(t)}}let H0=2*Math.PI*$0;function G0(a){return H0*Math.cos(a*Math.PI/180)}function Z0(a){return(180+a)/360}function q0(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function W0(a,t){return a/G0(t)}function eg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class Id{constructor(t,l,h=0){this.x=+t,this.y=+l,this.z=+h}static fromLngLat(t,l=0){let h=Tn.convert(t);return new Id(Z0(h.lng),q0(h.lat),W0(l,h.lat))}toLngLat(){return new Tn(360*this.x-180,eg(this.y))}toAltitude(){return this.z*G0(eg(this.y))}meterInMercatorCoordinateUnits(){return 1/H0*(t=eg(this.y),1/Math.cos(t*Math.PI/180));var t}}function Y0(a,t,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[a*h-2*Math.PI*6378137/2,t*h-2*Math.PI*6378137/2]}class tg{constructor(t,l,h){if(t<0||t>25||h<0||h>=Math.pow(2,t)||l<0||l>=Math.pow(2,t))throw new Error(`x=${l}, y=${h}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=l,this.y=h,this.key=Eu(0,t,t,l,h)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,l,h){let f=(v=this.y,w=this.z,M=Y0(256*(g=this.x),256*(v=Math.pow(2,w)-v-1),w),C=Y0(256*(g+1),256*(v+1),w),M[0]+","+M[1]+","+C[0]+","+C[1]);var g,v,w,M,C;let P=function(O,F,B){let j,K="";for(let Y=O;Y>0;Y--)j=1<<Y-1,K+=(F&j?1:0)+(B&j?2:0);return K}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===h?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){let l=this.z-t.z;return l>0&&t.x===this.x>>l&&t.y===this.y>>l}getTilePoint(t){let l=Math.pow(2,this.z);return new st((t.x*l-this.x)*$n,(t.y*l-this.y)*$n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class K0{constructor(t,l){this.wrap=t,this.canonical=l,this.key=Eu(t,l.z,l.z,l.x,l.y)}}class or{constructor(t,l,h,f,g){if(t<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${h}`);this.overscaledZ=t,this.wrap=l,this.canonical=new tg(h,+f,+g),this.key=Eu(l,t,h,f,g)}clone(){return new or(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let l=this.canonical.z-t;return t>this.canonical.z?new or(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new or(t,this.wrap,t,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(t,l){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let h=this.canonical.z-t;return t>this.canonical.z?Eu(this.wrap*+l,t,this.canonical.z,this.canonical.x,this.canonical.y):Eu(this.wrap*+l,t,t,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let l=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>l&&t.canonical.y===this.canonical.y>>l}children(t){if(this.overscaledZ>=t)return[new or(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let l=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new or(l,this.wrap,l,h,f),new or(l,this.wrap,l,h+1,f),new or(l,this.wrap,l,h,f+1),new or(l,this.wrap,l,h+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new or(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new or(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new K0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Id(t.x-this.wrap,t.y))}}function Eu(a,t,l,h,f){(a*=2)<0&&(a=-1*a-1);let g=1<<l;return(g*g*a+g*f+h).toString(36)+l.toString(36)+t.toString(36)}$e("CanonicalTileID",tg),$e("OverscaledTileID",or,{omit:["posMatrix"]});class Q0{constructor(t,l,h){if(this.uid=t,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return void rt(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;let f=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=h||"mapbox";for(let g=0;g<f;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(f,g)]=this.data[this._idx(f-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,f)]=this.data[this._idx(g,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let g=0;g<f;g++)for(let v=0;v<f;v++){let w=this.get(g,v);w>this.max&&(this.max=w),w<this.min&&(this.min=w)}}get(t,l){let h=new Uint8Array(this.data.buffer),f=4*this._idx(t,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[f],h[f+1],h[f+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,l){if(t<-1||t>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(t+1)}_unpackMapbox(t,l,h){return(256*t*256+256*l+h)/10-1e4}_unpackTerrarium(t,l,h){return 256*t+l+h/256-32768}getPixels(){return new rr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,l,h){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,g=l*this.dim+this.dim,v=h*this.dim,w=h*this.dim+this.dim;switch(l){case-1:f=g-1;break;case 1:g=f+1}switch(h){case-1:v=w-1;break;case 1:w=v+1}let M=-l*this.dim,C=-h*this.dim;for(let P=v;P<w;P++)for(let O=f;O<g;O++)this.data[this._idx(O,P)]=t.data[this._idx(O+M,P+C)]}}$e("DEMData",Q0);class X0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let l=0;l<t.length;l++){let h=t[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class J0{constructor(t,l,h,f,g){this.type="Feature",this._vectorTileFeature=t,t._z=l,t._x=h,t._y=f,this.properties=t.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(t[l]=this[l]);return t}}class ex{constructor(t,l){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ea($n,16,0),this.grid3D=new Ea($n,16,0),this.featureIndexArray=new xt,this.promoteId=l}insert(t,l,h,f,g,v){let w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,g);let M=v?this.grid3D:this.grid;for(let C=0;C<l.length;C++){let P=l[C],O=[1/0,1/0,-1/0,-1/0];for(let F=0;F<P.length;F++){let B=P[F];O[0]=Math.min(O[0],B.x),O[1]=Math.min(O[1],B.y),O[2]=Math.max(O[2],B.x),O[3]=Math.max(O[3],B.y)}O[0]<$n&&O[1]<$n&&O[2]>=0&&O[3]>=0&&M.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new zs.VectorTile(new Vm(this.rawTileData)).layers,this.sourceLayerCoder=new X0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,l,h,f){this.loadVTLayers();let g=t.params||{},v=$n/t.tileSize/t.scale,w=wl(g.filter),M=t.queryGeometry,C=t.queryPadding*v,P=nx(M),O=this.grid.query(P.minX-C,P.minY-C,P.maxX+C,P.maxY+C),F=nx(t.cameraQueryGeometry),B=this.grid3D.query(F.minX-C,F.minY-C,F.maxX+C,F.maxY+C,(Y,se,de,oe)=>function(ue,be,xe,Ve,qe){for(let Te of ue)if(be<=Te.x&&xe<=Te.y&&Ve>=Te.x&&qe>=Te.y)return!0;let Ne=[new st(be,xe),new st(be,qe),new st(Ve,qe),new st(Ve,xe)];if(ue.length>2)for(let Te of Ne)if(Al(ue,Te))return!0;for(let Te=0;Te<ue.length-1;Te++)if(pI(ue[Te],ue[Te+1],Ne))return!0;return!1}(t.cameraQueryGeometry,Y-C,se-C,de+C,oe+C));for(let Y of B)O.push(Y);O.sort(jD);let K,j={};for(let Y=0;Y<O.length;Y++){let se=O[Y];if(se===K)continue;K=se;let de=this.featureIndexArray.get(se),oe=null;this.loadMatchingFeature(j,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,w,g.layers,g.availableImages,l,h,f,(ue,be,xe)=>(oe||(oe=Ta(ue)),be.queryIntersectsFeature(M,ue,xe,oe,this.z,t.transform,v,t.pixelPosMatrix)))}return j}loadMatchingFeature(t,l,h,f,g,v,w,M,C,P,O){let F=this.bucketLayerIDs[l];if(v&&!function(Y,se){for(let de=0;de<Y.length;de++)if(se.indexOf(Y[de])>=0)return!0;return!1}(v,F))return;let B=this.sourceLayerCoder.decode(h),j=this.vtLayers[B].feature(f);if(g.needGeometry){let Y=Aa(j,!0);if(!g.filter(new _n(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!g.filter(new _n(this.tileID.overscaledZ),j))return;let K=this.getId(j,B);for(let Y=0;Y<F.length;Y++){let se=F[Y];if(v&&v.indexOf(se)<0)continue;let de=M[se];if(!de)continue;let oe={};K&&P&&(oe=P.getState(de.sourceLayer||"_geojsonTileLayer",K));let ue=re({},C[se]);ue.paint=tx(ue.paint,de.paint,j,oe,w),ue.layout=tx(ue.layout,de.layout,j,oe,w);let be=!O||O(j,de,oe);if(!be)continue;let xe=new J0(j,this.z,this.x,this.y,K);xe.layer=ue;let Ve=t[se];void 0===Ve&&(Ve=t[se]=[]),Ve.push({featureIndex:f,feature:xe,intersectionZ:be})}}lookupSymbolFeatures(t,l,h,f,g,v,w,M){let C={};this.loadVTLayers();let P=wl(g);for(let O of t)this.loadMatchingFeature(C,h,f,O,P,v,w,M,l);return C}hasLayer(t){for(let l of this.bucketLayerIDs)for(let h of l)if(t===h)return!0;return!1}getId(t,l){let h=t.id;return this.promoteId&&(h=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof h&&(h=Number(h))),h}}function tx(a,t,l,h,f){return Ie(a,(g,v)=>{let w=t instanceof Ca?t.get(v):null;return w&&w.evaluate?w.evaluate(l,h,f):w})}function nx(a){let t=1/0,l=1/0,h=-1/0,f=-1/0;for(let g of a)t=Math.min(t,g.x),l=Math.min(l,g.y),h=Math.max(h,g.x),f=Math.max(f,g.y);return{minX:t,minY:l,maxX:h,maxY:f}}function jD(a,t){return t-a}var ng;$e("FeatureIndex",ex,{omit:["rawTileData","sourceLayerCoder"]}),o.PerformanceMarkers=void 0,(ng=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",ng.load="load",ng.fullLoad="fullLoad";let Dd=null,Iu=[],ig=1e3/30,UD={mark(a){performance.mark(a)},frame(a){let t=a;null!=Dd&&Iu.push(t-Dd),Dd=t},clearMetrics(){Dd=null,Iu=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(let a in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure("fullLoadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);let a=performance.getEntriesByName("loadTime")[0].duration,t=performance.getEntriesByName("fullLoadTime")[0].duration,l=Iu.length,h=1/(Iu.reduce((g,v)=>g+v,0)/l/1e3),f=Iu.filter(g=>g>ig).reduce((g,v)=>g+(v-ig)/ig,0);return{loadTime:a,fullLoadTime:t,fps:h,percentDroppedFrames:f/(l+f)*100}}};o.AJAXError=ni,o.ARRAY_TYPE=Ti,o.Actor=class{constructor(a,t,l){this.target=a,this.parent=t,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ve(["receive","process"],this),this.invoker=new BD(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=kt()?a:window}send(a,t,l,h,f=!1){let g=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[g]=l);let v=Lr(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:a,hasCallback:!!l,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:Zo(t,v)},v),{cancel:()=>{l&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(a){let t=a.data,l=t.id;if(l&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){delete this.tasks[l];let h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h()}else kt()||t.mustQueue?(this.tasks[l]=t,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,t)}process(){if(!this.taskQueue.length)return;let a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){if("<response>"===t.type){let l=this.callbacks[a];delete this.callbacks[a],l&&(t.error?l(_o(t.error)):l(null,_o(t.data)))}else{let l=!1,h=Lr(this.globalScope)?void 0:[],f=t.hasCallback?(w,M)=>{l=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:w?Zo(w):null,data:Zo(M,h)},h)}:w=>{l=!0},g=null,v=_o(t.data);if(this.parent[t.type])g=this.parent[t.type](t.sourceMapId,v,f);else if(this.parent.getWorkerSource){let w=t.type.split(".");g=this.parent.getWorkerSource(t.sourceMapId,w[0],v.source)[w[1]](v,f)}else f(new Error(`Could not find function ${t.type}`));!l&&g&&g.cancel&&(this.cancelCallbacks[a]=g.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=mu,o.CanonicalTileID=tg,o.CollisionBoxArray=ge,o.CollisionCircleLayoutArray=class extends k{},o.Color=V,o.DEMData=Q0,o.DataConstantProperty=Ye,o.DictionaryCoder=X0,o.EXTENT=$n,o.ErrorEvent=xs,o.EvaluationParameters=_n,o.Event=Nr,o.Evented=Rr,o.FeatureIndex=ex,o.FillBucket=zm,o.FillExtrusionBucket=jm,o.GeoJSONFeature=J0,o.ImageAtlas=E0,o.ImagePosition=Hm,o.LineBucket=Um,o.LineStripIndexArray=class extends W{},o.LngLat=Tn,o.LngLatBounds=ka,o.MercatorCoordinate=Id,o.ONE_EM=oi,o.OverscaledTileID=or,o.PerformanceUtils=UD,o.PosArray=et,o.Properties=ri,o.QuadTriangleArray=class extends z{},o.RGBAImage=rr,o.RasterBoundsArray=class extends p{},o.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return 0===a.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},o.ResourceType=Ii,o.SegmentVector=It,o.SymbolBucket=Fl,o.Transitionable=td,o.TriangleIndexArray=Ci,o.Uniform1f=Ko,o.Uniform1i=class extends Yo{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},o.Uniform2f=class extends Yo{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},o.Uniform3f=class extends Yo{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},o.Uniform4f=Sl,o.UniformColor=jv,o.UniformMatrix4f=class extends Yo{constructor(a,t){super(a,t),this.current=lI}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},o.UnwrappedTileID=K0,o.ValidationError=Pe,o.ZoomHistory=eu,o.add=function(a,t,l){return a[0]=t[0]+l[0],a[1]=t[1]+l[1],a[2]=t[2]+l[2],a},o.addDynamicAttributes=Ym,o.asyncAll=function(a,t,l){if(!a.length)return l(null,[]);let h=a.length,f=new Array(a.length),g=null;a.forEach((v,w)=>{t(v,(M,C)=>{M&&(g=M),f[w]=C,0==--h&&l(g,f)})})},o.bezier=I,o.bindAll=ve,o.cacheEntryPossiblyAdded=function(a){Un++,Un>ti&&(a.getActor().send("enforceCacheSizeLimit",fn),Un=0)},o.clamp=L,o.clearTileCache=function(a){let t=caches.delete(Xe);a&&t.catch(a).then(()=>a())},o.clipLine=R0,o.clone=function(a){var t=new Ti(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},o.clone$1=Ae,o.clone$2=function(a){var t=new Ti(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},o.collisionCircleLayout=oD,o.config=Ge,o.copy=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},o.create=function(){var a=new Ti(16);return Ti!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},o.create$1=Wv,o.createExpression=pa,o.createFilter=wl,o.createLayout=Rn,o.createStyleLayer=function(a){return"custom"===a.type?new FD(a):new zD[a.type](a)},o.cross=function(a,t,l){var h=t[0],f=t[1],g=t[2],v=l[0],w=l[1],M=l[2];return a[0]=f*M-g*w,a[1]=g*v-h*M,a[2]=h*w-f*v,a},o.dot=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},o.dot$1=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]*t[3]},o.ease=A,o.emitValidationErrors=El,o.enforceCacheSizeLimit=function(a){typeof caches>"u"||Je||(Je=caches.open(Xe)),Je&&Je.then(t=>{t.keys().then(l=>{for(let h=0;h<l.length-a;h++)t.delete(l[h])})})},o.equals=function(a,t){var l=a[0],h=a[1],f=a[2],g=a[3],v=a[4],w=a[5],M=a[6],C=a[7],P=a[8],O=a[9],F=a[10],B=a[11],j=a[12],K=a[13],Y=a[14],se=a[15],de=t[0],oe=t[1],ue=t[2],be=t[3],xe=t[4],Ve=t[5],qe=t[6],Ne=t[7],Te=t[8],De=t[9],Re=t[10],ke=t[11],Ee=t[12],tt=t[13],Qe=t[14],bt=t[15];return Math.abs(l-de)<=Si*Math.max(1,Math.abs(l),Math.abs(de))&&Math.abs(h-oe)<=Si*Math.max(1,Math.abs(h),Math.abs(oe))&&Math.abs(f-ue)<=Si*Math.max(1,Math.abs(f),Math.abs(ue))&&Math.abs(g-be)<=Si*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(v-xe)<=Si*Math.max(1,Math.abs(v),Math.abs(xe))&&Math.abs(w-Ve)<=Si*Math.max(1,Math.abs(w),Math.abs(Ve))&&Math.abs(M-qe)<=Si*Math.max(1,Math.abs(M),Math.abs(qe))&&Math.abs(C-Ne)<=Si*Math.max(1,Math.abs(C),Math.abs(Ne))&&Math.abs(P-Te)<=Si*Math.max(1,Math.abs(P),Math.abs(Te))&&Math.abs(O-De)<=Si*Math.max(1,Math.abs(O),Math.abs(De))&&Math.abs(F-Re)<=Si*Math.max(1,Math.abs(F),Math.abs(Re))&&Math.abs(B-ke)<=Si*Math.max(1,Math.abs(B),Math.abs(ke))&&Math.abs(j-Ee)<=Si*Math.max(1,Math.abs(j),Math.abs(Ee))&&Math.abs(K-tt)<=Si*Math.max(1,Math.abs(K),Math.abs(tt))&&Math.abs(Y-Qe)<=Si*Math.max(1,Math.abs(Y),Math.abs(Qe))&&Math.abs(se-bt)<=Si*Math.max(1,Math.abs(se),Math.abs(bt))},o.evaluateSizeForFeature=function(a,{uSize:t,uSizeT:l},{lowerSize:h,upperSize:f}){return"source"===a.kind?h/Jo:"composite"===a.kind?gn(h/Jo,f/Jo,l):t},o.evaluateSizeForZoom=function(a,t){let l=0,h=0;if("constant"===a.kind)h=a.layoutSize;else if("source"!==a.kind){let{interpolationType:f,minZoom:g,maxZoom:v}=a,w=f?L(Ri.interpolationFactor(f,t,g,v),0,1):0;"camera"===a.kind?h=gn(a.minSize,a.maxSize,w):l=w}return{uSizeT:l,uSize:h}},o.evaluateVariableOffset=B0,o.evented=au,o.exported=si,o.exported$1=Ht,o.extend=re,o.filterObject=je,o.fromRotation=function(a,t){var l=Math.sin(t),h=Math.cos(t);return a[0]=h,a[1]=l,a[2]=0,a[3]=-l,a[4]=h,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.fromScaling=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},o.getAnchorAlignment=Zm,o.getAnchorJustification=Wm,o.getArrayBuffer=vs,o.getImage=fo,o.getJSON=function(a,t){return _s(re(a,{type:"json"}),t)},o.getOverlapMode=Jm,o.getRTLTextPluginStatus=Ia,o.getReferrer=na,o.getVideo=function(a,t){let l=window.document.createElement("video");l.muted=!0,l.onloadstart=function(){t(null,l)};for(let h=0;h<a.length;h++){let f=window.document.createElement("source");ia(a[h])||(l.crossOrigin="Anonymous"),f.src=a[h],l.appendChild(f)}return{cancel:()=>{}}},o.identity=Tm,o.invert=function(a,t){var l=t[0],h=t[1],f=t[2],g=t[3],v=t[4],w=t[5],M=t[6],C=t[7],P=t[8],O=t[9],F=t[10],B=t[11],j=t[12],K=t[13],Y=t[14],se=t[15],de=l*w-h*v,oe=l*M-f*v,ue=l*C-g*v,be=h*M-f*w,xe=h*C-g*w,Ve=f*C-g*M,qe=P*K-O*j,Ne=P*Y-F*j,Te=P*se-B*j,De=O*Y-F*K,Re=O*se-B*K,ke=F*se-B*Y,Ee=de*ke-oe*Re+ue*De+be*Te-xe*Ne+Ve*qe;return Ee?(a[0]=(w*ke-M*Re+C*De)*(Ee=1/Ee),a[1]=(f*Re-h*ke-g*De)*Ee,a[2]=(K*Ve-Y*xe+se*be)*Ee,a[3]=(F*xe-O*Ve-B*be)*Ee,a[4]=(M*Te-v*ke-C*Ne)*Ee,a[5]=(l*ke-f*Te+g*Ne)*Ee,a[6]=(Y*ue-j*Ve-se*oe)*Ee,a[7]=(P*Ve-F*ue+B*oe)*Ee,a[8]=(v*Re-w*Te+C*qe)*Ee,a[9]=(h*Te-l*Re-g*qe)*Ee,a[10]=(j*xe-K*ue+se*de)*Ee,a[11]=(O*ue-P*xe-B*de)*Ee,a[12]=(w*Ne-v*De-M*qe)*Ee,a[13]=(l*De-h*Ne+f*qe)*Ee,a[14]=(K*oe-j*be-Y*de)*Ee,a[15]=(P*be-O*oe+F*de)*Ee,a):null},o.isImageBitmap=Mi,o.isSafari=Lr,o.isWorker=kt,o.keysDifference=function(a,t){let l=[];for(let h in a)h in t||l.push(h);return l},o.lazyLoadRTLTextPlugin=function(){Wi.isLoading()||Wi.isLoaded()||"deferred"!==Ia()||ed()},o.makeRequest=_s,o.mapObject=Ie,o.mercatorXfromLng=Z0,o.mercatorYfromLat=q0,o.mercatorZfromAltitude=W0,o.mul=gI,o.mul$1=function(a,t,l){return a[0]=t[0]*l[0],a[1]=t[1]*l[1],a[2]=t[2]*l[2],a[3]=t[3]*l[3],a},o.multiply=Yv,o.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},o.normalize=function(a,t){var l=t[0],h=t[1],f=t[2],g=l*l+h*h+f*f;return g>0&&(g=1/Math.sqrt(g)),a[0]=t[0]*g,a[1]=t[1]*g,a[2]=t[2]*g,a},o.number=gn,o.ortho=function(a,t,l,h,f,g,v){var w=1/(t-l),M=1/(h-f),C=1/(g-v);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*M,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*C,a[11]=0,a[12]=(t+l)*w,a[13]=(f+h)*M,a[14]=(v+g)*C,a[15]=1,a},o.parseCacheControl=function(a){let t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,f,g)=>{let v=f||g;return t[h]=!v||v.toLowerCase(),""}),t["max-age"]){let l=parseInt(t["max-age"],10);isNaN(l)?delete t["max-age"]:t["max-age"]=l}return t},o.parseGlyphPbf=function(a){return new Vm(a).readFields(gD,[])},o.pbf=Vm,o.performSymbolLayout=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=$n/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;let t=a.bucket.layers[0].layout,l=a.bucket.layers[0]._unevaluatedLayout._values,h={layoutIconSize:l["icon-size"].possiblyEvaluate(new _n(a.bucket.zoom+1),a.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new _n(a.bucket.zoom+1),a.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new _n(18))};if("composite"===a.bucket.textSizeData.kind){let{minZoom:M,maxZoom:C}=a.bucket.textSizeData;h.compositeTextSizes=[l["text-size"].possiblyEvaluate(new _n(M),a.canonical),l["text-size"].possiblyEvaluate(new _n(C),a.canonical)]}if("composite"===a.bucket.iconSizeData.kind){let{minZoom:M,maxZoom:C}=a.bucket.iconSizeData;h.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new _n(M),a.canonical),l["icon-size"].possiblyEvaluate(new _n(C),a.canonical)]}let f=t.get("text-line-height")*oi,g="viewport"!==t.get("text-rotation-alignment")&&"point"!==t.get("symbol-placement"),v=t.get("text-keep-upright"),w=t.get("text-size");for(let M of a.bucket.features){let K,C=t.get("text-font").evaluate(M,{},a.canonical).join(","),P=w.evaluate(M,{},a.canonical),O=h.layoutTextSize.evaluate(M,{},a.canonical),F=h.layoutIconSize.evaluate(M,{},a.canonical),B={horizontal:{},vertical:void 0},j=M.text,Y=[0,0];if(j){let oe=j.toString(),ue=t.get("text-letter-spacing").evaluate(M,{},a.canonical)*oi,be=bm(oe)?ue:0,xe=t.get("text-anchor").evaluate(M,{},a.canonical),Ve=t.get("text-variable-anchor");if(!Ve){let Re=t.get("text-radial-offset").evaluate(M,{},a.canonical);Y=Re?B0(xe,[Re*oi,qm]):t.get("text-offset").evaluate(M,{},a.canonical).map(ke=>ke*oi)}let qe=g?"center":t.get("text-justify").evaluate(M,{},a.canonical),Ne=t.get("symbol-placement"),Te="point"===Ne?t.get("text-max-width").evaluate(M,{},a.canonical)*oi:0,De=()=>{a.bucket.allowVerticalPlacement&&Il(oe)&&(B.vertical=yd(j,a.glyphMap,a.glyphPositions,a.imagePositions,C,Te,f,xe,"left",be,Y,o.WritingMode.vertical,!0,Ne,O,P))};if(!g&&Ve){let Re="auto"===qe?Ve.map(Ee=>Wm(Ee)):[qe],ke=!1;for(let Ee=0;Ee<Re.length;Ee++){let tt=Re[Ee];if(!B.horizontal[tt])if(ke)B.horizontal[tt]=B.horizontal[0];else{let Qe=yd(j,a.glyphMap,a.glyphPositions,a.imagePositions,C,Te,f,"center",tt,be,Y,o.WritingMode.horizontal,!1,Ne,O,P);Qe&&(B.horizontal[tt]=Qe,ke=1===Qe.positionedLines.length)}}De()}else{"auto"===qe&&(qe=Wm(xe));let Re=yd(j,a.glyphMap,a.glyphPositions,a.imagePositions,C,Te,f,xe,qe,be,Y,o.WritingMode.horizontal,!1,Ne,O,P);Re&&(B.horizontal[qe]=Re),De(),Il(oe)&&g&&v&&(B.vertical=yd(j,a.glyphMap,a.glyphPositions,a.imagePositions,C,Te,f,xe,qe,be,Y,o.WritingMode.vertical,!1,Ne,O,P))}}let se=!1;if(M.icon&&M.icon.name){let oe=a.imageMap[M.icon.name];oe&&(K=wD(a.imagePositions[M.icon.name],t.get("icon-offset").evaluate(M,{},a.canonical),t.get("icon-anchor").evaluate(M,{},a.canonical)),se=!!oe.sdf,void 0===a.bucket.sdfIcons?a.bucket.sdfIcons=se:a.bucket.sdfIcons!==se&&rt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==a.bucket.pixelRatio||0!==t.get("icon-rotate").constantOr(1))&&(a.bucket.iconsNeedLinear=!0))}let de=U0(B.horizontal)||B.vertical;a.bucket.iconsInText=!!de&&de.iconsInText,(de||K)&&TD(a.bucket,M,B,K,a.imageMap,h,O,F,Y,se,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},o.perspective=function(a,t,l,h,f){var g,v=1/Math.tan(t/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+h)*(g=1/(h-f)),a[14]=2*f*h*g):(a[10]=-1,a[14]=-2*h),a},o.pick=function(a,t){let l={};for(let h=0;h<t.length;h++){let f=t[h];f in a&&(l[f]=a[f])}return l},o.plugin=Wi,o.pointGeometry=st,o.polygonIntersectsPolygon=Hv,o.potpack=M0,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=$e,o.registerForPluginStateChange=function(a){return a({pluginStatus:Di,pluginURL:vo}),au.on("pluginStateChange",a),a},o.renderColorRamp=n0,o.rotateX=function(a,t,l){var h=Math.sin(l),f=Math.cos(l),g=t[4],v=t[5],w=t[6],M=t[7],C=t[8],P=t[9],O=t[10],F=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=g*f+C*h,a[5]=v*f+P*h,a[6]=w*f+O*h,a[7]=M*f+F*h,a[8]=C*f-g*h,a[9]=P*f-v*h,a[10]=O*f-w*h,a[11]=F*f-M*h,a},o.rotateZ=function(a,t,l){var h=Math.sin(l),f=Math.cos(l),g=t[0],v=t[1],w=t[2],M=t[3],C=t[4],P=t[5],O=t[6],F=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*f+C*h,a[1]=v*f+P*h,a[2]=w*f+O*h,a[3]=M*f+F*h,a[4]=C*f-g*h,a[5]=P*f-v*h,a[6]=O*f-w*h,a[7]=F*f-M*h,a},o.scale=function(a,t,l){var h=l[0],f=l[1],g=l[2];return a[0]=t[0]*h,a[1]=t[1]*h,a[2]=t[2]*h,a[3]=t[3]*h,a[4]=t[4]*f,a[5]=t[5]*f,a[6]=t[6]*f,a[7]=t[7]*f,a[8]=t[8]*g,a[9]=t[9]*g,a[10]=t[10]*g,a[11]=t[11]*g,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},o.scale$1=function(a,t,l){return a[0]=t[0]*l,a[1]=t[1]*l,a[2]=t[2]*l,a},o.setCacheLimits=function(a,t){fn=a,ti=t},o.setRTLTextPlugin=function(a,t,l=!1){if(Di===iu||Di===ru||Di===ou)throw new Error("setRTLTextPlugin cannot be called multiple times.");vo=si.resolveURL(a),Di=iu,su=t,Os(),l||ed()},o.spec=_e,o.sphericalToCartesian=function([a,t,l]){return t+=90,t*=Math.PI/180,l*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(l),y:a*Math.sin(t)*Math.sin(l),z:a*Math.cos(l)}},o.sqrLen=function(a){var t=a[0],l=a[1];return t*t+l*l},o.sub=function(a,t,l){return a[0]=t[0]-l[0],a[1]=t[1]-l[1],a[2]=t[2]-l[2],a},o.toEvaluationFeature=Aa,o.transformMat3=function(a,t,l){var h=t[0],f=t[1],g=t[2];return a[0]=h*l[0]+f*l[3]+g*l[6],a[1]=h*l[1]+f*l[4]+g*l[7],a[2]=h*l[2]+f*l[5]+g*l[8],a},o.transformMat4=cd,o.transformMat4$1=function(a,t,l){var h=t[0],f=t[1];return a[0]=l[0]*h+l[4]*f+l[12],a[1]=l[1]*h+l[5]*f+l[13],a},o.translate=function(a,t,l){var h,f,g,v,w,M,C,P,O,F,B,j,K=l[0],Y=l[1],se=l[2];return t===a?(a[12]=t[0]*K+t[4]*Y+t[8]*se+t[12],a[13]=t[1]*K+t[5]*Y+t[9]*se+t[13],a[14]=t[2]*K+t[6]*Y+t[10]*se+t[14],a[15]=t[3]*K+t[7]*Y+t[11]*se+t[15]):(f=t[1],g=t[2],v=t[3],w=t[4],M=t[5],C=t[6],P=t[7],O=t[8],F=t[9],B=t[10],j=t[11],a[0]=h=t[0],a[1]=f,a[2]=g,a[3]=v,a[4]=w,a[5]=M,a[6]=C,a[7]=P,a[8]=O,a[9]=F,a[10]=B,a[11]=j,a[12]=h*K+w*Y+O*se+t[12],a[13]=f*K+M*Y+F*se+t[13],a[14]=g*K+C*Y+B*se+t[14],a[15]=v*K+P*Y+j*se+t[15]),a},o.triggerPluginCompletionEvent=Jh,o.unicodeBlockLookup=Oe,o.uniqueId=function(){return le++},o.validateCustomStyleLayer=function(a){let t=[],l=a.id;return void 0===l&&t.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&t.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&t.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),t},o.validateLight=Jc,o.validateStyle=Ma,o.vectorTile=zs,o.warnOnce=rt,o.wrap=G}),r(0,function(o){function y($){let T=typeof $;if("number"===T||"boolean"===T||"string"===T||null==$)return JSON.stringify($);if(Array.isArray($)){let V="[";for(let Q of $)V+=`${y(Q)},`;return`${V}]`}let N=Object.keys($).sort(),U="{";for(let V=0;V<N.length;V++)U+=`${JSON.stringify(N[V])}:${y($[N[V]])},`;return`${U}}`}function x($){let T="";for(let N of o.refProperties)T+=`/${y($[N])}`;return T}class I{constructor(T){this.keyCache={},T&&this.replace(T)}replace(T){this._layerConfigs={},this._layers={},this.update(T,[])}update(T,N){for(let V of T){this._layerConfigs[V.id]=V;let Q=this._layers[V.id]=o.createStyleLayer(V);Q._featureFilter=o.createFilter(Q.filter),this.keyCache[V.id]&&delete this.keyCache[V.id]}for(let V of N)delete this.keyCache[V],delete this._layerConfigs[V],delete this._layers[V];this.familiesBySource={};let U=function(V,Q){let te={};for(let X=0;X<V.length;X++){let ne=Q&&Q[V[X].id]||x(V[X]);Q&&(Q[V[X].id]=ne);let fe=te[ne];fe||(fe=te[ne]=[]),fe.push(V[X])}let J=[];for(let X in te)J.push(te[X]);return J}(Object.values(this._layerConfigs),this.keyCache);for(let V of U){let Q=V.map(we=>this._layers[we.id]),te=Q[0];if("none"===te.visibility)continue;let J=te.source||"",X=this.familiesBySource[J];X||(X=this.familiesBySource[J]={});let ne=te.sourceLayer||"_geojsonTileLayer",fe=X[ne];fe||(fe=X[ne]=[]),fe.push(Q)}}}class A{constructor(T){let N={},U=[];for(let J in T){let X=T[J],ne=N[J]={};for(let fe in X){let we=X[+fe];if(!we||0===we.bitmap.width||0===we.bitmap.height)continue;let pe={x:0,y:0,w:we.bitmap.width+2,h:we.bitmap.height+2};U.push(pe),ne[fe]={rect:pe,metrics:we.metrics}}}let{w:V,h:Q}=o.potpack(U),te=new o.AlphaImage({width:V||1,height:Q||1});for(let J in T){let X=T[J];for(let ne in X){let fe=X[+ne];if(!fe||0===fe.bitmap.width||0===fe.bitmap.height)continue;let we=N[J][ne].rect;o.AlphaImage.copy(fe.bitmap,te,{x:0,y:0},{x:we.x+1,y:we.y+1},fe.bitmap)}}this.image=te,this.positions=N}}o.register("GlyphAtlas",A);class L{constructor(T){this.tileID=new o.OverscaledTileID(T.tileID.overscaledZ,T.tileID.wrap,T.tileID.canonical.z,T.tileID.canonical.x,T.tileID.canonical.y),this.uid=T.uid,this.zoom=T.zoom,this.pixelRatio=T.pixelRatio,this.tileSize=T.tileSize,this.source=T.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=T.showCollisionBoxes,this.collectResourceTiming=!!T.collectResourceTiming,this.returnDependencies=!!T.returnDependencies,this.promoteId=T.promoteId}parse(T,N,U,V,Q){this.status="parsing",this.data=T,this.collisionBoxArray=new o.CollisionBoxArray;let te=new o.DictionaryCoder(Object.keys(T.layers).sort()),J=new o.FeatureIndex(this.tileID,this.promoteId);J.bucketLayerIDs=[];let X={},ne={featureIndex:J,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:U},fe=N.familiesBySource[this.source];for(let ut in fe){let vt=T.layers[ut];if(!vt)continue;1===vt.version&&o.warnOnce(`Vector tile source "${this.source}" layer "${ut}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let zt=te.encode(ut),rn=[];for(let Wn=0;Wn<vt.length;Wn++){let mn=vt.feature(Wn),ai=J.getId(mn,ut);rn.push({feature:mn,id:ai,index:Wn,sourceLayerIndex:zt})}for(let Wn of fe[ut]){let mn=Wn[0];mn.source!==this.source&&o.warnOnce(`layer.source = ${mn.source} does not equal this.source = ${this.source}`),mn.minzoom&&this.zoom<Math.floor(mn.minzoom)||mn.maxzoom&&this.zoom>=mn.maxzoom||"none"!==mn.visibility&&(G(Wn,this.zoom,U),(X[mn.id]=mn.createBucket({index:J.bucketLayerIDs.length,layers:Wn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zt,sourceID:this.source})).populate(rn,ne,this.tileID.canonical),J.bucketLayerIDs.push(Wn.map(ai=>ai.id)))}}let we,pe,Ze,We,Fe=o.mapObject(ne.glyphDependencies,ut=>Object.keys(ut).map(Number));Object.keys(Fe).length?V.send("getGlyphs",{uid:this.uid,stacks:Fe},(ut,vt)=>{we||(we=ut,pe=vt,Ft.call(this))}):pe={};let nt=Object.keys(ne.iconDependencies);nt.length?V.send("getImages",{icons:nt,source:this.source,tileID:this.tileID,type:"icons"},(ut,vt)=>{we||(we=ut,Ze=vt,Ft.call(this))}):Ze={};let lt=Object.keys(ne.patternDependencies);function Ft(){if(we)return Q(we);if(pe&&Ze&&We){let ut=new A(pe),vt=new o.ImageAtlas(Ze,We);for(let zt in X){let rn=X[zt];rn instanceof o.SymbolBucket?(G(rn.layers,this.zoom,U),o.performSymbolLayout({bucket:rn,glyphMap:pe,glyphPositions:ut.positions,imageMap:Ze,imagePositions:vt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):rn.hasPattern&&(rn instanceof o.LineBucket||rn instanceof o.FillBucket||rn instanceof o.FillExtrusionBucket)&&(G(rn.layers,this.zoom,U),rn.addFeatures(ne,this.tileID.canonical,vt.patternPositions))}this.status="done",Q(null,{buckets:Object.values(X).filter(zt=>!zt.isEmpty()),featureIndex:J,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ut.image,imageAtlas:vt,glyphMap:this.returnDependencies?pe:null,iconMap:this.returnDependencies?Ze:null,glyphPositions:this.returnDependencies?ut.positions:null})}}lt.length?V.send("getImages",{icons:lt,source:this.source,tileID:this.tileID,type:"patterns"},(ut,vt)=>{we||(we=ut,We=vt,Ft.call(this))}):We={},Ft.call(this)}}function G($,T,N){let U=new o.EvaluationParameters(T);for(let V of $)V.recalculate(U,N)}function re($,T){let N=o.getArrayBuffer($.request,(U,V,Q,te)=>{U?T(U):V&&T(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(V)),rawData:V,cacheControl:Q,expires:te})});return()=>{N.cancel(),T()}}class le{constructor(T,N,U,V){this.actor=T,this.layerIndex=N,this.availableImages=U,this.loadVectorData=V||re,this.loading={},this.loaded={}}loadTile(T,N){let U=T.uid;this.loading||(this.loading={});let V=!!(T&&T.request&&T.request.collectResourceTiming)&&new o.RequestPerformance(T.request),Q=this.loading[U]=new L(T);Q.abort=this.loadVectorData(T,(te,J)=>{if(delete this.loading[U],te||!J)return Q.status="done",this.loaded[U]=Q,N(te);let X=J.rawData,ne={};J.expires&&(ne.expires=J.expires),J.cacheControl&&(ne.cacheControl=J.cacheControl);let fe={};if(V){let we=V.finish();we&&(fe.resourceTiming=JSON.parse(JSON.stringify(we)))}Q.vectorTile=J.vectorTile,Q.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,(we,pe)=>{if(we||!pe)return N(we);N(null,o.extend({rawTileData:X.slice(0)},pe,ne,fe))}),this.loaded=this.loaded||{},this.loaded[U]=Q})}reloadTile(T,N){let U=this.loaded,V=T.uid,Q=this;if(U&&U[V]){let te=U[V];te.showCollisionBoxes=T.showCollisionBoxes;let J=(X,ne)=>{let fe=te.reloadCallback;fe&&(delete te.reloadCallback,te.parse(te.vectorTile,Q.layerIndex,this.availableImages,Q.actor,fe)),N(X,ne)};"parsing"===te.status?te.reloadCallback=J:"done"===te.status&&(te.vectorTile?te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,J):J())}}abortTile(T,N){let U=this.loading,V=T.uid;U&&U[V]&&U[V].abort&&(U[V].abort(),delete U[V]),N()}removeTile(T,N){let U=this.loaded,V=T.uid;U&&U[V]&&delete U[V],N()}}class ve{constructor(){this.loaded={}}loadTile(T,N){let{uid:U,encoding:V,rawImageData:Q}=T,te=o.isImageBitmap(Q)?this.getImageData(Q):Q,J=new o.DEMData(U,te,V);this.loaded=this.loaded||{},this.loaded[U]=J,N(null,J)}getImageData(T){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(T.width,T.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=T.width,this.offscreenCanvas.height=T.height,this.offscreenCanvasContext.drawImage(T,0,0,T.width,T.height);let N=this.offscreenCanvasContext.getImageData(-1,-1,T.width+2,T.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:N.width,height:N.height},N.data)}removeTile(T){let N=this.loaded,U=T.uid;N&&N[U]&&delete N[U]}}var Ie=function $(T,N){var U,V=T&&T.type;if("FeatureCollection"===V)for(U=0;U<T.features.length;U++)$(T.features[U],N);else if("GeometryCollection"===V)for(U=0;U<T.geometries.length;U++)$(T.geometries[U],N);else if("Feature"===V)$(T.geometry,N);else if("Polygon"===V)je(T.coordinates,N);else if("MultiPolygon"===V)for(U=0;U<T.coordinates.length;U++)je(T.coordinates[U],N);return T};function je($,T){if(0!==$.length){Ae($[0],T);for(var N=1;N<$.length;N++)Ae($[N],!T)}}function Ae($,T){for(var N=0,U=0,V=0,Q=$.length,te=Q-1;V<Q;te=V++){var J=($[V][0]-$[te][0])*($[te][1]+$[V][1]),X=N+J;U+=Math.abs(N)>=Math.abs(J)?N-X+J:J-X+N,N=X}N+U>=0!=!!T&&$.reverse()}let yt=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class rt{constructor(T){this._feature=T,this.extent=o.EXTENT,this.type=T.type,this.properties=T.tags,"id"in T&&!isNaN(T.id)&&(this.id=parseInt(T.id,10))}loadGeometry(){if(1===this._feature.type){let T=[];for(let N of this._feature.geometry)T.push([new o.pointGeometry(N[0],N[1])]);return T}{let T=[];for(let N of this._feature.geometry){let U=[];for(let V of N)U.push(new o.pointGeometry(V[0],V[1]));T.push(U)}return T}}toGeoJSON(T,N,U){return yt.call(this,T,N,U)}}class ot{constructor(T){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=T.length,this._features=T}feature(T){return new rt(this._features[T])}}var ln={exports:{}},kt=o.pointGeometry,nn=o.vectorTile.VectorTileFeature,Cn=jn;function jn($,T){this.options=T||{},this.features=$,this.length=$.length}function Pn($,T){this.id="number"==typeof $.id?$.id:void 0,this.type=$.type,this.rawGeometry=1===$.type?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=T||4096}jn.prototype.feature=function($){return new Pn(this.features[$],this.options.extent)},Pn.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var T=0;T<$.length;T++){for(var N=$[T],U=[],V=0;V<N.length;V++)U.push(new kt(N[V][0],N[V][1]));this.geometry.push(U)}return this.geometry},Pn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,T=1/0,N=-1/0,U=1/0,V=-1/0,Q=0;Q<$.length;Q++)for(var te=$[Q],J=0;J<te.length;J++){var X=te[J];T=Math.min(T,X.x),N=Math.max(N,X.x),U=Math.min(U,X.y),V=Math.max(V,X.y)}return[T,U,N,V]},Pn.prototype.toGeoJSON=nn.prototype.toGeoJSON;var Lr=o.pbf,Mi=Cn;function si($){var T=new Lr;return function(N,U){for(var V in N.layers)U.writeMessage(3,st,N.layers[V])}($,T),T.finish()}function st($,T){var N;T.writeVarintField(15,$.version||1),T.writeStringField(1,$.name||""),T.writeVarintField(5,$.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<$.length;N++)U.feature=$.feature(N),T.writeMessage(2,Zi,U);var V=U.keys;for(N=0;N<V.length;N++)T.writeStringField(3,V[N]);var Q=U.values;for(N=0;N<Q.length;N++)T.writeMessage(4,fn,Q[N])}function Zi($,T){var N=$.feature;void 0!==N.id&&T.writeVarintField(1,N.id),T.writeMessage(2,Ge,$),T.writeVarintField(3,N.type),T.writeMessage(4,Et,N)}function Ge($,T){var N=$.feature,U=$.keys,V=$.values,Q=$.keycache,te=$.valuecache;for(var J in N.properties){var X=N.properties[J],ne=Q[J];if(null!==X){void 0===ne&&(U.push(J),Q[J]=ne=U.length-1),T.writeVarint(ne);var fe=typeof X;"string"!==fe&&"boolean"!==fe&&"number"!==fe&&(X=JSON.stringify(X));var we=fe+":"+X,pe=te[we];void 0===pe&&(V.push(X),te[we]=pe=V.length-1),T.writeVarint(pe)}}}function Xe($,T){return(T<<3)+(7&$)}function Je($){return $<<1^$>>31}function Et($,T){for(var N=$.loadGeometry(),U=$.type,V=0,Q=0,te=N.length,J=0;J<te;J++){var X=N[J],ne=1;1===U&&(ne=X.length),T.writeVarint(Xe(1,ne));for(var fe=3===U?X.length-1:X.length,we=0;we<fe;we++){1===we&&1!==U&&T.writeVarint(Xe(2,fe-1));var pe=X[we].x-V,Ze=X[we].y-Q;T.writeVarint(Je(pe)),T.writeVarint(Je(Ze)),V+=pe,Q+=Ze}3===U&&T.writeVarint(Xe(7,1))}}function fn($,T){var N=typeof $;"string"===N?T.writeStringField(1,$):"boolean"===N?T.writeBooleanField(7,$):"number"===N&&($%1!=0?T.writeDoubleField(3,$):$<0?T.writeSVarintField(6,$):T.writeVarintField(5,$))}function ti($,T,N,U,V,Q){if(V-U<=N)return;let te=U+V>>1;On($,T,te,U,V,Q%2),ti($,T,N,U,te-1,Q+1),ti($,T,N,te+1,V,Q+1)}function On($,T,N,U,V,Q){for(;V>U;){if(V-U>600){let ne=V-U+1,fe=N-U+1,we=Math.log(ne),pe=.5*Math.exp(2*we/3),Ze=.5*Math.sqrt(we*pe*(ne-pe)/ne)*(fe-ne/2<0?-1:1);On($,T,N,Math.max(U,Math.floor(N-fe*pe/ne+Ze)),Math.min(V,Math.floor(N+(ne-fe)*pe/ne+Ze)),Q)}let te=T[2*N+Q],J=U,X=V;for(Un($,T,U,N),T[2*V+Q]>te&&Un($,T,U,V);J<X;){for(Un($,T,J,X),J++,X--;T[2*J+Q]<te;)J++;for(;T[2*X+Q]>te;)X--}T[2*U+Q]===te?Un($,T,U,X):(X++,Un($,T,X,V)),X<=N&&(U=X+1),N<=X&&(V=X-1)}}function Un($,T,N,U){Ht($,N,U),Ht(T,2*N,2*U),Ht(T,2*N+1,2*U+1)}function Ht($,T,N){let U=$[T];$[T]=$[N],$[N]=U}function er($,T,N,U){let V=$-N,Q=T-U;return V*V+Q*Q}ln.exports=si,ln.exports.fromVectorTileJs=si,ln.exports.fromGeojsonVt=function($,T){T=T||{};var N={};for(var U in $)N[U]=new Mi($[U].features,T),N[U].name=U,N[U].version=T.version,N[U].extent=T.extent;return si({layers:N})},ln.exports.GeoJSONWrapper=Mi;let _r=$=>$[0],qt=$=>$[1];class Ei{constructor(T,N=_r,U=qt,V=64,Q=Float64Array){this.nodeSize=V,this.points=T;let te=T.length<65536?Uint16Array:Uint32Array,J=this.ids=new te(T.length),X=this.coords=new Q(2*T.length);for(let ne=0;ne<T.length;ne++)J[ne]=ne,X[2*ne]=N(T[ne]),X[2*ne+1]=U(T[ne]);ti(J,X,V,0,J.length-1,0)}range(T,N,U,V){return function(Q,te,J,X,ne,fe,we){let We,Fe,pe=[0,Q.length-1,0],Ze=[];for(;pe.length;){let nt=pe.pop(),lt=pe.pop(),Ft=pe.pop();if(lt-Ft<=we){for(let zt=Ft;zt<=lt;zt++)We=te[2*zt],Fe=te[2*zt+1],We>=J&&We<=ne&&Fe>=X&&Fe<=fe&&Ze.push(Q[zt]);continue}let ut=Math.floor((Ft+lt)/2);We=te[2*ut],Fe=te[2*ut+1],We>=J&&We<=ne&&Fe>=X&&Fe<=fe&&Ze.push(Q[ut]);let vt=(nt+1)%2;(0===nt?J<=We:X<=Fe)&&(pe.push(Ft),pe.push(ut-1),pe.push(vt)),(0===nt?ne>=We:fe>=Fe)&&(pe.push(ut+1),pe.push(lt),pe.push(vt))}return Ze}(this.ids,this.coords,T,N,U,V,this.nodeSize)}within(T,N,U){return function(V,Q,te,J,X,ne){let fe=[0,V.length-1,0],we=[],pe=X*X;for(;fe.length;){let Ze=fe.pop(),We=fe.pop(),Fe=fe.pop();if(We-Fe<=ne){for(let vt=Fe;vt<=We;vt++)er(Q[2*vt],Q[2*vt+1],te,J)<=pe&&we.push(V[vt]);continue}let nt=Math.floor((Fe+We)/2),lt=Q[2*nt],Ft=Q[2*nt+1];er(lt,Ft,te,J)<=pe&&we.push(V[nt]);let ut=(Ze+1)%2;(0===Ze?te-X<=lt:J-X<=Ft)&&(fe.push(Fe),fe.push(nt-1),fe.push(ut)),(0===Ze?te+X>=lt:J+X>=Ft)&&(fe.push(nt+1),fe.push(We),fe.push(ut))}return we}(this.ids,this.coords,T,N,U,this.nodeSize)}}let Zn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},Ii=Math.fround||(ni=new Float32Array(1),$=>(ni[0]=+$,ni[0]));var ni;class na{constructor(T){this.options=fo(Object.create(Zn),T),this.trees=new Array(this.options.maxZoom+1)}load(T){let{log:N,minZoom:U,maxZoom:V,nodeSize:Q}=this.options;N&&console.time("total time");let te=`prepare ${T.length} points`;N&&console.time(te),this.points=T;let J=[];for(let X=0;X<T.length;X++)T[X].geometry&&J.push(_s(T[X],X));this.trees[V+1]=new Ei(J,ra,Or,Q,Float32Array),N&&console.timeEnd(te);for(let X=V;X>=U;X--){let ne=+Date.now();J=this._cluster(J,X),this.trees[X]=new Ei(J,ra,Or,Q,Float32Array),N&&console.log("z%d: %d clusters in %dms",X,J.length,+Date.now()-ne)}return N&&console.timeEnd("total time"),this}getClusters(T,N){let U=((T[0]+180)%360+360)%360-180,V=Math.max(-90,Math.min(90,T[1])),Q=180===T[2]?180:((T[2]+180)%360+360)%360-180,te=Math.max(-90,Math.min(90,T[3]));if(T[2]-T[0]>=360)U=-180,Q=180;else if(U>Q){let fe=this.getClusters([U,V,180,te],N),we=this.getClusters([-180,V,Q,te],N);return fe.concat(we)}let J=this.trees[this._limitZoom(N)],X=J.range(Nt(U),vr(te),Nt(Q),vr(V)),ne=[];for(let fe of X){let we=J.points[fe];ne.push(we.numPoints?vs(we):this.points[we.index])}return ne}getChildren(T){let N=this._getOriginId(T),U=this._getOriginZoom(T),V="No cluster with the specified id.",Q=this.trees[U];if(!Q)throw new Error(V);let te=Q.points[N];if(!te)throw new Error(V);let J=this.options.radius/(this.options.extent*Math.pow(2,U-1)),X=Q.within(te.x,te.y,J),ne=[];for(let fe of X){let we=Q.points[fe];we.parentId===T&&ne.push(we.numPoints?vs(we):this.points[we.index])}if(0===ne.length)throw new Error(V);return ne}getLeaves(T,N,U){let V=[];return this._appendLeaves(V,T,N=N||10,U=U||0,0),V}getTile(T,N,U){let V=this.trees[this._limitZoom(T)],Q=Math.pow(2,T),{extent:te,radius:J}=this.options,X=J/te,ne=(U-X)/Q,fe=(U+1+X)/Q,we={features:[]};return this._addTileFeatures(V.range((N-X)/Q,ne,(N+1+X)/Q,fe),V.points,N,U,Q,we),0===N&&this._addTileFeatures(V.range(1-X/Q,ne,1,fe),V.points,Q,U,Q,we),N===Q-1&&this._addTileFeatures(V.range(0,ne,X/Q,fe),V.points,-1,U,Q,we),we.features.length?we:null}getClusterExpansionZoom(T){let N=this._getOriginZoom(T)-1;for(;N<=this.options.maxZoom;){let U=this.getChildren(T);if(N++,1!==U.length)break;T=U[0].properties.cluster_id}return N}_appendLeaves(T,N,U,V,Q){let te=this.getChildren(N);for(let J of te){let X=J.properties;if(X&&X.cluster?Q+X.point_count<=V?Q+=X.point_count:Q=this._appendLeaves(T,X.cluster_id,U,V,Q):Q<V?Q++:T.push(J),T.length===U)break}return Q}_addTileFeatures(T,N,U,V,Q,te){for(let J of T){let fe,we,pe,X=N[J],ne=X.numPoints;if(ne)fe=ia(X),we=X.x,pe=X.y;else{let Fe=this.points[X.index];fe=Fe.properties,we=Nt(Fe.geometry.coordinates[0]),pe=vr(Fe.geometry.coordinates[1])}let We,Ze={type:1,geometry:[[Math.round(this.options.extent*(we*Q-U)),Math.round(this.options.extent*(pe*Q-V))]],tags:fe};ne?We=X.id:this.options.generateId?We=X.index:this.points[X.index].id&&(We=this.points[X.index].id),void 0!==We&&(Ze.id=We),te.features.push(Ze)}}_limitZoom(T){return Math.max(this.options.minZoom,Math.min(Math.floor(+T),this.options.maxZoom+1))}_cluster(T,N){let U=[],{radius:V,extent:Q,reduce:te,minPoints:J}=this.options,X=V/(Q*Math.pow(2,N));for(let ne=0;ne<T.length;ne++){let fe=T[ne];if(fe.zoom<=N)continue;fe.zoom=N;let we=this.trees[N+1],pe=we.within(fe.x,fe.y,X),Ze=fe.numPoints||1,We=Ze;for(let Fe of pe){let nt=we.points[Fe];nt.zoom>N&&(We+=nt.numPoints||1)}if(We>Ze&&We>=J){let Fe=fe.x*Ze,nt=fe.y*Ze,lt=te&&Ze>1?this._map(fe,!0):null,Ft=(ne<<5)+(N+1)+this.points.length;for(let ut of pe){let vt=we.points[ut];if(vt.zoom<=N)continue;vt.zoom=N;let zt=vt.numPoints||1;Fe+=vt.x*zt,nt+=vt.y*zt,vt.parentId=Ft,te&&(lt||(lt=this._map(fe,!0)),te(lt,this._map(vt)))}fe.parentId=Ft,U.push(ho(Fe/We,nt/We,Ft,We,lt))}else if(U.push(fe),We>1)for(let Fe of pe){let nt=we.points[Fe];nt.zoom<=N||(nt.zoom=N,U.push(nt))}}return U}_getOriginId(T){return T-this.points.length>>5}_getOriginZoom(T){return(T-this.points.length)%32}_map(T,N){if(T.numPoints)return N?fo({},T.properties):T.properties;let U=this.points[T.index].properties,V=this.options.map(U);return N&&V===U?fo({},V):V}}function ho($,T,N,U,V){return{x:Ii($),y:Ii(T),zoom:1/0,id:N,parentId:-1,numPoints:U,properties:V}}function _s($,T){let[N,U]=$.geometry.coordinates;return{x:Ii(Nt(N)),y:Ii(vr(U)),zoom:1/0,index:T,parentId:-1}}function vs($){return{type:"Feature",id:$.id,properties:ia($),geometry:{type:"Point",coordinates:[(T=$.x,360*(T-.5)),po($.y)]}};var T}function ia($){let T=$.numPoints,N=T>=1e4?`${Math.round(T/1e3)}k`:T>=1e3?Math.round(T/100)/10+"k":T;return fo(fo({},$.properties),{cluster:!0,cluster_id:$.id,point_count:T,point_count_abbreviated:N})}function Nt($){return $/360+.5}function vr($){let T=Math.sin($*Math.PI/180),N=.5-.25*Math.log((1+T)/(1-T))/Math.PI;return N<0?0:N>1?1:N}function po($){let T=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(T))/Math.PI-90}function fo($,T){for(let N in T)$[N]=T[N];return $}function ra($){return $.x}function Or($){return $.y}function Nr($,T,N,U){for(var V,Q=U,te=N-T>>1,J=N-T,X=$[T],ne=$[T+1],fe=$[N],we=$[N+1],pe=T+3;pe<N;pe+=3){var Ze=xs($[pe],$[pe+1],X,ne,fe,we);if(Ze>Q)V=pe,Q=Ze;else if(Ze===Q){var We=Math.abs(pe-te);We<J&&(V=pe,J=We)}}Q>U&&(V-T>3&&Nr($,T,V,U),$[V+2]=Q,N-V>3&&Nr($,V,N,U))}function xs($,T,N,U,V,Q){var te=V-N,J=Q-U;if(0!==te||0!==J){var X=(($-N)*te+(T-U)*J)/(te*te+J*J);X>1?(N=V,U=Q):X>0&&(N+=te*X,U+=J*X)}return(te=$-N)*te+(J=T-U)*J}function Rr($,T,N,U){var V={id:void 0===$?null:$,type:T,geometry:N,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var te=Q.geometry,J=Q.type;if("Point"===J||"MultiPoint"===J||"LineString"===J)_e(Q,te);else if("Polygon"===J||"MultiLineString"===J)for(var X=0;X<te.length;X++)_e(Q,te[X]);else if("MultiPolygon"===J)for(X=0;X<te.length;X++)for(var ne=0;ne<te[X].length;ne++)_e(Q,te[X][ne])}(V),V}function _e($,T){for(var N=0;N<T.length;N+=3)$.minX=Math.min($.minX,T[N]),$.minY=Math.min($.minY,T[N+1]),$.maxX=Math.max($.maxX,T[N]),$.maxY=Math.max($.maxY,T[N+1])}function Pe($,T,N,U){if(T.geometry){var V=T.geometry.coordinates,Q=T.geometry.type,te=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),J=[],X=T.id;if(N.promoteId?X=T.properties[N.promoteId]:N.generateId&&(X=U||0),"Point"===Q)Bo(V,J);else if("MultiPoint"===Q)for(var ne=0;ne<V.length;ne++)Bo(V[ne],J);else if("LineString"===Q)tr(V,J,te,!1);else if("MultiLineString"===Q){if(N.lineMetrics){for(ne=0;ne<V.length;ne++)tr(V[ne],J=[],te,!1),$.push(Rr(X,"LineString",J,T.properties));return}Rt(V,J,te,!1)}else if("Polygon"===Q)Rt(V,J,te,!0);else{if("MultiPolygon"!==Q){if("GeometryCollection"===Q){for(ne=0;ne<T.geometry.geometries.length;ne++)Pe($,{id:X,geometry:T.geometry.geometries[ne],properties:T.properties},N,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ne=0;ne<V.length;ne++){var fe=[];Rt(V[ne],fe,te,!0),J.push(fe)}}$.push(Rr(X,Q,J,T.properties))}}function Bo($,T){T.push(qi($[0])),T.push(Oi($[1])),T.push(0)}function tr($,T,N,U){for(var V,Q,te=0,J=0;J<$.length;J++){var X=qi($[J][0]),ne=Oi($[J][1]);T.push(X),T.push(ne),T.push(0),J>0&&(te+=U?(V*ne-X*Q)/2:Math.sqrt(Math.pow(X-V,2)+Math.pow(ne-Q,2))),V=X,Q=ne}var fe=T.length-3;T[2]=1,Nr(T,0,fe,N),T[fe+2]=1,T.size=Math.abs(te),T.start=0,T.end=T.size}function Rt($,T,N,U){for(var V=0;V<$.length;V++){var Q=[];tr($[V],Q,N,U),T.push(Q)}}function qi($){return $/360+.5}function Oi($){var T=Math.sin($*Math.PI/180),N=.5-.25*Math.log((1+T)/(1-T))/Math.PI;return N<0?0:N>1?1:N}function Ni($,T,N,U,V,Q,te,J){if(U/=T,Q>=(N/=T)&&te<U)return $;if(te<N||Q>=U)return null;for(var X=[],ne=0;ne<$.length;ne++){var fe=$[ne],we=fe.geometry,pe=fe.type,Ze=0===V?fe.minX:fe.minY,We=0===V?fe.maxX:fe.maxY;if(Ze>=N&&We<U)X.push(fe);else if(!(We<N||Ze>=U)){var Fe=[];if("Point"===pe||"MultiPoint"===pe)mo(we,Fe,N,U,V);else if("LineString"===pe)Ce(we,Fe,N,U,V,!1,J.lineMetrics);else if("MultiLineString"===pe)mt(we,Fe,N,U,V,!1);else if("Polygon"===pe)mt(we,Fe,N,U,V,!0);else if("MultiPolygon"===pe)for(var nt=0;nt<we.length;nt++){var lt=[];mt(we[nt],lt,N,U,V,!0),lt.length&&Fe.push(lt)}if(Fe.length){if(J.lineMetrics&&"LineString"===pe){for(nt=0;nt<Fe.length;nt++)X.push(Rr(fe.id,pe,Fe[nt],fe.tags));continue}"LineString"!==pe&&"MultiLineString"!==pe||(1===Fe.length?(pe="LineString",Fe=Fe[0]):pe="MultiLineString"),"Point"!==pe&&"MultiPoint"!==pe||(pe=3===Fe.length?"Point":"MultiPoint"),X.push(Rr(fe.id,pe,Fe,fe.tags))}}}return X.length?X:null}function mo($,T,N,U,V){for(var Q=0;Q<$.length;Q+=3){var te=$[Q+V];te>=N&&te<=U&&(T.push($[Q]),T.push($[Q+1]),T.push($[Q+2]))}}function Ce($,T,N,U,V,Q,te){for(var J,X,ne=_t($),fe=0===V?go:ht,we=$.start,pe=0;pe<$.length-3;pe+=3){var Ze=$[pe],We=$[pe+1],Fe=$[pe+2],nt=$[pe+3],lt=$[pe+4],Ft=0===V?Ze:We,ut=0===V?nt:lt,vt=!1;te&&(J=Math.sqrt(Math.pow(Ze-nt,2)+Math.pow(We-lt,2))),Ft<N?ut>N&&(X=fe(ne,Ze,We,nt,lt,N),te&&(ne.start=we+J*X)):Ft>U?ut<U&&(X=fe(ne,Ze,We,nt,lt,U),te&&(ne.start=we+J*X)):ii(ne,Ze,We,Fe),ut<N&&Ft>=N&&(X=fe(ne,Ze,We,nt,lt,N),vt=!0),ut>U&&Ft<=U&&(X=fe(ne,Ze,We,nt,lt,U),vt=!0),!Q&&vt&&(te&&(ne.end=we+J*X),T.push(ne),ne=_t($)),te&&(we+=J)}var zt=$.length-3;Ze=$[zt],We=$[zt+1],Fe=$[zt+2],(Ft=0===V?Ze:We)>=N&&Ft<=U&&ii(ne,Ze,We,Fe),zt=ne.length-3,Q&&zt>=3&&(ne[zt]!==ne[0]||ne[zt+1]!==ne[1])&&ii(ne,ne[0],ne[1],ne[2]),ne.length&&T.push(ne)}function _t($){var T=[];return T.size=$.size,T.start=$.start,T.end=$.end,T}function mt($,T,N,U,V,Q){for(var te=0;te<$.length;te++)Ce($[te],T,N,U,V,Q,!1)}function ii($,T,N,U){$.push(T),$.push(N),$.push(U)}function go($,T,N,U,V,Q){var te=(Q-T)/(U-T);return $.push(Q),$.push(N+(V-N)*te),$.push(1),te}function ht($,T,N,U,V,Q){var te=(Q-N)/(V-N);return $.push(T+(U-T)*te),$.push(Q),$.push(1),te}function Fr($,T){for(var N=[],U=0;U<$.length;U++){var V,Q=$[U],te=Q.type;if("Point"===te||"MultiPoint"===te||"LineString"===te)V=qn(Q.geometry,T);else if("MultiLineString"===te||"Polygon"===te){V=[];for(var J=0;J<Q.geometry.length;J++)V.push(qn(Q.geometry[J],T))}else if("MultiPolygon"===te)for(V=[],J=0;J<Q.geometry.length;J++){for(var X=[],ne=0;ne<Q.geometry[J].length;ne++)X.push(qn(Q.geometry[J][ne],T));V.push(X)}N.push(Rr(Q.id,te,V,Q.tags))}return N}function qn($,T){var N=[];N.size=$.size,void 0!==$.start&&(N.start=$.start,N.end=$.end);for(var U=0;U<$.length;U+=3)N.push($[U]+T,$[U+1],$[U+2]);return N}function bs($,T){if($.transformed)return $;var N,U,V,Q=1<<$.z,te=$.x,J=$.y;for(N=0;N<$.features.length;N++){var X=$.features[N],ne=X.geometry,fe=X.type;if(X.geometry=[],1===fe)for(U=0;U<ne.length;U+=2)X.geometry.push(Nn(ne[U],ne[U+1],T,Q,te,J));else for(U=0;U<ne.length;U++){var we=[];for(V=0;V<ne[U].length;V+=2)we.push(Nn(ne[U][V],ne[U][V+1],T,Q,te,J));X.geometry.push(we)}}return $.transformed=!0,$}function Nn($,T,N,U,V,Q){return[Math.round(N*($*U-V)),Math.round(N*(T*U-Q))]}function yi($,T,N,U,V){for(var Q=T===V.maxZoom?0:V.tolerance/((1<<T)*V.extent),te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:U,z:T,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},J=0;J<$.length;J++){te.numFeatures++,Kt(te,$[J],Q,V);var X=$[J].minX,ne=$[J].minY,fe=$[J].maxX,we=$[J].maxY;X<te.minX&&(te.minX=X),ne<te.minY&&(te.minY=ne),fe>te.maxX&&(te.maxX=fe),we>te.maxY&&(te.maxY=we)}return te}function Kt($,T,N,U){var V=T.geometry,Q=T.type,te=[];if("Point"===Q||"MultiPoint"===Q)for(var J=0;J<V.length;J+=3)te.push(V[J]),te.push(V[J+1]),$.numPoints++,$.numSimplified++;else if("LineString"===Q)ws(te,V,$,N,!1,!1);else if("MultiLineString"===Q||"Polygon"===Q)for(J=0;J<V.length;J++)ws(te,V[J],$,N,"Polygon"===Q,0===J);else if("MultiPolygon"===Q)for(var X=0;X<V.length;X++){var ne=V[X];for(J=0;J<ne.length;J++)ws(te,ne[J],$,N,!0,0===J)}if(te.length){var fe=T.tags||null;if("LineString"===Q&&U.lineMetrics){for(var we in fe={},T.tags)fe[we]=T.tags[we];fe.mapbox_clip_start=V.start/V.size,fe.mapbox_clip_end=V.end/V.size}var pe={geometry:te,type:"Polygon"===Q||"MultiPolygon"===Q?3:"LineString"===Q||"MultiLineString"===Q?2:1,tags:fe};null!==T.id&&(pe.id=T.id),$.features.push(pe)}}function ws($,T,N,U,V,Q){var te=U*U;if(U>0&&T.size<(V?te:U))N.numPoints+=T.length/3;else{for(var J=[],X=0;X<T.length;X+=3)(0===U||T[X+2]>te)&&(N.numSimplified++,J.push(T[X]),J.push(T[X+1])),N.numPoints++;V&&function(ne,fe){for(var we=0,pe=0,Ze=ne.length,We=Ze-2;pe<Ze;We=pe,pe+=2)we+=(ne[pe]-ne[We])*(ne[pe+1]+ne[We+1]);if(we>0===fe)for(pe=0,Ze=ne.length;pe<Ze/2;pe+=2){var Fe=ne[pe],nt=ne[pe+1];ne[pe]=ne[Ze-2-pe],ne[pe+1]=ne[Ze-1-pe],ne[Ze-2-pe]=Fe,ne[Ze-1-pe]=nt}}(J,Q),$.push(J)}}function xr($,T){var N=(T=this.options=function(V,Q){for(var te in Q)V[te]=Q[te];return V}(Object.create(this.options),T)).debug;if(N&&console.time("preprocess data"),T.maxZoom<0||T.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(T.promoteId&&T.generateId)throw new Error("promoteId and generateId cannot be used together.");var V,Q,te,J,X,ne,U=function(V,Q){var te=[];if("FeatureCollection"===V.type)for(var J=0;J<V.features.length;J++)Pe(te,V.features[J],Q,J);else Pe(te,"Feature"===V.type?V:{geometry:V},Q);return te}($,T);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",T.indexMaxZoom,T.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=V=U,X=Ni(V,1,-1-(te=(Q=T).buffer/Q.extent),te,0,-1,2,Q),ne=Ni(V,1,1-te,2+te,0,-1,2,Q),(X||ne)&&(J=Ni(V,1,-te,1+te,0,-1,2,Q)||[],X&&(J=Fr(X,1).concat(J)),ne&&(J=J.concat(Fr(ne,-1)))),(U=J).length&&this.splitTile(U,0,0,0),N&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jo($,T,N){return 32*((1<<$)*N+T)+$}function Uo($,T){let N=$.tileID.canonical;if(!this._geoJSONIndex)return T(null,null);let U=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!U)return T(null,null);let V=new ot(U.features),Q=ln.exports(V);0===Q.byteOffset&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),T(null,{vectorTile:V,rawData:Q.buffer})}xr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},xr.prototype.splitTile=function($,T,N,U,V,Q,te){for(var J=[$,T,N,U],X=this.options,ne=X.debug;J.length;){U=J.pop(),N=J.pop(),T=J.pop(),$=J.pop();var fe=1<<T,we=jo(T,N,U),pe=this.tiles[we];if(!pe&&(ne>1&&console.time("creation"),pe=this.tiles[we]=yi($,T,N,U,X),this.tileCoords.push({z:T,x:N,y:U}),ne)){ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",T,N,U,pe.numFeatures,pe.numPoints,pe.numSimplified),console.timeEnd("creation"));var Ze="z"+T;this.stats[Ze]=(this.stats[Ze]||0)+1,this.total++}if(pe.source=$,V){if(T===X.maxZoom||T===V)continue;var We=1<<V-T;if(N!==Math.floor(Q/We)||U!==Math.floor(te/We))continue}else if(T===X.indexMaxZoom||pe.numPoints<=X.indexMaxPoints)continue;if(pe.source=null,0!==$.length){ne>1&&console.time("clipping");var Fe,nt,lt,Ft,ut,vt,zt=.5*X.buffer/X.extent,rn=.5-zt,Wn=.5+zt,mn=1+zt;Fe=nt=lt=Ft=null,ut=Ni($,fe,N-zt,N+Wn,0,pe.minX,pe.maxX,X),vt=Ni($,fe,N+rn,N+mn,0,pe.minX,pe.maxX,X),$=null,ut&&(Fe=Ni(ut,fe,U-zt,U+Wn,1,pe.minY,pe.maxY,X),nt=Ni(ut,fe,U+rn,U+mn,1,pe.minY,pe.maxY,X),ut=null),vt&&(lt=Ni(vt,fe,U-zt,U+Wn,1,pe.minY,pe.maxY,X),Ft=Ni(vt,fe,U+rn,U+mn,1,pe.minY,pe.maxY,X),vt=null),ne>1&&console.timeEnd("clipping"),J.push(Fe||[],T+1,2*N,2*U),J.push(nt||[],T+1,2*N,2*U+1),J.push(lt||[],T+1,2*N+1,2*U),J.push(Ft||[],T+1,2*N+1,2*U+1)}}},xr.prototype.getTile=function($,T,N){var U=this.options,V=U.extent,Q=U.debug;if($<0||$>24)return null;var te=1<<$,J=jo($,T=(T%te+te)%te,N);if(this.tiles[J])return bs(this.tiles[J],V);Q>1&&console.log("drilling down to z%d-%d-%d",$,T,N);for(var X,ne=$,fe=T,we=N;!X&&ne>0;)ne--,fe=Math.floor(fe/2),we=Math.floor(we/2),X=this.tiles[jo(ne,fe,we)];return X&&X.source?(Q>1&&console.log("found parent tile z%d-%d-%d",ne,fe,we),Q>1&&console.time("drilling down"),this.splitTile(X.source,ne,fe,we,$,T,N),Q>1&&console.timeEnd("drilling down"),this.tiles[J]?bs(this.tiles[J],V):null):null};class Ms extends le{constructor(T,N,U,V){super(T,N,U,Uo),V&&(this.loadGeoJSON=V)}loadData(T,N){var U;null===(U=this._pendingRequest)||void 0===U||U.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let V=!!(T&&T.request&&T.request.collectResourceTiming)&&new o.RequestPerformance(T.request);this._pendingCallback=N,this._pendingRequest=this.loadGeoJSON(T,(Q,te)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!te)return N(Q);if("object"!=typeof te)return N(new Error(`Input data given to '${T.source}' is not a valid GeoJSON object.`));{Ie(te,!0);try{if(T.filter){let X=o.createExpression(T.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===X.result)throw new Error(X.value.map(fe=>`${fe.key}: ${fe.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(fe=>X.value.evaluate({zoom:0},fe))}}this._geoJSONIndex=T.cluster?new na(function({superclusterOptions:X,clusterProperties:ne}){if(!ne||!X)return X;let fe={},we={},pe={accumulated:null,zoom:0},Ze={properties:null},We=Object.keys(ne);for(let Fe of We){let[nt,lt]=ne[Fe],Ft=o.createExpression(lt),ut=o.createExpression("string"==typeof nt?[nt,["accumulated"],["get",Fe]]:nt);fe[Fe]=Ft.value,we[Fe]=ut.value}return X.map=Fe=>{Ze.properties=Fe;let nt={};for(let lt of We)nt[lt]=fe[lt].evaluate(pe,Ze);return nt},X.reduce=(Fe,nt)=>{Ze.properties=nt;for(let lt of We)pe.accumulated=Fe[lt],Fe[lt]=we[lt].evaluate(pe,Ze)},X}(T)).load(te.features):new xr(X=te,T.geojsonVtOptions)}catch(X){return N(X)}this.loaded={};let J={};if(V){let X=V.finish();X&&(J.resourceTiming={},J.resourceTiming[T.source]=JSON.parse(JSON.stringify(X)))}N(null,J)}var X})}reloadTile(T,N){let U=this.loaded;return U&&U[T.uid]?super.reloadTile(T,N):this.loadTile(T,N)}loadGeoJSON(T,N){if(T.request)return o.getJSON(T.request,N);if("string"==typeof T.data)try{N(null,JSON.parse(T.data))}catch{N(new Error(`Input data given to '${T.source}' is not a valid GeoJSON object.`))}else N(new Error(`Input data given to '${T.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(T,N){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),N()}getClusterExpansionZoom(T,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(T.clusterId))}catch(U){N(U)}}getClusterChildren(T,N){try{N(null,this._geoJSONIndex.getChildren(T.clusterId))}catch(U){N(U)}}getClusterLeaves(T,N){try{N(null,this._geoJSONIndex.getLeaves(T.clusterId,T.limit,T.offset))}catch(U){N(U)}}}class Vo{constructor(T){this.self=T,this.actor=new o.Actor(T,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:le,geojson:Ms},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,U)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=U},this.self.registerRTLTextPlugin=N=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=N.applyArabicShaping,o.plugin.processBidirectionalText=N.processBidirectionalText,o.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}setReferrer(T,N){this.referrer=N}setImages(T,N,U){this.availableImages[T]=N;for(let V in this.workerSources[T]){let Q=this.workerSources[T][V];for(let te in Q)Q[te].availableImages=N}U()}setLayers(T,N,U){this.getLayerIndex(T).replace(N),U()}updateLayers(T,N,U){this.getLayerIndex(T).update(N.layers,N.removedIds),U()}loadTile(T,N,U){this.getWorkerSource(T,N.type,N.source).loadTile(N,U)}loadDEMTile(T,N,U){this.getDEMWorkerSource(T,N.source).loadTile(N,U)}reloadTile(T,N,U){this.getWorkerSource(T,N.type,N.source).reloadTile(N,U)}abortTile(T,N,U){this.getWorkerSource(T,N.type,N.source).abortTile(N,U)}removeTile(T,N,U){this.getWorkerSource(T,N.type,N.source).removeTile(N,U)}removeDEMTile(T,N){this.getDEMWorkerSource(T,N.source).removeTile(N)}removeSource(T,N,U){if(!this.workerSources[T]||!this.workerSources[T][N.type]||!this.workerSources[T][N.type][N.source])return;let V=this.workerSources[T][N.type][N.source];delete this.workerSources[T][N.type][N.source],void 0!==V.removeSource?V.removeSource(N,U):U()}loadWorkerSource(T,N,U){try{this.self.importScripts(N.url),U()}catch(V){U(V.toString())}}syncRTLPluginState(T,N,U){try{o.plugin.setState(N);let V=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&null!=V){this.self.importScripts(V);let Q=o.plugin.isParsed();U(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${V}`),Q)}}catch(V){U(V.toString())}}getAvailableImages(T){let N=this.availableImages[T];return N||(N=[]),N}getLayerIndex(T){let N=this.layerIndexes[T];return N||(N=this.layerIndexes[T]=new I),N}getWorkerSource(T,N,U){return this.workerSources[T]||(this.workerSources[T]={}),this.workerSources[T][N]||(this.workerSources[T][N]={}),this.workerSources[T][N][U]||(this.workerSources[T][N][U]=new this.workerSourceTypes[N]({send:(Q,te,J)=>{this.actor.send(Q,te,J,T)}},this.getLayerIndex(T),this.getAvailableImages(T))),this.workerSources[T][N][U]}getDEMWorkerSource(T,N){return this.demWorkerSources[T]||(this.demWorkerSources[T]={}),this.demWorkerSources[T][N]||(this.demWorkerSources[T][N]=new ve),this.demWorkerSources[T][N]}enforceCacheSizeLimit(T,N){o.enforceCacheSizeLimit(N)}}return o.isWorker()&&(self.worker=new Vo(self)),Vo}),r(0,function(o){var y=x;function x(p){return n=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,m,_=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(_);try{m=new Worker(b),d=!0}catch{d=!1}return m&&m.terminate(),URL.revokeObjectURL(b),d}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var d=document.createElement("canvas");d.width=d.height=1;var m=d.getContext("2d");if(!m)return!1;var _=m.getImageData(0,0,1,1);return _&&_.width===d.width}()||(void 0===I[u=n&&n.failIfMajorPerformanceCaveat]&&(I[u]=function(d){var m,b,E,D,_=(b=d,E=document.createElement("canvas"),(D=Object.create(x.webGLContextAttributes)).failIfMajorPerformanceCaveat=b,E.getContext("webgl",D)||E.getContext("experimental-webgl",D));if(!_)return!1;try{m=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!m||_.isContextLost())&&(_.shaderSource(m,"void main() {}"),_.compileShader(m),!0===_.getShaderParameter(m,_.COMPILE_STATUS))}(u)),!I[u]||document.documentMode));var n,u}var I={};function A(p,n){if(Array.isArray(p)){if(!Array.isArray(n)||p.length!==n.length)return!1;for(let u=0;u<p.length;u++)if(!A(p[u],n[u]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==n){if("object"!=typeof n||Object.keys(p).length!==Object.keys(n).length)return!1;for(let u in p)if(!A(p[u],n[u]))return!1;return!0}return p===n}x.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class L{static testProp(n){if(!L.docStyle)return n[0];for(let u=0;u<n.length;u++)if(n[u]in L.docStyle)return n[u];return n[0]}static create(n,u,d){let m=window.document.createElement(n);return void 0!==u&&(m.className=u),d&&d.appendChild(m),m}static createNS(n,u){return window.document.createElementNS(n,u)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(n,u){n.style[L.transformProp]=u}static addEventListener(n,u,d,m={}){n.addEventListener(u,d,"passive"in m?m:m.capture)}static removeEventListener(n,u,d,m={}){n.removeEventListener(u,d,"passive"in m?m:m.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static mousePos(n,u){let d=n.getBoundingClientRect();return new o.pointGeometry(u.clientX-d.left-n.clientLeft,u.clientY-d.top-n.clientTop)}static touchPos(n,u){let d=n.getBoundingClientRect(),m=[];for(let _=0;_<u.length;_++)m.push(new o.pointGeometry(u[_].clientX-d.left-n.clientLeft,u[_].clientY-d.top-n.clientTop));return m}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);class G{constructor(n){this._transformRequestFn=n}transformRequest(n,u){return this._transformRequestFn&&this._transformRequestFn(n,u)||{url:n}}normalizeSpriteURL(n,u,d){let m=function(_){let b=_.match(re);if(!b)throw new Error(`Unable to parse URL "${_}"`);return{protocol:b[1],authority:b[2],path:b[3]||"/",params:b[4]?b[4].split("&"):[]}}(n);return m.path+=`${u}${d}`,function(_){let b=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${b}`}(m)}setTransformRequest(n){this._transformRequestFn=n}}let re=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class le{constructor(n,u,d,m){this.context=n,this.format=d,this.texture=n.gl.createTexture(),this.update(u,m)}update(n,u,d){let{width:m,height:_}=n,b=!(this.size&&this.size[0]===m&&this.size[1]===_||d),{context:E}=this,{gl:D}=E;if(this.useMipmap=Boolean(u&&u.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!u||!1!==u.premultiply)),b)this.size=[m,_],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||o.isImageBitmap(n)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,n):D.texImage2D(D.TEXTURE_2D,0,this.format,m,_,0,this.format,D.UNSIGNED_BYTE,n.data);else{let{x:S,y:k}=d||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||o.isImageBitmap(n)?D.texSubImage2D(D.TEXTURE_2D,0,S,k,D.RGBA,D.UNSIGNED_BYTE,n):D.texSubImage2D(D.TEXTURE_2D,0,S,k,m,_,D.RGBA,D.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(n,u,d){let{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),d!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=_.LINEAR),n!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,d||n),this.filter=n),u!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}function ve(p){let{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}class Ie extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(let{ids:u,callback:d}of this.requestors)this._notify(u,d);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,u){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,u)&&(this.images[n]=u)}_validate(n,u){let d=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),d=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),d=!1),this._validateContent(u.content,u)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),d=!1),d}_validateStretch(n,u){if(!n)return!0;let d=0;for(let m of n){if(m[0]<d||m[1]<m[0]||u<m[1])return!1;d=m[1]}return!0}_validateContent(n,u){return!(n&&(4!==n.length||n[0]<0||u.data.width<n[0]||n[1]<0||u.data.height<n[1]||n[2]<0||u.data.width<n[2]||n[3]<0||u.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,u){let d=this.images[n];if(d.data.width!==u.data.width||d.data.height!==u.data.height)throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=d.version+1,this.images[n]=u,this.updatedImages[n]=!0}removeImage(n){let u=this.images[n];delete this.images[n],delete this.patterns[n],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,u){let d=!0;if(!this.isLoaded())for(let m of n)this.images[m]||(d=!1);this.isLoaded()||d?this._notify(n,u):this.requestors.push({ids:n,callback:u})}_notify(n,u){let d={};for(let m of n){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));let _=this.images[m];_?d[m]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,d)}getPixelSize(){let{width:n,height:u}=this.atlasImage;return{width:n,height:u}}getPattern(n){let u=this.patterns[n],d=this.getImage(n);if(!d)return null;if(u&&u.position.version===d.version)return u.position;if(u)u.position.version=d.version;else{let m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},_=new o.ImagePosition(m,d);this.patterns[n]={bin:m,position:_}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){let u=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new le(n,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){let n=[];for(let _ in this.patterns)n.push(this.patterns[_].bin);let{w:u,h:d}=o.potpack(n),m=this.atlasImage;m.resize({width:u||1,height:d||1});for(let _ in this.patterns){let{bin:b}=this.patterns[_],E=b.x+1,D=b.y+1,S=this.images[_].data,k=S.width,R=S.height;o.RGBAImage.copy(S,m,{x:0,y:0},{x:E,y:D},{width:k,height:R}),o.RGBAImage.copy(S,m,{x:0,y:R-1},{x:E,y:D-1},{width:k,height:1}),o.RGBAImage.copy(S,m,{x:0,y:0},{x:E,y:D+R},{width:k,height:1}),o.RGBAImage.copy(S,m,{x:k-1,y:0},{x:E-1,y:D},{width:1,height:R}),o.RGBAImage.copy(S,m,{x:0,y:0},{x:E+k,y:D},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(let u of n){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;let d=this.images[u];d||o.warnOnce(`Image with ID: "${u}" was not found`),ve(d)&&this.updateImage(u,d)}}}let je=1e20;function Ae(p,n,u,d,m,_,b,E,D){for(let S=n;S<n+d;S++)yt(p,u*_+S,_,m,b,E,D);for(let S=u;S<u+m;S++)yt(p,S*_+n,1,d,b,E,D)}function yt(p,n,u,d,m,_,b){_[0]=0,b[0]=-je,b[1]=je,m[0]=p[n];for(let E=1,D=0,S=0;E<d;E++){m[E]=p[n+E*u];let k=E*E;do{let R=_[D];S=(m[E]-m[R]+k-R*R)/(E-R)/2}while(S<=b[D]&&--D>-1);D++,_[D]=E,b[D]=S,b[D+1]=je}for(let E=0,D=0;E<d;E++){for(;b[D+1]<E;)D++;let S=_[D],k=E-S;p[n+E*u]=m[S]+k*k}}class rt{constructor(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}}setURL(n){this.url=n}getGlyphs(n,u){let d=[];for(let m in n)for(let _ of n[m])d.push({stack:m,id:_});o.asyncAll(d,({stack:m,id:_},b)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{}});let D=E.glyphs[_];if(void 0!==D)return void b(null,{stack:m,id:_,glyph:D});if(D=this._tinySDF(E,m,_),D)return E.glyphs[_]=D,void b(null,{stack:m,id:_,glyph:D});let S=Math.floor(_/256);if(256*S>65535)return void b(new Error("glyphs > 65535 not supported"));if(E.ranges[S])return void b(null,{stack:m,id:_,glyph:D});let k=E.requests[S];k||(k=E.requests[S]=[],rt.loadGlyphRange(m,S,this.url,this.requestManager,(R,z)=>{if(z){for(let q in z)this._doesCharSupportLocalGlyph(+q)||(E.glyphs[+q]=z[+q]);E.ranges[S]=!0}for(let q of k)q(R,z);delete E.requests[S]})),k.push((R,z)=>{R?b(R):z&&b(null,{stack:m,id:_,glyph:z[_]||null})})},(m,_)=>{if(m)u(m);else if(_){let b={};for(let{stack:E,id:D,glyph:S}of _)(b[E]||(b[E]={}))[D]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};u(null,b)}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](n)||o.unicodeBlockLookup["Hangul Syllables"](n)||o.unicodeBlockLookup.Hiragana(n)||o.unicodeBlockLookup.Katakana(n))}_tinySDF(n,u,d){let m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let _=n.tinySDF;if(!_){let E="400";/bold/i.test(u)?E="900":/medium/i.test(u)?E="500":/light/i.test(u)&&(E="200"),_=n.tinySDF=new rt.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:m,fontWeight:E})}let b=_.draw(String.fromCharCode(d));return{id:d,bitmap:new o.AlphaImage({width:b.width||30,height:b.height||30},b.data),metrics:{width:b.glyphWidth||24,height:b.glyphHeight||24,left:b.glyphLeft||0,top:b.glyphTop-27||-8,advance:b.glyphAdvance||24}}}}rt.loadGlyphRange=function(p,n,u,d,m){let _=256*n,b=_+255,E=d.transformRequest(u.replace("{fontstack}",p).replace("{range}",`${_}-${b}`),o.ResourceType.Glyphs);o.getArrayBuffer(E,(D,S)=>{if(D)m(D);else if(S){let k={};for(let R of o.parseGlyphPbf(S))k[R.id]=R;m(null,k)}})},rt.TinySDF=class{constructor({fontSize:p=24,buffer:n=3,radius:u=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:_="normal",fontStyle:b="normal"}={}){this.buffer=n,this.cutoff=d,this.radius=u;let E=this.size=p+4*n,D=this._createCanvas(E),S=this.ctx=D.getContext("2d",{willReadFrequently:!0});S.font=`${b} ${_} ${p}px ${m}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(p){let n=document.createElement("canvas");return n.width=n.height=p,n}draw(p){let{width:n,actualBoundingBoxAscent:u,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:_}=this.ctx.measureText(p),b=Math.ceil(u),E=Math.min(this.size-this.buffer,Math.ceil(_-m)),D=Math.min(this.size-this.buffer,b+Math.ceil(d)),S=E+2*this.buffer,k=D+2*this.buffer,R=Math.max(S*k,0),z=new Uint8ClampedArray(R),q={data:z,width:S,height:k,glyphWidth:E,glyphHeight:D,glyphTop:b,glyphLeft:0,glyphAdvance:n};if(0===E||0===D)return q;let{ctx:H,buffer:Z,gridInner:ee,gridOuter:ie}=this;H.clearRect(Z,Z,E,D),H.fillText(p,Z,Z+b);let ae=H.getImageData(Z,Z,E,D);ie.fill(je,0,R),ee.fill(0,0,R);for(let W=0;W<D;W++)for(let he=0;he<E;he++){let ce=ae.data[4*(W*E+he)+3]/255;if(0===ce)continue;let ge=(W+Z)*S+he+Z;if(1===ce)ie[ge]=0,ee[ge]=je;else{let ye=.5-ce;ie[ge]=ye>0?ye*ye:0,ee[ge]=ye<0?ye*ye:0}}Ae(ie,0,0,S,k,S,this.f,this.v,this.z),Ae(ee,Z,Z,E,D,S,this.f,this.v,this.z);for(let W=0;W<R;W++){let he=Math.sqrt(ie[W])-Math.sqrt(ee[W]);z[W]=Math.round(255-255*(he/this.radius+this.cutoff))}return q}};let si,ot=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(p,n){return o.sphericalToCartesian(p.expression.evaluate(n))}interpolate(p,n,u){return{x:o.number(p.x,n.x,u),y:o.number(p.y,n.y,u),z:o.number(p.z,n.z,u)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)});class kt extends o.Evented{constructor(n){super(),this._transitionable=new o.Transitionable(ot),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,u={}){if(!this._validate(o.validateLight,n,u))for(let d in n){let m=n[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,d){return(!d||!1!==d.validate)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class nn{constructor(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,u){let d=n.join(",")+String(u);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(n,u)),this.dashEntry[d]}getDashRanges(n,u,d){let m=[],_=n.length%2==1?-n[n.length-1]*d:0,b=n[0]*d,E=!0;m.push({left:_,right:b,isDash:E,zeroLength:0===n[0]});let D=n[0];for(let S=1;S<n.length;S++){E=!E;let k=n[S];_=D*d,D+=k,b=D*d,m.push({left:_,right:b,isDash:E,zeroLength:0===k})}return m}addRoundDash(n,u,d){let m=u/2;for(let _=-d;_<=d;_++){let b=this.width*(this.nextRow+d+_),E=0,D=n[E];for(let S=0;S<this.width;S++){S/D.right>1&&(D=n[++E]);let q,k=Math.abs(S-D.left),R=Math.abs(S-D.right),z=Math.min(k,R),H=_/d*(m+1);if(D.isDash){let Z=m-Math.abs(H);q=Math.sqrt(z*z+Z*Z)}else q=m-Math.sqrt(z*z+H*H);this.data[b+S]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(n){for(let E=n.length-1;E>=0;--E){let D=n[E],S=n[E+1];D.zeroLength?n.splice(E,1):S&&S.isDash===D.isDash&&(S.left=D.left,n.splice(E,1))}let u=n[0],d=n[n.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);let m=this.width*this.nextRow,_=0,b=n[_];for(let E=0;E<this.width;E++){E/b.right>1&&(b=n[++_]);let D=Math.abs(E-b.left),S=Math.abs(E-b.right),k=Math.min(D,S);this.data[m+E]=Math.max(0,Math.min(255,(b.isDash?k:-k)+128))}}addDash(n,u){let d=u?7:0,m=2*d+1;if(this.nextRow+m>this.height)return o.warnOnce("LineAtlas out of space"),null;let _=0;for(let E=0;E<n.length;E++)_+=n[E];if(0!==_){let E=this.width/_,D=this.getDashRanges(n,this.width,E);u?this.addRoundDash(D,E,d):this.addRegularDash(D)}let b={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:_};return this.nextRow+=m,this.dirty=!0,b}bind(n){let u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}class Cn{constructor(n,u){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=o.uniqueId();let d=this.workerPool.acquire(this.id);for(let m=0;m<d.length;m++){let _=new Cn.Actor(d[m],u,this.id);_.name=`Worker ${m}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,u,d){o.asyncAll(this.actors,(m,_)=>{m.send(n,u,_)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function jn(p,n,u){let d=function(m,_){if(m)return u(m);if(_){let b=o.pick(o.extend(_,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(b.vectorLayers=_.vector_layers,b.vectorLayerIds=b.vectorLayers.map(E=>E.id)),u(null,b)}};return p.url?o.getJSON(n.transformRequest(p.url,o.ResourceType.Source),d):o.exported.frame(()=>d(null,p))}Cn.Actor=o.Actor;class Pn{constructor(n,u,d){this.bounds=o.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){let u=Math.pow(2,n.z),d=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*u),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*u),_=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*u),b=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*u);return n.x>=d&&n.x<_&&n.y>=m&&n.y<b}}class Lr extends o.Evented{constructor(n,u,d,m){if(super(),this.id=n,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(u,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=jn(this._options,this.map._requestManager,(n,u)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n?this.fire(new o.ErrorEvent(n)):u&&(o.extend(this,u),u.bounds&&(this.tileBounds=new Pn(u.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.cancel(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(n,u){let d=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,o.ResourceType.Tile),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function _(b,E){return delete n.request,n.aborted?u(null):b&&404!==b.status?u(b):(E&&E.resourceTiming&&(n.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&n.setExpiryData(E),n.loadVectorData(E,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,n.actor&&"expired"!==n.state?"loading"===n.state?n.reloadCallback=u:n.request=n.actor.send("reloadTile",m,_.bind(this)):(n.actor=this.dispatcher.getActor(),n.request=n.actor.send("loadTile",m,_.bind(this)))}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id},void 0)}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Mi extends o.Evented{constructor(n,u,d,m){super(),this.id=n,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},u),o.extend(this,o.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=jn(this._options,this.map._requestManager,(n,u)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):u&&(o.extend(this,u),u.bounds&&(this.tileBounds=new Pn(u.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,u){let d=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.request=o.getImage(this.map._requestManager.transformRequest(d,o.ResourceType.Tile),(m,_,b)=>{if(delete n.request,n.aborted)n.state="unloaded",u(null);else if(m)n.state="errored",u(m);else if(_){this.map._refreshExpiredTiles&&n.setExpiryData(b);let E=this.map.painter.context,D=E.gl;n.texture=this.map.painter.getTileTexture(_.width),n.texture?n.texture.update(_,{useMipmap:!0}):(n.texture=new le(E,_,D.RGBA,{useMipmap:!0}),n.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&D.texParameterf(D.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),n.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),u(null)}})}abortTile(n,u){n.request&&(n.request.cancel(),delete n.request),u()}unloadTile(n,u){n.texture&&this.map.painter.saveTileTexture(n.texture),u()}hasTransition(){return!1}}class st extends Mi{constructor(n,u,d,m){super(n,u,d,m),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(n,u){let d=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function m(_,b){_&&(n.state="errored",u(_)),b&&(n.dem=b,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded",u(null))}n.request=o.getImage(this.map._requestManager.transformRequest(d,o.ResourceType.Tile),function(_,b){if(delete n.request,n.aborted)n.state="unloaded",u(null);else if(_)n.state="errored",u(_);else if(b){this.map._refreshExpiredTiles&&n.setExpiryData(b),delete b.cacheControl,delete b.expires;let E=o.isImageBitmap(b)&&(null==si&&(si=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),si)?b:o.exported.getImageData(b,1),D={uid:n.uid,coord:n.tileID,source:this.id,rawImageData:E,encoding:this.encoding};n.actor&&"expired"!==n.state||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",D,m.bind(this)))}}.bind(this)),n.neighboringTiles=this._getNeighboringTiles(n.tileID)}_getNeighboringTiles(n){let u=n.canonical,d=Math.pow(2,u.z),m=(u.x-1+d)%d,_=0===u.x?n.wrap-1:n.wrap,b=(u.x+1+d)%d,E=u.x+1===d?n.wrap+1:n.wrap,D={};return D[new o.OverscaledTileID(n.overscaledZ,_,u.z,m,u.y).key]={backfilled:!1},D[new o.OverscaledTileID(n.overscaledZ,E,u.z,b,u.y).key]={backfilled:!1},u.y>0&&(D[new o.OverscaledTileID(n.overscaledZ,_,u.z,m,u.y-1).key]={backfilled:!1},D[new o.OverscaledTileID(n.overscaledZ,n.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},D[new o.OverscaledTileID(n.overscaledZ,E,u.z,b,u.y-1).key]={backfilled:!1}),u.y+1<d&&(D[new o.OverscaledTileID(n.overscaledZ,_,u.z,m,u.y+1).key]={backfilled:!1},D[new o.OverscaledTileID(n.overscaledZ,n.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},D[new o.OverscaledTileID(n.overscaledZ,E,u.z,b,u.y+1).key]={backfilled:!1}),D}unloadTile(n){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&n.actor.send("removeDEMTile",{uid:n.uid,source:this.id})}}class Zi extends o.Evented{constructor(n,u,d,m){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(m),this._data=u.data,this._options=o.extend({},u),this._collectResourceTiming=u.collectResourceTiming,void 0!==u.maxzoom&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;let _=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(void 0!==u.buffer?u.buffer:128)*_,tolerance:(void 0!==u.tolerance?u.tolerance:.375)*_,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:void 0!==u.clusterMaxZoom?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:o.EXTENT,radius:(u.clusterRadius||50)*_,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData("content"),this}getClusterExpansionZoom(n,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:n,source:this.id},u),this}getClusterChildren(n,u){return this.actor.send("geojson.getClusterChildren",{clusterId:n,source:this.id},u),this}getClusterLeaves(n,u,d,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:n,limit:u,offset:d},m),this}_updateWorkerData(n){let u=o.extend({},this.workerOptions),d=this._data;"string"==typeof d?(u.request=this.map._requestManager.transformRequest(o.exported.resolveURL(d),o.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(d),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,u,(m,_)=>{if(this._pendingLoads--,this._removed||_&&_.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source",sourceDataType:n}));let b=null;if(_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b=_.resourceTiming[this.id].slice(0)),m)return void this.fire(new o.ErrorEvent(m));let E={dataType:"source",sourceDataType:n};this._collectResourceTiming&&b&&b.length>0&&o.extend(E,{resourceTiming:b}),this.fire(new o.Event("data",E))})}loaded(){return 0===this._pendingLoads}loadTile(n,u){let d=n.actor?"reloadTile":"loadTile";n.actor=this.actor;let m={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};n.request=this.actor.send(d,m,(_,b)=>(delete n.request,n.unloadVectorData(),n.aborted?u(null):_?u(_):(n.loadVectorData(b,this.map.painter,"reloadTile"===d),u(null))))}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.aborted=!0}unloadTile(n){n.unloadVectorData(),this.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ge=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Xe extends o.Evented{constructor(n,u,d,m){super(),this.id=n,this.dispatcher=d,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=u}load(n,u){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(d,m)=>{this._loaded=!0,d?this.fire(new o.ErrorEvent(d)):m&&(this.image=m,n&&(this.coordinates=n),u&&u(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n;let u=n.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(m){let _=1/0,b=1/0,E=-1/0,D=-1/0;for(let z of m)_=Math.min(_,z.x),b=Math.min(b,z.y),E=Math.max(E,z.x),D=Math.max(D,z.y);let S=Math.max(E-_,D-b),k=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),R=Math.pow(2,k);return new o.CanonicalTileID(k,Math.floor((_+E)/2*R),Math.floor((b+D)/2*R))}(u),this.minzoom=this.maxzoom=this.tileID.z;let d=u.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(d[2].x,d[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;let n=this.map.painter.context,u=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Ge.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new le(n,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(let d in this.tiles){let m=this.tiles[d];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}loadTile(n,u){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},u(null)):(n.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Je extends Xe{constructor(n,u,d,m){super(n,u,d,m),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;let n=this.options;this.urls=[];for(let u of n.urls)this.urls.push(this.map._requestManager.transformRequest(u,o.ResourceType.Source).url);o.getVideo(this.urls,(u,d)=>{this._loaded=!0,u?this.fire(new o.ErrorEvent(u)):d&&(this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){let u=this.video.seekable;n<u.start(0)||n>u.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;let n=this.map.painter.context,u=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Ge.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new le(n,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(let d in this.tiles){let m=this.tiles[d];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Et extends Xe{constructor(n,u,d,m){super(n,u,d,m),u.coordinates?Array.isArray(u.coordinates)&&4===u.coordinates.length&&!u.coordinates.some(_=>!Array.isArray(_)||2!==_.length||_.some(b=>"number"!=typeof b))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${n}`,null,'missing required property "coordinates"'))),u.animate&&"boolean"!=typeof u.animate&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),u.canvas?"string"==typeof u.canvas||u.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${n}`,null,'missing required property "canvas"'))),this.options=u,this.animate=void 0===u.animate||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;let u=this.map.painter.context,d=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Ge.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new le(u,this.canvas,d.RGBA,{premultiply:!0});for(let m in this.tiles){let _=this.tiles[m];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}let fn={vector:Lr,raster:Mi,"raster-dem":st,geojson:Zi,video:Je,image:Xe,canvas:Et};function ti(p,n){let u=o.create();return o.translate(u,u,[1,1,0]),o.scale(u,u,[.5*p.width,.5*p.height,1]),o.multiply(u,u,p.calculatePosMatrix(n.toUnwrapped()))}function On(p,n,u,d,m,_){let b=function(R,z,q){if(R)for(let H of R){let Z=z[H];if(Z&&Z.source===q&&"fill-extrusion"===Z.type)return!0}else for(let H in z){let Z=z[H];if(Z.source===q&&"fill-extrusion"===Z.type)return!0}return!1}(m&&m.layers,n,p.id),E=_.maxPitchScaleFactor(),D=p.tilesIn(d,E,b);D.sort(Un);let S=[];for(let R of D)S.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(n,u,p._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,m,_,E,ti(p.transform,R.tileID))});let k=function(R){let z={},q={};for(let H of R){let Z=H.queryResults,ee=H.wrappedTileID,ie=q[ee]=q[ee]||{};for(let ae in Z){let W=Z[ae],he=ie[ae]=ie[ae]||{},ce=z[ae]=z[ae]||[];for(let ge of W)he[ge.featureIndex]||(he[ge.featureIndex]=!0,ce.push(ge))}}return z}(S);for(let R in k)k[R].forEach(z=>{let q=z.feature,H=p.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=H});return k}function Un(p,n){let u=p.tileID,d=n.tileID;return u.overscaledZ-d.overscaledZ||u.canonical.y-d.canonical.y||u.wrap-d.wrap||u.canonical.x-d.canonical.x}class Ht{constructor(n,u){this.tileID=n,this.uid=o.uniqueId(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){let u=n+this.timeAdded;u<o.exported.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.textures.forEach(u=>n.saveTileTexture(u)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(n,u,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(m,_){let b={};if(!_)return b;for(let E of m){let D=E.layerIds.map(S=>_.getLayer(S)).filter(Boolean);if(0!==D.length){E.layers=D,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(S=>D.filter(k=>k.id===S)[0]));for(let S of D)b[S.id]=E}}return b}(n.buckets,u.style),this.hasSymbolBuckets=!1;for(let m in this.buckets){let _=this.buckets[m];if(_ instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!d)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let m in this.buckets){let _=this.buckets[m];if(_ instanceof o.SymbolBucket&&_.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(let m in this.buckets){let _=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(_))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(let d in this.buckets){let m=this.buckets[d];m.uploadPending()&&m.upload(n)}let u=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new le(n,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new le(n,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,u,d,m,_,b,E,D,S,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:b,tileSize:this.tileSize,pixelPosMatrix:k,transform:D,params:E,queryPadding:this.queryPadding*S},n,u,d):{}}querySourceFeatures(n,u){let d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;let m=d.loadVTLayers(),_=u?u.sourceLayer:"",b=m._geojsonTileLayer||m[_];if(!b)return;let E=o.createFilter(u&&u.filter),{z:D,x:S,y:k}=this.tileID.canonical,R={z:D,x:S,y:k};for(let z=0;z<b.length;z++){let q=b.feature(z);if(E.needGeometry){let ee=o.toEvaluationFeature(q,!0);if(!E.filter(new o.EvaluationParameters(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!E.filter(new o.EvaluationParameters(this.tileID.overscaledZ),q))continue;let H=d.getId(q,_),Z=new o.GeoJSONFeature(q,D,S,k,H);Z.tile=R,n.push(Z)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){let u=this.expirationTime;if(n.cacheControl){let d=o.parseCacheControl(n.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){let d=Date.now(),m=!1;if(this.expirationTime>d)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{let _=this.expirationTime-u;_?this.expirationTime=d+Math.max(_,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(n,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(n).length)return;let d=this.latestFeatureIndex.loadVTLayers();for(let m in this.buckets){if(!u.style.hasLayer(m))continue;let _=this.buckets[m],b=_.layers[0].sourceLayer||"_geojsonTileLayer",E=d[b],D=n[b];if(!E||!D||0===Object.keys(D).length)continue;_.update(D,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});let S=u&&u.style&&u.style.getLayer(m);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=o.exported.now()+n}setDependencies(n,u){let d={};for(let m of u)d[m]=!0;this.dependencies[n]=d}hasDependency(n,u){for(let d of n){let m=this.dependencies[d];if(m)for(let _ of u)if(m[_])return!0}return!1}}class er{constructor(n,u){this.max=n,this.onRemove=u,this.reset()}reset(){for(let n in this.data)for(let u of this.data[n])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(n,u,d){let m=n.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);let _={value:u,timeout:void 0};if(void 0!==d&&(_.timeout=setTimeout(()=>{this.remove(n,_)},d)),this.data[m].push(_),this.order.push(m),this.order.length>this.max){let b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){let u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[n].length&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value}getByKey(n){let u=this.data[n];return u?u[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,u){if(!this.has(n))return this;let d=n.wrapped().key,m=void 0===u?0:this.data[d].indexOf(u),_=this.data[d][m];return this.data[d].splice(m,1),_.timeout&&clearTimeout(_.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(_.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){let u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(n){let u=[];for(let d in this.data)for(let m of this.data[d])n(m.value)||u.push(m);for(let d of u)this.remove(d.value.tileID,d)}}class _r{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,u,d){let m=String(u);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][m]=this.stateChanges[n][m]||{},o.extend(this.stateChanges[n][m],d),null===this.deletedStates[n]){this.deletedStates[n]={};for(let _ in this.state[n])_!==m&&(this.deletedStates[n][_]=null)}else if(this.deletedStates[n]&&null===this.deletedStates[n][m]){this.deletedStates[n][m]={};for(let _ in this.state[n][m])d[_]||(this.deletedStates[n][m][_]=null)}else for(let _ in d)this.deletedStates[n]&&this.deletedStates[n][m]&&null===this.deletedStates[n][m][_]&&delete this.deletedStates[n][m][_]}removeFeatureState(n,u,d){if(null===this.deletedStates[n])return;let m=String(u);if(this.deletedStates[n]=this.deletedStates[n]||{},d&&void 0!==u)null!==this.deletedStates[n][m]&&(this.deletedStates[n][m]=this.deletedStates[n][m]||{},this.deletedStates[n][m][d]=null);else if(void 0!==u)if(this.stateChanges[n]&&this.stateChanges[n][m])for(d in this.deletedStates[n][m]={},this.stateChanges[n][m])this.deletedStates[n][m][d]=null;else this.deletedStates[n][m]=null;else this.deletedStates[n]=null}getState(n,u){let d=String(u),m=o.extend({},(this.state[n]||{})[d],(this.stateChanges[n]||{})[d]);if(null===this.deletedStates[n])return{};if(this.deletedStates[n]){let _=this.deletedStates[n][u];if(null===_)return{};for(let b in _)delete m[b]}return m}initializeTileState(n,u){n.setFeatureState(this.state,u)}coalesceChanges(n,u){let d={};for(let m in this.stateChanges){this.state[m]=this.state[m]||{};let _={};for(let b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),o.extend(this.state[m][b],this.stateChanges[m][b]),_[b]=this.state[m][b];d[m]=_}for(let m in this.deletedStates){this.state[m]=this.state[m]||{};let _={};if(null===this.deletedStates[m])for(let b in this.state[m])_[b]={},this.state[m][b]={};else for(let b in this.deletedStates[m]){if(null===this.deletedStates[m][b])this.state[m][b]={};else for(let E of Object.keys(this.deletedStates[m][b]))delete this.state[m][b][E];_[b]=this.state[m][b]}d[m]=d[m]||{},o.extend(d[m],_)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(let m in n)n[m].setFeatureState(d,u)}}class qt extends o.Evented{constructor(n,u,d){super(),this.id=n,this.dispatcher=d,this.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(m,_,b,E){let D=new fn[_.type](m,_,b,E);if(D.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${D.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],D),D}(n,u,d,this),this._tiles={},this._cache=new er(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _r}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let n in this._tiles){let u=this._tiles[n];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,u){return this._source.loadTile(n,u)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){this._source.abortTile&&this._source.abortTile(n,()=>{}),this._source.fire(new o.Event("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let u in this._tiles){let d=this._tiles[u];d.upload(n),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Ei).map(n=>n.key)}getRenderableIds(n){let u=[];for(let d in this._tiles)this._isIdRenderable(d,n)&&u.push(this._tiles[d]);return n?u.sort((d,m)=>{let _=d.tileID,b=m.tileID,E=new o.pointGeometry(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),D=new o.pointGeometry(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-b.overscaledZ||D.y-E.y||D.x-E.x}).map(d=>d.tileID.key):u.map(d=>d.tileID).sort(Ei).map(d=>d.key)}hasRenderableParent(n){let u=this.findLoadedParent(n,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(n,u){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(u||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let n in this._tiles)"errored"!==this._tiles[n].state&&this._reloadTile(n,"reloading")}}_reloadTile(n,u){let d=this._tiles[n];d&&("loading"!==d.state&&(d.state=u),this._loadTile(d,this._tileLoaded.bind(this,d,n,u)))}_tileLoaded(n,u,d,m){if(m)return n.state="errored",void(404!==m.status?this._source.fire(new o.ErrorEvent(m,{tile:n})):this.update(this.transform,this.terrain));n.timeAdded=o.exported.now(),"expired"===d&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(u,n),"raster-dem"===this.getSource().type&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){let u=this.getRenderableIds();for(let m=0;m<u.length;m++){let _=u[m];if(n.neighboringTiles&&n.neighboringTiles[_]){let b=this.getTileByID(_);d(n,b),d(b,n)}}function d(m,_){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let b=_.tileID.canonical.x-m.tileID.canonical.x,E=_.tileID.canonical.y-m.tileID.canonical.y,D=Math.pow(2,m.tileID.canonical.z),S=_.tileID.key;0===b&&0===E||Math.abs(E)>1||(Math.abs(b)>1&&(1===Math.abs(b+D)?b+=D:1===Math.abs(b-D)&&(b-=D)),_.dem&&m.dem&&(m.dem.backfillBorder(_.dem,b,E),m.neighboringTiles&&m.neighboringTiles[S]&&(m.neighboringTiles[S].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,u,d,m){for(let _ in this._tiles){let b=this._tiles[_];if(m[_]||!b.hasData()||b.tileID.overscaledZ<=u||b.tileID.overscaledZ>d)continue;let E=b.tileID;for(;b&&b.tileID.overscaledZ>u+1;){let S=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[S.key],b&&b.hasData()&&(E=S)}let D=E;for(;D.overscaledZ>u;)if(D=D.scaledTo(D.overscaledZ-1),n[D.key]){m[E.key]=E;break}}}findLoadedParent(n,u){if(n.key in this._loadedParentTiles){let d=this._loadedParentTiles[n.key];return d&&d.tileID.overscaledZ>=u?d:null}for(let d=n.overscaledZ-1;d>=u;d--){let m=n.scaledTo(d),_=this._getLoadedTile(m);if(_)return _}}_getLoadedTile(n){let u=this._tiles[n.key];return u&&u.hasData()?u:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){let u=Math.ceil(n.width/this._source.tileSize)+1,d=Math.ceil(n.height/this._source.tileSize)+1,m=Math.floor(u*d*5),_="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(n){let u=Math.round((n-(void 0===this._prevLng?n:this._prevLng))/360);if(this._prevLng=n,u){let d={};for(let m in this._tiles){let _=this._tiles[m];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+u),d[_.tileID.key]=_}this._tiles=d;for(let m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(let m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(n,u){if(this.transform=n,this.terrain=u,!this._sourceLoaded||this._paused)return;let d;this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new o.OverscaledTileID(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(d=n.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(d=d.filter(S=>this._source.hasTile(S)))):d=[];let m=n.coveringZoomLevel(this._source),_=Math.max(m-qt.maxOverzooming,this._source.minzoom),b=Math.max(m+qt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let S={};for(let k of d)if(k.canonical.z>this._source.minzoom){let R=k.scaledTo(k.canonical.z-1);S[R.key]=R;let z=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));S[z.key]=z}d=d.concat(Object.values(S))}let E=this._updateRetainedTiles(d,m);if(Zn(this._source.type)){let S={},k={},R=Object.keys(E);for(let z of R){let q=E[z],H=this._tiles[z];if(!H||H.fadeEndTime&&H.fadeEndTime<=o.exported.now())continue;let Z=this.findLoadedParent(q,_);Z&&(this._addTile(Z.tileID),S[Z.tileID.key]=Z.tileID),k[z]=q}this._retainLoadedChildren(k,m,b,E);for(let z in S)E[z]||(this._coveredTiles[z]=!0,E[z]=S[z]);if(u){let z={},q={};for(let H of d)this._tiles[H.key].hasData()?z[H.key]=H:q[H.key]=H;for(let H in q){let Z=q[H].children(this._source.maxzoom);this._tiles[Z[0].key]&&this._tiles[Z[1].key]&&this._tiles[Z[2].key]&&this._tiles[Z[3].key]&&(z[Z[0].key]=E[Z[0].key]=Z[0],z[Z[1].key]=E[Z[1].key]=Z[1],z[Z[2].key]=E[Z[2].key]=Z[2],z[Z[3].key]=E[Z[3].key]=Z[3],delete q[H])}for(let H in q){let Z=this.findLoadedParent(q[H],this._source.minzoom);if(Z){z[Z.tileID.key]=E[Z.tileID.key]=Z.tileID;for(let ee in z)z[ee].isChildOf(Z.tileID)&&delete z[ee]}}for(let H in this._tiles)z[H]||(this._coveredTiles[H]=!0)}}for(let S in E)this._tiles[S].clearFadeHold();let D=o.keysDifference(this._tiles,E);for(let S of D){let k=this._tiles[S];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(S)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,u){let d={},m={},_=Math.max(u-qt.maxOverzooming,this._source.minzoom),b=Math.max(u+qt.maxUnderzooming,this._source.minzoom),E={};for(let D of n){let S=this._addTile(D);d[D.key]=D,S.hasData()||u<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,u,b,d);for(let D of n){let S=this._tiles[D.key];if(S.hasData())continue;if(u+1>this._source.maxzoom){let R=D.children(this._source.maxzoom)[0],z=this.getTile(R);if(z&&z.hasData()){d[R.key]=R;continue}}else{let R=D.children(this._source.maxzoom);if(d[R[0].key]&&d[R[1].key]&&d[R[2].key]&&d[R[3].key])continue}let k=S.wasRequested();for(let R=D.overscaledZ-1;R>=_;--R){let z=D.scaledTo(R);if(m[z.key]||(m[z.key]=!0,S=this.getTile(z),!S&&k&&(S=this._addTile(z)),S&&(d[z.key]=z,k=S.wasRequested(),S.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let n in this._tiles){let d,u=[],m=this._tiles[n].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}u.push(m.key);let _=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(_),d)break;m=_}for(let _ of u)this._loadedParentTiles[_]=d}}_addTile(n){let u=this._tiles[n.key];if(u)return u;u=this._cache.getAndRemove(n),u&&(this._setTileReloadTimer(n.key,u),u.tileID=n,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,u)));let d=u;return u||(u=new Ht(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(u,this._tileLoaded.bind(this,u,n.key,u.state))),u.uses++,this._tiles[n.key]=u,d||this._source.fire(new o.Event("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(n,u){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);let d=u.getExpiryTimeout();d&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},d))}_removeTile(n){let u=this._tiles[n];u&&(u.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,u,d){let m=[],_=this.transform;if(!_)return m;let b=d?_.getCameraQueryGeometry(n):n,E=n.map(H=>_.pointCoordinate(H,this.terrain)),D=b.map(H=>_.pointCoordinate(H,this.terrain)),S=this.getIds(),k=1/0,R=1/0,z=-1/0,q=-1/0;for(let H of D)k=Math.min(k,H.x),R=Math.min(R,H.y),z=Math.max(z,H.x),q=Math.max(q,H.y);for(let H=0;H<S.length;H++){let Z=this._tiles[S[H]];if(Z.holdingForFade())continue;let ee=Z.tileID,ie=Math.pow(2,_.zoom-Z.tileID.overscaledZ),ae=u*Z.queryPadding*o.EXTENT/Z.tileSize/ie,W=[ee.getTilePoint(new o.MercatorCoordinate(k,R)),ee.getTilePoint(new o.MercatorCoordinate(z,q))];if(W[0].x-ae<o.EXTENT&&W[0].y-ae<o.EXTENT&&W[1].x+ae>=0&&W[1].y+ae>=0){let he=E.map(ge=>ee.getTilePoint(ge)),ce=D.map(ge=>ee.getTilePoint(ge));m.push({tile:Z,tileID:ee,queryGeometry:he,cameraQueryGeometry:ce,scale:ie})}}return m}getVisibleCoordinates(n){let u=this.getRenderableIds(n).map(d=>this._tiles[d].tileID);for(let d of u)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(Zn(this._source.type))for(let n in this._tiles){let u=this._tiles[n];if(void 0!==u.fadeEndTime&&u.fadeEndTime>=o.exported.now())return!0}return!1}setFeatureState(n,u,d){this._state.updateState(n=n||"_geojsonTileLayer",u,d)}removeFeatureState(n,u,d){this._state.removeFeatureState(n=n||"_geojsonTileLayer",u,d)}getFeatureState(n,u){return this._state.getState(n=n||"_geojsonTileLayer",u)}setDependencies(n,u,d){let m=this._tiles[n];m&&m.setDependencies(u,d)}reloadTilesForDependencies(n,u){for(let d in this._tiles)this._tiles[d].hasDependency(n,u)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(n,u))}}function Ei(p,n){let u=Math.abs(2*p.wrap)-+(p.wrap<0),d=Math.abs(2*n.wrap)-+(n.wrap<0);return p.overscaledZ-n.overscaledZ||d-u||n.canonical.y-p.canonical.y||n.canonical.x-p.canonical.x}function Zn(p){return"raster"===p||"image"===p||"video"===p}qt.maxOverzooming=10,qt.maxUnderzooming=3;let Ii="mapboxgl_preloaded_worker_pool";class ni{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<ni.workerCount;)this.workers.push(new Worker(qo.workerUrl));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ii]}numActive(){return Object.keys(this.active).length}}let ho,na=Math.floor(o.exported.hardwareConcurrency/2);function _s(){return ho||(ho=new ni),ho}function vs(p,n){let u={};for(let d in p)"ref"!==d&&(u[d]=p[d]);return o.refProperties.forEach(d=>{d in n&&(u[d]=n[d])}),u}function ia(p){p=p.slice();let n=Object.create(null);for(let u=0;u<p.length;u++)n[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=vs(p[u],n[p[u].ref]));return p}ni.workerCount=Math.max(Math.min(na,6),1);let Nt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function vr(p,n,u){u.push({command:Nt.addSource,args:[p,n[p]]})}function po(p,n,u){n.push({command:Nt.removeSource,args:[p]}),u[p]=!0}function fo(p,n,u,d){po(p,u,d),vr(p,n,u)}function ra(p,n,u){let d;for(d in p[u])if(Object.prototype.hasOwnProperty.call(p[u],d)&&"data"!==d&&!A(p[u][d],n[u][d]))return!1;for(d in n[u])if(Object.prototype.hasOwnProperty.call(n[u],d)&&"data"!==d&&!A(p[u][d],n[u][d]))return!1;return!0}function Or(p,n,u,d,m,_){let b;for(b in n=n||{},p=p||{})Object.prototype.hasOwnProperty.call(p,b)&&(A(p[b],n[b])||u.push({command:_,args:[d,b,n[b],m]}));for(b in n)Object.prototype.hasOwnProperty.call(n,b)&&!Object.prototype.hasOwnProperty.call(p,b)&&(A(p[b],n[b])||u.push({command:_,args:[d,b,n[b],m]}))}function Nr(p){return p.id}function xs(p,n){return p[n.id]=n,p}class Rr{constructor(n,u){this.reset(n,u)}reset(n,u){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=o.clamp(n,0,1);let u=1,d=this._distances[u],m=n*this.paddedLength+this.padding;for(;d<m&&u<this._distances.length;)d=this._distances[++u];let _=u-1,b=this._distances[_],E=d-b,D=E>0?(m-b)/E:0;return this.points[_].mult(1-D).add(this.points[u].mult(D))}}function _e(p,n){let u=!0;return"always"===p||"never"!==p&&"never"!==n||(u=!1),u}class Pe{constructor(n,u,d){let m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(u/d);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,u,d,m,_){this._forEachCell(u,d,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(n,u,d,m){this._forEachCell(u-m,d-m,u+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(d),this.circles.push(m)}_insertBoxCell(n,u,d,m,_,b){this.boxCells[_].push(b)}_insertCircleCell(n,u,d,m,_,b){this.circleCells[_].push(b)}_query(n,u,d,m,_,b,E){if(d<0||n>this.width||m<0||u>this.height)return[];let D=[];if(n<=0&&u<=0&&this.width<=d&&this.height<=m){if(_)return[{key:null,x1:n,y1:u,x2:d,y2:m}];for(let S=0;S<this.boxKeys.length;S++)D.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){let k=this.circles[3*S],R=this.circles[3*S+1],z=this.circles[3*S+2];D.push({key:this.circleKeys[S],x1:k-z,y1:R-z,x2:k+z,y2:R+z})}}else this._forEachCell(n,u,d,m,this._queryCell,D,{hitTest:_,overlapMode:b,seenUids:{box:{},circle:{}}},E);return D}query(n,u,d,m){return this._query(n,u,d,m,!1,null)}hitTest(n,u,d,m,_,b){return this._query(n,u,d,m,!0,_,b).length>0}hitTestCircle(n,u,d,m,_){let b=n-d,E=n+d,D=u-d,S=u+d;if(E<0||b>this.width||S<0||D>this.height)return!1;let k=[];return this._forEachCell(b,D,E,S,this._queryCellCircle,k,{hitTest:!0,overlapMode:m,circle:{x:n,y:u,radius:d},seenUids:{box:{},circle:{}}},_),k.length>0}_queryCell(n,u,d,m,_,b,E,D){let{seenUids:S,hitTest:k,overlapMode:R}=E,z=this.boxCells[_];if(null!==z){let H=this.bboxes;for(let Z of z)if(!S.box[Z]){S.box[Z]=!0;let ee=4*Z,ie=this.boxKeys[Z];if(n<=H[ee+2]&&u<=H[ee+3]&&d>=H[ee+0]&&m>=H[ee+1]&&(!D||D(ie))&&(!k||!_e(R,ie.overlapMode))&&(b.push({key:ie,x1:H[ee],y1:H[ee+1],x2:H[ee+2],y2:H[ee+3]}),k))return!0}}let q=this.circleCells[_];if(null!==q){let H=this.circles;for(let Z of q)if(!S.circle[Z]){S.circle[Z]=!0;let ee=3*Z,ie=this.circleKeys[Z];if(this._circleAndRectCollide(H[ee],H[ee+1],H[ee+2],n,u,d,m)&&(!D||D(ie))&&(!k||!_e(R,ie.overlapMode))){let ae=H[ee],W=H[ee+1],he=H[ee+2];if(b.push({key:ie,x1:ae-he,y1:W-he,x2:ae+he,y2:W+he}),k)return!0}}}return!1}_queryCellCircle(n,u,d,m,_,b,E,D){let{circle:S,seenUids:k,overlapMode:R}=E,z=this.boxCells[_];if(null!==z){let H=this.bboxes;for(let Z of z)if(!k.box[Z]){k.box[Z]=!0;let ee=4*Z,ie=this.boxKeys[Z];if(this._circleAndRectCollide(S.x,S.y,S.radius,H[ee+0],H[ee+1],H[ee+2],H[ee+3])&&(!D||D(ie))&&!_e(R,ie.overlapMode))return b.push(!0),!0}}let q=this.circleCells[_];if(null!==q){let H=this.circles;for(let Z of q)if(!k.circle[Z]){k.circle[Z]=!0;let ee=3*Z,ie=this.circleKeys[Z];if(this._circlesCollide(H[ee],H[ee+1],H[ee+2],S.x,S.y,S.radius)&&(!D||D(ie))&&!_e(R,ie.overlapMode))return b.push(!0),!0}}}_forEachCell(n,u,d,m,_,b,E,D){let S=this._convertToXCellCoord(n),k=this._convertToYCellCoord(u),R=this._convertToXCellCoord(d),z=this._convertToYCellCoord(m);for(let q=S;q<=R;q++)for(let H=k;H<=z;H++)if(_.call(this,n,u,d,m,this.xCellCount*H+q,b,E,D))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,u,d,m,_,b){let E=m-n,D=_-u,S=d+b;return S*S>E*E+D*D}_circleAndRectCollide(n,u,d,m,_,b,E){let D=(b-m)/2,S=Math.abs(n-(m+D));if(S>D+d)return!1;let k=(E-_)/2,R=Math.abs(u-(_+k));if(R>k+d)return!1;if(S<=D||R<=k)return!0;let z=S-D,q=R-k;return z*z+q*q<=d*d}}function Bo(p,n,u,d,m){let _=o.create();return n?(o.scale(_,_,[1/m,1/m,1]),u||o.rotateZ(_,_,d.angle)):o.multiply(_,d.labelPlaneMatrix,p),_}function tr(p,n,u,d,m){if(n){let _=o.clone(p);return o.scale(_,_,[m,m,1]),u||o.rotateZ(_,_,-d.angle),_}return d.glCoordMatrix}function Rt(p,n,u){let d;u?(d=[p.x,p.y,u(p.x,p.y),1],o.transformMat4(d,d,n)):(d=[p.x,p.y,0,1],Fr(d,d,n));let m=d[3];return{point:new o.pointGeometry(d[0]/m,d[1]/m),signedDistanceFromCamera:m}}function qi(p,n){return.5+p/n*.5}function Oi(p,n){let u=p[0]/p[3],d=p[1]/p[3];return u>=-n[0]&&u<=n[0]&&d>=-n[1]&&d<=n[1]}function Ni(p,n,u,d,m,_,b,E,D,S){let k=d?p.textSizeData:p.iconSizeData,R=o.evaluateSizeForZoom(k,u.transform.zoom),z=[256/u.width*2+1,256/u.height*2+1],q=d?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;q.clear();let H=p.lineVertexArray,Z=d?p.text.placedSymbolArray:p.icon.placedSymbolArray,ee=u.transform.width/u.transform.height,ie=!1;for(let ae=0;ae<Z.length;ae++){let he,W=Z.get(ae);if(W.hidden||W.writingMode===o.WritingMode.vertical&&!ie){ht(W.numGlyphs,q);continue}if(ie=!1,S?(he=[W.anchorX,W.anchorY,S(W.anchorX,W.anchorY),1],o.transformMat4(he,he,n)):(he=[W.anchorX,W.anchorY,0,1],Fr(he,he,n)),!Oi(he,z)){ht(W.numGlyphs,q);continue}let ce=qi(u.transform.cameraToCenterDistance,he[3]),ge=o.evaluateSizeForFeature(k,R,W),ye=b?ge/ce:ge*ce,Me=new o.pointGeometry(W.anchorX,W.anchorY),me=Rt(Me,m,S).point,ze={},Se=_t(W,ye,!1,E,n,m,_,p.glyphOffsetArray,H,q,me,Me,ze,ee,D,S);ie=Se.useVertical,(Se.notEnoughRoom||ie||Se.needsFlipping&&_t(W,ye,!0,E,n,m,_,p.glyphOffsetArray,H,q,me,Me,ze,ee,D,S).notEnoughRoom)&&ht(W.numGlyphs,q)}d?p.text.dynamicLayoutVertexBuffer.updateData(q):p.icon.dynamicLayoutVertexBuffer.updateData(q)}function mo(p,n,u,d,m,_,b,E,D,S,k,R,z){let q=E.glyphStartIndex+E.numGlyphs,H=E.lineStartIndex,Z=E.lineStartIndex+E.lineLength,ee=n.getoffsetX(E.glyphStartIndex),ie=n.getoffsetX(q-1),ae=ii(p*ee,u,d,m,_,b,E.segment,H,Z,D,S,k,R,z);if(!ae)return null;let W=ii(p*ie,u,d,m,_,b,E.segment,H,Z,D,S,k,R,z);return W?{first:ae,last:W}:null}function Ce(p,n,u,d){return p===o.WritingMode.horizontal&&Math.abs(u.y-n.y)>Math.abs(u.x-n.x)*d?{useVertical:!0}:(p===o.WritingMode.vertical?n.y<u.y:n.x>u.x)?{needsFlipping:!0}:null}function _t(p,n,u,d,m,_,b,E,D,S,k,R,z,q,H,Z){let W,ee=n/24,ie=p.lineOffsetX*ee,ae=p.lineOffsetY*ee;if(p.numGlyphs>1){let he=p.glyphStartIndex+p.numGlyphs,ce=p.lineStartIndex,ge=p.lineStartIndex+p.lineLength,ye=mo(ee,E,ie,ae,u,k,R,p,D,_,z,H,Z);if(!ye)return{notEnoughRoom:!0};let Me=Rt(ye.first.point,b,Z).point,me=Rt(ye.last.point,b,Z).point;if(d&&!u){let ze=Ce(p.writingMode,Me,me,q);if(ze)return ze}W=[ye.first];for(let ze=p.glyphStartIndex+1;ze<he-1;ze++)W.push(ii(ee*E.getoffsetX(ze),ie,ae,u,k,R,p.segment,ce,ge,D,_,z,H,Z));W.push(ye.last)}else{if(d&&!u){let ce=Rt(R,m,Z).point,ge=p.lineStartIndex+p.segment+1,ye=new o.pointGeometry(D.getx(ge),D.gety(ge)),Me=Rt(ye,m,Z),me=Me.signedDistanceFromCamera>0?Me.point:mt(R,ye,ce,1,m,Z),ze=Ce(p.writingMode,ce,me,q);if(ze)return ze}let he=ii(ee*E.getoffsetX(p.glyphStartIndex),ie,ae,u,k,R,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,D,_,z,H,Z);if(!he)return{notEnoughRoom:!0};W=[he]}for(let he of W)o.addDynamicAttributes(S,he.point,he.angle);return{}}function mt(p,n,u,d,m,_){let b=Rt(p.add(p.sub(n)._unit()),m,_).point,E=u.sub(b);return u.add(E._mult(d/E.mag()))}function ii(p,n,u,d,m,_,b,E,D,S,k,R,z,q){let H=d?p-n:p+n,Z=H>0?1:-1,ee=0;d&&(Z*=-1,ee=Math.PI),Z<0&&(ee+=Math.PI);let ie=Z>0?E+b:E+b+1,ae=m,W=m,he=0,ce=0,ge=Math.abs(H),ye=[];for(;he+ce<=ge;){if(ie+=Z,ie<E||ie>=D)return null;if(W=ae,ye.push(ae),ae=R[ie],void 0===ae){let Ue=new o.pointGeometry(S.getx(ie),S.gety(ie)),gt=Rt(Ue,k,q);if(gt.signedDistanceFromCamera>0)ae=R[ie]=gt.point;else{let xt=ie-Z;ae=mt(0===he?_:new o.pointGeometry(S.getx(xt),S.gety(xt)),Ue,W,ge-he+1,k,q)}}he+=ce,ce=W.dist(ae)}let Me=(ge-he)/ce,me=ae.sub(W),ze=me.mult(Me)._add(W);ze._add(me._unit()._perp()._mult(u*Z));let Se=ee+Math.atan2(ae.y-W.y,ae.x-W.x);return ye.push(ze),{point:ze,angle:z?Se:0,path:ye}}let go=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ht(p,n){for(let u=0;u<p;u++){let d=n.length;n.resize(d+4),n.float32.set(go,3*d)}}function Fr(p,n,u){let d=n[0],m=n[1];return p[0]=u[0]*d+u[4]*m+u[12],p[1]=u[1]*d+u[5]*m+u[13],p[3]=u[3]*d+u[7]*m+u[15],p}let qn=100;class bs{constructor(n,u=new Pe(n.width+200,n.height+200,25),d=new Pe(n.width+200,n.height+200,25)){this.transform=n,this.grid=u,this.ignoredGrid=d,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+qn,this.screenBottomBoundary=n.height+qn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,u,d,m,_,b){let E=this.projectAndGetPerspectiveRatio(m,n.anchorPointX,n.anchorPointY,b),D=d*E.perspectiveRatio,S=n.x1*D+E.point.x,k=n.y1*D+E.point.y,R=n.x2*D+E.point.x,z=n.y2*D+E.point.y;return!this.isInsideGrid(S,k,R,z)||"always"!==u&&this.grid.hitTest(S,k,R,z,u,_)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[S,k,R,z],offscreen:this.isOffscreen(S,k,R,z)}}placeCollisionCircles(n,u,d,m,_,b,E,D,S,k,R,z,q,H){let Z=[],ee=new o.pointGeometry(u.anchorX,u.anchorY),ie=Rt(ee,b,H),ae=qi(this.transform.cameraToCenterDistance,ie.signedDistanceFromCamera),W=(k?_/ae:_*ae)/o.ONE_EM,he=Rt(ee,E,H).point,ce=mo(W,m,u.lineOffsetX*W,u.lineOffsetY*W,!1,he,ee,u,d,E,{},!1,H),ge=!1,ye=!1,Me=!0;if(ce){let me=.5*z*ae+q,ze=new o.pointGeometry(-100,-100),Se=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ue=new Rr,gt=ce.first,xt=ce.last,et=[];for(let Lt=gt.path.length-1;Lt>=1;Lt--)et.push(gt.path[Lt]);for(let Lt=1;Lt<xt.path.length;Lt++)et.push(xt.path[Lt]);let Wt=2.5*me;if(D){let Lt=et.map(Bt=>Rt(Bt,D,H));et=Lt.some(Bt=>Bt.signedDistanceFromCamera<=0)?[]:Lt.map(Bt=>Bt.point)}let Yt=[];if(et.length>0){let Lt=et[0].clone(),Bt=et[0].clone();for(let Qt=1;Qt<et.length;Qt++)Lt.x=Math.min(Lt.x,et[Qt].x),Lt.y=Math.min(Lt.y,et[Qt].y),Bt.x=Math.max(Bt.x,et[Qt].x),Bt.y=Math.max(Bt.y,et[Qt].y);Yt=Lt.x>=ze.x&&Bt.x<=Se.x&&Lt.y>=ze.y&&Bt.y<=Se.y?[et]:Bt.x<ze.x||Lt.x>Se.x||Bt.y<ze.y||Lt.y>Se.y?[]:o.clipLine([et],ze.x,ze.y,Se.x,Se.y)}for(let Lt of Yt){Ue.reset(Lt,.25*me);let Bt=0;Bt=Ue.length<=.5*me?1:Math.ceil(Ue.paddedLength/Wt)+1;for(let Qt=0;Qt<Bt;Qt++){let Yn=Qt/Math.max(Bt-1,1),Mr=Ue.lerp(Yn),ir=Mr.x+qn,Er=Mr.y+qn;Z.push(ir,Er,me,0);let Mo=ir-me,Yi=Er-me,Ci=ir+me,jr=Er+me;if(Me=Me&&this.isOffscreen(Mo,Yi,Ci,jr),ye=ye||this.isInsideGrid(Mo,Yi,Ci,jr),"always"!==n&&this.grid.hitTestCircle(ir,Er,me,n,R)&&(ge=!0,!S))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!S&&ge||!ye||ae<this.perspectiveRatioCutoff?[]:Z,offscreen:Me,collisionDetected:ge}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};let u=[],d=1/0,m=1/0,_=-1/0,b=-1/0;for(let k of n){let R=new o.pointGeometry(k.x+qn,k.y+qn);d=Math.min(d,R.x),m=Math.min(m,R.y),_=Math.max(_,R.x),b=Math.max(b,R.y),u.push(R)}let E=this.grid.query(d,m,_,b).concat(this.ignoredGrid.query(d,m,_,b)),D={},S={};for(let k of E){let R=k.key;if(void 0===D[R.bucketInstanceId]&&(D[R.bucketInstanceId]={}),D[R.bucketInstanceId][R.featureIndex])continue;let z=[new o.pointGeometry(k.x1,k.y1),new o.pointGeometry(k.x2,k.y1),new o.pointGeometry(k.x2,k.y2),new o.pointGeometry(k.x1,k.y2)];o.polygonIntersectsPolygon(u,z)&&(D[R.bucketInstanceId][R.featureIndex]=!0,void 0===S[R.bucketInstanceId]&&(S[R.bucketInstanceId]=[]),S[R.bucketInstanceId].push(R.featureIndex))}return S}insertCollisionBox(n,u,d,m,_,b){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:_,collisionGroupID:b,overlapMode:u},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,u,d,m,_,b){let E=d?this.ignoredGrid:this.grid,D={bucketInstanceId:m,featureIndex:_,collisionGroupID:b,overlapMode:u};for(let S=0;S<n.length;S+=4)E.insertCircle(D,n[S],n[S+1],n[S+2])}projectAndGetPerspectiveRatio(n,u,d,m){let _;return m?(_=[u,d,m(u,d),1],o.transformMat4(_,_,n)):(_=[u,d,0,1],Fr(_,_,n)),{point:new o.pointGeometry((_[0]/_[3]+1)/2*this.transform.width+qn,(-_[1]/_[3]+1)/2*this.transform.height+qn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(n,u,d,m){return d<qn||n>=this.screenRightBoundary||m<qn||u>this.screenBottomBoundary}isInsideGrid(n,u,d,m){return d>=0&&n<this.gridRightBoundary&&m>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let n=o.identity([]);return o.translate(n,n,[-100,-100,0]),n}}function Nn(p,n,u){return n*(o.EXTENT/(p.tileSize*Math.pow(2,u-p.tileID.overscaledZ)))}class yi{constructor(n,u,d,m){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):m&&d?1:0,this.placed=d}isHidden(){return 0===this.opacity&&!this.placed}}class Kt{constructor(n,u,d,m,_){this.text=new yi(n?n.text:null,u,d,_),this.icon=new yi(n?n.icon:null,u,m,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ws{constructor(n,u,d){this.text=n,this.icon=u,this.skipFade=d}}class xr{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class jo{constructor(n,u,d,m,_){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=_}}class Uo{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){let u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:d=>d.collisionGroupID===u}}return this.collisionGroups[n]}}function Ms(p,n,u,d,m){let{horizontalAlign:_,verticalAlign:b}=o.getAnchorAlignment(p),E=-(_-.5)*n,D=-(b-.5)*u,S=o.evaluateVariableOffset(p,d);return new o.pointGeometry(E+S[0]*m,D+S[1]*m)}function Vo(p,n,u,d,m,_){let{x1:b,x2:E,y1:D,y2:S,anchorPointX:k,anchorPointY:R}=p,z=new o.pointGeometry(n,u);return d&&z._rotate(m?_:-_),{x1:b+z.x,y1:D+z.y,x2:E+z.x,y2:S+z.y,anchorPointX:k,anchorPointY:R}}class ${constructor(n,u,d,m,_){this.transform=n.clone(),this.terrain=u,this.collisionIndex=new bs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Uo(m),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,u,d,m){let _=d.getBucket(u),b=d.latestFeatureIndex;if(!_||!b||u.id!==_.layerIds[0])return;let E=d.collisionBoxArray,D=_.layers[0].layout,S=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),k=d.tileSize/o.EXTENT,R=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),z="map"===D.get("text-pitch-alignment"),q="map"===D.get("text-rotation-alignment"),H=Nn(d,1,this.transform.zoom),Z=Bo(R,z,q,this.transform,H),ee=null;if(z){let ae=tr(R,z,q,this.transform,H);ee=o.multiply([],this.transform.labelPlaneMatrix,ae)}this.retainedQueryData[_.bucketInstanceId]=new jo(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,d.tileID);let ie={bucket:_,layout:D,posMatrix:R,textLabelPlaneMatrix:Z,labelToScreenMatrix:ee,scale:S,textPixelRatio:k,holdingForFade:d.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(let ae of _.sortKeyRanges){let{sortKey:W,symbolInstanceStart:he,symbolInstanceEnd:ce}=ae;n.push({sortKey:W,symbolInstanceStart:he,symbolInstanceEnd:ce,parameters:ie})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(n,u,d,m,_,b,E,D,S,k,R,z,q,H,Z,ee){let ie=[z.textOffset0,z.textOffset1],ae=Ms(n,d,m,ie,_),W=this.collisionIndex.placeCollisionBox(Vo(u,ae.x,ae.y,b,E,this.transform.angle),R,D,S,k.predicate,ee);if((!Z||0!==this.collisionIndex.placeCollisionBox(Vo(Z,ae.x,ae.y,b,E,this.transform.angle),R,D,S,k.predicate,ee).box.length)&&W.box.length>0){let he;if(this.prevPlacement&&this.prevPlacement.variableOffsets[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID].text&&(he=this.prevPlacement.variableOffsets[z.crossTileID].anchor),0===z.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[z.crossTileID]={textOffset:ie,width:d,height:m,anchor:n,textBoxScale:_,prevAnchor:he},this.markUsedJustification(q,n,z,H),q.allowVerticalPlacement&&(this.markUsedOrientation(q,H,z),this.placedOrientations[z.crossTileID]=H),{shift:ae,placedGlyphBoxes:W}}}placeLayerBucketPart(n,u,d){let{bucket:m,layout:_,posMatrix:b,textLabelPlaneMatrix:E,labelToScreenMatrix:D,textPixelRatio:S,holdingForFade:k,collisionBoxArray:R,partiallyEvaluatedTextSize:z,collisionGroup:q}=n.parameters,H=_.get("text-optional"),Z=_.get("icon-optional"),ee=o.getOverlapMode(_,"text-overlap","text-allow-overlap"),ie="always"===ee,ae=o.getOverlapMode(_,"icon-overlap","icon-allow-overlap"),W="always"===ae,he="map"===_.get("text-rotation-alignment"),ce="map"===_.get("text-pitch-alignment"),ge="none"!==_.get("icon-text-fit"),ye="viewport-y"===_.get("symbol-z-order"),Me=ie&&(W||!m.hasIconData()||Z),me=W&&(ie||!m.hasTextData()||H);!m.collisionArrays&&R&&m.deserializeCollisionBoxes(R);let ze=(Se,Ue)=>{if(u[Se.crossTileID])return;if(k)return void(this.placements[Se.crossTileID]=new ws(!1,!1,!1));let gt=!1,xt=!1,et=!0,Wt=null,Yt={box:null,offscreen:null},Lt={box:null,offscreen:null},Bt=null,Qt=null,Yn=null,Mr=0,ir=0,Er=0;Ue.textFeatureIndex?Mr=Ue.textFeatureIndex:Se.useRuntimeCollisionCircles&&(Mr=Se.featureIndex),Ue.verticalTextFeatureIndex&&(ir=Ue.verticalTextFeatureIndex);let Mo=this.retainedQueryData[m.bucketInstanceId].tileID,Yi=this.terrain?(Vn,It)=>this.terrain.getElevation(Mo,Vn,It):null;for(let Vn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){let It=Ue[Vn];It&&(It.elevation=Yi?Yi(It.anchorPointX,It.anchorPointY):0)}let Ci=Ue.textBox;if(Ci){let Vn=Gt=>{let Kn=o.WritingMode.horizontal;if(m.allowVerticalPlacement&&!Gt&&this.prevPlacement){let Qn=this.prevPlacement.placedOrientations[Se.crossTileID];Qn&&(this.placedOrientations[Se.crossTileID]=Qn,Kn=Qn,this.markUsedOrientation(m,Kn,Se))}return Kn},It=(Gt,Kn)=>{if(m.allowVerticalPlacement&&Se.numVerticalGlyphVertices>0&&Ue.verticalTextBox){for(let Qn of m.writingModes)if(Qn===o.WritingMode.vertical?(Yt=Kn(),Lt=Yt):Yt=Gt(),Yt&&Yt.box&&Yt.box.length)break}else Yt=Gt()};if(_.get("text-variable-anchor")){let Gt=_.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Se.crossTileID]){let vn=this.prevPlacement.variableOffsets[Se.crossTileID];Gt.indexOf(vn.anchor)>0&&(Gt=Gt.filter(Ki=>Ki!==vn.anchor),Gt.unshift(vn.anchor))}let Kn=(vn,Ki,Wo)=>{let uu=vn.x2-vn.x1,Rs=vn.y2-vn.y1,od=Se.textBoxScale,hu=ge&&"never"===ae?Ki:null,Eo={box:[],offscreen:!1},Yo="never"!==ee?2*Gt.length:Gt.length;for(let Ko=0;Ko<Yo;++Ko){let Sl=this.attemptAnchorPlacement(Gt[Ko%Gt.length],vn,uu,Rs,od,he,ce,S,b,q,Ko>=Gt.length?ee:"never",Se,m,Wo,hu,Yi);if(Sl&&(Eo=Sl.placedGlyphBoxes,Eo&&Eo.box&&Eo.box.length)){gt=!0,Wt=Sl.shift;break}}return Eo};It(()=>Kn(Ci,Ue.iconBox,o.WritingMode.horizontal),()=>{let vn=Ue.verticalTextBox;return m.allowVerticalPlacement&&!(Yt&&Yt.box&&Yt.box.length)&&Se.numVerticalGlyphVertices>0&&vn?Kn(vn,Ue.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Yt&&(gt=Yt.box,et=Yt.offscreen);let Qn=Vn(Yt&&Yt.box);if(!gt&&this.prevPlacement){let vn=this.prevPlacement.variableOffsets[Se.crossTileID];vn&&(this.variableOffsets[Se.crossTileID]=vn,this.markUsedJustification(m,vn.anchor,Se,Qn))}}else{let Gt=(Kn,Qn)=>{let vn=this.collisionIndex.placeCollisionBox(Kn,ee,S,b,q.predicate,Yi);return vn&&vn.box&&vn.box.length&&(this.markUsedOrientation(m,Qn,Se),this.placedOrientations[Se.crossTileID]=Qn),vn};It(()=>Gt(Ci,o.WritingMode.horizontal),()=>{let Kn=Ue.verticalTextBox;return m.allowVerticalPlacement&&Se.numVerticalGlyphVertices>0&&Kn?Gt(Kn,o.WritingMode.vertical):{box:null,offscreen:null}}),Vn(Yt&&Yt.box&&Yt.box.length)}}if(Bt=Yt,gt=Bt&&Bt.box&&Bt.box.length>0,et=Bt&&Bt.offscreen,Se.useRuntimeCollisionCircles){let Vn=m.text.placedSymbolArray.get(Se.centerJustifiedTextSymbolIndex),It=o.evaluateSizeForFeature(m.textSizeData,z,Vn),Gt=_.get("text-padding");Qt=this.collisionIndex.placeCollisionCircles(ee,Vn,m.lineVertexArray,m.glyphOffsetArray,It,b,E,D,d,ce,q.predicate,Se.collisionCircleDiameter,Gt,Yi),Qt.circles.length&&Qt.collisionDetected&&!d&&o.warnOnce("Collisions detected, but collision boxes are not shown"),gt=ie||Qt.circles.length>0&&!Qt.collisionDetected,et=et&&Qt.offscreen}if(Ue.iconFeatureIndex&&(Er=Ue.iconFeatureIndex),Ue.iconBox){let Vn=It=>{let Gt=ge&&Wt?Vo(It,Wt.x,Wt.y,he,ce,this.transform.angle):It;return this.collisionIndex.placeCollisionBox(Gt,ae,S,b,q.predicate,Yi)};Lt&&Lt.box&&Lt.box.length&&Ue.verticalIconBox?(Yn=Vn(Ue.verticalIconBox),xt=Yn.box.length>0):(Yn=Vn(Ue.iconBox),xt=Yn.box.length>0),et=et&&Yn.offscreen}let jr=H||0===Se.numHorizontalGlyphVertices&&0===Se.numVerticalGlyphVertices,Cl=Z||0===Se.numIconVertices;if(jr||Cl?Cl?jr||(xt=xt&&gt):gt=xt&&gt:xt=gt=xt&&gt,gt&&Bt&&Bt.box&&this.collisionIndex.insertCollisionBox(Bt.box,ee,_.get("text-ignore-placement"),m.bucketInstanceId,Lt&&Lt.box&&ir?ir:Mr,q.ID),xt&&Yn&&this.collisionIndex.insertCollisionBox(Yn.box,ae,_.get("icon-ignore-placement"),m.bucketInstanceId,Er,q.ID),Qt&&(gt&&this.collisionIndex.insertCollisionCircles(Qt.circles,ee,_.get("text-ignore-placement"),m.bucketInstanceId,Mr,q.ID),d)){let Vn=m.bucketInstanceId,It=this.collisionCircleArrays[Vn];void 0===It&&(It=this.collisionCircleArrays[Vn]=new xr);for(let Gt=0;Gt<Qt.circles.length;Gt+=4)It.circles.push(Qt.circles[Gt+0]),It.circles.push(Qt.circles[Gt+1]),It.circles.push(Qt.circles[Gt+2]),It.circles.push(Qt.collisionDetected?1:0)}if(0===Se.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===m.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Se.crossTileID]=new ws(gt||Me,xt||me,et||m.justReloaded),u[Se.crossTileID]=!0};if(ye){if(0!==n.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");let Se=m.getSortedSymbolIndexes(this.transform.angle);for(let Ue=Se.length-1;Ue>=0;--Ue){let gt=Se[Ue];ze(m.symbolInstances.get(gt),m.collisionArrays[gt])}}else for(let Se=n.symbolInstanceStart;Se<n.symbolInstanceEnd;Se++)ze(m.symbolInstances.get(Se),m.collisionArrays[Se]);if(d&&m.bucketInstanceId in this.collisionCircleArrays){let Se=this.collisionCircleArrays[m.bucketInstanceId];o.invert(Se.invProjMatrix,b),Se.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(n,u,d,m){let _;_=m===o.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(u)];let b=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(let E of b)E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=_>=0&&E!==_?0:d.crossTileID)}markUsedOrientation(n,u,d){let m=u===o.WritingMode.horizontal||u===o.WritingMode.horizontalOnly?u:0,_=u===o.WritingMode.vertical?u:0,b=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(let E of b)n.text.placedSymbolArray.get(E).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,d=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let m=u?u.symbolFadeChange(n):1,_=u?u.opacities:{},b=u?u.variableOffsets:{},E=u?u.placedOrientations:{};for(let D in this.placements){let S=this.placements[D],k=_[D];k?(this.opacities[D]=new Kt(k,m,S.text,S.icon),d=d||S.text!==k.text.placed||S.icon!==k.icon.placed):(this.opacities[D]=new Kt(null,m,S.text,S.icon,S.skipFade),d=d||S.text||S.icon)}for(let D in _){let S=_[D];if(!this.opacities[D]){let k=new Kt(S,m,!1,!1);k.isHidden()||(this.opacities[D]=k,d=d||S.text.placed||S.icon.placed)}}for(let D in b)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=b[D]);for(let D in E)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=E[D]);if(u&&void 0===u.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)}updateLayerOpacities(n,u){let d={};for(let m of u){let _=m.getBucket(n);_&&m.latestFeatureIndex&&n.id===_.layerIds[0]&&this.updateBucketOpacities(_,d,m.collisionBoxArray)}}updateBucketOpacities(n,u,d){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();let m=n.layers[0].layout,_=new Kt(null,0,!1,!1,!0),b=m.get("text-allow-overlap"),E=m.get("icon-allow-overlap"),D=m.get("text-variable-anchor"),S="map"===m.get("text-rotation-alignment"),k="map"===m.get("text-pitch-alignment"),R="none"!==m.get("icon-text-fit"),z=new Kt(null,0,b&&(E||!n.hasIconData()||m.get("icon-optional")),E&&(b||!n.hasTextData()||m.get("text-optional")),!0);!n.collisionArrays&&d&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(d);let q=(H,Z,ee)=>{for(let ie=0;ie<Z/4;ie++)H.opacityVertexArray.emplaceBack(ee)};for(let H=0;H<n.symbolInstances.length;H++){let Z=n.symbolInstances.get(H),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:ie,crossTileID:ae}=Z,W=this.opacities[ae];u[ae]?W=_:W||(W=z,this.opacities[ae]=W),u[ae]=!0;let he=Z.numIconVertices>0,ce=this.placedOrientations[Z.crossTileID],ge=ce===o.WritingMode.vertical,ye=ce===o.WritingMode.horizontal||ce===o.WritingMode.horizontalOnly;if(ee>0||ie>0){let Me=ne(W.text);q(n.text,ee,ge?fe:Me),q(n.text,ie,ye?fe:Me);let me=W.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(Ue=>{Ue>=0&&(n.text.placedSymbolArray.get(Ue).hidden=me||ge?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=me||ye?1:0);let ze=this.variableOffsets[Z.crossTileID];ze&&this.markUsedJustification(n,ze.anchor,Z,ce);let Se=this.placedOrientations[Z.crossTileID];Se&&(this.markUsedJustification(n,"left",Z,Se),this.markUsedOrientation(n,Se,Z))}if(he){let Me=ne(W.icon),me=!(R&&Z.verticalPlacedIconSymbolIndex&&ge);Z.placedIconSymbolIndex>=0&&(q(n.icon,Z.numIconVertices,me?Me:fe),n.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=W.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(q(n.icon,Z.numVerticalIconVertices,me?fe:Me),n.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=W.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){let Me=n.collisionArrays[H];if(Me){let me=new o.pointGeometry(0,0);if(Me.textBox||Me.verticalTextBox){let Se=!0;if(D){let Ue=this.variableOffsets[ae];Ue?(me=Ms(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale),S&&me._rotate(k?this.transform.angle:-this.transform.angle)):Se=!1}Me.textBox&&T(n.textCollisionBox.collisionVertexArray,W.text.placed,!Se||ge,me.x,me.y),Me.verticalTextBox&&T(n.textCollisionBox.collisionVertexArray,W.text.placed,!Se||ye,me.x,me.y)}let ze=Boolean(!ye&&Me.verticalIconBox);Me.iconBox&&T(n.iconCollisionBox.collisionVertexArray,W.icon.placed,ze,R?me.x:0,R?me.y:0),Me.verticalIconBox&&T(n.iconCollisionBox.collisionVertexArray,W.icon.placed,!ze,R?me.x:0,R?me.y:0)}}}if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);if(n.bucketInstanceId in this.collisionCircleArrays){let H=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=H.invProjMatrix,n.placementViewportMatrix=H.viewportMatrix,n.collisionCircleArray=H.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,u){let d=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function T(p,n,u,d,m){p.emplaceBack(n?1:0,u?1:0,d||0,m||0),p.emplaceBack(n?1:0,u?1:0,d||0,m||0),p.emplaceBack(n?1:0,u?1:0,d||0,m||0),p.emplaceBack(n?1:0,u?1:0,d||0,m||0)}let N=Math.pow(2,25),U=Math.pow(2,24),V=Math.pow(2,17),Q=Math.pow(2,16),te=Math.pow(2,9),J=Math.pow(2,8),X=Math.pow(2,1);function ne(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;let n=p.placed?1:0,u=Math.floor(127*p.opacity);return u*N+n*U+u*V+n*Q+u*te+n*J+u*X+n}let fe=0;class we{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,u,d,m,_){let b=this._bucketParts;for(;this._currentTileIndex<n.length;)if(u.getBucketParts(b,m,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((E,D)=>E.sortKey-D.sortKey));this._currentPartIndex<b.length;)if(u.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,_())return!0;return!1}}class pe{constructor(n,u,d,m,_,b,E,D){this.placement=new $(n,u,b,E,D),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,u,d){let m=o.exported.now(),_=()=>{let b=o.exported.now()-m;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){let b=u[n[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if("symbol"===b.type&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new we(b)),this._inProgressLayer.continuePlacement(d[b.source],this.placement,this._showCollisionBoxes,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}let Ze=512/o.EXTENT/2;class We{constructor(n,u,d){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let m=0;m<u.length;m++){let _=u.get(m),b=_.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,n)})}}getScaledCoordinates(n,u){let d=Ze/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*o.EXTENT+n.anchorX)*d),y:Math.floor((u.canonical.y*o.EXTENT+n.anchorY)*d)}}findMatches(n,u,d){let m=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let _=0;_<n.length;_++){let b=n.get(_);if(b.crossTileID)continue;let E=this.indexedSymbolInstances[b.key];if(!E)continue;let D=this.getScaledCoordinates(b,u);for(let S of E)if(Math.abs(S.coord.x-D.x)<=m&&Math.abs(S.coord.y-D.y)<=m&&!d[S.crossTileID]){d[S.crossTileID]=!0,b.crossTileID=S.crossTileID;break}}}}class Fe{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){let u=Math.round((n-this.lng)/360);if(0!==u)for(let d in this.indexes){let m=this.indexes[d],_={};for(let b in m){let E=m[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+u),_[E.tileID.key]=E}this.indexes[d]=_}this.lng=n}addBucket(n,u,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let _=0;_<u.symbolInstances.length;_++)u.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});let m=this.usedCrossTileIDs[n.overscaledZ];for(let _ in this.indexes){let b=this.indexes[_];if(Number(_)>n.overscaledZ)for(let E in b){let D=b[E];D.tileID.isChildOf(n)&&D.findMatches(u.symbolInstances,n,m)}else{let E=b[n.scaledTo(Number(_)).key];E&&E.findMatches(u.symbolInstances,n,m)}}for(let _=0;_<u.symbolInstances.length;_++){let b=u.symbolInstances.get(_);b.crossTileID||(b.crossTileID=d.generate(),m[b.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new We(n,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(n,u){for(let d in u.indexedSymbolInstances)for(let m of u.indexedSymbolInstances[d])delete this.usedCrossTileIDs[n][m.crossTileID]}removeStaleBuckets(n){let u=!1;for(let d in this.indexes){let m=this.indexes[d];for(let _ in m)n[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[_]),delete m[_],u=!0)}return u}}class lt{constructor(){this.layerIndexes={},this.crossTileIDs=new Fe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,u,d){let m=this.layerIndexes[n.id];void 0===m&&(m=this.layerIndexes[n.id]=new nt);let _=!1,b={};m.handleWrapJump(d);for(let E of u){let D=E.getBucket(n);D&&n.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(E.tileID,D,this.crossTileIDs)&&(_=!0),b[D.bucketInstanceId]=!0)}return m.removeStaleBuckets(b)&&(_=!0),_}pruneUnusedLayers(n){let u={};n.forEach(d=>{u[d]=!0});for(let d in this.layerIndexes)u[d]||delete this.layerIndexes[d]}}var Ft=o.createLayout([{name:"a_pos",type:"Int16",components:2}]);class ut extends o.Evented{constructor(n){super(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=n._cache.max,n.usedForTerrain=!0,n.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(let n in this._tiles){let u=this._tiles[n];u.textures.forEach(d=>d.destroy()),u.textures=[]}}update(n,u){this.sourceCache.update(n,u),this._renderableTilesKeys=[];for(let d of n.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),o.ortho(d.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[d.key]=new Ht(d,this.tileSize))}removeOutdated(n){let u={};this.renderHistory=this.renderHistory.filter((d,m)=>this.renderHistory.indexOf(d)===m).slice(0,this.renderHistorySize);for(let d of this._renderableTilesKeys)u[d]=!0;for(let d of this.renderHistory)u[d]=!0;for(let d in this._tiles)u[d]||(this._tiles[d].clearTextures(n),delete this._tiles[d])}getRenderableTiles(){return this._renderableTilesKeys.map(n=>this.getTileByID(n))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n){let u={};for(let d of this._renderableTilesKeys){let m=this._tiles[d].tileID;if(m.canonical.equals(n.canonical)){let _=n.clone();_.posMatrix=new Float64Array(16),o.ortho(_.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),u[d]=_}else if(m.canonical.isChildOf(n.canonical)){let _=n.clone();_.posMatrix=new Float64Array(16);let b=m.canonical.z-n.canonical.z,E=m.canonical.x-(m.canonical.x>>b<<b),D=m.canonical.y-(m.canonical.y>>b<<b),S=o.EXTENT>>b;o.ortho(_.posMatrix,0,S,0,S,0,1),o.translate(_.posMatrix,_.posMatrix,[-E*S,-D*S,0]),u[d]=_}else if(n.canonical.isChildOf(m.canonical)){let _=n.clone();_.posMatrix=new Float64Array(16);let b=n.canonical.z-m.canonical.z,E=n.canonical.x-(n.canonical.x>>b<<b),D=n.canonical.y-(n.canonical.y>>b<<b),S=o.EXTENT>>b;o.ortho(_.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(_.posMatrix,_.posMatrix,[E*S,D*S,0]),o.scale(_.posMatrix,_.posMatrix,[1/2**b,1/2**b,0]),u[d]=_}}return u}getSourceTile(n,u){let d=this.sourceCache._source,m=n.overscaledZ-this.deltaZoom;if(m>d.maxzoom&&(m=d.maxzoom),m<d.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(m).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!_||!_.dem)&&u)for(;m>=d.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(n.scaledTo(m--).key);return _}tilesAfterTime(n=Date.now()){return Object.values(this._tiles).filter(u=>u.timeLoaded>=n)}}class vt{constructor(n,u,d){this.style=n,this.sourceCache=new ut(u),this.options=d,this.exaggeration="number"==typeof d.exaggeration?d.exaggeration:1,this.elevationOffset="number"==typeof d.elevationOffset?d.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(n,u,d,m=o.EXTENT){if(!(u>=0&&u<m&&d>=0&&d<m))return this.elevationOffset;let _=0,b=this.getTerrainData(n);if(b.tile&&b.tile.dem){let E=o.transformMat4$1([],[u/m*o.EXTENT,d/m*o.EXTENT],b.u_terrain_matrix),D=[E[0]*b.tile.dem.dim,E[1]*b.tile.dem.dim],S=[Math.floor(D[0]),Math.floor(D[1])],k=b.tile.dem.get(S[0],S[1]),R=b.tile.dem.get(S[0],S[1]+1),z=b.tile.dem.get(S[0]+1,S[1]),q=b.tile.dem.get(S[0]+1,S[1]+1);_=o.number(o.number(k,R,D[0]-S[0]),o.number(z,q,D[0]-S[0]),D[1]-S[1])}return _}rememberForRerender(n,u){for(let d in this.sourceCache._tiles){let m=this.sourceCache._tiles[d];(m.tileID.equals(u)||m.tileID.isChildOf(u))&&(n===this.sourceCache.sourceCache.id&&(m.timeLoaded=Date.now()),this._rerender[n]=this._rerender[n]||{},this._rerender[n][m.tileID.key]=!0)}}needsRerender(n,u){return this._rerender[n]&&this._rerender[n][u.key]}clearRerenderCache(){this._rerender={}}getElevation(n,u,d,m=o.EXTENT){return(this.getDEMElevation(n,u,d,m)+this.elevationOffset)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){let m=this.style.map.painter.context,_=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new le(m,_,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new le(m,new o.RGBAImage({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}let u=this.sourceCache.getSourceTile(n,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){let m=this.style.map.painter.context;u.demTexture=this.style.map.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new le(m,u.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),u.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}let d=u&&u+u.tileID.key+n.key;if(d&&!this._demMatrixCache[d]){let m=this.sourceCache.sourceCache._source.maxzoom,_=n.canonical.z-u.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=m?_=n.canonical.z-m:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let b=n.canonical.x-(n.canonical.x>>_<<_),E=n.canonical.y-(n.canonical.y>>_<<_),D=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<_),1/(o.EXTENT<<_),0]);o.translate(D,D,[b*o.EXTENT,E*o.EXTENT,0]),this._demMatrixCache[n.key]={matrix:D,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getRTTFramebuffer(){let n=this.style.map.painter;if(!this._rttFramebuffer){let u=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=n.context.createFramebuffer(u,u,!0),this._rttFramebuffer.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,u,u))}return this._rttFramebuffer}getFramebuffer(n){let u=this.style.map.painter,d=u.width/devicePixelRatio,m=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new le(u.context,{width:d,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new le(u.context,{width:d,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(d,m,!0),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,d,m))),this._fbo.colorAttachment.set("coords"===n?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let n=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;let u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,b=0;_<this._coordsTextureSize;_++)for(let E=0;E<this._coordsTextureSize;E++,b+=4)u[b+0]=255&E,u[b+1]=255&_,u[b+2]=E>>8<<4|_>>8,u[b+3]=0;let d=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),m=new le(n,d,n.gl.RGBA,{premultiply:!1});return m.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(n){let u=new Uint8Array(4),d=this.style.map.painter,m=d.context,_=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(n.x,d.height/devicePixelRatio-n.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,u),m.bindFramebuffer.set(null);let b=u[0]+(u[2]>>4<<8),E=u[1]+((15&u[2])<<8),D=this.coordsIndex[255-u[3]],S=D&&this.sourceCache.getTileByID(D);if(!S)return null;let k=this._coordsTextureSize,R=(1<<S.tileID.canonical.z)*k;return new o.MercatorCoordinate((S.tileID.canonical.x*k+b)/R,(S.tileID.canonical.y*k+E)/R,this.getElevation(S.tileID,b,E,k))}getTerrainMesh(){if(this._mesh)return this._mesh;let n=this.style.map.painter.context,u=new o.PosArray,d=new o.TriangleIndexArray,m=this.meshSize,_=o.EXTENT/m,b=m*m;for(let E=0;E<=m;E++)for(let D=0;D<=m;D++)u.emplaceBack(D*_,E*_);for(let E=0;E<b;E+=m+1)for(let D=0;D<m;D++)d.emplaceBack(D+E,m+D+E+1,m+D+E+2),d.emplaceBack(D+E,m+D+E+2,D+E+1);return this._mesh={indexBuffer:n.createIndexBuffer(d),vertexBuffer:n.createVertexBuffer(u,Ft.members),segments:o.SegmentVector.simpleSegment(0,0,u.length,d.length)},this._mesh}getMinMaxElevation(n){let u=this.getTerrainData(n).tile,d={minElevation:null,maxElevation:null};return u&&u.dem&&(d.minElevation=(u.dem.min+this.elevationOffset)*this.exaggeration,d.maxElevation=(u.dem.max+this.elevationOffset)*this.exaggeration),d}}let zt=(p,n)=>o.emitValidationErrors(p,n&&n.filter(u=>"source.canvas"!==u.identifier)),rn=o.pick(Nt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Wn=o.pick(Nt,["setCenter","setZoom","setBearing","setPitch"]),mn=function(){let p={},n=o.spec.$version;for(let u in o.spec.$root){let d=o.spec.$root[u];if(d.required){let m=null;m="version"===u?n:"array"===d.type?[]:{},null!=m&&(p[u]=m)}}return p}();class ai extends o.Evented{constructor(n,u={}){super(),this.map=n,this.dispatcher=new Cn(_s(),this),this.imageManager=new Ie,this.imageManager.setEventedParent(this),this.glyphManager=new rt(n._requestManager,u.localIdeographFontFamily),this.lineAtlas=new nn(256,512),this.crossTileSymbolIndex=new lt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());let d=this;this._rtlTextPluginCallback=ai.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,b)=>{if(o.triggerPluginCompletionEvent(_),b&&b.every(E=>E))for(let E in d.sourceCaches)d.sourceCaches[E].reload()})}),this.on("data",m=>{if("source"!==m.dataType||"metadata"!==m.sourceDataType)return;let _=this.sourceCaches[m.sourceId];if(!_)return;let b=_.getSource();if(b&&b.vectorLayerIds)for(let E in this._layers){let D=this._layers[E];D.source===b.id&&this._validateLayer(D)}})}loadURL(n,u={}){this.fire(new o.Event("dataloading",{dataType:"style"}));let d="boolean"!=typeof u.validate||u.validate,m=this.map._requestManager.transformRequest(n,o.ResourceType.Style);this._request=o.getJSON(m,(_,b)=>{this._request=null,_?this.fire(new o.ErrorEvent(_)):b&&this._load(b,d)})}loadJSON(n,u={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(n,!1!==u.validate)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(mn,!1)}_load(n,u){if(u&&zt(this,o.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n;for(let m in n.sources)this.addSource(m,n.sources[m],{validate:!1});n.sprite?this._loadSprite(n.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(n.glyphs);let d=ia(this.stylesheet.layers);this._order=d.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of d)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new kt(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}_loadSprite(n){this._spriteRequest=function(u,d,m,_){let b,E,D,S=m>1?"@2x":"",k=o.getJSON(d.transformRequest(d.normalizeSpriteURL(u,S,".json"),o.ResourceType.SpriteJSON),(q,H)=>{k=null,D||(D=q,b=H,z())}),R=o.getImage(d.transformRequest(d.normalizeSpriteURL(u,S,".png"),o.ResourceType.SpriteImage),(q,H)=>{R=null,D||(D=q,E=H,z())});function z(){if(D)_(D);else if(b&&E){let q=o.exported.getImageData(E),H={};for(let Z in b){let{width:ee,height:ie,x:ae,y:W,sdf:he,pixelRatio:ce,stretchX:ge,stretchY:ye,content:Me}=b[Z],me=new o.RGBAImage({width:ee,height:ie});o.RGBAImage.copy(q,me,{x:ae,y:W},{x:0,y:0},{width:ee,height:ie}),H[Z]={data:me,pixelRatio:ce,sdf:he,stretchX:ge,stretchY:ye,content:Me}}_(null,H)}}return{cancel(){k&&(k.cancel(),k=null),R&&(R.cancel(),R=null)}}}(n,this.map._requestManager,this.map.getPixelRatio(),(u,d)=>{if(this._spriteRequest=null,u)this.fire(new o.ErrorEvent(u));else if(d)for(let m in d)this.imageManager.addImage(m,d[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(n){let u=this.sourceCaches[n.source];if(!u)return;let d=n.sourceLayer;if(!d)return;let m=u.getSource();("geojson"===m.type||m.vectorLayerIds&&-1===m.vectorLayerIds.indexOf(d))&&this.fire(new o.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${m.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){let u=[];for(let d of n){let m=this._layers[d];"custom"!==m.type&&u.push(m.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let n in this.sourceCaches)if(this.sourceCaches[n].hasTransition())return!0;for(let n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;let u=this._changed;if(this._changed){let m=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(m.length||_.length)&&this._updateWorkerLayers(m,_);for(let b in this._updatedSources){let E=this._updatedSources[b];if("reload"===E)this._reloadSource(b);else{if("clear"!==E)throw new Error(`Invalid action ${E}`);this._clearSource(b)}}this._updateTilesForChangedImages();for(let b in this._updatedPaintProps)this._layers[b].updateTransitions(n);this.light.updateTransitions(n),this._resetUpdates()}let d={};for(let m in this.sourceCaches){let _=this.sourceCaches[m];d[m]=_.used,_.used=!1}for(let m of this._order){let _=this._layers[m];_.recalculate(n,this._availableImages),!_.isHidden(n.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(let m in d){let _=this.sourceCaches[m];d[m]!==_.used&&_.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(n),this.z=n.zoom,u&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let n=Object.keys(this._changedImages);if(n.length){for(let u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(n){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),n){let u=this.sourceCaches[n.source];if(!u)throw new Error(`cannot load terrain, because there exists no source with ID: ${n.source}`);this.terrain=new vt(this,u,n),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=d=>{d.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=d=>{d.tile&&(d.sourceId===n.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(d.sourceId,d.tile.tileID)):"geojson"===d.source.type&&this.terrain.rememberForRerender(d.sourceId,d.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new o.Event("terrain",{terrain:n}))}setState(n){if(this._checkLoaded(),zt(this,o.validateStyle(n)))return!1;(n=o.clone$1(n)).layers=ia(n.layers);let u=function(m,_){if(!m)return[{command:Nt.setStyle,args:[_]}];let b=[];try{if(!A(m.version,_.version))return[{command:Nt.setStyle,args:[_]}];A(m.center,_.center)||b.push({command:Nt.setCenter,args:[_.center]}),A(m.zoom,_.zoom)||b.push({command:Nt.setZoom,args:[_.zoom]}),A(m.bearing,_.bearing)||b.push({command:Nt.setBearing,args:[_.bearing]}),A(m.pitch,_.pitch)||b.push({command:Nt.setPitch,args:[_.pitch]}),A(m.sprite,_.sprite)||b.push({command:Nt.setSprite,args:[_.sprite]}),A(m.glyphs,_.glyphs)||b.push({command:Nt.setGlyphs,args:[_.glyphs]}),A(m.transition,_.transition)||b.push({command:Nt.setTransition,args:[_.transition]}),A(m.light,_.light)||b.push({command:Nt.setLight,args:[_.light]});let E={},D=[];!function(k,R,z,q){let H;for(H in R=R||{},k=k||{})Object.prototype.hasOwnProperty.call(k,H)&&(Object.prototype.hasOwnProperty.call(R,H)||po(H,z,q));for(H in R)Object.prototype.hasOwnProperty.call(R,H)&&(Object.prototype.hasOwnProperty.call(k,H)?A(k[H],R[H])||("geojson"===k[H].type&&"geojson"===R[H].type&&ra(k,R,H)?z.push({command:Nt.setGeoJSONSourceData,args:[H,R[H].data]}):fo(H,R,z,q)):vr(H,R,z))}(m.sources,_.sources,D,E);let S=[];m.layers&&m.layers.forEach(k=>{E[k.source]?b.push({command:Nt.removeLayer,args:[k.id]}):S.push(k)}),b=b.concat(D),function(k,R,z){R=R||[];let W,he,ce,ge,ye,Me,me,q=(k=k||[]).map(Nr),H=R.map(Nr),Z=k.reduce(xs,{}),ee=R.reduce(xs,{}),ie=q.slice(),ae=Object.create(null);for(W=0,he=0;W<q.length;W++)ce=q[W],Object.prototype.hasOwnProperty.call(ee,ce)?he++:(z.push({command:Nt.removeLayer,args:[ce]}),ie.splice(ie.indexOf(ce,he),1));for(W=0,he=0;W<H.length;W++)ce=H[H.length-1-W],ie[ie.length-1-W]!==ce&&(Object.prototype.hasOwnProperty.call(Z,ce)?(z.push({command:Nt.removeLayer,args:[ce]}),ie.splice(ie.lastIndexOf(ce,ie.length-he),1)):he++,Me=ie[ie.length-W],z.push({command:Nt.addLayer,args:[ee[ce],Me]}),ie.splice(ie.length-W,0,ce),ae[ce]=!0);for(W=0;W<H.length;W++)if(ce=H[W],ge=Z[ce],ye=ee[ce],!ae[ce]&&!A(ge,ye))if(A(ge.source,ye.source)&&A(ge["source-layer"],ye["source-layer"])&&A(ge.type,ye.type)){for(me in Or(ge.layout,ye.layout,z,ce,null,Nt.setLayoutProperty),Or(ge.paint,ye.paint,z,ce,null,Nt.setPaintProperty),A(ge.filter,ye.filter)||z.push({command:Nt.setFilter,args:[ce,ye.filter]}),A(ge.minzoom,ye.minzoom)&&A(ge.maxzoom,ye.maxzoom)||z.push({command:Nt.setLayerZoomRange,args:[ce,ye.minzoom,ye.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,me)&&"layout"!==me&&"paint"!==me&&"filter"!==me&&"metadata"!==me&&"minzoom"!==me&&"maxzoom"!==me&&(0===me.indexOf("paint.")?Or(ge[me],ye[me],z,ce,me.slice(6),Nt.setPaintProperty):A(ge[me],ye[me])||z.push({command:Nt.setLayerProperty,args:[ce,me,ye[me]]}));for(me in ye)Object.prototype.hasOwnProperty.call(ye,me)&&!Object.prototype.hasOwnProperty.call(ge,me)&&"layout"!==me&&"paint"!==me&&"filter"!==me&&"metadata"!==me&&"minzoom"!==me&&"maxzoom"!==me&&(0===me.indexOf("paint.")?Or(ge[me],ye[me],z,ce,me.slice(6),Nt.setPaintProperty):A(ge[me],ye[me])||z.push({command:Nt.setLayerProperty,args:[ce,me,ye[me]]}))}else z.push({command:Nt.removeLayer,args:[ce]}),Me=ie[ie.lastIndexOf(ce)+1],z.push({command:Nt.addLayer,args:[ye,Me]})}(S,_.layers,b)}catch(E){console.warn("Unable to compute style diff:",E),b=[{command:Nt.setStyle,args:[_]}]}return b}(this.serialize(),n).filter(m=>!(m.command in Wn));if(0===u.length)return!1;let d=u.filter(m=>!(m.command in rn));if(d.length>0)throw new Error(`Unimplemented: ${d.map(m=>m.command).join(", ")}.`);return u.forEach(m=>{"setTransition"!==m.command&&this[m.command].apply(this,m.args)}),this.stylesheet=n,!0}addImage(n,u){if(this.getImage(n))return this.fire(new o.ErrorEvent(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,u),this._afterImageUpdated(n)}updateImage(n,u){this.imageManager.updateImage(n,u)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new o.ErrorEvent(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,u,d={}){if(this._checkLoaded(),void 0!==this.sourceCaches[n])throw new Error(`Source "${n}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(o.validateStyle.source,`sources.${n}`,u,null,d))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let m=this.sourceCaches[n]=new qt(n,u,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:n})),m.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),void 0===this.sourceCaches[n])throw new Error("There is no source with this ID");for(let d in this._layers)if(this._layers[d].source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${d}" is using it.`)));let u=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],u.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,u){if(this._checkLoaded(),void 0===this.sourceCaches[n])throw new Error(`There is no source with this ID=${n}`);let d=this.sourceCaches[n].getSource();if("geojson"!==d.type)throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(u),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,u,d={}){this._checkLoaded();let _,m=n.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer "${m}" already exists on this map.`)));if("custom"===n.type){if(zt(this,o.validateCustomStyleLayer(n)))return;_=o.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(m,n.source),n=o.clone$1(n),n=o.extend(n,{source:m})),this._validate(o.validateStyle.layer,`layers.${m}`,n,{arrayIndex:-1},d))return;_=o.createStyleLayer(n),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[_.id]=_.serialize()}let b=u?this._order.indexOf(u):this._order.length;if(u&&-1===b)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${m}" before non-existing layer "${u}".`)));else{if(this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=_,this._removedLayers[m]&&_.source&&"custom"!==_.type){let E=this._removedLayers[m];delete this._removedLayers[m],E.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(n,u){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===u)return;let d=this._order.indexOf(n);this._order.splice(d,1);let m=u?this._order.indexOf(u):this._order.length;u&&-1===m?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${n}" before non-existing layer "${u}".`))):(this._order.splice(m,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();let u=this._layers[n];if(!u)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${n}".`)));u.setEventedParent(null);let d=this._order.indexOf(n);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=u,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],u.onRemove&&u.onRemove(this.map)}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,u,d){this._checkLoaded();let m=this.getLayer(n);m?m.minzoom===u&&m.maxzoom===d||(null!=u&&(m.minzoom=u),null!=d&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,u,d={}){this._checkLoaded();let m=this.getLayer(n);if(m){if(!A(m.filter,u))return null==u?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateStyle.filter,`layers.${m.id}.filter`,u,null,d)||(m.filter=o.clone$1(u),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return o.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,u,d,m={}){this._checkLoaded();let _=this.getLayer(n);_?A(_.getLayoutProperty(u),d)||(_.setLayoutProperty(u,d,m),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,u){let d=this.getLayer(n);if(d)return d.getLayoutProperty(u);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,u,d,m={}){this._checkLoaded();let _=this.getLayer(n);_?A(_.getPaintProperty(u),d)||(_.setPaintProperty(u,d,m)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,u){return this.getLayer(n).getPaintProperty(u)}setFeatureState(n,u){this._checkLoaded();let d=n.source,m=n.sourceLayer,_=this.sourceCaches[d];if(void 0===_)return void this.fire(new o.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));let b=_.getSource().type;"geojson"===b&&m?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==b||m?(void 0===n.id&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),_.setFeatureState(m,n.id,u)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,u){this._checkLoaded();let d=n.source,m=this.sourceCaches[d];if(void 0===m)return void this.fire(new o.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));let _=m.getSource().type,b="vector"===_?n.sourceLayer:void 0;"vector"!==_||b?u&&"string"!=typeof n.id&&"number"!=typeof n.id?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(b,n.id,u):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();let u=n.source,d=n.sourceLayer,m=this.sourceCaches[u];if(void 0!==m)return"vector"!==m.getSource().type||d?(void 0===n.id&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),m.getFeatureState(d,n.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,n=>n.serialize()),layers:this._serializeLayers(this._order)},n=>void 0!==n)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&"raster"!==this.sourceCaches[n.source].getSource().type&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(n){let u=b=>"fill-extrusion"===this._layers[b].type,d={},m=[];for(let b=this._order.length-1;b>=0;b--){let E=this._order[b];if(u(E)){d[E]=b;for(let D of n){let S=D[E];if(S)for(let k of S)m.push(k)}}}m.sort((b,E)=>E.intersectionZ-b.intersectionZ);let _=[];for(let b=this._order.length-1;b>=0;b--){let E=this._order[b];if(u(E))for(let D=m.length-1;D>=0;D--){let S=m[D].feature;if(d[S.layer.id]<b)break;_.push(S),m.pop()}else for(let D of n){let S=D[E];if(S)for(let k of S)_.push(k.feature)}}return _}queryRenderedFeatures(n,u,d){u&&u.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",u.filter,null,u);let m={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let b of u.layers){let E=this._layers[b];if(!E)return this.fire(new o.ErrorEvent(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];m[E.source]=!0}}let _=[];u.availableImages=this._availableImages;for(let b in this.sourceCaches)u.layers&&!m[b]||_.push(On(this.sourceCaches[b],this._layers,this._serializedLayers,n,u,d));return this.placement&&_.push(function(b,E,D,S,k,R,z){let q={},H=R.queryRenderedSymbols(S),Z=[];for(let ee of Object.keys(H).map(Number))Z.push(z[ee]);Z.sort(Un);for(let ee of Z){let ie=ee.featureIndex.lookupSymbolFeatures(H[ee.bucketInstanceId],E,ee.bucketIndex,ee.sourceLayerIndex,k.filter,k.layers,k.availableImages,b);for(let ae in ie){let W=q[ae]=q[ae]||[],he=ie[ae];he.sort((ce,ge)=>{let ye=ee.featureSortOrder;if(ye){let Me=ye.indexOf(ce.featureIndex);return ye.indexOf(ge.featureIndex)-Me}return ge.featureIndex-ce.featureIndex});for(let ce of he)W.push(ce)}}for(let ee in q)q[ee].forEach(ie=>{let ae=ie.feature,W=D[b[ee].source].getFeatureState(ae.layer["source-layer"],ae.id);ae.source=ae.layer.source,ae.layer["source-layer"]&&(ae.sourceLayer=ae.layer["source-layer"]),ae.state=W});return q}(this._layers,this._serializedLayers,this.sourceCaches,n,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(n,u){u&&u.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",u.filter,null,u);let d=this.sourceCaches[n];return d?function(m,_){let b=m.getRenderableIds().map(S=>m.getTileByID(S)),E=[],D={};for(let S=0;S<b.length;S++){let k=b[S],R=k.tileID.canonical.key;D[R]||(D[R]=!0,k.querySourceFeatures(E,_))}return E}(d,u):[]}addSourceType(n,u,d){return ai.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(ai.setSourceType(n,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:u.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(n,u={}){this._checkLoaded();let d=this.light.getLight(),m=!1;for(let b in n)if(!A(n[b],d[b])){m=!0;break}if(!m)return;let _={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,u),this.light.updateTransitions(_)}_validate(n,u,d,m,_={}){return(!_||!1!==_.validate)&&zt(this,n.call(o.validateStyle,o.extend({key:u,style:this.serialize(),value:d,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let n in this._layers)this._layers[n].setEventedParent(null);for(let n in this.sourceCaches){let u=this.sourceCaches[n];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(let u in this.sourceCaches)this.sourceCaches[u].update(n,this.terrain)}_generateCollisionBoxes(){for(let n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,u,d,m,_=!1){let b=!1,E=!1,D={};for(let S of this._order){let k=this._layers[S];if("symbol"!==k.type)continue;if(!D[k.source]){let z=this.sourceCaches[k.source];D[k.source]=z.getRenderableIds(!0).map(q=>z.getTileByID(q)).sort((q,H)=>H.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(H.tileID)?-1:1))}let R=this.crossTileSymbolIndex.addLayer(k,D[k.source],n.center.lng);b=b||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||0===d)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),n.zoom))&&(this.pauseablePlacement=new pe(n,this.terrain,this._order,_,u,d,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),E=!0),b&&this.pauseablePlacement.placement.setStale()),E||b)for(let S of this._order){let k=this._layers[S];"symbol"===k.type&&this.placement.updateLayerOpacities(k,D[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(let n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,u,d){this.imageManager.getImages(u.icons,d),this._updateTilesForChangedImages();let m=this.sourceCaches[u.source];m&&m.setDependencies(u.tileID.key,u.type,u.icons)}getGlyphs(n,u,d){this.glyphManager.getGlyphs(u.stacks,d)}getResource(n,u,d){return o.makeRequest(u,d)}}ai.getSourceType=function(p){return fn[p]},ai.setSourceType=function(p,n){fn[p]=n},ai.registerForPluginStateChange=o.registerForPluginStateChange;var Es="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";let oa={prelude:on("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:on("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:on("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:on("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:on("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:on("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:on("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:on("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:on("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:on("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:on("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:on("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:on("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:on("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:on("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:on("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:on("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:on("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:on("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:on("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:on("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:on("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:on("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:on("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:on("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:on("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:on("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Es),terrainDepth:on("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Es),terrainCoords:on("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Es)};function on(p,n){let u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=n.match(/attribute ([\w]+) ([\w]+)/g),m=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=_?_.concat(m):m,E={};return{fragmentSource:p=p.replace(u,(D,S,k,R,z)=>(E[z]=!0,"define"===S?`\n#ifndef HAS_UNIFORM_u_${z}\nvarying ${k} ${R} ${z};\n#else\nuniform ${k} ${R} u_${z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${z}\n    ${k} ${R} ${z} = u_${z};\n#endif\n`)),vertexSource:n=n.replace(u,(D,S,k,R,z)=>{let q="float"===R?"vec2":"vec4",H=z.match(/color/)?"color":q;return E[z]?"define"===S?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${k} ${q} a_${z};\nvarying ${k} ${R} ${z};\n#else\nuniform ${k} ${R} u_${z};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = a_${z};\n#else\n    ${k} ${R} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = unpack_mix_${H}(a_${z}, u_${z}_t);\n#else\n    ${k} ${R} ${z} = u_${z};\n#endif\n`:"define"===S?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${k} ${q} a_${z};\n#else\nuniform ${k} ${R} u_${z};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${k} ${R} ${z} = a_${z};\n#else\n    ${k} ${R} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${k} ${R} ${z} = unpack_mix_${H}(a_${z}, u_${z}_t);\n#else\n    ${k} ${R} ${z} = u_${z};\n#endif\n`}),staticAttributes:d,staticUniforms:b}}class kc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,u,d,m,_,b,E,D,S){this.context=n;let k=this.boundPaintVertexBuffers.length!==m.length;for(let R=0;!k&&R<m.length;R++)this.boundPaintVertexBuffers[R]!==m[R]&&(k=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===d&&!k&&this.boundIndexBuffer===_&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===D&&this.boundDynamicVertexBuffer3===S?(n.bindVertexArrayOES.set(this.vao),E&&E.bind(),_&&_.dynamicDraw&&_.bind(),D&&D.bind(),S&&S.bind()):this.freshBind(u,d,m,_,b,E,D,S)}freshBind(n,u,d,m,_,b,E,D){let S,k=n.numAttributes,R=this.context,z=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=D;else{S=R.currentNumAttributes||0;for(let q=k;q<S;q++)z.disableVertexAttribArray(q)}u.enableAttributes(z,n);for(let q of d)q.enableAttributes(z,n);b&&b.enableAttributes(z,n),E&&E.enableAttributes(z,n),D&&D.enableAttributes(z,n),u.bind(),u.setVertexAttribPointers(z,n,_);for(let q of d)q.bind(),q.setVertexAttribPointers(z,n,_);b&&(b.bind(),b.setVertexAttribPointers(z,n,_)),m&&m.bind(),E&&(E.bind(),E.setVertexAttribPointers(z,n,_)),D&&(D.bind(),D.setVertexAttribPointers(z,n,_)),R.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Lc(p){let n=[];for(let u=0;u<p.length;u++){if(null===p[u])continue;let d=p[u].split(" ");n.push(d.pop())}return n}class bh{constructor(n,u,d,m,_,b,E){let D=n.gl;this.program=D.createProgram();let S=Lc(d.staticAttributes),k=m?m.getBinderAttributes():[],R=S.concat(k),z=oa.prelude.staticUniforms?Lc(oa.prelude.staticUniforms):[],q=d.staticUniforms?Lc(d.staticUniforms):[],H=m?m.getBinderUniforms():[],Z=z.concat(q).concat(H),ee=[];for(let ye of Z)ee.indexOf(ye)<0&&ee.push(ye);let ie=m?m.defines():[];b&&ie.push("#define OVERDRAW_INSPECTOR;"),E&&ie.push("#define TERRAIN3D;");let ae=ie.concat(oa.prelude.fragmentSource,d.fragmentSource).join("\n"),W=ie.concat(oa.prelude.vertexSource,d.vertexSource).join("\n"),he=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(he,ae),D.compileShader(he),D.attachShader(this.program,he);let ce=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(ce,W),D.compileShader(ce),D.attachShader(this.program,ce),this.attributes={};let ge={};this.numAttributes=R.length;for(let ye=0;ye<this.numAttributes;ye++)R[ye]&&(D.bindAttribLocation(this.program,ye,R[ye]),this.attributes[R[ye]]=ye);D.linkProgram(this.program),D.deleteShader(ce),D.deleteShader(he);for(let ye=0;ye<ee.length;ye++){let Me=ee[ye];if(Me&&!ge[Me]){let me=D.getUniformLocation(this.program,Me);me&&(ge[Me]=me)}}var ye,Me;this.fixedUniforms=_(n,ge),this.terrainUniforms={u_depth:new o.Uniform1i(ye=n,(Me=ge).u_depth),u_terrain:new o.Uniform1i(ye,Me.u_terrain),u_terrain_dim:new o.Uniform1f(ye,Me.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(ye,Me.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(ye,Me.u_terrain_unpack),u_terrain_offset:new o.Uniform1f(ye,Me.u_terrain_offset),u_terrain_exaggeration:new o.Uniform1f(ye,Me.u_terrain_exaggeration)},this.binderUniforms=m?m.getUniforms(n,ge):[]}draw(n,u,d,m,_,b,E,D,S,k,R,z,q,H,Z,ee,ie,ae){let W=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(d),n.setStencilMode(m),n.setColorMode(_),n.setCullFace(b),D){n.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,D.depthTexture),n.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,D.texture);for(let ce in this.terrainUniforms)this.terrainUniforms[ce].set(D[ce])}for(let ce in this.fixedUniforms)this.fixedUniforms[ce].set(E[ce]);Z&&Z.setUniforms(n,this.binderUniforms,q,{zoom:H});let he=0;switch(u){case W.LINES:he=2;break;case W.TRIANGLES:he=3;break;case W.LINE_STRIP:he=1}for(let ce of z.get()){let ge=ce.vaos||(ce.vaos={});(ge[S]||(ge[S]=new kc)).bind(n,this,k,Z?Z.getPaintVertexBuffers():[],R,ce.vertexOffset,ee,ie,ae),W.drawElements(u,ce.primitiveLength*he,W.UNSIGNED_SHORT,ce.primitiveOffset*he*2)}}}function wh(p,n,u){let d=1/Nn(u,1,n.transform.tileZoom),m=Math.pow(2,u.tileID.overscaledZ),_=u.tileSize*Math.pow(2,n.transform.tileZoom)/m,b=_*(u.tileID.canonical.x+u.tileID.wrap*m),E=_*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[d,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}let Oc=(p,n,u,d)=>{let m=n.style.light,_=m.properties.get("position"),b=[_.x,_.y,_.z],E=o.create$1();"viewport"===m.properties.get("anchor")&&o.fromRotation(E,-n.transform.angle),o.transformMat3(b,b,E);let D=m.properties.get("color");return{u_matrix:p,u_lightpos:b,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+u,u_opacity:d}},rm=(p,n,u,d,m,_,b)=>o.extend(Oc(p,n,u,d),wh(_,n,b),{u_height_factor:-Math.pow(2,m.overscaledZ)/b.tileSize/8}),ll=p=>({u_matrix:p}),Nc=(p,n,u,d)=>o.extend(ll(p),wh(u,n,d)),Mh=(p,n)=>({u_matrix:p,u_world:n}),Eh=(p,n,u,d,m)=>o.extend(Nc(p,n,u,d),{u_world:m}),Ih=(p,n,u,d)=>{let _,b,m=p.transform;if("map"===d.paint.get("circle-pitch-alignment")){let E=Nn(u,1,m.zoom);_=!0,b=[E,E]}else _=!1,b=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+("map"===d.paint.get("circle-pitch-scale")),u_matrix:p.translatePosMatrix(n.posMatrix,u,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:b}},$o=(p,n,u)=>{let d=Nn(u,1,n.zoom),m=Math.pow(2,n.zoom-u.tileID.overscaledZ),_=u.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:n.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[n.pixelsToGLUnits[0]/(d*m),n.pixelsToGLUnits[1]/(d*m)],u_overscale_factor:_}},sa=(p,n,u=1)=>({u_matrix:p,u_color:n,u_overlay:0,u_overlay_scale:u}),Is=p=>({u_matrix:p}),cl=(p,n,u,d)=>({u_matrix:p,u_extrude_scale:Nn(n,1,u),u_intensity:d});function ul(p,n){let u=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new o.MercatorCoordinate(0,d/u).toLngLat().lat,new o.MercatorCoordinate(0,(d+1)/u).toLngLat().lat]}let Ds=(p,n,u,d)=>{let m=p.transform;return{u_matrix:la(p,n,u,d),u_ratio:1/Nn(n,1,m.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Rc=(p,n,u,d,m)=>o.extend(Ds(p,n,u,m),{u_image:0,u_image_height:d}),hl=(p,n,u,d,m)=>{let _=p.transform,b=gn(n,_);return{u_matrix:la(p,n,u,m),u_texsize:n.imageAtlasTexture.size,u_ratio:1/Nn(n,1,_.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[b,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},aa=(p,n,u,d,m,_)=>{let b=p.lineAtlas,E=gn(n,p.transform),D="round"===u.layout.get("line-cap"),S=b.getDash(d.from,D),k=b.getDash(d.to,D),R=S.width*m.fromScale,z=k.width*m.toScale;return o.extend(Ds(p,n,u,_),{u_patternscale_a:[E/R,-S.height/2],u_patternscale_b:[E/z,-k.height/2],u_sdfgamma:b.width/(256*Math.min(R,z)*p.pixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:k.y,u_mix:m.t})};function gn(p,n){return 1/Nn(p,1,n.tileZoom)}function la(p,n,u,d){return p.translatePosMatrix(d?d.posMatrix:n.tileID.posMatrix,n,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}let Dh=(p,n,u,d,m)=>{return{u_matrix:p,u_tl_parent:n,u_scale_parent:u,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(b=m.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(_=m.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Ch(m.paint.get("raster-hue-rotate"))};var _,b};function Ch(p){p*=Math.PI/180;let n=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*n-u+1)/3,(Math.sqrt(3)*n-u+1)/3]}let Fc=(p,n,u,d,m,_,b,E,D,S)=>{let k=m.transform;return{u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:k.cameraToCenterDistance,u_pitch:k.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:k.width/k.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+D,u_pitch_with_map:+d,u_texsize:S,u_texture:0}},dl=(p,n,u,d,m,_,b,E,D,S,k)=>{let R=m.transform;return o.extend(Fc(p,n,u,d,m,_,b,E,D,S),{u_gamma_scale:d?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+k})},Sh=(p,n,u,d,m,_,b,E,D,S)=>o.extend(dl(p,n,u,d,m,_,b,E,!0,D,!0),{u_texsize_icon:S,u_texture_icon:1}),om=(p,n,u)=>({u_matrix:p,u_opacity:n,u_color:u}),sm=(p,n,u,d,m,_)=>o.extend(function(b,E,D,S){let k=D.imageManager.getPattern(b.from.toString()),R=D.imageManager.getPattern(b.to.toString()),{width:z,height:q}=D.imageManager.getPixelSize(),H=Math.pow(2,S.tileID.overscaledZ),Z=S.tileSize*Math.pow(2,D.transform.tileZoom)/H,ee=Z*(S.tileID.canonical.x+S.tileID.wrap*H),ie=Z*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[z,q],u_mix:E.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Nn(S,1,D.transform.tileZoom),u_pixel_coord_upper:[ee>>16,ie>>16],u_pixel_coord_lower:[65535&ee,65535&ie]}}(d,_,u,m),{u_matrix:p,u_opacity:n}),zc={fillExtrusion:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_lightpos:new o.Uniform3f(p,n.u_lightpos),u_lightintensity:new o.Uniform1f(p,n.u_lightintensity),u_lightcolor:new o.Uniform3f(p,n.u_lightcolor),u_vertical_gradient:new o.Uniform1f(p,n.u_vertical_gradient),u_opacity:new o.Uniform1f(p,n.u_opacity)}),fillExtrusionPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_lightpos:new o.Uniform3f(p,n.u_lightpos),u_lightintensity:new o.Uniform1f(p,n.u_lightintensity),u_lightcolor:new o.Uniform3f(p,n.u_lightcolor),u_vertical_gradient:new o.Uniform1f(p,n.u_vertical_gradient),u_height_factor:new o.Uniform1f(p,n.u_height_factor),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade),u_opacity:new o.Uniform1f(p,n.u_opacity)}),fill:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),fillPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade)}),fillOutline:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_world:new o.Uniform2f(p,n.u_world)}),fillOutlinePattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_world:new o.Uniform2f(p,n.u_world),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade)}),circle:(p,n)=>({u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(p,n.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(p,n.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),collisionBox:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(p,n.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(p,n.u_extrude_scale),u_overscale_factor:new o.Uniform1f(p,n.u_overscale_factor)}),collisionCircle:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_inv_matrix:new o.UniformMatrix4f(p,n.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(p,n.u_viewport_size)}),debug:(p,n)=>({u_color:new o.UniformColor(p,n.u_color),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_overlay:new o.Uniform1i(p,n.u_overlay),u_overlay_scale:new o.Uniform1f(p,n.u_overlay_scale)}),clippingMask:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),heatmap:(p,n)=>({u_extrude_scale:new o.Uniform1f(p,n.u_extrude_scale),u_intensity:new o.Uniform1f(p,n.u_intensity),u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),heatmapTexture:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_world:new o.Uniform2f(p,n.u_world),u_image:new o.Uniform1i(p,n.u_image),u_color_ramp:new o.Uniform1i(p,n.u_color_ramp),u_opacity:new o.Uniform1f(p,n.u_opacity)}),hillshade:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_latrange:new o.Uniform2f(p,n.u_latrange),u_light:new o.Uniform2f(p,n.u_light),u_shadow:new o.UniformColor(p,n.u_shadow),u_highlight:new o.UniformColor(p,n.u_highlight),u_accent:new o.UniformColor(p,n.u_accent)}),hillshadePrepare:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_dimension:new o.Uniform2f(p,n.u_dimension),u_zoom:new o.Uniform1f(p,n.u_zoom),u_unpack:new o.Uniform4f(p,n.u_unpack)}),line:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_ratio:new o.Uniform1f(p,n.u_ratio),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(p,n.u_units_to_pixels)}),lineGradient:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_ratio:new o.Uniform1f(p,n.u_ratio),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(p,n.u_units_to_pixels),u_image:new o.Uniform1i(p,n.u_image),u_image_height:new o.Uniform1f(p,n.u_image_height)}),linePattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_texsize:new o.Uniform2f(p,n.u_texsize),u_ratio:new o.Uniform1f(p,n.u_ratio),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_image:new o.Uniform1i(p,n.u_image),u_units_to_pixels:new o.Uniform2f(p,n.u_units_to_pixels),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade)}),lineSDF:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_ratio:new o.Uniform1f(p,n.u_ratio),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(p,n.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(p,n.u_patternscale_a),u_patternscale_b:new o.Uniform2f(p,n.u_patternscale_b),u_sdfgamma:new o.Uniform1f(p,n.u_sdfgamma),u_image:new o.Uniform1i(p,n.u_image),u_tex_y_a:new o.Uniform1f(p,n.u_tex_y_a),u_tex_y_b:new o.Uniform1f(p,n.u_tex_y_b),u_mix:new o.Uniform1f(p,n.u_mix)}),raster:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_tl_parent:new o.Uniform2f(p,n.u_tl_parent),u_scale_parent:new o.Uniform1f(p,n.u_scale_parent),u_buffer_scale:new o.Uniform1f(p,n.u_buffer_scale),u_fade_t:new o.Uniform1f(p,n.u_fade_t),u_opacity:new o.Uniform1f(p,n.u_opacity),u_image0:new o.Uniform1i(p,n.u_image0),u_image1:new o.Uniform1i(p,n.u_image1),u_brightness_low:new o.Uniform1f(p,n.u_brightness_low),u_brightness_high:new o.Uniform1f(p,n.u_brightness_high),u_saturation_factor:new o.Uniform1f(p,n.u_saturation_factor),u_contrast_factor:new o.Uniform1f(p,n.u_contrast_factor),u_spin_weights:new o.Uniform3f(p,n.u_spin_weights)}),symbolIcon:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_texture:new o.Uniform1i(p,n.u_texture)}),symbolSDF:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_texture:new o.Uniform1i(p,n.u_texture),u_gamma_scale:new o.Uniform1f(p,n.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(p,n.u_is_halo)}),symbolTextAndIcon:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_texsize_icon:new o.Uniform2f(p,n.u_texsize_icon),u_texture:new o.Uniform1i(p,n.u_texture),u_texture_icon:new o.Uniform1i(p,n.u_texture_icon),u_gamma_scale:new o.Uniform1f(p,n.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(p,n.u_is_halo)}),background:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_opacity:new o.Uniform1f(p,n.u_opacity),u_color:new o.UniformColor(p,n.u_color)}),backgroundPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_opacity:new o.Uniform1f(p,n.u_opacity),u_image:new o.Uniform1i(p,n.u_image),u_pattern_tl_a:new o.Uniform2f(p,n.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(p,n.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(p,n.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(p,n.u_pattern_br_b),u_texsize:new o.Uniform2f(p,n.u_texsize),u_mix:new o.Uniform1f(p,n.u_mix),u_pattern_size_a:new o.Uniform2f(p,n.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(p,n.u_pattern_size_b),u_scale_a:new o.Uniform1f(p,n.u_scale_a),u_scale_b:new o.Uniform1f(p,n.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(p,n.u_tile_units_to_pixels)}),terrain:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_texture:new o.Uniform1i(p,n.u_texture)}),terrainDepth:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),terrainCoords:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_texture:new o.Uniform1i(p,n.u_texture),u_terrain_coords_id:new o.Uniform1f(p,n.u_terrain_coords_id)})};class Bc{constructor(n,u,d){this.context=n;let m=n.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){let u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let ha,jc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Uc{constructor(n,u,d,m){this.length=u.length,this.attributes=d,this.itemSize=u.bytesPerElement,this.dynamicDraw=m,this.context=n;let _=n.gl;this.buffer=_.createBuffer(),n.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,u){for(let d=0;d<this.attributes.length;d++){let m=u.attributes[this.attributes[d].name];void 0!==m&&n.enableVertexAttribArray(m)}}setVertexAttribPointers(n,u,d){for(let m=0;m<this.attributes.length;m++){let _=this.attributes[m],b=u.attributes[_.name];void 0!==b&&n.vertexAttribPointer(b,_.components,n[jc[_.type]],!1,this.itemSize,_.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ut{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Th extends Ut{getDefault(){return o.Color.transparent}set(n){let u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class am extends Ut{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class ca extends Ut{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class ua extends Ut{getDefault(){return[!0,!0,!0,!0]}set(n){let u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ah extends Ut{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ri extends Ut{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Vc extends Ut{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){let u=this.current;(n.func!==u.func||n.ref!==u.ref||n.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class pl extends Ut{getDefault(){let n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){let u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class fl extends Ut{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;n?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=n,this.dirty=!1}}class $c extends Ut{getDefault(){return[0,1]}set(n){let u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Hc extends Ut{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;n?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=n,this.dirty=!1}}class ml extends Ut{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Gc extends Ut{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;n?u.enable(u.BLEND):u.disable(u.BLEND),this.current=n,this.dirty=!1}}class Zc extends Ut{getDefault(){let n=this.gl;return[n.ONE,n.ZERO]}set(n){let u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class gl extends Ut{getDefault(){return o.Color.transparent}set(n){let u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ph extends Ut{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class kh extends Ut{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;n?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=n,this.dirty=!1}}class Cs extends Ut{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class lm extends Ut{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class cm extends Ut{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class um extends Ut{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class hm extends Ut{getDefault(){let n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){let u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class dm extends Ut{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class pm extends Ut{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class qc extends Ut{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class yl extends Ut{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Wc extends Ut{getDefault(){return null}set(n){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Yc extends Ut{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Ss extends Ut{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Lh extends Ut{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Oh extends Ut{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class _l extends Ut{constructor(n,u){super(n),this.context=n,this.parent=u}getDefault(){return null}}class Ho extends _l{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Nh extends _l{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ts{constructor(n,u,d,m){this.context=n,this.width=u,this.height=d;let _=n.gl,b=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new Ho(n,b),m&&(this.depthAttachment=new Nh(n,b)),_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){let d=this.depthAttachment.get();d&&n.deleteRenderbuffer(d)}n.deleteFramebuffer(this.framebuffer)}}class dn{constructor(n,u,d){this.blendFunction=n,this.blendColor=u,this.mask=d}}dn.Replace=[1,0],dn.disabled=new dn(dn.Replace,o.Color.transparent,[!1,!1,!1,!1]),dn.unblended=new dn(dn.Replace,o.Color.transparent,[!0,!0,!0,!0]),dn.alphaBlended=new dn([1,771],o.Color.transparent,[!0,!0,!0,!0]);class Rh{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Th(this),this.clearDepth=new am(this),this.clearStencil=new ca(this),this.colorMask=new ua(this),this.depthMask=new Ah(this),this.stencilMask=new Ri(this),this.stencilFunc=new Vc(this),this.stencilOp=new pl(this),this.stencilTest=new fl(this),this.depthRange=new $c(this),this.depthTest=new Hc(this),this.depthFunc=new ml(this),this.blend=new Gc(this),this.blendFunc=new Zc(this),this.blendColor=new gl(this),this.blendEquation=new Ph(this),this.cullFace=new kh(this),this.cullFaceSide=new Cs(this),this.frontFace=new lm(this),this.program=new cm(this),this.activeTexture=new um(this),this.viewport=new hm(this),this.bindFramebuffer=new dm(this),this.bindRenderbuffer=new pm(this),this.bindTexture=new qc(this),this.bindVertexBuffer=new yl(this),this.bindElementBuffer=new Wc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Yc(this),this.pixelStoreUnpack=new Ss(this),this.pixelStoreUnpackPremultiplyAlpha=new Lh(this),this.pixelStoreUnpackFlipY=new Oh(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,u){return new Bc(this,n,u)}createVertexBuffer(n,u,d){return new Uc(this,n,u,d)}createRenderbuffer(n,u,d){let m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,n,u,d),this.bindRenderbuffer.set(null),_}createFramebuffer(n,u,d){return new Ts(this,n,u,d)}clear({color:n,depth:u}){let d=this.gl,m=0;n&&(m|=d.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(m|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),d.clear(m)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){A(n.blendFunction,dn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class St{constructor(n,u,d){this.func=n,this.mask=u,this.range=d}}St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);class cn{constructor(n,u,d,m,_,b){this.test=n,this.ref=u,this.mask=d,this.fail=m,this.depthFail=_,this.pass=b}}cn.disabled=new cn({func:519,mask:0},0,0,7680,7680,7680);class yn{constructor(n,u,d){this.enable=n,this.mode=u,this.frontFace=d}}function As(p,n,u,d,m,_,b){let E=p.context,D=E.gl,S=p.useProgram("collisionBox"),k=[],R=0,z=0;for(let W=0;W<d.length;W++){let he=d[W],ce=n.getTile(he),ge=ce.getBucket(u);if(!ge)continue;let ye=he.posMatrix;0===m[0]&&0===m[1]||(ye=p.translatePosMatrix(he.posMatrix,ce,m,_));let Me=b?ge.textCollisionBox:ge.iconCollisionBox,me=ge.collisionCircleArray;if(me.length>0){let ze=o.create(),Se=ye;o.mul(ze,ge.placementInvProjMatrix,p.transform.glCoordMatrix),o.mul(ze,ze,ge.placementViewportMatrix),k.push({circleArray:me,circleOffset:z,transform:Se,invTransform:ze,coord:he}),R+=me.length/4,z=R}Me&&S.draw(E,D.LINES,St.disabled,cn.disabled,p.colorModeForRenderPass(),yn.disabled,$o(ye,p.transform,ce),p.style.terrain&&p.style.terrain.getTerrainData(he),u.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,null,p.transform.zoom,null,null,Me.collisionVertexBuffer)}if(!b||!k.length)return;let q=p.useProgram("collisionCircle"),H=new o.CollisionCircleLayoutArray;H.resize(4*R),H._trim();let Z=0;for(let W of k)for(let he=0;he<W.circleArray.length/4;he++){let ce=4*he,ge=W.circleArray[ce+0],ye=W.circleArray[ce+1],Me=W.circleArray[ce+2],me=W.circleArray[ce+3];H.emplace(Z++,ge,ye,Me,me,0),H.emplace(Z++,ge,ye,Me,me,1),H.emplace(Z++,ge,ye,Me,me,2),H.emplace(Z++,ge,ye,Me,me,3)}(!ha||ha.length<2*R)&&(ha=function(W){let he=2*W,ce=new o.QuadTriangleArray;ce.resize(he),ce._trim();for(let ge=0;ge<he;ge++){let ye=6*ge;ce.uint16[ye+0]=4*ge+0,ce.uint16[ye+1]=4*ge+1,ce.uint16[ye+2]=4*ge+2,ce.uint16[ye+3]=4*ge+2,ce.uint16[ye+4]=4*ge+3,ce.uint16[ye+5]=4*ge+0}return ce}(R));let ee=E.createIndexBuffer(ha,!0),ie=E.createVertexBuffer(H,o.collisionCircleLayout.members,!0);for(let W of k){let he={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(ae=p.transform).cameraToCenterDistance,u_viewport_size:[ae.width,ae.height]};q.draw(E,D.TRIANGLES,St.disabled,cn.disabled,p.colorModeForRenderPass(),yn.disabled,he,p.style.terrain&&p.style.terrain.getTerrainData(W.coord),u.id,ie,ee,o.SegmentVector.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,p.transform.zoom,null,null,null)}var ae;ie.destroy(),ee.destroy()}yn.disabled=new yn(!1,1029,2305),yn.backCCW=new yn(!0,1029,2305);let fm=o.identity(new Float32Array(16));function mm(p,n,u,d,m,_){let{horizontalAlign:b,verticalAlign:E}=o.getAnchorAlignment(p),D=-(b-.5)*n,S=-(E-.5)*u,k=o.evaluateVariableOffset(p,d);return new o.pointGeometry((D/m+k[0])*_,(S/m+k[1])*_)}function Fh(p,n,u,d,m,_,b,E,D,S,k){let R=p.text.placedSymbolArray,z=p.text.dynamicLayoutVertexArray,q=p.icon.dynamicLayoutVertexArray,H={};z.clear();for(let Z=0;Z<R.length;Z++){let ee=R.get(Z),ae=ee.hidden||!ee.crossTileID||p.allowVerticalPlacement&&!ee.placedOrientation?null:d[ee.crossTileID];if(ae){let W=new o.pointGeometry(ee.anchorX,ee.anchorY),he=Rt(W,u?b:_,k),ce=qi(m.cameraToCenterDistance,he.signedDistanceFromCamera),ge=o.evaluateSizeForFeature(p.textSizeData,D,ee)*ce/o.ONE_EM;u&&(ge*=p.tilePixelRatio/E);let{width:ye,height:Me,anchor:me,textOffset:ze,textBoxScale:Se}=ae,Ue=mm(me,ye,Me,ze,Se,ge),gt=u?Rt(W.add(Ue),_,k).point:he.point.add(n?Ue.rotate(-m.angle):Ue),xt=p.allowVerticalPlacement&&ee.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let et=0;et<ee.numGlyphs;et++)o.addDynamicAttributes(z,gt,xt);S&&ee.associatedIconIndex>=0&&(H[ee.associatedIconIndex]={shiftedAnchor:gt,angle:xt})}else ht(ee.numGlyphs,z)}if(S){q.clear();let Z=p.icon.placedSymbolArray;for(let ee=0;ee<Z.length;ee++){let ie=Z.get(ee);if(ie.hidden)ht(ie.numGlyphs,q);else{let ae=H[ee];if(ae)for(let W=0;W<ie.numGlyphs;W++)o.addDynamicAttributes(q,ae.shiftedAnchor,ae.angle);else ht(ie.numGlyphs,q)}}p.icon.dynamicLayoutVertexBuffer.updateData(q)}p.text.dynamicLayoutVertexBuffer.updateData(z)}function gm(p,n,u){return u.iconsInText&&n?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function vl(p,n,u,d,m,_,b,E,D,S,k,R){let z=p.context,q=z.gl,H=p.transform,Z="map"===E,ee="map"===D,ie="viewport"!==E&&"point"!==u.layout.get("symbol-placement"),ae=Z&&!ee&&!ie,W=!u.layout.get("symbol-sort-key").isConstant(),he=!1,ce=p.depthModeForSublayer(0,St.ReadOnly),ge=u.layout.get("text-variable-anchor"),ye=[];for(let Me of d){let me=n.getTile(Me),ze=me.getBucket(u);if(!ze)continue;let Se=m?ze.text:ze.icon;if(!Se||!Se.segments.get().length)continue;let Bt,Qt,Yn,Mr,Ue=Se.programConfigurations.get(u.id),gt=m||ze.sdfIcons,xt=m?ze.textSizeData:ze.iconSizeData,et=ee||0!==H.pitch,Wt=p.useProgram(gm(gt,m,ze),Ue),Yt=o.evaluateSizeForZoom(xt,H.zoom),Lt=p.style.terrain&&p.style.terrain.getTerrainData(Me),ir=[0,0],Er=null;if(m)Qt=me.glyphAtlasTexture,Yn=q.LINEAR,Bt=me.glyphAtlasTexture.size,ze.iconsInText&&(ir=me.imageAtlasTexture.size,Er=me.imageAtlasTexture,Mr=et||p.options.rotating||p.options.zooming||"composite"===xt.kind||"camera"===xt.kind?q.LINEAR:q.NEAREST);else{let Ki=1!==u.layout.get("icon-size").constantOr(0)||ze.iconsNeedLinear;Qt=me.imageAtlasTexture,Yn=gt||p.options.rotating||p.options.zooming||Ki||et?q.LINEAR:q.NEAREST,Bt=me.imageAtlasTexture.size}let Mo=Nn(me,1,p.transform.zoom),Yi=Bo(Me.posMatrix,ee,Z,p.transform,Mo),Ci=tr(Me.posMatrix,ee,Z,p.transform,Mo),jr=ge&&ze.hasTextData(),Cl="none"!==u.layout.get("icon-text-fit")&&jr&&ze.hasIconData();if(ie){let Ki=p.style.terrain?(uu,Rs)=>p.style.terrain.getElevation(Me,uu,Rs):null,Wo="map"===u.layout.get("text-rotation-alignment");Ni(ze,Me.posMatrix,p,m,Yi,Ci,ee,S,Wo,Ki)}let Qn,Vn=p.translatePosMatrix(Me.posMatrix,me,_,b),It=ie||m&&ge||Cl?fm:Yi,Gt=p.translatePosMatrix(Ci,me,_,b,!0),Kn=gt&&0!==u.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1);Qn=gt?ze.iconsInText?Sh(xt.kind,Yt,ae,ee,p,Vn,It,Gt,Bt,ir):dl(xt.kind,Yt,ae,ee,p,Vn,It,Gt,m,Bt,!0):Fc(xt.kind,Yt,ae,ee,p,Vn,It,Gt,m,Bt);let vn={program:Wt,buffers:Se,uniformValues:Qn,atlasTexture:Qt,atlasTextureIcon:Er,atlasInterpolation:Yn,atlasInterpolationIcon:Mr,isSDF:gt,hasHalo:Kn};if(W&&ze.canOverlap){he=!0;let Ki=Se.segments.get();for(let Wo of Ki)ye.push({segments:new o.SegmentVector([Wo]),sortKey:Wo.sortKey,state:vn,terrainData:Lt})}else ye.push({segments:Se.segments,sortKey:0,state:vn,terrainData:Lt})}he&&ye.sort((Me,me)=>Me.sortKey-me.sortKey);for(let Me of ye){let me=Me.state;if(z.activeTexture.set(q.TEXTURE0),me.atlasTexture.bind(me.atlasInterpolation,q.CLAMP_TO_EDGE),me.atlasTextureIcon&&(z.activeTexture.set(q.TEXTURE1),me.atlasTextureIcon&&me.atlasTextureIcon.bind(me.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),me.isSDF){let ze=me.uniformValues;me.hasHalo&&(ze.u_is_halo=1,da(me.buffers,Me.segments,u,p,me.program,ce,k,R,ze,Me.terrainData)),ze.u_is_halo=0}da(me.buffers,Me.segments,u,p,me.program,ce,k,R,me.uniformValues,Me.terrainData)}}function da(p,n,u,d,m,_,b,E,D,S){let k=d.context;m.draw(k,k.gl.TRIANGLES,_,b,E,yn.disabled,D,S,u.id,p.layoutVertexBuffer,p.indexBuffer,n,u.paint,d.transform.zoom,p.programConfigurations.get(u.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function pa(p,n,u,d,m,_,b){let R,z,q,H,Z,E=p.context.gl,D=u.paint.get("fill-pattern"),S=D&&D.constantOr(1),k=u.getCrossfadeParameters();b?(z=S&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=E.LINES):(z=S?"fillPattern":"fill",R=E.TRIANGLES);for(let ee of d){let ie=n.getTile(ee);if(S&&!ie.patternsLoaded())continue;let ae=ie.getBucket(u);if(!ae)continue;let W=ae.programConfigurations.get(u.id),he=p.useProgram(z,W),ce=p.style.terrain&&p.style.terrain.getTerrainData(ee);S&&(p.context.activeTexture.set(E.TEXTURE0),ie.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),W.updatePaintBuffers(k));let ge=D.constantOr(null);if(ge&&ie.imageAtlas){let me=ie.imageAtlas,ze=me.patternPositions[ge.to.toString()],Se=me.patternPositions[ge.from.toString()];ze&&Se&&W.setConstantPatternPositions(ze,Se)}let ye=ce?ee:null,Me=p.translatePosMatrix(ye?ye.posMatrix:ee.posMatrix,ie,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(b){H=ae.indexBuffer2,Z=ae.segments2;let me=[E.drawingBufferWidth,E.drawingBufferHeight];q="fillOutlinePattern"===z&&S?Eh(Me,p,k,ie,me):Mh(Me,me)}else H=ae.indexBuffer,Z=ae.segments,q=S?Nc(Me,p,k,ie):ll(Me);he.draw(p.context,R,m,p.stencilModeForClipping(ee),_,yn.disabled,q,ce,u.id,ae.layoutVertexBuffer,H,Z,u.paint,p.transform.zoom,W)}}function fa(p,n,u,d,m,_,b){let E=p.context,D=E.gl,S=u.paint.get("fill-extrusion-pattern"),k=S.constantOr(1),R=u.getCrossfadeParameters(),z=u.paint.get("fill-extrusion-opacity");for(let q of d){let H=n.getTile(q),Z=H.getBucket(u);if(!Z)continue;let ee=p.style.terrain&&p.style.terrain.getTerrainData(q),ie=Z.programConfigurations.get(u.id),ae=p.useProgram(k?"fillExtrusionPattern":"fillExtrusion",ie);k&&(p.context.activeTexture.set(D.TEXTURE0),H.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ie.updatePaintBuffers(R));let W=S.constantOr(null);if(W&&H.imageAtlas){let ye=H.imageAtlas,Me=ye.patternPositions[W.to.toString()],me=ye.patternPositions[W.from.toString()];Me&&me&&ie.setConstantPatternPositions(Me,me)}let he=p.translatePosMatrix(q.posMatrix,H,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),ce=u.paint.get("fill-extrusion-vertical-gradient"),ge=k?rm(he,p,ce,z,q,R,H):Oc(he,p,ce,z);ae.draw(E,E.gl.TRIANGLES,m,_,b,yn.backCCW,ge,ee,u.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,u.paint,p.transform.zoom,ie,p.style.terrain&&Z.centroidVertexBuffer)}}function Kc(p,n,u,d,m,_,b){let E=p.context,D=E.gl,S=u.fbo;if(!S)return;let k=p.useProgram("hillshade"),R=p.style.terrain&&p.style.terrain.getTerrainData(n);E.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,S.colorAttachment.get()),k.draw(E,D.TRIANGLES,m,_,b,yn.disabled,((z,q,H,Z)=>{let ee=H.paint.get("hillshade-shadow-color"),ie=H.paint.get("hillshade-highlight-color"),ae=H.paint.get("hillshade-accent-color"),W=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===H.paint.get("hillshade-illumination-anchor")&&(W-=z.transform.angle);let he=!z.options.moving;return{u_matrix:Z?Z.posMatrix:z.transform.calculatePosMatrix(q.tileID.toUnwrapped(),he),u_image:0,u_latrange:ul(0,q.tileID),u_light:[H.paint.get("hillshade-exaggeration"),W],u_shadow:ee,u_highlight:ie,u_accent:ae}})(p,u,d,R?n:null),R,d.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function zh(p,n,u,d,m,_){let b=p.context,E=b.gl,D=n.dem;if(D&&D.data){let S=D.dim,k=D.stride,R=D.getPixels();if(b.activeTexture.set(E.TEXTURE1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(k),n.demTexture){let q=n.demTexture;q.update(R,{premultiply:!1}),q.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else n.demTexture=new le(b,R,E.RGBA,{premultiply:!1}),n.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);b.activeTexture.set(E.TEXTURE0);let z=n.fbo;if(!z){let q=new le(b,{width:S,height:S,data:null},E.RGBA);q.bind(E.LINEAR,E.CLAMP_TO_EDGE),z=n.fbo=b.createFramebuffer(S,S,!0),z.colorAttachment.set(q.texture)}b.bindFramebuffer.set(z.framebuffer),b.viewport.set([0,0,S,S]),p.useProgram("hillshadePrepare").draw(b,E.TRIANGLES,d,m,_,yn.disabled,((q,H)=>{let Z=H.stride,ee=o.create();return o.ortho(ee,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(ee,ee,[0,-o.EXTENT,0]),{u_matrix:ee,u_image:1,u_dimension:[Z,Z],u_zoom:q.overscaledZ,u_unpack:H.getUnpackVector()}})(n.tileID,D),null,u.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function xl(p,n,u,d,m,_){let b=d.paint.get("raster-fade-duration");if(!_&&b>0){let E=o.exported.now(),D=(E-p.timeAdded)/b,S=n?(E-n.timeAdded)/b:-1,k=u.getSource(),R=m.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),q=z&&p.refreshedUponExpiration?1:o.clamp(z?D:1-S,0,1);return p.refreshedUponExpiration&&D>=1&&(p.refreshedUponExpiration=!1),n?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}let bl=new o.Color(1,0,0,1),nr=new o.Color(0,1,0,1),Bh=new o.Color(0,0,1,1),Qc=new o.Color(1,0,1,1),jh=new o.Color(0,1,1,1);function Go(p,n,u,d){Ps(p,0,n+u/2,p.transform.width,u,d)}function ma(p,n,u,d){Ps(p,n-u/2,0,u,p.transform.height,d)}function Ps(p,n,u,d,m,_){let b=p.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(n*p.pixelRatio,u*p.pixelRatio,d*p.pixelRatio,m*p.pixelRatio),b.clear({color:_}),E.disable(E.SCISSOR_TEST)}function ym(p,n,u){let d=p.context,m=d.gl,_=u.posMatrix,b=p.useProgram("debug"),E=St.disabled,D=cn.disabled,S=p.colorModeForRenderPass(),k="$debug",R=p.style.terrain&&p.style.terrain.getTerrainData(u);d.activeTexture.set(m.TEXTURE0),p.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE);let z=n.getTileByID(u.key).latestRawTileData,q=Math.floor((z&&z.byteLength||0)/1024),H=n.getTile(u).tileSize,Z=512/Math.min(H,512)*(u.overscaledZ/p.transform.zoom)*.5,ee=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ee+=` => ${u.overscaledZ}`),function(ie,ae){ie.initDebugOverlayCanvas();let W=ie.debugOverlayCanvas,he=ie.context.gl,ce=ie.debugOverlayCanvas.getContext("2d");ce.clearRect(0,0,W.width,W.height),ce.shadowColor="white",ce.shadowBlur=2,ce.lineWidth=1.5,ce.strokeStyle="white",ce.textBaseline="top",ce.font="bold 36px Open Sans, sans-serif",ce.fillText(ae,5,5),ce.strokeText(ae,5,5),ie.debugOverlayTexture.update(W),ie.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(p,`${ee} ${q}kB`),b.draw(d,m.TRIANGLES,E,D,dn.alphaBlended,yn.disabled,sa(_,o.Color.transparent,Z),null,k,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),b.draw(d,m.LINE_STRIP,E,D,S,yn.disabled,sa(_,o.Color.red),R,k,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function wl(p,n,u){let d=p.context,m=d.gl,_=p.colorModeForRenderPass(),b=new St(m.LEQUAL,St.ReadWrite,p.depthRangeFor3D),E=p.useProgram("terrain"),D=n.getTerrainMesh(),S=n.getTerrainData(u.tileID);d.bindFramebuffer.set(null),d.viewport.set([0,0,p.width,p.height]),d.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,n.getRTTFramebuffer().colorAttachment.get());let k=p.transform.calculatePosMatrix(u.tileID.toUnwrapped());E.draw(d,m.TRIANGLES,b,cn.disabled,_,yn.backCCW,{u_matrix:k,u_texture:0},S,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}function Uh(p,n,u,d){let m=p.context,_=u.tileSize*n.qualityFactor;u.textures[d]||(u.textures[d]=p.getTileTexture(_)||new le(m,{width:_,height:_,data:null},m.gl.RGBA),u.textures[d].bind(m.gl.LINEAR,m.gl.CLAMP_TO_EDGE),0===d&&n.sourceCache.renderHistory.unshift(u.tileID.key));let b=n.getRTTFramebuffer();b.colorAttachment.set(u.textures[d].texture),m.bindFramebuffer.set(b.framebuffer),m.viewport.set([0,0,_,_])}class Vh{constructor(n){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=n,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=n.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){let n=this.painter.style,u=n.terrain;for(let d in n.sourceCaches){this._coordsDescendingInv[d]={};let m=n.sourceCaches[d].getVisibleCoordinates();for(let _ of m){let b=u.sourceCache.getTerrainCoords(_);for(let E in b)this._coordsDescendingInv[d][E]||(this._coordsDescendingInv[d][E]=[]),this._coordsDescendingInv[d][E].push(b[E])}}for(let d of n._order){let m=n._layers[d],_=m.source;if(this._renderToTexture[m.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(let b in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][b]=this._coordsDescendingInv[_][b].map(E=>E.key).sort().join()}}return this._renderableTiles.forEach(d=>{for(let m in this._coordsDescendingInvStr){let _=this._coordsDescendingInvStr[m][d.tileID.key];_&&_!==d.textureCoords[m]&&d.clearTextures(this.painter),u.needsRerender(m,d.tileID)&&d.clearTextures(this.painter)}this._rerender[d.tileID.key]=!d.textures.length}),u.clearRerenderCache(),u.sourceCache.removeOutdated(this.painter),this}renderLayer(n){let u=n.type,d=this.painter,m=d.style._order,_=d.currentLayer,b=_+1===m.length;if(this._renderToTexture[u]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(m[_]),!b))return!0;if(this._renderToTexture[this._prevType]||"hillshade"===u||this._renderToTexture[u]&&b){this._prevType=u;let E=this._stacks.length-1,D=this._stacks[E]||[];for(let S of this._renderableTiles){if(Uh(d,d.style.terrain,S,E),this._rerender[S.tileID.key]){d.context.clear({color:o.Color.transparent});for(let k=0;k<D.length;k++){let R=d.style._layers[D[k]],z=R.source?this._coordsDescendingInv[R.source][S.tileID.key]:[S.tileID];d._renderTileClippingMasks(R,z),d.renderLayer(d,d.style.sourceCaches[R.source],R,z),R.source&&(S.textureCoords[R.source]=this._coordsDescendingInvStr[R.source][S.tileID.key])}}wl(d,d.style.terrain,S)}if("hillshade"===u){this._stacks.push([m[_]]);for(let S of this._renderableTiles){let k=this._coordsDescendingInv[n.source][S.tileID.key];Uh(d,d.style.terrain,S,this._stacks.length-1),d.context.clear({color:o.Color.transparent}),d._renderTileClippingMasks(n,k),d.renderLayer(d,d.style.sourceCaches[n.source],n,k),wl(d,d.style.terrain,S)}return!0}return this._renderToTexture[u]}return!1}}let ga={symbol:function(p,n,u,d,m){if("translucent"!==p.renderPass)return;let _=cn.disabled,b=p.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(E,D,S,k,R,z,q){let H=D.transform,Z="map"===R,ee="map"===z;for(let ie of E){let ae=k.getTile(ie),W=ae.getBucket(S);if(!W||!W.text||!W.text.segments.get().length)continue;let he=o.evaluateSizeForZoom(W.textSizeData,H.zoom),ce=Nn(ae,1,D.transform.zoom),ge=Bo(ie.posMatrix,ee,Z,D.transform,ce),ye="none"!==S.layout.get("icon-text-fit")&&W.hasIconData();if(he){let Me=Math.pow(2,H.zoom-ae.tileID.overscaledZ);Fh(W,Z,ee,q,H,ge,ie.posMatrix,Me,he,ye,D.style.terrain?(me,ze)=>D.style.terrain.getElevation(ie,me,ze):null)}}}(d,p,u,n,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),m),0!==u.paint.get("icon-opacity").constantOr(1)&&vl(p,n,u,d,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),_,b),0!==u.paint.get("text-opacity").constantOr(1)&&vl(p,n,u,d,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),_,b),n.map.showCollisionBoxes&&(As(p,n,u,d,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),As(p,n,u,d,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,u,d){if("translucent"!==p.renderPass)return;let m=u.paint.get("circle-opacity"),_=u.paint.get("circle-stroke-width"),b=u.paint.get("circle-stroke-opacity"),E=!u.layout.get("circle-sort-key").isConstant();if(0===m.constantOr(1)&&(0===_.constantOr(1)||0===b.constantOr(1)))return;let D=p.context,S=D.gl,k=p.depthModeForSublayer(0,St.ReadOnly),R=cn.disabled,z=p.colorModeForRenderPass(),q=[];for(let H=0;H<d.length;H++){let Z=d[H],ee=n.getTile(Z),ie=ee.getBucket(u);if(!ie)continue;let ae=ie.programConfigurations.get(u.id),W=p.useProgram("circle",ae),he=ie.layoutVertexBuffer,ce=ie.indexBuffer,ge=p.style.terrain&&p.style.terrain.getTerrainData(Z),ye={programConfiguration:ae,program:W,layoutVertexBuffer:he,indexBuffer:ce,uniformValues:Ih(p,Z,ee,u),terrainData:ge};if(E){let Me=ie.segments.get();for(let me of Me)q.push({segments:new o.SegmentVector([me]),sortKey:me.sortKey,state:ye})}else q.push({segments:ie.segments,sortKey:0,state:ye})}E&&q.sort((H,Z)=>H.sortKey-Z.sortKey);for(let H of q){let{programConfiguration:Z,program:ee,layoutVertexBuffer:ie,indexBuffer:ae,uniformValues:W,terrainData:he}=H.state;ee.draw(D,S.TRIANGLES,k,R,z,yn.disabled,W,he,u.id,ie,ae,H.segments,u.paint,p.transform.zoom,Z)}},heatmap:function(p,n,u,d){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){let m=p.context,_=m.gl,b=cn.disabled,E=new dn([_.ONE,_.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(D,S,k){let R=D.gl;D.activeTexture.set(R.TEXTURE1),D.viewport.set([0,0,S.width/4,S.height/4]);let z=k.heatmapFbo;if(z)R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get()),D.bindFramebuffer.set(z.framebuffer);else{let q=R.createTexture();R.bindTexture(R.TEXTURE_2D,q),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),z=k.heatmapFbo=D.createFramebuffer(S.width/4,S.height/4,!1),function(H,Z,ee,ie){let ae=H.gl;ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,Z.width/4,Z.height/4,0,ae.RGBA,H.extRenderToTextureHalfFloat?H.extTextureHalfFloat.HALF_FLOAT_OES:ae.UNSIGNED_BYTE,null),ie.colorAttachment.set(ee)}(D,S,q,z)}})(m,p,u),m.clear({color:o.Color.transparent});for(let D=0;D<d.length;D++){let S=d[D];if(n.hasRenderableParent(S))continue;let k=n.getTile(S),R=k.getBucket(u);if(!R)continue;let z=R.programConfigurations.get(u.id),q=p.useProgram("heatmap",z),{zoom:H}=p.transform;q.draw(m,_.TRIANGLES,St.disabled,b,E,yn.disabled,cl(S.posMatrix,k,H,u.paint.get("heatmap-intensity")),null,u.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,u.paint,p.transform.zoom,z)}m.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(m,_){let b=m.context,E=b.gl,D=_.heatmapFbo;if(!D)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,D.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1);let S=_.colorRampTexture;S||(S=_.colorRampTexture=new le(b,_.colorRamp,E.RGBA)),S.bind(E.LINEAR,E.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(b,E.TRIANGLES,St.disabled,cn.disabled,m.colorModeForRenderPass(),yn.disabled,((k,R,z,q)=>{let H=o.create();o.ortho(H,0,k.width,k.height,0,0,1);let Z=k.context.gl;return{u_matrix:H,u_world:[Z.drawingBufferWidth,Z.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}})(m,_),null,_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(p,u))},line:function(p,n,u,d){if("translucent"!==p.renderPass)return;let m=u.paint.get("line-opacity"),_=u.paint.get("line-width");if(0===m.constantOr(1)||0===_.constantOr(1))return;let b=p.depthModeForSublayer(0,St.ReadOnly),E=p.colorModeForRenderPass(),D=u.paint.get("line-dasharray"),S=u.paint.get("line-pattern"),k=S.constantOr(1),R=u.paint.get("line-gradient"),z=u.getCrossfadeParameters(),q=k?"linePattern":D?"lineSDF":R?"lineGradient":"line",H=p.context,Z=H.gl,ee=!0;for(let ie of d){let ae=n.getTile(ie);if(k&&!ae.patternsLoaded())continue;let W=ae.getBucket(u);if(!W)continue;let he=W.programConfigurations.get(u.id),ce=p.context.program.get(),ge=p.useProgram(q,he),ye=ee||ge.program!==ce,Me=p.style.terrain&&p.style.terrain.getTerrainData(ie),me=S.constantOr(null);if(me&&ae.imageAtlas){let Ue=ae.imageAtlas,gt=Ue.patternPositions[me.to.toString()],xt=Ue.patternPositions[me.from.toString()];gt&&xt&&he.setConstantPatternPositions(gt,xt)}let ze=Me?ie:null,Se=k?hl(p,ae,u,z,ze):D?aa(p,ae,u,D,z,ze):R?Rc(p,ae,u,W.lineClipsArray.length,ze):Ds(p,ae,u,ze);if(k)H.activeTexture.set(Z.TEXTURE0),ae.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),he.updatePaintBuffers(z);else if(D&&(ye||p.lineAtlas.dirty))H.activeTexture.set(Z.TEXTURE0),p.lineAtlas.bind(H);else if(R){let Ue=W.gradients[u.id],gt=Ue.texture;if(u.gradientVersion!==Ue.version){let xt=256;if(u.stepInterpolant){let et=n.getSource().maxzoom,Wt=ie.canonical.z===et?Math.ceil(1<<p.transform.maxZoom-ie.canonical.z):1;xt=o.clamp(o.nextPowerOfTwo(W.maxLineLength/o.EXTENT*1024*Wt),256,H.maxTextureSize)}Ue.gradient=o.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:xt,image:Ue.gradient||void 0,clips:W.lineClipsArray}),Ue.texture?Ue.texture.update(Ue.gradient):Ue.texture=new le(H,Ue.gradient,Z.RGBA),Ue.version=u.gradientVersion,gt=Ue.texture}H.activeTexture.set(Z.TEXTURE0),gt.bind(u.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}ge.draw(H,Z.TRIANGLES,b,p.stencilModeForClipping(ie),E,yn.disabled,Se,Me,u.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,u.paint,p.transform.zoom,he,W.layoutVertexBuffer2),ee=!1}},fill:function(p,n,u,d){let m=u.paint.get("fill-color"),_=u.paint.get("fill-opacity");if(0===_.constantOr(1))return;let b=p.colorModeForRenderPass(),E=u.paint.get("fill-pattern"),D=p.opaquePassEnabledForLayer()&&!E.constantOr(1)&&1===m.constantOr(o.Color.transparent).a&&1===_.constantOr(0)?"opaque":"translucent";if(p.renderPass===D){let S=p.depthModeForSublayer(1,"opaque"===p.renderPass?St.ReadWrite:St.ReadOnly);pa(p,n,u,d,S,b,!1)}if("translucent"===p.renderPass&&u.paint.get("fill-antialias")){let S=p.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);pa(p,n,u,d,S,b,!0)}},"fill-extrusion":function(p,n,u,d){let m=u.paint.get("fill-extrusion-opacity");if(0!==m&&"translucent"===p.renderPass){let _=new St(p.context.gl.LEQUAL,St.ReadWrite,p.depthRangeFor3D);if(1!==m||u.paint.get("fill-extrusion-pattern").constantOr(1))fa(p,n,u,d,_,cn.disabled,dn.disabled),fa(p,n,u,d,_,p.stencilModeFor3D(),p.colorModeForRenderPass());else{let b=p.colorModeForRenderPass();fa(p,n,u,d,_,cn.disabled,b)}}},hillshade:function(p,n,u,d){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;let m=p.context,_=p.depthModeForSublayer(0,St.ReadOnly),b=p.colorModeForRenderPass(),[E,D]="translucent"===p.renderPass?p.stencilConfigForOverlap(d):[{},d];for(let S of D){let k=n.getTile(S);void 0!==k.needsHillshadePrepare&&k.needsHillshadePrepare&&"offscreen"===p.renderPass?zh(p,k,u,_,cn.disabled,b):"translucent"===p.renderPass&&Kc(p,S,k,u,_,E[S.overscaledZ],b)}m.viewport.set([0,0,p.width,p.height])},raster:function(p,n,u,d){if("translucent"!==p.renderPass||0===u.paint.get("raster-opacity")||!d.length)return;let m=p.context,_=m.gl,b=n.getSource(),E=p.useProgram("raster"),D=p.colorModeForRenderPass(),[S,k]=b instanceof Xe?[{},d]:p.stencilConfigForOverlap(d),R=k[k.length-1].overscaledZ,z=!p.options.moving;for(let q of k){let H=p.depthModeForSublayer(q.overscaledZ-R,1===u.paint.get("raster-opacity")?St.ReadWrite:St.ReadOnly,_.LESS),Z=n.getTile(q);Z.registerFadeDuration(u.paint.get("raster-fade-duration"));let ae,W,ee=n.findLoadedParent(q,0),ie=xl(Z,ee,n,u,p.transform,p.style.terrain),he="nearest"===u.paint.get("raster-resampling")?_.NEAREST:_.LINEAR;m.activeTexture.set(_.TEXTURE0),Z.texture.bind(he,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),m.activeTexture.set(_.TEXTURE1),ee?(ee.texture.bind(he,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),ae=Math.pow(2,ee.tileID.overscaledZ-Z.tileID.overscaledZ),W=[Z.tileID.canonical.x*ae%1,Z.tileID.canonical.y*ae%1]):Z.texture.bind(he,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST);let ce=p.style.terrain&&p.style.terrain.getTerrainData(q),ge=ce?q:null,ye=ge?ge.posMatrix:p.transform.calculatePosMatrix(q.toUnwrapped(),z),Me=Dh(ye,W||[0,0],ae||1,ie,u);b instanceof Xe?E.draw(m,_.TRIANGLES,H,cn.disabled,D,yn.disabled,Me,ce,u.id,b.boundsBuffer,p.quadTriangleIndexBuffer,b.boundsSegments):E.draw(m,_.TRIANGLES,H,S[q.overscaledZ],D,yn.disabled,Me,ce,u.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}},background:function(p,n,u,d){let m=u.paint.get("background-color"),_=u.paint.get("background-opacity");if(0===_)return;let b=p.context,E=b.gl,D=p.transform,S=D.tileSize,k=u.paint.get("background-pattern");if(p.isPatternMissing(k))return;let R=!k&&1===m.a&&1===_&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==R)return;let z=cn.disabled,q=p.depthModeForSublayer(0,"opaque"===R?St.ReadWrite:St.ReadOnly),H=p.colorModeForRenderPass(),Z=p.useProgram(k?"backgroundPattern":"background"),ee=d||D.coveringTiles({tileSize:S,terrain:p.style.terrain});k&&(b.activeTexture.set(E.TEXTURE0),p.imageManager.bind(p.context));let ie=u.getCrossfadeParameters();for(let ae of ee){let W=d?ae.posMatrix:p.transform.calculatePosMatrix(ae.toUnwrapped()),he=k?sm(W,_,p,k,{tileID:ae,tileSize:S},ie):om(W,_,m),ce=p.style.terrain&&p.style.terrain.getTerrainData(ae);Z.draw(b,E.TRIANGLES,q,z,H,yn.disabled,he,ce,u.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}},debug:function(p,n,u){for(let d=0;d<u.length;d++)ym(p,n,u[d])},custom:function(p,n,u){let d=p.context,m=u.implementation;if("offscreen"===p.renderPass){let _=m.prerender;_&&(p.setCustomLayerDefaults(),d.setColorMode(p.colorModeForRenderPass()),_.call(m,d.gl,p.transform.customLayerMatrix()),d.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),d.setColorMode(p.colorModeForRenderPass()),d.setStencilMode(cn.disabled);let _="3d"===m.renderingMode?new St(p.context.gl.LEQUAL,St.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,St.ReadOnly);d.setDepthMode(_),m.render(d.gl,p.transform.customLayerMatrix()),d.setDirty(),p.setBaseState(),d.bindFramebuffer.set(null)}}};class Xc{constructor(n,u){this.context=new Rh(n),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=qt.maxUnderzooming+qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new lt,this.gpuTimers={}}resize(n,u,d){if(this.width=n*d,this.height=u*d,this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let m of this.style._order)this.style._layers[m].resize()}setup(){let n=this.context,u=new o.PosArray;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(u,Ft.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);let d=new o.PosArray;d.emplaceBack(0,0),d.emplaceBack(o.EXTENT,0),d.emplaceBack(0,o.EXTENT),d.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=n.createVertexBuffer(d,Ft.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);let m=new o.RasterBoundsArray;m.emplaceBack(0,0,0,0),m.emplaceBack(o.EXTENT,0,o.EXTENT,0),m.emplaceBack(0,o.EXTENT,0,o.EXTENT),m.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(m,Ge.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);let _=new o.PosArray;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,Ft.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);let b=new o.LineStripIndexArray;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(b);let E=new o.TriangleIndexArray;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(E),this.emptyTexture=new le(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);let D=this.context.gl;this.stencilClearMode=new cn({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)}clearStencil(){let n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let d=o.create();o.ortho(d,0,this.width,this.height,0,0,1),o.scale(d,d,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,u.TRIANGLES,St.disabled,this.stencilClearMode,dn.disabled,yn.disabled,Is(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,u){if(this.currentStencilSource===n.source||!n.isTileClipped()||!u||!u.length)return;this.currentStencilSource=n.source;let d=this.context,m=d.gl;this.nextStencilID+u.length>256&&this.clearStencil(),d.setColorMode(dn.disabled),d.setDepthMode(St.disabled);let _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let b of u){let E=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,D=this.style.terrain&&this.style.terrain.getTerrainData(b);_.draw(d,m.TRIANGLES,St.disabled,new cn({func:m.ALWAYS,mask:0},E,255,m.KEEP,m.KEEP,m.REPLACE),dn.disabled,yn.disabled,Is(b.posMatrix),D,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let n=this.nextStencilID++,u=this.context.gl;return new cn({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(n){let u=this.context.gl;return new cn({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(n){let u=this.context.gl,d=n.sort((b,E)=>E.overscaledZ-b.overscaledZ),m=d[d.length-1].overscaledZ,_=d[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();let b={};for(let E=0;E<_;E++)b[E+m]=new cn({func:u.GEQUAL,mask:255},E+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=_,[b,d]}return[{[m]:cn.disabled},d]}colorModeForRenderPass(){let n=this.context.gl;return this._showOverdrawInspector?new dn([n.CONSTANT_COLOR,n.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?dn.unblended:dn.alphaBlended}depthModeForSublayer(n,u,d){if(!this.opaquePassEnabledForLayer())return St.disabled;let m=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new St(d||this.context.gl.LEQUAL,u,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,u){this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();let d=this.style._order,m=this.style.sourceCaches,_=this.style.terrain&&new Vh(this);for(let S in m){let k=m[S];k.used&&k.prepare(this.context)}let b={},E={},D={};for(let S in m){let k=m[S];b[S]=k.getVisibleCoordinates(),E[S]=b[S].slice().reverse(),D[S]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<d.length;S++)if(this.style._layers[d[S]].is3D()){this.opaquePassCutoff=S;break}if(_){this.opaquePassCutoff=0;let S=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||S.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(k,R){let z=k.context,q=z.gl,H=dn.unblended,Z=new St(q.LEQUAL,St.ReadWrite,[0,1]),ee=R.getTerrainMesh(),ie=R.sourceCache.getRenderableTiles(),ae=k.useProgram("terrainDepth");z.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),z.clear({color:o.Color.transparent,depth:1});for(let W of ie){let he=R.getTerrainData(W.tileID),ce=k.transform.calculatePosMatrix(W.tileID.toUnwrapped());ae.draw(z,q.TRIANGLES,Z,cn.disabled,H,yn.backCCW,{u_matrix:ce},he,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,k.width,k.height])}(this,this.style.terrain),function(k,R){let z=k.context,q=z.gl,H=dn.unblended,Z=new St(q.LEQUAL,St.ReadWrite,[0,1]),ee=R.getTerrainMesh(),ie=R.getCoordsTexture(),ae=R.sourceCache.getRenderableTiles(),W=k.useProgram("terrainCoords");z.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),z.clear({color:o.Color.transparent,depth:1}),R.coordsIndex=[];for(let he of ae){let ce=R.getTerrainData(he.tileID);z.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ie.texture);let ge=k.transform.calculatePosMatrix(he.tileID.toUnwrapped());W.draw(z,q.TRIANGLES,Z,cn.disabled,H,yn.backCCW,{u_matrix:ge,u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0},ce,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments),R.coordsIndex.push(he.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,k.width,k.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(let S of d){let k=this.style._layers[S];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;let R=E[k.source];("custom"===k.type||R.length)&&this.renderLayer(this,m[k.source],k,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!_)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){let S=this.style._layers[d[this.currentLayer]],k=m[S.source],R=b[S.source];this._renderTileClippingMasks(S,R),this.renderLayer(this,k,S,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){let S=this.style._layers[d[this.currentLayer]],k=m[S.source];if(_&&_.renderLayer(S))continue;let R=("symbol"===S.type?D:E)[S.source];this._renderTileClippingMasks(S,b[S.source]),this.renderLayer(this,k,S,R)}if(this.options.showTileBoundaries){let S,k;Object.values(this.style._layers).forEach(R=>{R.source&&!R.isHidden(this.transform.zoom)&&(R.source!==(k&&k.id)&&(k=this.style.sourceCaches[R.source]),(!S||S.getSource().maxzoom<k.getSource().maxzoom)&&(S=k))}),S&&ga.debug(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){let k=S.transform.padding;Go(S,S.transform.height-(k.top||0),3,bl),Go(S,k.bottom||0,3,nr),ma(S,k.left||0,3,Bh),ma(S,S.transform.width-(k.right||0),3,Qc);let R=S.transform.centerPoint;var z,q,H,Z;Ps(z=S,(q=R.x)-1,(H=S.transform.height-R.y)-10,2,20,Z=jh),Ps(z,q-10,H-1,20,2,Z)}(this),this.context.setDefault()}renderLayer(n,u,d,m){d.isHidden(this.transform.zoom)||("background"===d.type||"custom"===d.type||(m||[]).length)&&(this.id=d.id,this.gpuTimingStart(d),ga[d.type](n,u,d,m,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;let u=this.context.extTimerQuery,d=this.gpuTimers[n.id];d||(d=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),d.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,d.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){let n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){let u={};for(let d in n){let m=n[d],_=this.context.extTimerQuery,b=_.getQueryObjectEXT(m.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(m.query),u[d]=b}return u}translatePosMatrix(n,u,d,m,_){if(!d[0]&&!d[1])return n;let b=_?"map"===m?this.transform.angle:0:"viewport"===m?-this.transform.angle:0;if(b){let S=Math.sin(b),k=Math.cos(b);d=[d[0]*k-d[1]*S,d[0]*S+d[1]*k]}let E=[_?d[0]:Nn(u,d[0],this.transform.zoom),_?d[1]:Nn(u,d[1],this.transform.zoom),0],D=new Float32Array(16);return o.translate(D,n,E),D}saveTileTexture(n){let u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){let u=this._tileTextures[n];return u&&u.length>0?u.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;let u=this.imageManager.getPattern(n.from.toString()),d=this.imageManager.getPattern(n.to.toString());return!u||!d}useProgram(n,u){this.cache=this.cache||{};let d=n+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new bh(this.context,n,oa[n],u,zc[n],this._showOverdrawInspector,this.style.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new le(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ml{constructor(n,u){this.points=n,this.planes=u}static fromInvProjectionMatrix(n,u,d){let m=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{let D=1/(E=o.transformMat4([],E,n))[3]/u*m;return o.mul$1(E,E,[D,D,1/E[3],D])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{let D=o.sub([],_[E[0]],_[E[1]]),S=o.sub([],_[E[2]],_[E[1]]),k=o.normalize([],o.cross([],D,S)),R=-o.dot(k,_[E[1]]);return k.concat(R)});return new Ml(_,b)}}class ya{constructor(n,u){this.min=n,this.max=u,this.center=o.scale$1([],o.add([],this.min,this.max),.5)}quadrant(n){let u=[n%2==0,n<2],d=o.clone$2(this.min),m=o.clone$2(this.max);for(let _=0;_<u.length;_++)d[_]=u[_]?this.min[_]:this.center[_],m[_]=u[_]?this.center[_]:this.max[_];return m[2]=this.max[2],new ya(d,m)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersects(n){let u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],d=!0;for(let m=0;m<n.planes.length;m++){let _=n.planes[m],b=0;for(let E=0;E<u.length;E++)o.dot$1(_,u[E])>=0&&b++;if(0===b)return 0;b!==u.length&&(d=!1)}if(d)return 2;for(let m=0;m<3;m++){let _=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let E=0;E<n.points.length;E++){let D=n.points[E][m]-this.min[m];_=Math.min(_,D),b=Math.max(b,D)}if(b<0||_>this.max[m]-this.min[m])return 0}return 1}}class ks{constructor(n=0,u=0,d=0,m=0){if(isNaN(n)||n<0||isNaN(u)||u<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=d,this.right=m}interpolate(n,u,d){return null!=u.top&&null!=n.top&&(this.top=o.number(n.top,u.top,d)),null!=u.bottom&&null!=n.bottom&&(this.bottom=o.number(n.bottom,u.bottom,d)),null!=u.left&&null!=n.left&&(this.left=o.number(n.left,u.left,d)),null!=u.right&&null!=n.right&&(this.right=o.number(n.right,u.right,d)),this}getCenter(n,u){let d=o.clamp((this.left+n-this.right)/2,0,n),m=o.clamp((this.top+u-this.bottom)/2,0,u);return new o.pointGeometry(d,m)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new ks(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class _a{constructor(n,u,d,m,_){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=void 0===_||!!_,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=d??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ks,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){let n=new _a(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n._elevation=this._elevation,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(n){let u=-o.wrap(n,-180,180)*Math.PI/180;var d,m,_,b,E,D,S,k,R,z;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(d=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),m=this.rotationMatrix,b=this.angle,E=(_=this.rotationMatrix)[0],D=_[1],S=_[2],k=_[3],R=Math.sin(b),z=Math.cos(b),m[0]=E*z+S*R,m[1]=D*z+k*R,m[2]=E*-R+S*z,m[3]=D*-R+k*z)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){let u=o.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(n){let u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,u,d){this._unmodified=!1,this._edgeInsets.interpolate(n,u,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){let u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(n){let u=[new o.UnwrappedTileID(0,n)];if(this._renderWorldCopies){let d=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new o.pointGeometry(0,this.height)),E=Math.floor(Math.min(d.x,m.x,_.x,b.x)),D=Math.floor(Math.max(d.x,m.x,_.x,b.x)),S=1;for(let k=E-S;k<=D+S;k++)0!==k&&u.push(new o.UnwrappedTileID(k,n))}return u}coveringTiles(n){var u,d;let m=this.coveringZoomLevel(n),_=m;if(void 0!==n.minzoom&&m<n.minzoom)return[];void 0!==n.maxzoom&&m>n.maxzoom&&(m=n.maxzoom);let b=this.pointCoordinate(this.getCameraPoint()),E=o.MercatorCoordinate.fromLngLat(this.center),D=Math.pow(2,m),S=[D*b.x,D*b.y,0],k=[D*E.x,D*E.y,0],R=Ml.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m),z=n.minzoom||0;!n.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(z=m);let q=n.terrain?2/Math.min(this.tileSize,n.tileSize)*this.tileSize:3,H=W=>({aabb:new ya([W*D,0,0],[(W+1)*D,D,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),Z=[],ee=[],ie=m,ae=n.reparseOverscaled?_:m;if(this._renderWorldCopies)for(let W=1;W<=3;W++)Z.push(H(-W)),Z.push(H(W));for(Z.push(H(0));Z.length>0;){let W=Z.pop(),he=W.x,ce=W.y,ge=W.fullyVisible;if(!ge){let Ue=W.aabb.intersects(R);if(0===Ue)continue;ge=2===Ue}let ye=n.terrain?S:k,Me=W.aabb.distanceX(ye),me=W.aabb.distanceY(ye),ze=Math.max(Math.abs(Me),Math.abs(me));if(W.zoom===ie||ze>q+(1<<ie-W.zoom)-2&&W.zoom>=z){let Ue=ie-W.zoom,gt=S[0]-.5-(he<<Ue),xt=S[1]-.5-(ce<<Ue);ee.push({tileID:new o.OverscaledTileID(W.zoom===ie?ae:W.zoom,W.wrap,W.zoom,he,ce),distanceSq:o.sqrLen([k[0]-.5-he,k[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(gt*gt+xt*xt)})}else for(let Ue=0;Ue<4;Ue++){let gt=(he<<1)+Ue%2,xt=(ce<<1)+(Ue>>1),et=W.zoom+1,Wt=W.aabb.quadrant(Ue);if(n.terrain){let Yt=new o.OverscaledTileID(et,W.wrap,et,gt,xt),Lt=n.terrain.getMinMaxElevation(Yt),Bt=null!==(u=Lt.minElevation)&&void 0!==u?u:this.elevation,Qt=null!==(d=Lt.maxElevation)&&void 0!==d?d:this.elevation;Wt=new ya([Wt.min[0],Wt.min[1],Bt],[Wt.max[0],Wt.max[1],Qt])}Z.push({aabb:Wt,zoom:et,x:gt,y:xt,wrap:W.wrap,fullyVisible:ge})}}return ee.sort((W,he)=>W.distanceSq-he.distanceSq).map(W=>W.tileID)}resize(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){let u=o.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.pointGeometry(o.mercatorXfromLng(n.lng)*this.worldSize,o.mercatorYfromLat(u)*this.worldSize)}unproject(n){return new o.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(n){this.freezeElevation||(this.elevation=n?this.getElevation(this._center,n):0)}getElevation(n,u){let d=o.MercatorCoordinate.fromLngLat(n),m=(1<<this.tileZoom)*o.EXTENT,_=d.x*m,b=d.y*m,E=Math.floor(_/o.EXTENT),D=Math.floor(b/o.EXTENT),S=new o.OverscaledTileID(this.tileZoom,0,this.tileZoom,E,D);return u.getElevation(S,_%o.EXTENT,b%o.EXTENT,o.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(n){let u=this.pointLocation(this.centerPoint,n),d=this.getElevation(u,n);if(!(this.elevation-d))return;let m=this.getCameraPosition(),_=o.MercatorCoordinate.fromLngLat(m.lngLat,m.altitude),b=o.MercatorCoordinate.fromLngLat(u,d),E=_.x-b.x,D=_.y-b.y,S=_.z-b.z,k=Math.sqrt(E*E+D*D+S*S),R=this.scaleZoom(this.cameraToCenterDistance/k/this.tileSize);this._elevation=d,this._center=u,this.zoom=R}setLocationAtPoint(n,u){let d=this.pointCoordinate(u),m=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(n),b=new o.MercatorCoordinate(_.x-(d.x-m.x),_.y-(d.y-m.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(n,u){return u?this.coordinatePoint(this.locationCoordinate(n),this.getElevation(n,u),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(n))}pointLocation(n,u){return this.coordinateLocation(this.pointCoordinate(n,u))}locationCoordinate(n){return o.MercatorCoordinate.fromLngLat(n)}coordinateLocation(n){return n&&n.toLngLat()}pointCoordinate(n,u){if(u){let z=u.pointCoordinate(n);if(null!=z)return z}let d=[n.x,n.y,0,1],m=[n.x,n.y,1,1];o.transformMat4(d,d,this.pixelMatrixInverse),o.transformMat4(m,m,this.pixelMatrixInverse);let _=d[3],b=m[3],E=d[1]/_,D=m[1]/b,S=d[2]/_,k=m[2]/b,R=S===k?0:(0-S)/(k-S);return new o.MercatorCoordinate(o.number(d[0]/_,m[0]/b,R)/this.worldSize,o.number(E,D,R)/this.worldSize)}coordinatePoint(n,u=0,d=this.pixelMatrix){let m=[n.x*this.worldSize,n.y*this.worldSize,u,1];return o.transformMat4(m,m,d),new o.pointGeometry(m[0]/m[3],m[1]/m[3])}getBounds(){let n=Math.max(0,this.height/2-this.getHorizon());return(new o.LngLatBounds).extend(this.pointLocation(new o.pointGeometry(0,n))).extend(this.pointLocation(new o.pointGeometry(this.width,n))).extend(this.pointLocation(new o.pointGeometry(this.width,this.height))).extend(this.pointLocation(new o.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(n,u=!1){let d=n.key,m=u?this._alignedPosMatrixCache:this._posMatrixCache;if(m[d])return m[d];let _=n.canonical,b=this.worldSize/this.zoomScale(_.z),E=_.x+Math.pow(2,_.z)*n.wrap,D=o.identity(new Float64Array(16));return o.translate(D,D,[E*b,_.y*b,0]),o.scale(D,D,[b/o.EXTENT,b/o.EXTENT,1]),o.multiply(D,u?this.alignedProjMatrix:this.projMatrix,D),m[d]=new Float32Array(D),m[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let n,u,d,m,_=-90,b=90,E=-180,D=180,S=this.size,k=this._unmodified;if(this.latRange){let q=this.latRange;_=o.mercatorYfromLat(q[1])*this.worldSize,b=o.mercatorYfromLat(q[0])*this.worldSize,n=b-_<S.y?S.y/(b-_):0}if(this.lngRange){let q=this.lngRange;E=o.wrap(o.mercatorXfromLng(q[0])*this.worldSize,0,this.worldSize),D=o.wrap(o.mercatorXfromLng(q[1])*this.worldSize,0,this.worldSize),D<E&&(D+=this.worldSize),u=D-E<S.x?S.x/(D-E):0}let R=this.point,z=Math.max(u||0,n||0);if(z)return this.center=this.unproject(new o.pointGeometry(u?(D+E)/2:R.x,n?(b+_)/2:R.y)),this.zoom+=this.scaleZoom(z),this._unmodified=k,void(this._constraining=!1);if(this.latRange){let q=R.y,H=S.y/2;q-H<_&&(m=_+H),q+H>b&&(m=b-H)}if(this.lngRange){let q=(E+D)/2,H=o.wrap(R.x,q-this.worldSize/2,q+this.worldSize/2),Z=S.x/2;H-Z<E&&(d=E+Z),H+Z>D&&(d=D-Z)}void 0===d&&void 0===m||(this.center=this.unproject(new o.pointGeometry(void 0!==d?d:R.x,void 0!==m?m:R.y)).wrap()),this._unmodified=k,this._constraining=!1}_calcMatrices(){if(!this.height)return;let n=this.centerOffset,u=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let m=o.identity(new Float64Array(16));o.scale(m,m,[this.width/2,-this.height/2,1]),o.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=o.identity(new Float64Array(16)),o.scale(m,m,[1,-1,1]),o.translate(m,m,[-1,-1,0]),o.scale(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);let _=Math.PI/2+this._pitch,b=this._fov*(.5+n.y/this.height),E=Math.sin(b)*this.cameraToSeaLevelDistance/Math.sin(o.clamp(Math.PI-_-b,.01,Math.PI-.01)),D=this.getHorizon(),S=2*Math.atan(D/this.cameraToCenterDistance)*(.5+n.y/(2*D)),k=Math.sin(S)*this.cameraToSeaLevelDistance/Math.sin(o.clamp(Math.PI-_-S,.01,Math.PI-.01)),R=Math.cos(Math.PI/2-this._pitch)*E+this.cameraToSeaLevelDistance,z=Math.cos(Math.PI/2-this._pitch)*k+this.cameraToSeaLevelDistance,q=1.01*Math.min(R,z),H=this.height/50;m=new Float64Array(16),o.perspective(m,this._fov,this.width/this.height,H,q),m[8]=2*-n.x/this.width,m[9]=2*n.y/this.height,o.scale(m,m,[1,-1,1]),o.translate(m,m,[0,0,-this.cameraToCenterDistance]),o.rotateX(m,m,this._pitch),o.rotateZ(m,m,this.angle),o.translate(m,m,[-u,-d,0]),this.mercatorMatrix=o.scale([],m,[this.worldSize,this.worldSize,this.worldSize]),o.scale(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,m),o.translate(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=o.invert([],m),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,m);let Z=this.width%2/2,ee=this.height%2/2,ie=Math.cos(this.angle),ae=Math.sin(this.angle),W=u-Math.round(u)+ie*Z+ae*ee,he=d-Math.round(d)+ie*ee+ae*Z,ce=new Float64Array(m);if(o.translate(ce,ce,[W>.5?W-1:W,he>.5?he-1:he,0]),this.alignedProjMatrix=ce,m=o.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let n=this.pointCoordinate(new o.pointGeometry(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return o.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,n))}getCameraQueryGeometry(n){let u=this.getCameraPoint();if(1===n.length)return[n[0],u];{let d=u.x,m=u.y,_=u.x,b=u.y;for(let E of n)d=Math.min(d,E.x),m=Math.min(m,E.y),_=Math.max(_,E.x),b=Math.max(b,E.y);return[new o.pointGeometry(d,m),new o.pointGeometry(_,m),new o.pointGeometry(_,b),new o.pointGeometry(d,b),new o.pointGeometry(d,m)]}}}class $h{constructor(n){this._hashName=n&&encodeURIComponent(n),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(u,d){let m=!1,_=null,b=()=>{_=null,m&&(u(),_=setTimeout(b,300),m=!1)};return()=>(m=!0,_||b(),_)}(this._updateHashUnthrottled.bind(this))}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){let u=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),b=Math.round(u.lng*_)/_,E=Math.round(u.lat*_)/_,D=this._map.getBearing(),S=this._map.getPitch(),k="";if(k+=n?`/${b}/${E}/${d}`:`${d}/${E}/${b}`,(D||S)&&(k+="/"+Math.round(10*D)/10),S&&(k+=`/${Math.round(S)}`),this._hashName){let R=this._hashName,z=!1,q=window.location.hash.slice(1).split("&").map(H=>{let Z=H.split("=")[0];return Z===R?(z=!0,`${Z}=${k}`):H}).filter(H=>H);return z||q.push(`${R}=${k}`),`#${q.join("&")}`}return`#${k}`}_getCurrentHash(){let n=window.location.hash.replace("#","");if(this._hashName){let u;return n.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(u=d)}),(u&&u[1]||"").split("/")}return n.split("/")}_onHashChange(){let n=this._getCurrentHash();if(n.length>=3&&!n.some(u=>isNaN(u))){let u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){let n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}}}let va={linearity:.3,easing:o.bezier(0,0,.3,1)},Hh=o.extend({deceleration:2500,maxSpeed:1400},va),Gh=o.extend({deceleration:20,maxSpeed:1400},va),Zh=o.extend({deceleration:1e3,maxSpeed:360},va),Ls=o.extend({deceleration:1e3,maxSpeed:90},va);class qh{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:n})}_drainInertiaBuffer(){let n=this._inertiaBuffer,u=o.exported.now();for(;n.length>0&&u-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let u={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(let{settings:_}of this._inertiaBuffer)u.zoom+=_.zoomDelta||0,u.bearing+=_.bearingDelta||0,u.pitch+=_.pitchDelta||0,_.panDelta&&u.pan._add(_.panDelta),_.around&&(u.around=_.around),_.pinchAround&&(u.pinchAround=_.pinchAround);let d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(u.pan.mag()){let _=ba(u.pan.mag(),d,o.extend({},Hh,n||{}));m.offset=u.pan.mult(_.amount/u.pan.mag()),m.center=this._map.transform.center,xa(m,_)}if(u.zoom){let _=ba(u.zoom,d,Gh);m.zoom=this._map.transform.zoom+_.amount,xa(m,_)}if(u.bearing){let _=ba(u.bearing,d,Zh);m.bearing=this._map.transform.bearing+o.clamp(_.amount,-179,179),xa(m,_)}if(u.pitch){let _=ba(u.pitch,d,Ls);m.pitch=this._map.transform.pitch+_.amount,xa(m,_)}if(m.zoom||m.bearing){let _=void 0===u.pinchAround?u.around:u.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),o.extend(m,{noMoveStart:!0})}}function xa(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function ba(p,n,u){let{maxSpeed:d,linearity:m,deceleration:_}=u,b=o.clamp(p*m/(n/1e3),-d,d),E=Math.abs(b)/(_*m);return{easing:u.easing,duration:1e3*E,amount:b*(E/2)}}class Fi extends o.Event{constructor(n,u,d,m={}){let _=L.mousePos(u.getCanvasContainer(),d),b=u.unproject(_);super(n,o.extend({point:_,lngLat:b,originalEvent:d},m)),this._defaultPrevented=!1,this.target=u}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class wa extends o.Event{constructor(n,u,d){let m="touchend"===n?d.changedTouches:d.touches,_=L.touchPos(u.getCanvasContainer(),m),b=_.map(D=>u.unproject(D)),E=_.reduce((D,S,k,R)=>D.add(S.div(R.length)),new o.pointGeometry(0,0));super(n,{points:_,point:E,lngLats:b,lngLat:u.unproject(E),originalEvent:d}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class zi extends o.Event{constructor(n,u,d){super(n,{originalEvent:d}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class _m{constructor(n,u){this._map=n,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new zi(n.type,this._map,n))}mousedown(n,u){return this._mousedownPos=u,this._firePreventable(new Fi(n.type,this._map,n))}mouseup(n){this._map.fire(new Fi(n.type,this._map,n))}click(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Fi(n.type,this._map,n))}dblclick(n){return this._firePreventable(new Fi(n.type,this._map,n))}mouseover(n){this._map.fire(new Fi(n.type,this._map,n))}mouseout(n){this._map.fire(new Fi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new wa(n.type,this._map,n))}touchmove(n){this._map.fire(new wa(n.type,this._map,n))}touchend(n){this._map.fire(new wa(n.type,this._map,n))}touchcancel(n){this._map.fire(new wa(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yo{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new Fi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new Fi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wh{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,u){this.isEnabled()&&n.shiftKey&&0===n.button&&(L.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(n,u){if(!this._active)return;let d=u;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;let m=this._startPos;this._lastPos=d,this._box||(this._box=L.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));let _=Math.min(m.x,d.x),b=Math.max(m.x,d.x),E=Math.min(m.y,d.y),D=Math.max(m.y,d.y);L.setTransform(this._box,`translate(${_}px,${E}px)`),this._box.style.width=b-_+"px",this._box.style.height=D-E+"px"}mouseupWindow(n,u){if(!this._active||0!==n.button)return;let d=this._startPos,m=u;if(this.reset(),L.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:_=>_.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,u){return this._map.fire(new o.Event(n,{originalEvent:u}))}}function zr(p,n){if(p.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${n.length}`);let u={};for(let d=0;d<p.length;d++)u[p[d].identifier]=n[d];return u}class Ma{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,u,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){let _=new o.pointGeometry(0,0);for(let b of m)_._add(b);return _.div(m.length)}(u),this.touches=zr(d,u)))}touchmove(n,u,d){if(this.aborted||!this.centroid)return;let m=zr(d,u);for(let _ in this.touches){let E=m[_];(!E||E.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(n,u,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===d.length){let m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Jc{constructor(n){this.singleTap=new Ma(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,u,d){this.singleTap.touchstart(n,u,d)}touchmove(n,u,d){this.singleTap.touchmove(n,u,d)}touchend(n,u,d){let m=this.singleTap.touchend(n,u,d);if(m){let _=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(_&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class vm{constructor(){this._zoomIn=new Jc({numTouches:1,numTaps:2}),this._zoomOut=new Jc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,u,d){this._zoomIn.touchstart(n,u,d),this._zoomOut.touchstart(n,u,d)}touchmove(n,u,d){this._zoomIn.touchmove(n,u,d),this._zoomOut.touchmove(n,u,d)}touchend(n,u,d){let m=this._zoomIn.touchend(n,u,d),_=this._zoomOut.touchend(n,u,d);return m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(m)},{originalEvent:n})}):_?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(_)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let xm={0:1,2:2};class El{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,u){return!1}_move(n,u){return{}}mousedown(n,u){if(this._lastPoint)return;let d=L.mouseButton(n);this._correctButton(n,d)&&(this._lastPoint=u,this._eventButton=d)}mousemoveWindow(n,u){let d=this._lastPoint;if(d)if(n.preventDefault(),function(m,_){let b=xm[_];return void 0===m.buttons||(m.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(d,u)}mouseupWindow(n){this._lastPoint&&L.mouseButton(n)===this._eventButton&&(this._moved&&L.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ea extends El{mousedown(n,u){super.mousedown(n,u),this._lastPoint&&(this._active=!0)}_correctButton(n,u){return 0===u&&!n.ctrlKey}_move(n,u){return{around:u,panDelta:u.sub(n)}}}class Br extends El{_correctButton(n,u){return 0===u&&n.ctrlKey||2===u}_move(n,u){let d=.8*(u.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){n.preventDefault()}}class $e extends El{_correctButton(n,u){return 0===u&&n.ctrlKey||2===u}_move(n,u){let d=-.5*(u.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){n.preventDefault()}}class Yh{constructor(n,u){this._minTouches=n.cooperativeGestures?2:1,this._clickTolerance=n.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(n,u,d){return this._calculateTransform(n,u,d)}touchmove(n,u,d){if(this._map._cooperativeGestures&&(2===this._minTouches&&d.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(n,!1,d.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(d.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,u,d)}touchend(n,u,d){this._calculateTransform(n,u,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,u,d){d.length>0&&(this._active=!0);let m=zr(d,u),_=new o.pointGeometry(0,0),b=new o.pointGeometry(0,0),E=0;for(let S in m){let k=m[S],R=this._touches[S];R&&(_._add(k),b._add(k.sub(R)),E++,m[S]=k)}if(this._touches=m,E<this._minTouches||!b.mag())return;let D=b.div(E);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(E),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,u,d){return{}}touchstart(n,u,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([u[0],u[1]]))}touchmove(n,u,d){if(!this._firstTwoTouches)return;n.preventDefault();let[m,_]=this._firstTwoTouches,b=_o(d,u,m),E=_o(d,u,_);if(!b||!E)return;let D=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],D,n)}touchend(n,u,d){if(!this._firstTwoTouches)return;let[m,_]=this._firstTwoTouches,b=_o(d,u,m),E=_o(d,u,_);b&&E||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _o(p,n,u){for(let d=0;d<p.length;d++)if(p[d].identifier===u)return n[d]}function eu(p,n){return Math.log(p/n)/Math.LN2}class Oe extends Zo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,u){let d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(eu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:eu(this._distance,d),pinchAround:u}}}function Il(p,n){return 180*p.angleWith(n)/Math.PI}class bm extends Zo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,u){let d=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Il(this._vector,d),pinchAround:u}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());let u=25/(Math.PI*this._minDiameter)*360,d=Il(n,this._startVector);return Math.abs(d)<u}}function tu(p){return Math.abs(p.y)>Math.abs(p.x)}class nu extends Zo{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,u,d){super.touchstart(n,u,d),this._currentTouchCount=d.length}_start(n){this._lastPoints=n,tu(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,u,d){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let m=n[0].sub(this._lastPoints[0]),_=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,_,d.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(m.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(n,u,d){if(void 0!==this._valid)return this._valid;let m=n.mag()>=2,_=u.mag()>=2;if(!m&&!_)return;if(!m||!_)return void 0===this._firstMove&&(this._firstMove=d),d-this._firstMove<100&&void 0;let b=n.y>0==u.y>0;return tu(n)&&tu(u)&&b}}let Kh={panStep:100,bearingStep:15,pitchStep:10};class Qh{constructor(){let n=Kh;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let u=0,d=0,m=0,_=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),_=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),_=1);break;case 38:n.shiftKey?m=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?m=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:E=>{let D=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:wm,zoom:u?Math.round(D)+u*(n.shiftKey?2:1):D,bearing:E.getBearing()+d*this._bearingStep,pitch:E.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:E.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wm(p){return p*(2-p)}let Xh=4.000244140625;class iu{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&"center"===n.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;n.preventDefault()}let u=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,d=o.exported.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,0!==u&&u%Xh==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(m*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=L.mousePos(this._el,n);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let n=this._map.transform;if(0!==this._delta){let E="wheel"===this._type&&Math.abs(this._delta)>Xh?this._wheelZoomRate:this._defaultZoomRate,D=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&0!==D&&(D=1/D);let S="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(S*D))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let _,u="number"==typeof this._targetZoom?this._targetZoom:n.zoom,d=this._startZoom,m=this._easing,b=!1;if("wheel"===this._type&&d&&m){let E=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),D=m(E);_=o.number(d,u,D),E<1?this._frameId||(this._frameId=!0):b=!0}else _=u,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:_-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let u=o.ease;if(this._prevEase){let d=this._prevEase,m=(o.exported.now()-d.start)/d.duration,_=d.easing(m+.01)-d.easing(m),b=.27/Math.sqrt(_*_+1e-4)*.01,E=Math.sqrt(.0729-b*b);u=o.bezier(b,E,.25,1)}return this._prevEase={start:o.exported.now(),duration:n,easing:u},u}reset(){this._active=!1}}class ru{constructor(n,u){this._clickZoom=n,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ou{constructor(){this.reset()}reset(){this._active=!1}dblclick(n,u){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(u)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class su{constructor(){this._tap=new Jc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,u,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=u[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,u,d))}touchmove(n,u,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;let m=u[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,n.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(n,u,d)}touchend(n,u,d){this._tapTime?this._swipePoint&&0===d.length&&this.reset():this._tap.touchend(n,u,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Di{constructor(n,u,d){this._el=n,this._mousePan=u,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vo{constructor(n,u,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jh{constructor(n,u,d,m){this._el=n,this._touchZoom=u,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Os=p=>p.zoom||p.drag||p.pitch||p.rotate;class au extends o.Event{}function Ia(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ed{constructor(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qh(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),o.bindAll(["handleEvent","handleWindowEvent"],this);let d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(let[m,_,b]of this._listeners)L.addEventListener(m,_,m===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(let[n,u,d]of this._listeners)L.removeEventListener(n,u,n===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(n){let u=this._map,d=u.getCanvasContainer();this._add("mapEvent",new _m(u,n));let m=u.boxZoom=new Wh(u,n);this._add("boxZoom",m);let _=new vm,b=new ou;u.doubleClickZoom=new ru(b,_),this._add("tapZoom",_),this._add("clickZoom",b);let E=new su;this._add("tapDragZoom",E);let D=u.touchPitch=new nu(u);this._add("touchPitch",D);let S=new Br(n),k=new $e(n);u.dragRotate=new vo(n,S,k),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);let R=new Ea(n),z=new Yh(n,u);u.dragPan=new Di(d,R,z),this._add("mousePan",R),this._add("touchPan",z,["touchZoom","touchRotate"]);let q=new bm,H=new Oe;u.touchZoomRotate=new Jh(d,H,q,E),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]);let Z=u.scrollZoom=new iu(u,this);this._add("scrollZoom",Z,["mousePan"]);let ee=u.keyboard=new Qh;this._add("keyboard",ee),this._add("blockableMapEvent",new yo(u));for(let ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ie]&&u[ie].enable(n[ie])}_add(n,u,d){this._handlers.push({handlerName:n,handler:u,allowed:d}),this._handlersById[n]=u}stop(n){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(let{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Os(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,u,d){for(let m in n)if(m!==d&&(!u||u.indexOf(m)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){let u=[];for(let d of n)this._el.contains(d.target)&&u.push(d);return u}handleEvent(n,u){if("blur"===n.type)return void this.stop(!0);this._updatingCamera=!0;let d="renderFrame"===n.type?void 0:n,m={needsRenderFrame:!1},_={},b={},E=n.touches,D=E?this._getMapTouches(E):void 0,S=D?L.touchPos(this._el,D):L.mousePos(this._el,n);for(let{handlerName:z,handler:q,allowed:H}of this._handlers){if(!q.isEnabled())continue;let Z;this._blockedByActive(b,H,z)?q.reset():q[u||n.type]&&(Z=q[u||n.type](n,S,D),this.mergeHandlerResult(m,_,Z,z,d),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||q.isActive())&&(b[z]=q)}let k={};for(let z in this._previousActiveHandlers)b[z]||(k[z]=d);this._previousActiveHandlers=b,(Object.keys(k).length||Ia(m))&&(this._changes.push([m,_,k]),this._triggerRenderFrame()),(Object.keys(b).length||Ia(m))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:R}=m;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(n,u,d,m,_){if(!d)return;o.extend(n,d);let b={handlerName:m,originalEvent:d.originalEvent||_};void 0!==d.zoomDelta&&(u.zoom=b),void 0!==d.panDelta&&(u.drag=b),void 0!==d.pitchDelta&&(u.pitch=b),void 0!==d.bearingDelta&&(u.rotate=b)}_applyChanges(){let n={},u={},d={};for(let[m,_,b]of this._changes)m.panDelta&&(n.panDelta=(n.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),void 0!==m.around&&(n.around=m.around),void 0!==m.pinchAround&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),o.extend(u,_),o.extend(d,b);this._updateMapTransform(n,u,d),this._changes=[]}_updateMapTransform(n,u,d){let m=this._map,_=m.transform,b=m.style&&m.style.terrain;if(!(Ia(n)||b&&this._drag))return this._fireEvents(u,d,!0);let{panDelta:E,zoomDelta:D,bearingDelta:S,pitchDelta:k,around:R,pinchAround:z}=n;void 0!==z&&(R=z),m._stop(!0),R=R||m.transform.centerPoint;let q=_.pointLocation(E?R.sub(E):R);S&&(_.bearing+=S),k&&(_.pitch+=k),D&&(_.zoom+=D),b?u.drag&&!this._drag?(this._drag={center:_.centerPoint,lngLat:_.pointLocation(R),point:R,handlerName:u.drag.handlerName},m.fire(new o.Event("freezeElevation",{freeze:!0}))):this._drag&&d[this._drag.handlerName]?(m.fire(new o.Event("freezeElevation",{freeze:!1})),this._drag=null):u.drag&&this._drag&&(_.center=_.pointLocation(_.centerPoint.sub(E))):_.setLocationAtPoint(q,R),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,d,!0)}_fireEvents(n,u,d){let m=Os(this._eventsInProgress),_=Os(n),b={};for(let k in n){let{originalEvent:R}=n[k];this._eventsInProgress[k]||(b[`${k}start`]=R),this._eventsInProgress[k]=n[k]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(let k in b)this._fireEvent(k,b[k]);_&&this._fireEvent("move",_.originalEvent);for(let k in n){let{originalEvent:R}=n[k];this._fireEvent(k,R)}let D,E={};for(let k in this._eventsInProgress){let{handlerName:R,originalEvent:z}=this._eventsInProgress[k];this._handlersById[R].isActive()||(delete this._eventsInProgress[k],D=u[R]||z,E[`${k}end`]=D)}for(let k in E)this._fireEvent(k,E[k]);let S=Os(this._eventsInProgress);if(d&&(m||_)&&!S){this._updatingCamera=!0;let k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=z=>0!==z&&-this._bearingSnap<z&&z<this._bearingSnap;k?(R(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:D})):(this._map.fire(new o.Event("moveend",{originalEvent:D})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,u){this._map.fire(new o.Event(n,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new au("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}let Wi={extend:(p,...n)=>o.extend(p,...n),run(p){p()},logToElement(p,n=!1,u="log"){let d=window.document.getElementById(u);d&&(n&&(d.innerHTML=""),d.innerHTML+=`<br>${p}`)}};class _n extends o.Evented{constructor(n,u){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=u.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,u){return this.jumpTo({center:n},u)}panBy(n,u,d){return n=o.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,o.extend({offset:n},u),d)}panTo(n,u,d){return this.easeTo(o.extend({center:n},u),d)}getZoom(){return this.transform.zoom}setZoom(n,u){return this.jumpTo({zoom:n},u),this}zoomTo(n,u,d){return this.easeTo(o.extend({zoom:n},u),d)}zoomIn(n,u){return this.zoomTo(this.getZoom()+1,n,u),this}zoomOut(n,u){return this.zoomTo(this.getZoom()-1,n,u),this}getBearing(){return this.transform.bearing}setBearing(n,u){return this.jumpTo({bearing:n},u),this}getPadding(){return this.transform.padding}setPadding(n,u){return this.jumpTo({padding:n},u),this}rotateTo(n,u,d){return this.easeTo(o.extend({bearing:n},u),d)}resetNorth(n,u){return this.rotateTo(0,o.extend({duration:1e3},n),u),this}resetNorthPitch(n,u){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},n),u),this}snapToNorth(n,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,u):this}getPitch(){return this.transform.pitch}setPitch(n,u){return this.jumpTo({pitch:n},u),this}cameraForBounds(n,u){n=o.LngLatBounds.convert(n);let d=u&&u.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),d,u)}_cameraForBoxAndBearing(n,u,d,m){let _={top:0,bottom:0,right:0,left:0};if("number"==typeof(m=o.extend({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding){let ce=m.padding;m.padding={top:ce,bottom:ce,right:ce,left:ce}}m.padding=o.extend(_,m.padding);let b=this.transform,E=b.padding,D=b.project(o.LngLat.convert(n)),S=b.project(o.LngLat.convert(u)),k=D.rotate(-d*Math.PI/180),R=S.rotate(-d*Math.PI/180),z=new o.pointGeometry(Math.max(k.x,R.x),Math.max(k.y,R.y)),q=new o.pointGeometry(Math.min(k.x,R.x),Math.min(k.y,R.y)),H=z.sub(q),Z=(b.width-(E.left+E.right+m.padding.left+m.padding.right))/H.x,ee=(b.height-(E.top+E.bottom+m.padding.top+m.padding.bottom))/H.y;if(ee<0||Z<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let ie=Math.min(b.scaleZoom(b.scale*Math.min(Z,ee)),m.maxZoom),ae=o.pointGeometry.convert(m.offset),W=new o.pointGeometry((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(d*Math.PI/180),he=ae.add(W).mult(b.scale/b.zoomScale(ie));return{center:b.unproject(D.add(S).div(2).sub(he)),zoom:ie,bearing:d}}fitBounds(n,u,d){return this._fitInternal(this.cameraForBounds(n,u),u,d)}fitScreenCoordinates(n,u,d,m,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(n)),this.transform.pointLocation(o.pointGeometry.convert(u)),d,m),m,_)}_fitInternal(n,u,d){return n?(delete(u=o.extend(n,u)).padding,u.linear?this.easeTo(u,d):this.flyTo(u,d)):this}jumpTo(n,u){this.stop();let d=this.transform,m=!1,_=!1,b=!1;return"zoom"in n&&d.zoom!==+n.zoom&&(m=!0,d.zoom=+n.zoom),void 0!==n.center&&(d.center=o.LngLat.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(_=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(b=!0,d.pitch=+n.pitch),null==n.padding||d.isPaddingEqual(n.padding)||(d.padding=n.padding),this.fire(new o.Event("movestart",u)).fire(new o.Event("move",u)),m&&this.fire(new o.Event("zoomstart",u)).fire(new o.Event("zoom",u)).fire(new o.Event("zoomend",u)),_&&this.fire(new o.Event("rotatestart",u)).fire(new o.Event("rotate",u)).fire(new o.Event("rotateend",u)),b&&this.fire(new o.Event("pitchstart",u)).fire(new o.Event("pitch",u)).fire(new o.Event("pitchend",u)),this.fire(new o.Event("moveend",u))}calculateCameraOptionsFromTo(n,u,d,m=0){let _=o.MercatorCoordinate.fromLngLat(n,u),b=o.MercatorCoordinate.fromLngLat(d,m),E=b.x-_.x,D=b.y-_.y,S=b.z-_.z,k=Math.hypot(E,D,S);if(0===k)throw new Error("Can't calculate camera options with same From and To");let R=Math.hypot(E,D),z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/k/this.transform.tileSize),q=180*Math.atan2(E,-D)/Math.PI,H=180*Math.acos(R/k)/Math.PI;return H=S<0?90-H:90+H,{center:b.toLngLat(),zoom:z,pitch:H,bearing:q}}easeTo(n,u){this._stop(!1,n.easeId),(!1===(n=o.extend({offset:[0,0],duration:500,easing:o.ease},n)).animate||!n.essential&&o.exported.prefersReducedMotion)&&(n.duration=0);let d=this.transform,m=this.getZoom(),_=this.getBearing(),b=this.getPitch(),E=this.getPadding(),D="zoom"in n?+n.zoom:m,S="bearing"in n?this._normalizeBearing(n.bearing,_):_,k="pitch"in n?+n.pitch:b,R="padding"in n?n.padding:d.padding,z=o.pointGeometry.convert(n.offset),q=d.centerPoint.add(z),H=d.pointLocation(q),Z=o.LngLat.convert(n.center||H);this._normalizeCenter(Z);let W,he,ee=d.project(H),ie=d.project(Z).sub(ee),ae=d.zoomScale(D-m);n.around&&(W=o.LngLat.convert(n.around),he=d.locationPoint(W));let ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||D!==m,this._rotating=this._rotating||_!==S,this._pitching=this._pitching||k!==b,this._padding=!d.isPaddingEqual(R),this._easeId=n.easeId,this._prepareEase(u,n.noMoveStart,ce),this._ease(ge=>{if(this._zooming&&(d.zoom=o.number(m,D,ge)),this._rotating&&(d.bearing=o.number(_,S,ge)),this._pitching&&(d.pitch=o.number(b,k,ge)),this._padding&&(d.interpolatePadding(E,R,ge),q=d.centerPoint.add(z)),W)d.setLocationAtPoint(W,he);else{let ye=d.zoomScale(d.zoom-m),Me=D>m?Math.min(2,ae):Math.max(.5,ae),me=Math.pow(Me,1-ge),ze=d.unproject(ee.add(ie.mult(ge*me)).mult(ye));d.setLocationAtPoint(d.renderWorldCopies?ze.wrap():ze,q)}this._fireMoveEvents(u)},ge=>{this._afterEase(u,ge)},n),this}_prepareEase(n,u,d={}){this._moving=!0,this.fire(new o.Event("freezeElevation",{freeze:!0})),u||d.moving||this.fire(new o.Event("movestart",n)),this._zooming&&!d.zooming&&this.fire(new o.Event("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new o.Event("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new o.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.Event("move",n)),this._zooming&&this.fire(new o.Event("zoom",n)),this._rotating&&this.fire(new o.Event("rotate",n)),this._pitching&&this.fire(new o.Event("pitch",n))}_afterEase(n,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId,this.fire(new o.Event("freezeElevation",{freeze:!1}));let d=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new o.Event("zoomend",n)),m&&this.fire(new o.Event("rotateend",n)),_&&this.fire(new o.Event("pitchend",n)),this.fire(new o.Event("moveend",n))}flyTo(n,u){if(!n.essential&&o.exported.prefersReducedMotion){let et=o.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(et,u)}this.stop(),n=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},n);let d=this.transform,m=this.getZoom(),_=this.getBearing(),b=this.getPitch(),E=this.getPadding(),D="zoom"in n?o.clamp(+n.zoom,d.minZoom,d.maxZoom):m,S="bearing"in n?this._normalizeBearing(n.bearing,_):_,k="pitch"in n?+n.pitch:b,R="padding"in n?n.padding:d.padding,z=d.zoomScale(D-m),q=o.pointGeometry.convert(n.offset),H=d.centerPoint.add(q),Z=d.pointLocation(H),ee=o.LngLat.convert(n.center||Z);this._normalizeCenter(ee);let ie=d.project(Z),ae=d.project(ee).sub(ie),W=n.curve,he=Math.max(d.width,d.height),ce=he/z,ge=ae.mag();if("minZoom"in n){let et=o.clamp(Math.min(n.minZoom,m,D),d.minZoom,d.maxZoom),Wt=he/d.zoomScale(et-m);W=Math.sqrt(Wt/ge*2)}let ye=W*W;function Me(et){let Wt=(ce*ce-he*he+(et?-1:1)*ye*ye*ge*ge)/(2*(et?ce:he)*ye*ge);return Math.log(Math.sqrt(Wt*Wt+1)-Wt)}function me(et){return(Math.exp(et)-Math.exp(-et))/2}function ze(et){return(Math.exp(et)+Math.exp(-et))/2}let Se=Me(0),Ue=function(et){return ze(Se)/ze(Se+W*et)},gt=function(et){return he*((ze(Se)*(me(Wt=Se+W*et)/ze(Wt))-me(Se))/ye)/ge;var Wt},xt=(Me(1)-Se)/W;if(Math.abs(ge)<1e-6||!isFinite(xt)){if(Math.abs(he-ce)<1e-6)return this.easeTo(n,u);let et=ce<he?-1:1;xt=Math.abs(Math.log(ce/he))/W,gt=function(){return 0},Ue=function(Wt){return Math.exp(et*W*Wt)}}return n.duration="duration"in n?+n.duration:1e3*xt/("screenSpeed"in n?+n.screenSpeed/W:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=_!==S,this._pitching=k!==b,this._padding=!d.isPaddingEqual(R),this._prepareEase(u,!1),this._ease(et=>{let Wt=et*xt,Yt=1/Ue(Wt);d.zoom=1===et?D:m+d.scaleZoom(Yt),this._rotating&&(d.bearing=o.number(_,S,et)),this._pitching&&(d.pitch=o.number(b,k,et)),this._padding&&(d.interpolatePadding(E,R,et),H=d.centerPoint.add(q));let Lt=1===et?ee:d.unproject(ie.add(ae.mult(gt(Wt))).mult(Yt));d.setLocationAtPoint(d.renderWorldCopies?Lt.wrap():Lt,H),this._fireMoveEvents(u)},()=>this._afterEase(u),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,u)}if(!n){let d=this.handlers;d&&d.stop(!1)}return this}_ease(n,u,d){!1===d.animate||0===d.duration?(n(1),u()):(this._easeStart=o.exported.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let n=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,u){n=o.wrap(n,-180,180);let d=Math.abs(n-u);return Math.abs(n-360-u)<d&&(n-=360),Math.abs(n+360-u)<d&&(n+=360),n}_normalizeCenter(n){let u=this.transform;if(!u.renderWorldCopies||u.lngRange)return;let d=n.lng-u.center.lng;n.lng+=d>180?-360:d<-180?360:0}}class Da{constructor(n={}){this.options=n,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options&&this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,u){let d=this._map._getUIString(`AttributionControl.${u}`);n.title=d,n.setAttribute("aria-label",d)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType&&"terrain"!==n.type||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(m=>"string"!=typeof m?"":m)):"string"==typeof this.options.customAttribution&&n.push(this.options.customAttribution)),this._map.style.stylesheet){let m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}let u=this._map.style.sourceCaches;for(let m in u){let _=u[m];if(_.used||_.usedForTerrain){let b=_.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n=n.filter(m=>String(m).trim()),n.sort((m,_)=>m.length-_.length),n=n.filter((m,_)=>{for(let b=_+1;b<n.length;b++)if(n[b].indexOf(m)>=0)return!1;return!0});let d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Dl{constructor(n={}){this.options=n,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl mapboxgl-ctrl");let u=L.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){let n=this._container.children;if(n.length){let u=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&u.classList.add("maplibregl-compact","mapboxgl-compact"):u.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class td{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){let u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u}remove(n){let u=this._currentlyRunning,d=u?this._queue.concat(u):this._queue;for(let m of d)if(m.id===n)return void(m.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let u=this._currentlyRunning=this._queue;this._queue=[];for(let d of u)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}let nd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},id={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Mm={showCompass:!0,showZoom:!0,visualizePitch:!1};class br{constructor(n,u,d=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Br({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new $e({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),L.addEventListener(u,"mousedown",this.mousedown),L.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(u,"touchmove",this.touchmove),L.addEventListener(u,"touchend",this.touchend),L.addEventListener(u,"touchcancel",this.reset)}down(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),L.disableDrag()}move(n,u){let d=this.map,m=this.mouseRotate.mousemoveWindow(n,u);if(m&&m.bearingDelta&&d.setBearing(d.getBearing()+m.bearingDelta),this.mousePitch){let _=this.mousePitch.mousemoveWindow(n,u);_&&_.pitchDelta&&d.setPitch(d.getPitch()+_.pitchDelta)}}off(){let n=this.element;L.removeEventListener(n,"mousedown",this.mousedown),L.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(n,"touchmove",this.touchmove),L.removeEventListener(n,"touchend",this.touchend),L.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup)}mousedown(n){this.down(o.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),L.mousePos(this.element,n)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)}mousemove(n){this.move(n,L.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=L.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ca(p,n,u){if(p=new o.LngLat(p.lng,p.lat),n){let d=new o.LngLat(p.lng-360,p.lat),m=new o.LngLat(p.lng+360,p.lat),_=u.locationPoint(p).distSqr(n);u.locationPoint(d).distSqr(n)<_?p=d:u.locationPoint(m).distSqr(n)<_&&(p=m)}for(;Math.abs(p.lng-u.center.lng)>180;){let d=u.locationPoint(p);if(d.x>=0&&d.y>=0&&d.x<=u.width&&d.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}let Ye={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function it(p,n,u){let d=p.classList;for(let m in Ye)d.remove(`maplibregl-${u}-anchor-${m}`,`mapboxgl-${u}-anchor-${m}`);d.add(`maplibregl-${u}-anchor-${n}`,`mapboxgl-${u}-anchor-${n}`)}class Ns extends o.Evented{constructor(n,u){if(super(),(n instanceof HTMLElement||u)&&(n=o.extend({element:n},u)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=o.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div"),this._element.setAttribute("aria-label","Map marker");let d=L.createNS("http://www.w3.org/2000/svg","svg"),m=41,_=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${_}px`),d.setAttributeNS(null,"viewBox",`0 0 ${_} ${m}`);let b=L.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");let E=L.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");let D=L.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");let S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let ae of S){let W=L.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",ae.rx),W.setAttributeNS(null,"ry",ae.ry),D.appendChild(W)}let k=L.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);let R=L.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(R);let z=L.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");let q=L.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(q);let H=L.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");let Z=L.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");let ee=L.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");let ie=L.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),Z.appendChild(ee),Z.appendChild(ie),E.appendChild(D),E.appendChild(k),E.appendChild(z),E.appendChild(H),E.appendChild(Z),d.appendChild(E),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(d),this._offset=o.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),it(this._element,this._anchor,"marker"),this._popup=null}addTo(n){return this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){let m=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(n){let u=n.code,d=n.charCode||n.keyCode;"Space"!==u&&"Enter"!==u&&32!==d&&13!==d||this.togglePopup()}_onMapClick(n){let u=n.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let n=this._popup;return n?(n.isOpen()?n.remove():n.addTo(this._map),this):this}_update(n){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ca(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?u=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?d="rotateX(0deg)":"map"===this._pitchAlignment&&(d=`rotateX(${this._map.getPitch()}deg)`),n&&"moveend"!==n.type||(this._pos=this._pos.round()),L.setTransform(this._element,`${Ye[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${u}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{let m=this._map.unproject(this._pos),_=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*_?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(n){return this._offset=o.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){let u=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&"auto"!==n?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let xo,lu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ri=0,bo=!1,wr={maxWidth:100,unit:"metric"};function rd(p,n,u){let d=u&&u.maxWidth||100,m=p._container.clientHeight/2,_=p.unproject([0,m]),b=p.unproject([d,m]),E=_.distanceTo(b);if(u&&"imperial"===u.unit){let D=3.2808*E;D>5280?wo(n,d,D/5280,p._getUIString("ScaleControl.Miles")):wo(n,d,D,p._getUIString("ScaleControl.Feet"))}else u&&"nautical"===u.unit?wo(n,d,E/1852,p._getUIString("ScaleControl.NauticalMiles")):E>=1e3?wo(n,d,E/1e3,p._getUIString("ScaleControl.Kilometers")):wo(n,d,E,p._getUIString("ScaleControl.Meters"))}function wo(p,n,u,d){let m=function(_){let b=Math.pow(10,`${Math.floor(_)}`.length-1),E=_/b;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(D){let S=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*S)/S}(E),b*E}(u);p.style.width=n*(m/u)+"px",p.innerHTML=`${m}&nbsp;${d}`}let Sn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Rn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cu(p){if(p){if("number"==typeof p){let n=Math.round(Math.sqrt(.5*Math.pow(p,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,p),"top-left":new o.pointGeometry(n,n),"top-right":new o.pointGeometry(-n,n),bottom:new o.pointGeometry(0,-p),"bottom-left":new o.pointGeometry(n,-n),"bottom-right":new o.pointGeometry(-n,-n),left:new o.pointGeometry(p,0),right:new o.pointGeometry(-p,0)}}if(p instanceof o.pointGeometry||Array.isArray(p)){let n=o.pointGeometry.convert(p);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:o.pointGeometry.convert(p.center||[0,0]),top:o.pointGeometry.convert(p.top||[0,0]),"top-left":o.pointGeometry.convert(p["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(p["top-right"]||[0,0]),bottom:o.pointGeometry.convert(p.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(p["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(p["bottom-right"]||[0,0]),left:o.pointGeometry.convert(p.left||[0,0]),right:o.pointGeometry.convert(p.right||[0,0])}}return cu(new o.pointGeometry(0,0))}let qo={supported:y,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends _n{constructor(p){var n;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),null!=(p=o.extend({},id,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new _a(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._interactive=p.interactive,this._cooperativeGestures=p.cooperativeGestures,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new td,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},nd,p.locale),this._clickTolerance=p.clickTolerance,this._pixelRatio=null!==(n=p.pixelRatio)&&void 0!==n?n:devicePixelRatio,this._requestManager=new G(p.transformRequest),"string"==typeof p.container){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ed(this,p),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=p.hash&&new $h("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,o.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Da({customAttribution:p.customAttribution})),p.maplibreLogo&&this.addControl(new Dl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update("style"===u.dataType),this.fire(new o.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new o.Event(`${u.dataType}dataloading`,u))}),this.on("dataabort",u=>{this.fire(new o.Event("sourcedataabort",u))})}_getMapId(){return this._mapId}addControl(p,n){if(void 0===n&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=p.onAdd(this);this._controls.push(p);let d=this._controlPositions[n];return-1!==n.indexOf("bottom")?d.insertBefore(u,d.firstChild):d.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,n,u,d){return null==d&&this.style.terrain&&(d=this.transform.getElevation(u,this.style.terrain)),super.calculateCameraOptionsFromTo(p,n,u,d)}resize(p){let n=this._containerDimensions(),u=n[0],d=n[1];this._resizeCanvas(u,d,this.getPixelRatio()),this.transform.resize(u,d),this.painter.resize(u,d,this.getPixelRatio());let m=!this._moving;return m&&(this.stop(),this.fire(new o.Event("movestart",p)).fire(new o.Event("move",p))),this.fire(new o.Event("resize",p)),m&&this.fire(new o.Event("moveend",p)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(p){let[n,u]=this._containerDimensions();this._pixelRatio=p,this._resizeCanvas(n,u,p),this.painter.resize(n,u,p)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(o.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(o.LngLat.convert(p),this.style&&this.style.terrain)}unproject(p){return this.transform.pointLocation(o.pointGeometry.convert(p),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(p,n,u){if("mouseenter"===p||"mouseover"===p){let d=!1;return{layer:n,listener:u,delegates:{mousemove:_=>{let b=this.getLayer(n)?this.queryRenderedFeatures(_.point,{layers:[n]}):[];b.length?d||(d=!0,u.call(this,new Fi(p,this,_.originalEvent,{features:b}))):d=!1},mouseout:()=>{d=!1}}}}if("mouseleave"===p||"mouseout"===p){let d=!1;return{layer:n,listener:u,delegates:{mousemove:b=>{(this.getLayer(n)?this.queryRenderedFeatures(b.point,{layers:[n]}):[]).length?d=!0:d&&(d=!1,u.call(this,new Fi(p,this,b.originalEvent)))},mouseout:b=>{d&&(d=!1,u.call(this,new Fi(p,this,b.originalEvent)))}}}}{let d=m=>{let _=this.getLayer(n)?this.queryRenderedFeatures(m.point,{layers:[n]}):[];_.length&&(m.features=_,u.call(this,m),delete m.features)};return{layer:n,listener:u,delegates:{[p]:d}}}}on(p,n,u){if(void 0===u)return super.on(p,n);let d=this._createDelegatedListener(p,n,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(d);for(let m in d.delegates)this.on(m,d.delegates[m]);return this}once(p,n,u){if(void 0===u)return super.once(p,n);let d=this._createDelegatedListener(p,n,u);for(let m in d.delegates)this.once(m,d.delegates[m]);return this}off(p,n,u){return void 0===u?super.off(p,n):(this._delegatedListeners&&this._delegatedListeners[p]&&(d=>{let m=this._delegatedListeners[p];for(let _=0;_<m.length;_++){let b=m[_];if(b.layer===n&&b.listener===u){for(let E in b.delegates)this.off(E,b.delegates[E]);return m.splice(_,1),this}}})(),this)}queryRenderedFeatures(p,n){if(!this.style)return[];let u;if(void 0!==n||void 0===p||p instanceof o.pointGeometry||Array.isArray(p)||(n=p,p=void 0),n=n||{},(p=p||[[0,0],[this.transform.width,this.transform.height]])instanceof o.pointGeometry||"number"==typeof p[0])u=[o.pointGeometry.convert(p)];else{let d=o.pointGeometry.convert(p[0]),m=o.pointGeometry.convert(p[1]);u=[d,new o.pointGeometry(m.x,d.y),m,new o.pointGeometry(d.x,m.y),d]}return this.style.queryRenderedFeatures(u,n,this.transform)}querySourceFeatures(p,n){return this.style.querySourceFeatures(p,n)}setStyle(p,n){return!1!==(n=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(p,n))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){let n=this._locale[p];if(null==n)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){return this.style&&(this.style.setEventedParent(null),this.style._remove()),p?(this.style=new ai(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ai(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,n){if("string"==typeof p){let u=this._requestManager.transformRequest(p,o.ResourceType.Style);o.getJSON(u,(d,m)=>{d?this.fire(new o.ErrorEvent(d)):m&&this._updateDiff(m,n)})}else"object"==typeof p&&this._updateDiff(p,n)}_updateDiff(p,n){try{this.style.setState(p)&&this._update(!0)}catch(u){o.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(p,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(p,n){return this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)}isSourceLoaded(p){let n=this.style&&this.style.sourceCaches[p];if(void 0!==n)return n.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){return this.style.setTerrain(p),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){let p=this.style&&this.style.sourceCaches;for(let n in p){let u=p[n]._tiles;for(let d in u){let m=u[d];if("loaded"!==m.state&&"errored"!==m.state)return!1}}return!0}addSourceType(p,n,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,u)}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,n,{pixelRatio:u=1,sdf:d=!1,stretchX:m,stretchY:_,content:b}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||o.isImageBitmap(n)){let{width:E,height:D,data:S}=o.exported.getImageData(n);this.style.addImage(p,{data:new o.RGBAImage({width:E,height:D},S),pixelRatio:u,stretchX:m,stretchY:_,content:b,sdf:d,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:E,height:D,data:S}=n,k=n;this.style.addImage(p,{data:new o.RGBAImage({width:E,height:D},new Uint8Array(S)),pixelRatio:u,stretchX:m,stretchY:_,content:b,sdf:d,version:0,userImage:k}),k.onAdd&&k.onAdd(this,p)}}}updateImage(p,n){let u=this.style.getImage(p);if(!u)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let d=n instanceof HTMLImageElement||o.isImageBitmap(n)?o.exported.getImageData(n):n,{width:m,height:_,data:b}=d;if(void 0===m||void 0===_)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==u.data.width||_!==u.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));let E=!(n instanceof HTMLImageElement||o.isImageBitmap(n));u.data.replace(b,E),this.style.updateImage(p,u)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,n){o.getImage(this._requestManager.transformRequest(p,o.ResourceType.Image),n)}listImages(){return this.style.listImages()}addLayer(p,n){return this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)}moveLayer(p,n){return this.style.moveLayer(p,n),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,n,u){return this.style.setLayerZoomRange(p,n,u),this._update(!0)}setFilter(p,n,u={}){return this.style.setFilter(p,n,u),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,n,u,d={}){return this.style.setPaintProperty(p,n,u,d),this._update(!0)}getPaintProperty(p,n){return this.style.getPaintProperty(p,n)}setLayoutProperty(p,n,u,d={}){return this.style.setLayoutProperty(p,n,u,d),this._update(!0)}getLayoutProperty(p,n){return this.style.getLayoutProperty(p,n)}setLight(p,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,n),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,n){return this.style.setFeatureState(p,n),this._update()}removeFeatureState(p,n){return this.style.removeFeatureState(p,n),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,n=0;return this._container&&(p=this._container.clientWidth||400,n=this._container.clientHeight||300),[p,n]}_setupContainer(){let p=this._container;p.classList.add("maplibregl-map","mapboxgl-map");let n=this._canvasContainer=L.create("div","maplibregl-canvas-container mapboxgl-canvas-container",p);this._interactive&&n.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let u=this._containerDimensions();this._resizeCanvas(u[0],u[1],this.getPixelRatio());let d=this._controlContainer=L.create("div","maplibregl-control-container mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{m[_]=L.create("div",`maplibregl-ctrl-${_} mapboxgl-ctrl-${_}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){let p=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=L.create("div","maplibregl-cooperative-gesture-screen",p);let n="Control",u="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(u="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",n="Meta"),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${u}</div>\n            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>\n        `,document.addEventListener("keydown",d=>{d.key===n&&(this._metaPress=!0)}),document.addEventListener("keyup",d=>{d.key===n&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",d=>{this._onCooperativeGesture(d,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(p,n,u){this._canvas.width=u*p,this._canvas.height=u*n,this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_setupPainter(){let p=o.extend({},y.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);n?(this.painter=new Xc(n,this.transform),o.exported$1.testSupport(n)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(p,n,u){return!n&&u<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){let n,u=0,d=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,n),u=o.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let m=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let b=this.transform.zoom,E=o.exported.now();this.style.zoomHistory.update(b,E);let D=new o.EvaluationParameters(b,{now:E,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=D.crossFadingFactor();1===S&&S===this._crossFadingFactor||(m=!0,this._crossFadingFactor=S),this.style.update(D)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){let b=o.exported.now()-u;d.endQueryEXT(d.TIME_ELAPSED_EXT,n),setTimeout(()=>{let E=d.getQueryObjectEXT(n,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(n),this.fire(new o.Event("gpu-timing-frame",{cpuTime:b,gpuTime:E}))},50)}if(this.listens("gpu-timing-layer")){let b=this.painter.collectGpuTimers();setTimeout(()=>{let E=this.painter.queryGpuTimers(b);this.fire(new o.Event("gpu-timing-layer",{layerTimes:E}))},50)}let _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(let n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));let p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._cooperativeGestures&&L.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(p=>{o.PerformanceUtils.frame(p),this._frame=null,this._render(p)}))}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,n){o.setCacheLimits(p,n)}get version(){return"2.4.0"}},NavigationControl:class{constructor(p){this.options=o.extend({},Mm,p),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),L.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),L.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let p=this._map.getZoom(),n=p===this._map.getMaxZoom(),u=p===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){let p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=p}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new br(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,n){let u=L.create("button",p,this._container);return u.type="button",u.addEventListener("click",n),u}_setButtonTitle(p,n){let u=this._map._getUIString(`NavigationControl.${n}`);p.title=u,p.setAttribute("aria-label",u)}},GeolocateControl:class extends o.Evented{constructor(p){super(),this.options=o.extend({},lu,p),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(p){var n;return this._map=p,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==xo?n(xo):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(u=>{xo="denied"!==u.state,n(xo)}):(xo=!!window.navigator.geolocation,n(xo)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ri=0,bo=!1}_isOutOfMapMaxBounds(p){let n=this._map.getMaxBounds(),u=p.coords;return n&&(u.longitude<n.getWest()||u.longitude>n.getEast()||u.latitude<n.getSouth()||u.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",p)),this._finish()}}_updateCamera(p){let n=new o.LngLat(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,d=this._map.getBearing(),m=o.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(u),m,{geolocateSource:!0})}_updateMarker(p){if(p){let n=new o.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let p=this._map._container.clientHeight/2,n=this._map.unproject([0,p]),u=this._map.unproject([1,p]),d=n.distanceTo(u),m=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&bo)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{let n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ns(this._dotElement),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ns({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ri--,bo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ri++,ri>1?(p={maximumAge:6e5,timeout:0},bo=!0):(p=this.options.positionOptions,bo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Da,LogoControl:Dl,ScaleControl:class{constructor(p){this.options=o.extend({},wr,p),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){rd(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,rd(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){let p=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(p){this.options=p,o.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(p){return this._map=p,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends o.Evented{constructor(p){super(),this.options=o.extend(Object.create(Sn),p),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=o.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){let d,n=document.createDocumentFragment(),u=document.createElement("body");for(u.innerHTML=p;d=u.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(p){this._update(p.point)}_onMouseMove(p){this._update(p.point)}_onDrag(p){this._update(p.point)}_update(p){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=L.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(_=>this._container.classList.add(_)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ca(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!p))return;let n=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),u=this.options.anchor,d=cu(this.options.offset);if(!u){let E,_=this._container.offsetWidth,b=this._container.offsetHeight;E=n.y+d.bottom.y<b?["top"]:n.y>this._map.transform.height-b?["bottom"]:[],n.x<_/2?E.push("left"):n.x>this._map.transform.width-_/2&&E.push("right"),u=0===E.length?"bottom":E.join("-")}let m=n.add(d[u]).round();L.setTransform(this._container,`${Ye[u]} translate(${m.x}px,${m.y}px)`),it(this._container,u,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let p=this._container.querySelector(Rn);p&&p.focus()}_onClose(){this.remove()}},Marker:Ns,Style:ai,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:Et,GeoJSONSource:Zi,ImageSource:Xe,RasterDEMTileSource:st,RasterTileSource:Mi,VectorTileSource:Lr,VideoSource:Je,prewarm:function(){_s().acquire(Ii)},clearPrewarmedResources:function(){let p=ho;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(Ii),ho=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return ni.workerCount},set workerCount(p){ni.workerCount=p},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.clearTileCache(p)},workerUrl:"",addProtocol(p,n){o.config.REGISTERED_PROTOCOLS[p]=n},removeProtocol(p){delete o.config.REGISTERED_PROTOCOLS[p]}};return Wi.extend(qo,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),qo}),s},"object"==typeof Av&&typeof Pv<"u"?Pv.exports=e():"function"==typeof define&&define.amd?define(e):(i=typeof globalThis<"u"?globalThis:i||self).maplibregl=e()},()=>(e||i((e={exports:{}}).exports,e),e.exports)),cx=null,lg=1;function Hi(i){let e=cx;return cx=i,e}function iC(i){if((!hg(i)||i.dirty)&&(i.dirty||i.lastCleanEpoch!==lg)){if(!i.producerMustRecompute(i)&&!cg(i))return i.dirty=!1,void(i.lastCleanEpoch=lg);i.producerRecomputeValue(i),i.dirty=!1,i.lastCleanEpoch=lg}}function cg(i){Sd(i);for(let e=0;e<i.producerNode.length;e++){let s=i.producerNode[e],r=i.producerLastReadVersion[e];if(r!==s.version||(iC(s),r!==s.version))return!0}return!1}function ug(i,e){if(function(i){i.liveConsumerNode??(i.liveConsumerNode=[]),i.liveConsumerIndexOfThis??(i.liveConsumerIndexOfThis=[])}(i),Sd(i),1===i.liveConsumerNode.length)for(let r=0;r<i.producerNode.length;r++)ug(i.producerNode[r],i.producerIndexOfThis[r]);let s=i.liveConsumerNode.length-1;if(i.liveConsumerNode[e]=i.liveConsumerNode[s],i.liveConsumerIndexOfThis[e]=i.liveConsumerIndexOfThis[s],i.liveConsumerNode.length--,i.liveConsumerIndexOfThis.length--,e<i.liveConsumerNode.length){let r=i.liveConsumerIndexOfThis[e],c=i.liveConsumerNode[e];Sd(c),c.producerIndexOfThis[r]=e}}function hg(i){return i.consumerIsAlwaysLive||(i?.liveConsumerNode?.length??0)>0}function Sd(i){i.producerNode??(i.producerNode=[]),i.producerIndexOfThis??(i.producerIndexOfThis=[]),i.producerLastReadVersion??(i.producerLastReadVersion=[])}function Zt(i){return"function"==typeof i}function Td(i){let s=i(r=>{Error.call(r),r.stack=(new Error).stack});return s.prototype=Object.create(Error.prototype),s.prototype.constructor=s,s}var Ad=Td(i=>function(s){i(this),this.message=s?`${s.length} errors occurred during unsubscription:\n${s.map((r,c)=>`${c+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=s});function Oa(i,e){if(i){let s=i.indexOf(e);0<=s&&i.splice(s,1)}}var di=class{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:s}=this;if(s)if(this._parentage=null,Array.isArray(s))for(let o of s)o.remove(this);else s.remove(this);let{initialTeardown:r}=this;if(Zt(r))try{r()}catch(o){e=o instanceof Ad?o.errors:[o]}let{_finalizers:c}=this;if(c){this._finalizers=null;for(let o of c)try{mx(o)}catch(y){e=e??[],y instanceof Ad?e=[...e,...y.errors]:e.push(y)}}if(e)throw new Ad(e)}}add(e){var s;if(e&&e!==this)if(this.closed)mx(e);else{if(e instanceof di){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(s=this._finalizers)&&void 0!==s?s:[]).push(e)}}_hasParent(e){let{_parentage:s}=this;return s===e||Array.isArray(s)&&s.includes(e)}_addParent(e){let{_parentage:s}=this;this._parentage=Array.isArray(s)?(s.push(e),s):s?[s,e]:e}_removeParent(e){let{_parentage:s}=this;s===e?this._parentage=null:Array.isArray(s)&&Oa(s,e)}remove(e){let{_finalizers:s}=this;s&&Oa(s,e),e instanceof di&&e._removeParent(this)}};di.EMPTY=(()=>{let i=new di;return i.closed=!0,i})();var dg=di.EMPTY;function Pd(i){return i instanceof di||i&&"closed"in i&&Zt(i.remove)&&Zt(i.add)&&Zt(i.unsubscribe)}function mx(i){Zt(i)?i():i.unsubscribe()}var Gr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Bl={setTimeout(i,e,...s){let{delegate:r}=Bl;return r?.setTimeout?r.setTimeout(i,e,...s):setTimeout(i,e,...s)},clearTimeout(i){let{delegate:e}=Bl;return(e?.clearTimeout||clearTimeout)(i)},delegate:void 0};function kd(i){Bl.setTimeout(()=>{let{onUnhandledError:e}=Gr;if(!e)throw i;e(i)})}function Zr(){}var gx=(()=>pg("C",void 0,void 0))();function pg(i,e,s){return{kind:i,value:e,error:s}}var Na=null;function jl(i){if(Gr.useDeprecatedSynchronousErrorHandling){let e=!Na;if(e&&(Na={errorThrown:!1,error:null}),i(),e){let{errorThrown:s,error:r}=Na;if(Na=null,s)throw r}}else i()}var Ra=class extends di{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Pd(e)&&e.add(this)):this.destination=cC}static create(e,s,r){return new is(e,s,r)}next(e){this.isStopped?mg(function(i){return pg("N",i,void 0)}(e),this):this._next(e)}error(e){this.isStopped?mg(function(i){return pg("E",void 0,i)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?mg(gx,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},aC=Function.prototype.bind;function fg(i,e){return aC.call(i,e)}var gg=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:s}=this;if(s.next)try{s.next(e)}catch(r){Ld(r)}}error(e){let{partialObserver:s}=this;if(s.error)try{s.error(e)}catch(r){Ld(r)}else Ld(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(s){Ld(s)}}},is=class extends Ra{constructor(e,s,r){let c;if(super(),Zt(e)||!e)c={next:e??void 0,error:s??void 0,complete:r??void 0};else{let o;this&&Gr.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),c={next:e.next&&fg(e.next,o),error:e.error&&fg(e.error,o),complete:e.complete&&fg(e.complete,o)}):c=e}this.destination=new gg(c)}};function Ld(i){Gr.useDeprecatedSynchronousErrorHandling?function(i){Gr.useDeprecatedSynchronousErrorHandling&&Na&&(Na.errorThrown=!0,Na.error=i)}(i):kd(i)}function mg(i,e){let{onStoppedNotification:s}=Gr;s&&Bl.setTimeout(()=>s(i,e))}var cC={closed:!0,next:Zr,error:function(i){throw i},complete:Zr},Ul=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")();function Vl(i){return i}var In=(()=>{class i{constructor(s){s&&(this._subscribe=s)}lift(s){let r=new i;return r.source=this,r.operator=s,r}subscribe(s,r,c){let o=function(i){return i&&i instanceof Ra||function(i){return i&&Zt(i.next)&&Zt(i.error)&&Zt(i.complete)}(i)&&Pd(i)}(s)?s:new is(s,r,c);return jl(()=>{let{operator:y,source:x}=this;o.add(y?y.call(o,x):x?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(s){try{return this._subscribe(s)}catch(r){s.error(r)}}forEach(s,r){return new(r=bx(r))((c,o)=>{let y=new is({next:x=>{try{s(x)}catch(I){o(I),y.unsubscribe()}},error:o,complete:c});this.subscribe(y)})}_subscribe(s){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(s)}[Ul](){return this}pipe(...s){return function(i){return 0===i.length?Vl:1===i.length?i[0]:function(s){return i.reduce((r,c)=>c(r),s)}}(s)(this)}toPromise(s){return new(s=bx(s))((r,c)=>{let o;this.subscribe(y=>o=y,y=>c(y),()=>r(o))})}}return i.create=e=>new i(e),i})();function bx(i){var e;return null!==(e=i??Gr.Promise)&&void 0!==e?e:Promise}function Xt(i){return e=>{if(function(i){return Zt(i?.lift)}(e))return e.lift(function(s){try{return i(s,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function an(i,e,s,r,c){return new yg(i,e,s,r,c)}var yg=class extends Ra{constructor(e,s,r,c,o,y){super(e),this.onFinalize=o,this.shouldUnsubscribe=y,this._next=s?function(x){try{s(x)}catch(I){e.error(I)}}:super._next,this._error=c?function(x){try{c(x)}catch(I){e.error(I)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(x){e.error(x)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:s}=this;super.unsubscribe(),!s&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}},wx=Td(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}),Ct=(()=>{class i extends In{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(s){let r=new Od(this,this);return r.operator=s,r}_throwIfClosed(){if(this.closed)throw new wx}next(s){jl(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(s)}})}error(s){jl(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=s;let{observers:r}=this;for(;r.length;)r.shift().error(s)}})}complete(){jl(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:s}=this;for(;s.length;)s.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var s;return(null===(s=this.observers)||void 0===s?void 0:s.length)>0}_trySubscribe(s){return this._throwIfClosed(),super._trySubscribe(s)}_subscribe(s){return this._throwIfClosed(),this._checkFinalizedStatuses(s),this._innerSubscribe(s)}_innerSubscribe(s){let{hasError:r,isStopped:c,observers:o}=this;return r||c?dg:(this.currentObservers=null,o.push(s),new di(()=>{this.currentObservers=null,Oa(o,s)}))}_checkFinalizedStatuses(s){let{hasError:r,thrownError:c,isStopped:o}=this;r?s.error(c):o&&s.complete()}asObservable(){let s=new In;return s.source=this,s}}return i.create=(e,s)=>new Od(e,s),i})(),Od=class extends Ct{constructor(e,s){super(),this.destination=e,this.source=s}next(e){var s,r;null===(r=null===(s=this.destination)||void 0===s?void 0:s.next)||void 0===r||r.call(s,e)}error(e){var s,r;null===(r=null===(s=this.destination)||void 0===s?void 0:s.error)||void 0===r||r.call(s,e)}complete(){var e,s;null===(s=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===s||s.call(e)}_subscribe(e){var s,r;return null!==(r=null===(s=this.source)||void 0===s?void 0:s.subscribe(e))&&void 0!==r?r:dg}},rs=class extends Ct{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let s=super._subscribe(e);return!s.closed&&e.next(this._value),s}getValue(){let{hasError:e,thrownError:s,_value:r}=this;if(e)throw s;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}},Tu={now:()=>(Tu.delegate||Date).now(),delegate:void 0},Cr=class extends Ct{constructor(e=1/0,s=1/0,r=Tu){super(),this._bufferSize=e,this._windowTime=s,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=s===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,s)}next(e){let{isStopped:s,_buffer:r,_infiniteTimeWindow:c,_timestampProvider:o,_windowTime:y}=this;s||(r.push(e),!c&&r.push(o.now()+y)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();let s=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:c}=this,o=c.slice();for(let y=0;y<o.length&&!e.closed;y+=r?1:2)e.next(o[y]);return this._checkFinalizedStatuses(e),s}_trimBuffer(){let{_bufferSize:e,_timestampProvider:s,_buffer:r,_infiniteTimeWindow:c}=this,o=(c?1:2)*e;if(e<1/0&&o<r.length&&r.splice(0,r.length-o),!c){let y=s.now(),x=0;for(let I=1;I<r.length&&r[I]<=y;I+=2)x=I;x&&r.splice(0,x+1)}}},Nd=class extends di{constructor(e,s){super()}schedule(e,s=0){return this}},Au={setInterval(i,e,...s){let{delegate:r}=Au;return r?.setInterval?r.setInterval(i,e,...s):setInterval(i,e,...s)},clearInterval(i){let{delegate:e}=Au;return(e?.clearInterval||clearInterval)(i)},delegate:void 0},Rd=class extends Nd{constructor(e,s){super(e,s),this.scheduler=e,this.work=s,this.pending=!1}schedule(e,s=0){var r;if(this.closed)return this;this.state=e;let c=this.id,o=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(o,c,s)),this.pending=!0,this.delay=s,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(o,this.id,s),this}requestAsyncId(e,s,r=0){return Au.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,s,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return s;null!=s&&Au.clearInterval(s)}execute(e,s){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let r=this._execute(e,s);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,s){let c,r=!1;try{this.work(e)}catch(o){r=!0,c=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){let{id:e,scheduler:s}=this,{actions:r}=s;this.work=this.state=this.scheduler=null,this.pending=!1,Oa(r,this),null!=e&&(this.id=this.recycleAsyncId(s,e,null)),this.delay=null,super.unsubscribe()}}},Vs=class{constructor(e,s=Vs.now){this.schedulerActionCtor=e,this.now=s}schedule(e,s=0,r){return new this.schedulerActionCtor(this,e).schedule(r,s)}};Vs.now=Tu.now;var Fd=class extends Vs{constructor(e,s=Vs.now){super(e,s),this.actions=[],this._active=!1}flush(e){let r,{actions:s}=this;if(this._active)s.push(e);else{this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=s.shift());if(this._active=!1,r){for(;e=s.shift();)e.unsubscribe();throw r}}}},qr=new Fd(Rd),Mx=qr,zd=new In(i=>i.complete());function Bd(i){return i&&Zt(i.schedule)}function Ex(i){return i[i.length-1]}function $l(i){return Bd(Ex(i))?i.pop():void 0}function Fa(i){return this instanceof Fa?(this.v=i,this):new Fa(i)}function Tx(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,e=i[Symbol.asyncIterator];return e?e.call(i):(i=function(i){var e="function"==typeof Symbol&&Symbol.iterator,s=e&&i[e],r=0;if(s)return s.call(i);if(i&&"number"==typeof i.length)return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(i),s={},r("next"),r("throw"),r("return"),s[Symbol.asyncIterator]=function(){return this},s);function r(o){s[o]=i[o]&&function(y){return new Promise(function(x,I){!function(o,y,x,I){Promise.resolve(I).then(function(A){o({value:A,done:x})},y)}(x,I,(y=i[o](y)).done,y.value)})}}}var jd=i=>i&&"number"==typeof i.length&&"function"!=typeof i;function Ud(i){return Zt(i?.then)}function Vd(i){return Zt(i[Ul])}function $d(i){return Symbol.asyncIterator&&Zt(i?.[Symbol.asyncIterator])}function Hd(i){return new TypeError(`You provided ${null!==i&&"object"==typeof i?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function pC(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var Gd=pC();function Zd(i){return Zt(i?.[Gd])}function qd(i){return function(i,e,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,r=s.apply(i,e||[]),o=[];return c={},y("next"),y("throw"),y("return"),c[Symbol.asyncIterator]=function(){return this},c;function y(re){r[re]&&(c[re]=function(le){return new Promise(function(ve,Ie){o.push([re,le,ve,Ie])>1||x(re,le)})})}function x(re,le){try{!function(re){re.value instanceof Fa?Promise.resolve(re.value.v).then(A,L):G(o[0][2],re)}(r[re](le))}catch(ve){G(o[0][3],ve)}}function A(re){x("next",re)}function L(re){x("throw",re)}function G(re,le){re(le),o.shift(),o.length&&x(o[0][0],o[0][1])}}(this,arguments,function*(){let s=i.getReader();try{for(;;){let{value:r,done:c}=yield Fa(s.read());if(c)return yield Fa(void 0);yield yield Fa(r)}}finally{s.releaseLock()}})}function Wd(i){return Zt(i?.getReader)}function bn(i){if(i instanceof In)return i;if(null!=i){if(Vd(i))return function(i){return new In(e=>{let s=i[Ul]();if(Zt(s.subscribe))return s.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(i);if(jd(i))return function(i){return new In(e=>{for(let s=0;s<i.length&&!e.closed;s++)e.next(i[s]);e.complete()})}(i);if(Ud(i))return function(i){return new In(e=>{i.then(s=>{e.closed||(e.next(s),e.complete())},s=>e.error(s)).then(null,kd)})}(i);if($d(i))return Ax(i);if(Zd(i))return function(i){return new In(e=>{for(let s of i)if(e.next(s),e.closed)return;e.complete()})}(i);if(Wd(i))return function(i){return Ax(qd(i))}(i)}throw Hd(i)}function Ax(i){return new In(e=>{(function(i,e){var s,r,c,o;return function(i,e,s,r){return new(s||(s=Promise))(function(o,y){function x(L){try{A(r.next(L))}catch(G){y(G)}}function I(L){try{A(r.throw(L))}catch(G){y(G)}}function A(L){L.done?o(L.value):function(o){return o instanceof s?o:new s(function(y){y(o)})}(L.value).then(x,I)}A((r=r.apply(i,e||[])).next())})}(this,void 0,void 0,function*(){try{for(s=Tx(i);!(r=yield s.next()).done;)if(e.next(r.value),e.closed)return}catch(y){c={error:y}}finally{try{r&&!r.done&&(o=s.return)&&(yield o.call(s))}finally{if(c)throw c.error}}e.complete()})})(i,e).catch(s=>e.error(s))})}function Sr(i,e,s,r=0,c=!1){let o=e.schedule(function(){s(),c?i.add(this.schedule(null,r)):this.unsubscribe()},r);if(i.add(o),!c)return o}function Yd(i,e=0){return Xt((s,r)=>{s.subscribe(an(r,c=>Sr(r,i,()=>r.next(c),e),()=>Sr(r,i,()=>r.complete(),e),c=>Sr(r,i,()=>r.error(c),e)))})}function Kd(i,e=0){return Xt((s,r)=>{r.add(i.schedule(()=>s.subscribe(r),e))})}function Qd(i,e){if(!i)throw new Error("Iterable cannot be null");return new In(s=>{Sr(s,e,()=>{let r=i[Symbol.asyncIterator]();Sr(s,e,()=>{r.next().then(c=>{c.done?s.complete():s.next(c.value)})},0,!0)})})}function os(i,e){return e?function(i,e){if(null!=i){if(Vd(i))return function(i,e){return bn(i).pipe(Kd(e),Yd(e))}(i,e);if(jd(i))return function(i,e){return new In(s=>{let r=0;return e.schedule(function(){r===i.length?s.complete():(s.next(i[r++]),s.closed||this.schedule())})})}(i,e);if(Ud(i))return function(i,e){return bn(i).pipe(Kd(e),Yd(e))}(i,e);if($d(i))return Qd(i,e);if(Zd(i))return function(i,e){return new In(s=>{let r;return Sr(s,e,()=>{r=i[Gd](),Sr(s,e,()=>{let c,o;try{({value:c,done:o}=r.next())}catch(y){return void s.error(y)}o?s.complete():s.next(c)},0,!0)}),()=>Zt(r?.return)&&r.return()})}(i,e);if(Wd(i))return function(i,e){return Qd(qd(i),e)}(i,e)}throw Hd(i)}(i,e):bn(i)}function Hl(...i){return os(i,$l(i))}function Gi(i,e){return Xt((s,r)=>{let c=0;s.subscribe(an(r,o=>{r.next(i.call(e,o,c++))}))})}function $s(i,e,s=1/0){return Zt(e)?$s((r,c)=>Gi((o,y)=>e(r,o,c,y))(bn(i(r,c))),s):("number"==typeof e&&(s=e),Xt((r,c)=>function(i,e,s,r,c,o,y,x){let I=[],A=0,L=0,G=!1,re=()=>{G&&!I.length&&!A&&e.complete()},le=Ie=>A<r?ve(Ie):I.push(Ie),ve=Ie=>{A++;let je=!1;bn(s(Ie,L++)).subscribe(an(e,Ae=>{e.next(Ae)},()=>{je=!0},void 0,()=>{if(je)try{for(A--;I.length&&A<r;){let Ae=I.shift();ve(Ae)}re()}catch(Ae){e.error(Ae)}}))};return i.subscribe(an(e,le,()=>{G=!0,re()})),()=>{}}(r,c,i,s)))}function Xd(i=1/0){return $s(Vl,i)}function Gl(i=0,e,s=Mx){let r=-1;return null!=e&&(Bd(e)?s=e:r=e),new In(c=>{let o=function(i){return i instanceof Date&&!isNaN(i)}(i)?+i-s.now():i;o<0&&(o=0);let y=0;return s.schedule(function(){c.closed||(c.next(y++),0<=r?this.schedule(void 0,r):c.complete())},o)})}function Pu(...i){let e=$l(i),s=function(i,e){return"number"==typeof Ex(i)?i.pop():1/0}(i),r=i;return r.length?1===r.length?bn(r[0]):Xd(s)(os(r,e)):zd}function Wr(i,e=qr){return Xt((s,r)=>{let c=null,o=null,y=null,x=()=>{if(c){c.unsubscribe(),c=null;let A=o;o=null,r.next(A)}};function I(){let A=y+i,L=e.now();if(L<A)return c=this.schedule(void 0,A-L),void r.add(c);x()}s.subscribe(an(r,A=>{o=A,y=e.now(),c||(c=e.schedule(I,i),r.add(c))},()=>{x(),r.complete()},void 0,()=>{o=c=null}))})}function Zl(i){return i<=0?()=>zd:Xt((e,s)=>{let r=0;e.subscribe(an(s,c=>{++r<=i&&(s.next(c),i<=r&&s.complete())}))})}function bg(i,e){return e?s=>function(...i){return Xd(1)(os(i,$l(i)))}(e.pipe(Zl(1),Xt((i,e)=>{i.subscribe(an(e,Zr))})),s.pipe(bg(i))):$s((s,r)=>bn(i(s,r)).pipe(Zl(1),function(i){return Gi(()=>i)}(s)))}function xC(i,e){return i===e}function Jd(i){return Xt((e,s)=>{try{e.subscribe(s)}finally{s.add(i)}})}function za(i,e=qr){return function(i){return Xt((e,s)=>{let r=!1,c=null;e.subscribe(an(s,o=>{r=!0,c=o})),bn(i).subscribe(an(s,()=>{if(r){r=!1;let o=c;c=null,s.next(o)}},Zr))})}(function(i=0,e=qr){return i<0&&(i=0),Gl(i,i,e)}(i,e))}function ep(i={}){let{connector:e=(()=>new Ct),resetOnError:s=!0,resetOnComplete:r=!0,resetOnRefCountZero:c=!0}=i;return o=>{let y,x,I,A=0,L=!1,G=!1,re=()=>{x?.unsubscribe(),x=void 0},le=()=>{re(),y=I=void 0,L=G=!1},ve=()=>{let Ie=y;le(),Ie?.unsubscribe()};return Xt((Ie,je)=>{A++,!G&&!L&&re();let Ae=I=I??e();je.add(()=>{A--,0===A&&!G&&!L&&(x=Eg(ve,c))}),Ae.subscribe(je),!y&&A>0&&(y=new is({next:yt=>Ae.next(yt),error:yt=>{G=!0,re(),x=Eg(le,s,yt),Ae.error(yt)},complete:()=>{L=!0,re(),x=Eg(le,r),Ae.complete()}}),bn(Ie).subscribe(y))})(o)}}function Eg(i,e,...s){if(!0===e)return void i();if(!1===e)return;let r=new is({next:()=>{r.unsubscribe(),i()}});return bn(e(...s)).subscribe(r)}function ss(i,e){return Xt((s,r)=>{let c=null,o=0,y=!1,x=()=>y&&!c&&r.complete();s.subscribe(an(r,I=>{c?.unsubscribe();let A=0,L=o++;bn(i(I,L)).subscribe(c=an(r,G=>r.next(e?e(I,G,L,A++):G),()=>{c=null,x()}))},()=>{y=!0,x()}))})}function An(i){return Xt((e,s)=>{bn(i).subscribe(an(s,()=>s.complete(),Zr)),!s.closed&&e.subscribe(s)})}function Mn(i){for(let e in i)if(i[e]===Mn)return e;throw Error("Could not find renamed property on target object.")}function Pi(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(Pi).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;let e=i.toString();if(null==e)return""+e;let s=e.indexOf("\n");return-1===s?e:e.substring(0,s)}function jg(i,e){return null==i||""===i?null===e?"":e:null==e||""===e?i:i+" "+e}var bC=Mn({__forward_ref__:Mn});function kb(i){return i.__forward_ref__=kb,i.toString=function(){return Pi(this())},i}function Xi(i){return function(i){return"function"==typeof i&&i.hasOwnProperty(bC)&&i.__forward_ref__===kb}(i)?i():i}function Lb(i){return i&&!!i.\u0275providers}var Ob="https://g.co/ng/security#xss",He=class extends Error{constructor(e,s){super(function(i,e){return`NG0${Math.abs(i)}${e?": "+e:""}`}(e,s)),this.code=e}},MC=Mn({"\u0275cmp":Mn}),EC=Mn({"\u0275dir":Mn}),IC=Mn({"\u0275pipe":Mn}),DC=Mn({"\u0275mod":Mn}),Zx=Mn({"\u0275fac":Mn}),ku=Mn({__NG_ELEMENT_ID__:Mn}),qx=Mn({__NG_ENV_ID__:Mn});function kp(i){return"string"==typeof i?i:null==i?"":String(i)}function Fy(i,e){throw new He(-201,!1)}function Be(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function ur(i){return{providers:i.providers||[],imports:i.imports||[]}}function zy(i){return Wx(i,Nb)||Wx(i,Rb)}function Wx(i,e){return i.hasOwnProperty(e)?i[e]:null}function Yx(i){return i&&(i.hasOwnProperty(Kx)||i.hasOwnProperty(kC))?i[Kx]:null}var Ug,Nb=Mn({"\u0275prov":Mn}),Kx=Mn({"\u0275inj":Mn}),Rb=Mn({ngInjectableDef:Mn}),kC=Mn({ngInjectorDef:Mn}),$t=function(i){return i[i.Default=0]="Default",i[i.Host=1]="Host",i[i.Self=2]="Self",i[i.SkipSelf=4]="SkipSelf",i[i.Optional=8]="Optional",i}($t||{});function Tr(i){let e=Ug;return Ug=i,e}function Fb(i,e,s){let r=zy(i);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:s&$t.Optional?null:void 0!==e?e:void Fy(Pi(i))}var Lu,bi=globalThis,Pt=class{constructor(e,s){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=Be({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}},Ru={},Vg="__NG_DI_FLAG__",pp="ngTempTokenPath",RC=/\n/gm,Qx="__source";function ql(i){let e=Lu;return Lu=i,e}function zC(i,e=$t.Default){if(void 0===Lu)throw new He(-203,!1);return null===Lu?Fb(i,void 0,e):Lu.get(i,e&$t.Optional?null:void 0,e)}function Le(i,e=$t.Default){return(Ug||zC)(Xi(i),e)}function Ln(i,e=$t.Default){return Le(i,Lp(e))}function Lp(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function $g(i){let e=[];for(let s=0;s<i.length;s++){let r=Xi(i[s]);if(Array.isArray(r)){if(0===r.length)throw new He(900,!1);let c,o=$t.Default;for(let y=0;y<r.length;y++){let x=r[y],I=BC(x);"number"==typeof I?-1===I?c=x.token:o|=I:c=x}e.push(Le(c,o))}else e.push(Le(r))}return e}function zb(i,e){return i[Vg]=e,i.prototype[Vg]=e,i}function BC(i){return i[Vg]}function Op(i){return{toString:i}.toString()}var Bb=function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i}(Bb||{}),To=function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i}(To||{}),Fu={},lr=[];function jb(i,e,s){let r=i.length;for(;;){let c=i.indexOf(e,s);if(-1===c)return c;if(0===c||i.charCodeAt(c-1)<=32){let o=e.length;if(c+o===r||i.charCodeAt(c+o)<=32)return c}s=c+1}}function Hg(i,e,s){let r=0;for(;r<s.length;){let c=s[r];if("number"==typeof c){if(0!==c)break;r++;let o=s[r++],y=s[r++],x=s[r++];i.setAttribute(e,y,x,o)}else{let o=c,y=s[++r];$C(o)?i.setProperty(e,o,y):i.setAttribute(e,o,y),r++}}return r}function VC(i){return 3===i||4===i||6===i}function $C(i){return 64===i.charCodeAt(0)}function By(i,e){if(null!==e&&0!==e.length)if(null===i||0===i.length)i=e.slice();else{let s=-1;for(let r=0;r<e.length;r++){let c=e[r];"number"==typeof c?s=c:0===s||Xx(i,s,c,null,-1===s||2===s?e[++r]:null)}}return i}function Xx(i,e,s,r,c){let o=0,y=i.length;if(-1===e)y=-1;else for(;o<i.length;){let x=i[o++];if("number"==typeof x){if(x===e){y=-1;break}if(x>e){y=o-1;break}}}for(;o<i.length;){let x=i[o];if("number"==typeof x)break;if(x===s){if(null===r)return void(null!==c&&(i[o+1]=c));if(r===i[o+1])return void(i[o+2]=c)}o++,null!==r&&o++,null!==c&&o++}-1!==y&&(i.splice(y,0,e),o=y+1),i.splice(o++,0,s),null!==r&&i.splice(o++,0,r),null!==c&&i.splice(o++,0,c)}var Ub="ng-template";function HC(i,e,s){let r=0,c=!0;for(;r<i.length;){let o=i[r++];if("string"==typeof o&&c){let y=i[r++];if(s&&"class"===o&&-1!==jb(y.toLowerCase(),e,0))return!0}else{if(1===o){for(;r<i.length&&"string"==typeof(o=i[r++]);)if(o.toLowerCase()===e)return!0;return!1}"number"==typeof o&&(c=!1)}}return!1}function Vb(i){return 4===i.type&&i.value!==Ub}function GC(i,e,s){return e===(4!==i.type||s?i.value:Ub)}function ZC(i,e,s){let r=4,c=i.attrs||[],o=function(i){for(let e=0;e<i.length;e++)if(VC(i[e]))return e;return i.length}(c),y=!1;for(let x=0;x<e.length;x++){let I=e[x];if("number"!=typeof I){if(!y)if(4&r){if(r=2|1&r,""!==I&&!GC(i,I,s)||""===I&&1===e.length){if(Yr(r))return!1;y=!0}}else{let A=8&r?I:e[++x];if(8&r&&null!==i.attrs){if(!HC(i.attrs,A,s)){if(Yr(r))return!1;y=!0}continue}let G=qC(8&r?"class":I,c,Vb(i),s);if(-1===G){if(Yr(r))return!1;y=!0;continue}if(""!==A){let re;re=G>o?"":c[G+1].toLowerCase();let le=8&r?re:null;if(le&&-1!==jb(le,A,0)||2&r&&A!==re){if(Yr(r))return!1;y=!0}}}}else{if(!y&&!Yr(r)&&!Yr(I))return!1;if(y&&Yr(I))continue;y=!1,r=I|1&r}}return Yr(r)||y}function Yr(i){return 0==(1&i)}function qC(i,e,s,r){if(null===e)return-1;let c=0;if(r||!s){let o=!1;for(;c<e.length;){let y=e[c];if(y===i)return c;if(3===y||6===y)o=!0;else{if(1===y||2===y){let x=e[++c];for(;"string"==typeof x;)x=e[++c];continue}if(4===y)break;if(0===y){c+=4;continue}}c+=o?1:2}return-1}return function(i,e){let s=i.indexOf(4);if(s>-1)for(s++;s<i.length;){let r=i[s];if("number"==typeof r)return-1;if(r===e)return s;s++}return-1}(e,i)}function WC(i,e,s=!1){for(let r=0;r<e.length;r++)if(ZC(i,e[r],s))return!0;return!1}function Jx(i,e){return i?":not("+e.trim()+")":e}function QC(i){let e=i[0],s=1,r=2,c="",o=!1;for(;s<i.length;){let y=i[s];if("string"==typeof y)if(2&r){let x=i[++s];c+="["+y+(x.length>0?'="'+x+'"':"")+"]"}else 8&r?c+="."+y:4&r&&(c+=" "+y);else""!==c&&!Yr(y)&&(e+=Jx(o,c),c=""),r=y,o=o||!Yr(r);s++}return""!==c&&(e+=Jx(o,c)),e}function Dn(i){return Op(()=>{let e=Zb(i),s={...e,decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===Bb.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&i.dependencies||null,getStandaloneInjector:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||To.Emulated,styles:i.styles||lr,_:null,schemas:i.schemas||null,tView:null,id:""};qb(s);let r=i.dependencies;return s.directiveDefs=tb(r,!1),s.pipeDefs=tb(r,!0),s.id=function(i){let e=0,s=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,i.consts,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery].join("|");for(let c of s)e=Math.imul(31,e)+c.charCodeAt(0)<<0;return e+=2147483648,"c"+e}(s),s})}function eS(i){return Xl(i)||Hb(i)}function tS(i){return null!==i}function hr(i){return Op(()=>({type:i.type,bootstrap:i.bootstrap||lr,declarations:i.declarations||lr,imports:i.imports||lr,exports:i.exports||lr,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function eb(i,e){if(null==i)return Fu;let s={};for(let r in i)if(i.hasOwnProperty(r)){let c=i[r],o=c;Array.isArray(c)&&(o=c[1],c=c[0]),s[c]=r,e&&(e[c]=o)}return s}function lc(i){return Op(()=>{let e=Zb(i);return qb(e),e})}function $b(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function Xl(i){return i[MC]||null}function Hb(i){return i[EC]||null}function Gb(i){return i[IC]||null}function Zb(i){let e={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:i.inputs||Fu,exportAs:i.exportAs||null,standalone:!0===i.standalone,signals:!0===i.signals,selectors:i.selectors||lr,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:eb(i.inputs,e),outputs:eb(i.outputs),debugInfo:null}}function qb(i){i.features?.forEach(e=>e(i))}function tb(i,e){if(!i)return null;let s=e?Gb:eS;return()=>("function"==typeof i?i():i).map(r=>s(r)).filter(tS)}var hs=0,At=1,Tt=2,ei=3,Qr=4,to=5,Gg=6,zu=7,Xr=8,Jl=9,ec=10,Gn=11,Bu=12,nb=13,cc=14,Ao=15,qu=16,Wl=17,So=18,Np=19,Wb=20,Ou=21,Dg=22,ja=23,Jr=25,Yb=1,Kb=2,Zg=6,Ua=7,tc=9,cr=11;function Hs(i){return Array.isArray(i)&&"object"==typeof i[Yb]}function eo(i){return Array.isArray(i)&&!0===i[Yb]}function jy(i){return 0!=(4&i.flags)}function Rp(i){return i.componentOffset>-1}function Fp(i){return 1==(1&i.flags)}function uc(i){return!!i.template}function oS(i){return 0!=(512&i[Tt])}function nc(i,e){return i.hasOwnProperty(Zx)?i[Zx]:null}var ju=class{constructor(e,s,r){this.previousValue=e,this.currentValue=s,this.firstChange=r}isFirstChange(){return this.firstChange}};function pi(){return Qb}function Qb(i){return i.type.prototype.ngOnChanges&&(i.setInput=aS),sS}function sS(){let i=Jb(this),e=i?.current;if(e){let s=i.previous;if(s===Fu)i.previous=e;else for(let r in e)s[r]=e[r];i.current=null,this.ngOnChanges(e)}}function aS(i,e,s,r){let c=this.declaredInputs[s],o=Jb(i)||function(i,e){return i[Xb]=e}(i,{previous:Fu,current:null}),y=o.current||(o.current={}),x=o.previous,I=x[c];y[c]=new ju(I&&I.currentValue,e,x===Fu),i[r]=e}pi.ngInherit=!0;var Xb="__ngSimpleChanges__";function Jb(i){return i[Xb]||null}var Do=function(i,e,s){};function Po(i){for(;Array.isArray(i);)i=i[hs];return i}function ew(i,e){return Po(e[i])}function Ar(i,e){return Po(e[i.index])}function tw(i,e){return i.data[e]}function qs(i,e){let s=e[i];return Hs(s)?s:s[hs]}function Uy(i){return 128==(128&i[Tt])}function ic(i,e){return null==e?null:i[e]}function nw(i){i[Wl]=0}function fS(i){1024&i[Tt]||(i[Tt]|=1024,Uy(i)&&zp(i))}function iw(i){9216&i[Tt]&&zp(i)}function zp(i){let e=i[ei];for(;null!==e&&!(eo(e)&&e[Zg]||Hs(e)&&8192&e[Tt]);){if(eo(e))e[Zg]=!0;else if(e[Tt]|=8192,!Uy(e))break;e=e[ei]}}var jt={lFrame:hw(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function rw(){return jt.bindingsEnabled}function Jt(){return jt.lFrame.lView}function fi(){return jt.lFrame.tView}function en(i){return jt.lFrame.contextLView=i,i[Xr]}function tn(i){return jt.lFrame.contextLView=null,i}function dr(){let i=ow();for(;null!==i&&64===i.type;)i=i.parent;return i}function ow(){return jt.lFrame.currentTNode}function Ya(i,e){let s=jt.lFrame;s.currentTNode=i,s.isParent=e}function Vy(){return jt.lFrame.isParent}function sw(){jt.lFrame.isParent=!1}function $y(){let i=jt.lFrame,e=i.bindingRootIndex;return-1===e&&(e=i.bindingRootIndex=i.tView.bindingStartIndex),e}function Hy(){return jt.lFrame.bindingIndex++}function aw(i){let e=jt.lFrame,s=e.bindingIndex;return e.bindingIndex=e.bindingIndex+i,s}function DS(i,e){let s=jt.lFrame;s.bindingIndex=s.bindingRootIndex=i,qg(e)}function qg(i){jt.lFrame.currentDirectiveIndex=i}function lw(){return jt.lFrame.currentQueryIndex}function Gy(i){jt.lFrame.currentQueryIndex=i}function TS(i){let e=i[At];return 2===e.type?e.declTNode:1===e.type?i[to]:null}function cw(i,e,s){if(s&$t.SkipSelf){let c=e,o=i;for(;!(c=c.parent,null!==c||s&$t.Host||(c=TS(o),null===c||(o=o[cc],10&c.type))););if(null===c)return!1;e=c,i=o}let r=jt.lFrame=uw();return r.currentTNode=e,r.lView=i,!0}function Zy(i){let e=uw(),s=i[At];jt.lFrame=e,e.currentTNode=s.firstChild,e.lView=i,e.tView=s,e.contextLView=i,e.bindingIndex=s.bindingStartIndex,e.inI18n=!1}function uw(){let i=jt.lFrame,e=null===i?null:i.child;return null===e?hw(i):e}function hw(i){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=e),e}function dw(){let i=jt.lFrame;return jt.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}var pw=dw;function qy(){let i=dw();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Ka(){return jt.lFrame.selectedIndex}function Va(i){jt.lFrame.selectedIndex=i}function Wy(){let i=jt.lFrame;return tw(i.tView,i.selectedIndex)}var fw=!0;function Bp(){return fw}function jp(i){fw=i}function Up(i,e){for(let s=e.directiveStart,r=e.directiveEnd;s<r;s++){let o=i.data[s].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:x,ngAfterViewInit:I,ngAfterViewChecked:A,ngOnDestroy:L}=o;y&&(i.contentHooks??(i.contentHooks=[])).push(-s,y),x&&((i.contentHooks??(i.contentHooks=[])).push(s,x),(i.contentCheckHooks??(i.contentCheckHooks=[])).push(s,x)),I&&(i.viewHooks??(i.viewHooks=[])).push(-s,I),A&&((i.viewHooks??(i.viewHooks=[])).push(s,A),(i.viewCheckHooks??(i.viewCheckHooks=[])).push(s,A)),null!=L&&(i.destroyHooks??(i.destroyHooks=[])).push(s,L)}}function ap(i,e,s){mw(i,e,3,s)}function lp(i,e,s,r){(3&i[Tt])===s&&mw(i,e,s,r)}function Cg(i,e){let s=i[Tt];(3&s)===e&&(s&=16383,s+=1,i[Tt]=s)}function mw(i,e,s,r){let o=r??-1,y=e.length-1,x=0;for(let I=void 0!==r?65535&i[Wl]:0;I<y;I++)if("number"==typeof e[I+1]){if(x=e[I],null!=r&&x>=r)break}else e[I]<0&&(i[Wl]+=65536),(x<o||-1==o)&&(LS(i,s,e,I),i[Wl]=(4294901760&i[Wl])+I+2),I++}function rb(i,e){Do(4,i,e);let s=Hi(null);try{e.call(i)}finally{Hi(s),Do(5,i,e)}}function LS(i,e,s,r){let c=s[r]<0,o=s[r+1],x=i[c?-s[r]:s[r]];c?i[Tt]>>14<i[Wl]>>16&&(3&i[Tt])===e&&(i[Tt]+=16384,rb(x,o)):rb(x,o)}var Ql=-1,$a=class{constructor(e,s,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=r}};function gw(i){return i!==Ql}function mp(i){return 32767&i}function gp(i,e){let s=function(i){return i>>16}(i),r=e;for(;s>0;)r=r[cc],s--;return r}var Wg=!0;function yp(i){let e=Wg;return Wg=i,e}var yw=255,_w=5,BS=0,Co={};function _p(i,e){let s=vw(i,e);if(-1!==s)return s;let r=e[At];r.firstCreatePass&&(i.injectorIndex=e.length,Sg(r.data,i),Sg(e,null),Sg(r.blueprint,null));let c=Yy(i,e),o=i.injectorIndex;if(gw(c)){let y=mp(c),x=gp(c,e),I=x[At].data;for(let A=0;A<8;A++)e[o+A]=x[y+A]|I[y+A]}return e[o+8]=c,o}function Sg(i,e){i.push(0,0,0,0,0,0,0,0,e)}function vw(i,e){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===e[i.injectorIndex+8]?-1:i.injectorIndex}function Yy(i,e){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let s=0,r=null,c=e;for(;null!==c;){if(r=Ew(c),null===r)return Ql;if(s++,c=c[cc],-1!==r.injectorIndex)return r.injectorIndex|s<<16}return Ql}function Yg(i,e,s){!function(i,e,s){let r;"string"==typeof s?r=s.charCodeAt(0)||0:s.hasOwnProperty(ku)&&(r=s[ku]),null==r&&(r=s[ku]=BS++);let c=r&yw;e.data[i+(c>>_w)]|=1<<c}(i,e,s)}function xw(i,e,s){if(s&$t.Optional||void 0!==i)return i;Fy()}function bw(i,e,s,r){if(s&$t.Optional&&void 0===r&&(r=null),0==(s&($t.Self|$t.Host))){let c=i[Jl],o=Tr(void 0);try{return c?c.get(e,r,s&$t.Optional):Fb(e,r,s&$t.Optional)}finally{Tr(o)}}return xw(r,0,s)}function ww(i,e,s,r=$t.Default,c){if(null!==i){if(2048&e[Tt]&&!(r&$t.Self)){let y=function(i,e,s,r,c){let o=i,y=e;for(;null!==o&&null!==y&&2048&y[Tt]&&!(512&y[Tt]);){let x=Mw(o,y,s,r|$t.Self,Co);if(x!==Co)return x;let I=o.parent;if(!I){let A=y[Wb];if(A){let L=A.get(s,Co,r);if(L!==Co)return L}I=Ew(y),y=y[cc]}o=I}return c}(i,e,s,r,Co);if(y!==Co)return y}let o=Mw(i,e,s,r,Co);if(o!==Co)return o}return bw(e,s,r,c)}function Mw(i,e,s,r,c){let o=function(i){if("string"==typeof i)return i.charCodeAt(0)||0;let e=i.hasOwnProperty(ku)?i[ku]:void 0;return"number"==typeof e?e>=0?e&yw:$S:e}(s);if("function"==typeof o){if(!cw(e,i,r))return r&$t.Host?xw(c,0,r):bw(e,s,r,c);try{let y;if(y=o(r),null!=y||r&$t.Optional)return y;Fy()}finally{pw()}}else if("number"==typeof o){let y=null,x=vw(i,e),I=Ql,A=r&$t.Host?e[Ao][to]:null;for((-1===x||r&$t.SkipSelf)&&(I=-1===x?Yy(i,e):e[x+8],I!==Ql&&sb(r,!1)?(y=e[At],x=mp(I),e=gp(I,e)):x=-1);-1!==x;){let L=e[At];if(ob(o,x,L.data)){let G=US(x,e,s,y,r,A);if(G!==Co)return G}I=e[x+8],I!==Ql&&sb(r,e[At].data[x+8]===A)&&ob(o,x,e)?(y=L,x=mp(I),e=gp(I,e)):x=-1}}return c}function US(i,e,s,r,c,o){let y=e[At],x=y.data[i+8],L=cp(x,y,s,null==r?Rp(x)&&Wg:r!=y&&0!=(3&x.type),c&$t.Host&&o===x);return null!==L?Ha(e,y,L,x):Co}function cp(i,e,s,r,c){let o=i.providerIndexes,y=e.data,x=1048575&o,I=i.directiveStart,L=o>>20,re=c?x+L:i.directiveEnd;for(let le=r?x:x+L;le<re;le++){let ve=y[le];if(le<I&&s===ve||le>=I&&ve.type===s)return le}if(c){let le=y[I];if(le&&uc(le)&&le.type===s)return I}return null}function Ha(i,e,s,r){let c=i[s],o=e.data;if(function(i){return i instanceof $a}(c)){let y=c;y.resolving&&function(i,e){throw new He(-200,`Circular dependency in DI detected for ${i}`)}(function(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():kp(i)}(o[s]));let x=yp(y.canSeeViewProviders);y.resolving=!0;let A=y.injectImpl?Tr(y.injectImpl):null;cw(i,r,$t.Default);try{c=i[s]=y.factory(void 0,o,i,r),e.firstCreatePass&&s>=r.directiveStart&&function(i,e,s){let{ngOnChanges:r,ngOnInit:c,ngDoCheck:o}=e.type.prototype;if(r){let y=Qb(e);(s.preOrderHooks??(s.preOrderHooks=[])).push(i,y),(s.preOrderCheckHooks??(s.preOrderCheckHooks=[])).push(i,y)}c&&(s.preOrderHooks??(s.preOrderHooks=[])).push(0-i,c),o&&((s.preOrderHooks??(s.preOrderHooks=[])).push(i,o),(s.preOrderCheckHooks??(s.preOrderCheckHooks=[])).push(i,o))}(s,o[s],e)}finally{null!==A&&Tr(A),yp(x),y.resolving=!1,pw()}}return c}function ob(i,e,s){return!!(s[e+(i>>_w)]&1<<i)}function sb(i,e){return!(i&$t.Self||i&$t.Host&&e)}var Ba=class{constructor(e,s){this._tNode=e,this._lView=s}get(e,s,r){return ww(this._tNode,this._lView,e,Lp(r),s)}};function $S(){return new Ba(dr(),Jt())}function Ew(i){let e=i[At],s=e.type;return 2===s?e.declTNode:1===s?i[to]:null}var tp="__parameters__";function Iw(i,e,s){return Op(()=>{let r=function(i){return function(...s){if(i){let r=i(...s);for(let c in r)this[c]=r[c]}}}(e);function c(...o){if(this instanceof c)return r.apply(this,o),this;let y=new c(...o);return x.annotation=y,x;function x(I,A,L){let G=I.hasOwnProperty(tp)?I[tp]:Object.defineProperty(I,tp,{value:[]})[tp];for(;G.length<=L;)G.push(null);return(G[L]=G[L]||[]).push(y),I}}return s&&(c.prototype=Object.create(s.prototype)),c.prototype.ngMetadataName=i,c.annotationCls=c,c})}function Ky(i,e){i.forEach(s=>Array.isArray(s)?Ky(s,e):e(s))}function Dw(i,e,s){e>=i.length?i.push(s):i.splice(e,0,s)}function vp(i,e){return e>=i.length-1?i.pop():i.splice(e,1)[0]}function Qy(i,e,s){let r=Wu(i,e);return r>=0?i[1|r]=s:(r=~r,function(i,e,s,r){let c=i.length;if(c==e)i.push(s,r);else if(1===c)i.push(r,i[0]),i[0]=s;else{for(c--,i.push(i[c-1],i[c]);c>e;)i[c]=i[c-2],c--;i[e]=s,i[e+1]=r}}(i,r,e,s)),r}function Tg(i,e){let s=Wu(i,e);if(s>=0)return i[1|s]}function Wu(i,e){return function(i,e,s){let r=0,c=i.length>>1;for(;c!==r;){let o=r+(c-r>>1),y=i[o<<1];if(e===y)return o<<1;y>e?c=o:r=o+1}return~(c<<1)}(i,e)}var Xy=zb(Iw("Optional"),8),Cw=zb(Iw("SkipSelf"),4),Vp=new Pt("ENVIRONMENT_INITIALIZER"),Sw=new Pt("INJECTOR",-1),Tw=new Pt("INJECTOR_DEF_TYPES"),bp=class{get(e,s=Ru){if(s===Ru){let r=new Error(`NullInjectorError: No provider for ${Pi(e)}!`);throw r.name="NullInjectorError",r}return s}};function oT(...i){return{"\u0275providers":sT(0,i),"\u0275fromNgModule":!0}}function sT(i,...e){let c,s=[],r=new Set,o=y=>{s.push(y)};return Ky(e,y=>{let x=y;Kg(x,o,[],r)&&(c||(c=[]),c.push(x))}),void 0!==c&&Aw(c,o),s}function Aw(i,e){for(let s=0;s<i.length;s++){let{ngModule:r,providers:c}=i[s];e_(c,o=>{e(o,r)})}}function Kg(i,e,s,r){if(!(i=Xi(i)))return!1;let c=null,o=Yx(i),y=!o&&Xl(i);if(o||y){if(y&&!y.standalone)return!1;c=i}else{let I=i.ngModule;if(o=Yx(I),!o)return!1;c=I}let x=r.has(c);if(y){if(x)return!1;if(r.add(c),y.dependencies){let I="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(let A of I)Kg(A,e,s,r)}}else{if(!o)return!1;{if(null!=o.imports&&!x){let A;r.add(c);try{Ky(o.imports,L=>{Kg(L,e,s,r)&&(A||(A=[]),A.push(L))})}finally{}void 0!==A&&Aw(A,e)}if(!x){let A=nc(c)||(()=>new c);e({provide:c,useFactory:A,deps:lr},c),e({provide:Tw,useValue:c,multi:!0},c),e({provide:Vp,useValue:()=>Le(c),multi:!0},c)}let I=o.providers;if(null!=I&&!x){let A=i;e_(I,L=>{e(L,A)})}}}return c!==i&&void 0!==i.providers}function e_(i,e){for(let s of i)Lb(s)&&(s=s.\u0275providers),Array.isArray(s)?e_(s,e):e(s)}var aT=Mn({provide:String,useValue:Mn});function Pw(i){return null!==i&&"object"==typeof i&&aT in i}function rc(i){return"function"==typeof i}var Ag,$p=new Pt("Set Injector scope."),up={},hT={};function kw(){return void 0===Ag&&(Ag=new bp),Ag}var as=class{},Qg=class extends as{get destroyed(){return this._destroyed}constructor(e,s,r,c){super(),this.parent=s,this.source=r,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Jg(e,y=>this.processProvider(y)),this.records.set(Sw,Yl(void 0,this)),c.has("environment")&&this.records.set(as,Yl(void 0,this));let o=this.records.get($p);null!=o&&"string"==typeof o.value&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(Tw,lr,$t.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(let s of this._ngOnDestroyHooks)s.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let s of e)s()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let s=ql(this),r=Tr(void 0);try{return e()}finally{ql(s),Tr(r)}}get(e,s=Ru,r=$t.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(qx))return e[qx](this);r=Lp(r);let o=ql(this),y=Tr(void 0);try{if(!(r&$t.SkipSelf)){let I=this.records.get(e);if(void 0===I){let A=function(i){return"function"==typeof i||"object"==typeof i&&i instanceof Pt}(e)&&zy(e);I=A&&this.injectableDefInScope(A)?Yl(Xg(e),up):null,this.records.set(e,I)}if(null!=I)return this.hydrate(e,I)}return(r&$t.Self?kw():this.parent).get(e,s=r&$t.Optional&&s===Ru?null:s)}catch(x){if("NullInjectorError"===x.name){if((x[pp]=x[pp]||[]).unshift(Pi(e)),o)throw x;return function(i,e,s,r){let c=i[pp];throw e[Qx]&&c.unshift(e[Qx]),i.message=function(i,e,s,r=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.slice(2):i;let c=Pi(e);if(Array.isArray(e))c=e.map(Pi).join(" -> ");else if("object"==typeof e){let o=[];for(let y in e)if(e.hasOwnProperty(y)){let x=e[y];o.push(y+":"+("string"==typeof x?JSON.stringify(x):Pi(x)))}c=`{${o.join(", ")}}`}return`${s}${r?"("+r+")":""}[${c}]: ${i.replace(RC,"\n  ")}`}("\n"+i.message,c,s,r),i.ngTokenPath=c,i[pp]=null,i}(x,e,"R3InjectorError",this.source)}throw x}finally{Tr(y),ql(o)}}resolveInjectorInitializers(){let e=ql(this),s=Tr(void 0);try{let c=this.get(Vp,lr,$t.Self);for(let o of c)o()}finally{ql(e),Tr(s)}}toString(){let e=[],s=this.records;for(let r of s.keys())e.push(Pi(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new He(205,!1)}processProvider(e){let s=rc(e=Xi(e))?e:Xi(e&&e.provide),r=function(i){return Pw(i)?Yl(void 0,i.useValue):Yl(Lw(i),up)}(e);if(rc(e)||!0!==e.multi)this.records.get(s);else{let c=this.records.get(s);c||(c=Yl(void 0,up,!0),c.factory=()=>$g(c.multi),this.records.set(s,c)),s=e,c.multi.push(e)}this.records.set(s,r)}hydrate(e,s){return s.value===up&&(s.value=hT,s.value=s.factory()),"object"==typeof s.value&&s.value&&function(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(s.value)&&this._ngOnDestroyHooks.add(s.value),s.value}injectableDefInScope(e){if(!e.providedIn)return!1;let s=Xi(e.providedIn);return"string"==typeof s?"any"===s||this.scopes.has(s):this.injectorDefTypes.has(s)}removeOnDestroy(e){let s=this._onDestroyHooks.indexOf(e);-1!==s&&this._onDestroyHooks.splice(s,1)}};function Xg(i){let e=zy(i),s=null!==e?e.factory:nc(i);if(null!==s)return s;if(i instanceof Pt)throw new He(204,!1);if(i instanceof Function)return function(i){let e=i.length;if(e>0)throw function(i,e){let s=[];for(let r=0;r<i;r++)s.push("?")}(e),new He(204,!1);let s=function(i){return i&&(i[Nb]||i[Rb])||null}(i);return null!==s?()=>s.factory(i):()=>new i}(i);throw new He(204,!1)}function Lw(i,e,s){let r;if(rc(i)){let c=Xi(i);return nc(c)||Xg(c)}if(Pw(i))r=()=>Xi(i.useValue);else if(function(i){return!(!i||!i.useFactory)}(i))r=()=>i.useFactory(...$g(i.deps||[]));else if(function(i){return!(!i||!i.useExisting)}(i))r=()=>Le(Xi(i.useExisting));else{let c=Xi(i&&(i.useClass||i.provide));if(!function(i){return!!i.deps}(i))return nc(c)||Xg(c);r=()=>new c(...$g(i.deps))}return r}function Yl(i,e,s=!1){return{factory:i,value:e,multi:s?[]:void 0}}function Jg(i,e){for(let s of i)Array.isArray(s)?Jg(s,e):s&&Lb(s)?Jg(s.\u0275providers,e):e(s)}function ab(i,e=null,s=null,r){let c=Ow(i,e,s,r);return c.resolveInjectorInitializers(),c}function Ow(i,e=null,s=null,r,c=new Set){let o=[s||lr,oT(i)];return r=r||("object"==typeof i?void 0:Pi(i)),new Qg(o,e||kw(),r||null,c)}var ey,pr=(()=>{let e=class{static create(r,c){if(Array.isArray(r))return ab({name:""},c,r,"");{let o=r.name??"";return ab({name:o},r.parent,r.providers,o)}}},i=e;return e.THROW_IF_NOT_FOUND=Ru,e.NULL=new bp,e.\u0275prov=Be({token:e,providedIn:"any",factory:()=>Le(Sw)}),e.__NG_ELEMENT_ID__=-1,i})();function Rw(){if(void 0!==ey)return ey;if(typeof document<"u")return document;throw new He(210,!1)}var Hp=new Pt("AppId",{providedIn:"root",factory:()=>yT}),yT="ng",t_=new Pt("Platform Initializer"),Ws=new Pt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),n_=new Pt("AnimationModuleType"),i_=new Pt("CSP nonce",{providedIn:"root",factory:()=>Rw().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function Fw(i){return i.ownerDocument}function zw(i){return 128==(128&i.flags)}var CT,ls=function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i}(ls||{}),vT=/^>|^->|<!--|-->|--!>|<!-$/g,xT=/(<|>)/g,Bw=new Map,MT=0,lb="__ngContext__";function Gs(i,e){Hs(e)?(i[lb]=e[Np],function(i){Bw.set(i[Np],i)}(e)):i[lb]=e}function r_(i,e){return CT(i,e)}function o_(i){let e=i[ei];return eo(e)?e[ei]:e}function jw(i){return Vw(i[Bu])}function Uw(i){return Vw(i[Qr])}function Vw(i){for(;null!==i&&!eo(i);)i=i[Qr];return i}function Kl(i,e,s,r,c){if(null!=r){let o,y=!1;eo(r)?o=r:Hs(r)&&(y=!0,r=r[hs]);let x=Po(r);0===i&&null!==s?null==c?Zw(e,s,x):wp(e,s,x,c||null,!0):1===i&&null!==s?wp(e,s,x,c||null,!0):2===i?function(i,e,s){let r=s_(i,e);r&&function(i,e,s,r){i.removeChild(e,s,r)}(i,r,e,s)}(e,x,y):3===i&&e.destroyNode(x),null!=o&&function(i,e,s,r,c){let o=s[Ua];o!==Po(s)&&Kl(e,i,r,o,c);for(let x=cr;x<s.length;x++){let I=s[x];Yu(I[At],I,i,e,r,o)}}(e,i,o,s,c)}}function $w(i,e,s){return i.createElement(e,s)}function Hw(i,e){let s=i[tc],r=s.indexOf(e);s.splice(r,1)}function ty(i,e){if(i.length<=cr)return;let s=cr+e,r=i[s];if(r){let c=r[qu];null!==c&&c!==i&&Hw(c,r),e>0&&(i[s-1][Qr]=r[Qr]);let o=vp(i,cr+e);!function(i,e){Yu(i,e,e[Gn],2,null,null),e[hs]=null,e[to]=null}(r[At],r);let y=o[So];null!==y&&y.detachView(o[At]),r[ei]=null,r[Qr]=null,r[Tt]&=-129}return r}function Gw(i,e){if(!(256&e[Tt])){let s=e[Gn];e[ja]&&function(i){if(Sd(i),hg(i))for(let e=0;e<i.producerNode.length;e++)ug(i.producerNode[e],i.producerIndexOfThis[e]);i.producerNode.length=i.producerLastReadVersion.length=i.producerIndexOfThis.length=0,i.liveConsumerNode&&(i.liveConsumerNode.length=i.liveConsumerIndexOfThis.length=0)}(e[ja]),s.destroyNode&&Yu(i,e,s,3,null,null),function(i){let e=i[Bu];if(!e)return Pg(i[At],i);for(;e;){let s=null;if(Hs(e))s=e[Bu];else{let r=e[cr];r&&(s=r)}if(!s){for(;e&&!e[Qr]&&e!==i;)Hs(e)&&Pg(e[At],e),e=e[ei];null===e&&(e=i),Hs(e)&&Pg(e[At],e),s=e&&e[Qr]}e=s}}(e)}}function Pg(i,e){if(!(256&e[Tt])){e[Tt]&=-129,e[Tt]|=256,function(i,e){let s;if(null!=i&&null!=(s=i.destroyHooks))for(let r=0;r<s.length;r+=2){let c=e[s[r]];if(!(c instanceof $a)){let o=s[r+1];if(Array.isArray(o))for(let y=0;y<o.length;y+=2){let x=c[o[y]],I=o[y+1];Do(4,x,I);try{I.call(x)}finally{Do(5,x,I)}}else{Do(4,c,o);try{o.call(c)}finally{Do(5,c,o)}}}}}(i,e),function(i,e){let s=i.cleanup,r=e[zu];if(null!==s)for(let o=0;o<s.length-1;o+=2)if("string"==typeof s[o]){let y=s[o+3];y>=0?r[y]():r[-y].unsubscribe(),o+=2}else s[o].call(r[s[o+1]]);null!==r&&(e[zu]=null);let c=e[Ou];if(null!==c){e[Ou]=null;for(let o=0;o<c.length;o++)(0,c[o])()}}(i,e),1===e[At].type&&e[Gn].destroy();let s=e[qu];if(null!==s&&eo(e[ei])){s!==e[ei]&&Hw(s,e);let r=e[So];null!==r&&r.detachView(i)}!function(i){Bw.delete(i[Np])}(e)}}function wp(i,e,s,r,c){i.insertBefore(e,s,r,c)}function Zw(i,e,s){i.appendChild(e,s)}function cb(i,e,s,r,c){null!==r?wp(i,e,s,r,c):Zw(i,e,s)}function s_(i,e){return i.parentNode(e)}var ub,np,ip,GT=function(i,e,s){return 40&i.type?Ar(i,s):null};function Gp(i,e,s,r){let c=function(i,e,s){return function(i,e,s){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return s[hs];{let{componentOffset:c}=r;if(c>-1){let{encapsulation:o}=i.data[r.directiveStart+c];if(o===To.None||o===To.Emulated)return null}return Ar(r,s)}}(i,e.parent,s)}(i,r,e),o=e[Gn],x=function(i,e,s){return GT(i,e,s)}(r.parent||e[to],r,e);if(null!=c)if(Array.isArray(s))for(let I=0;I<s.length;I++)cb(o,c,s[I],x,!1);else cb(o,c,s,x,!1);void 0!==ub&&ub(o,r,e,s,c)}function hp(i,e){if(null!==e){let s=e.type;if(3&s)return Ar(e,i);if(4&s)return ny(-1,i[e.index]);if(8&s){let r=e.child;if(null!==r)return hp(i,r);{let c=i[e.index];return eo(c)?ny(-1,c):Po(c)}}if(32&s)return r_(e,i)()||Po(i[e.index]);{let r=qw(i,e);return null!==r?Array.isArray(r)?r[0]:hp(o_(i[Ao]),r):hp(i,e.next)}}return null}function qw(i,e){return null!==e?i[Ao][to].projection[e.projection]:null}function ny(i,e){let s=cr+i+1;if(s<e.length){let r=e[s],c=r[At].firstChild;if(null!==c)return hp(r,c)}return e[Ua]}function a_(i,e,s,r,c,o,y){for(;null!=s;){let x=r[s.index],I=s.type;if(y&&0===e&&(x&&Gs(Po(x),r),s.flags|=2),32!=(32&s.flags))if(8&I)a_(i,e,s.child,r,c,o,!1),Kl(e,i,c,x,o);else if(32&I){let L,A=r_(s,r);for(;L=A();)Kl(e,i,c,L,o);Kl(e,i,c,x,o)}else 16&I?qT(i,e,r,s,c,o):Kl(e,i,c,x,o);s=y?s.projectionNext:s.next}}function Yu(i,e,s,r,c,o){a_(s,r,i.firstChild,e,c,o,!1)}function qT(i,e,s,r,c,o){let y=s[Ao],I=y[to].projection[r.projection];if(Array.isArray(I))for(let A=0;A<I.length;A++)Kl(e,i,c,I[A],o);else{let A=I,L=y[ei];zw(r)&&(A.flags|=128),a_(i,e,A,L,c,o,!0)}}function Ww(i,e,s){""===s?i.removeAttribute(e,"class"):i.setAttribute(e,"class",s)}function Yw(i,e,s){let{mergedAttrs:r,classes:c,styles:o}=s;null!==r&&Hg(i,e,r),null!==c&&Ww(i,e,c),null!==o&&function(i,e,s){i.setAttribute(e,"style",s)}(i,e,o)}function Zp(i){return function(){if(void 0===np&&(np=null,bi.trustedTypes))try{np=bi.trustedTypes.createPolicy("angular",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return np}()?.createHTML(i)||i}function hb(i){return function(){if(void 0===ip&&(ip=null,bi.trustedTypes))try{ip=bi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return ip}()?.createHTML(i)||i}var cs=class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Ob})`}},iy=class extends cs{getTypeName(){return"HTML"}},ry=class extends cs{getTypeName(){return"Style"}},oy=class extends cs{getTypeName(){return"Script"}},sy=class extends cs{getTypeName(){return"URL"}},ay=class extends cs{getTypeName(){return"ResourceURL"}};function ko(i){return i instanceof cs?i.changingThisBreaksApplicationSecurity:i}function Qa(i,e){let s=function(i){return i instanceof cs&&i.getTypeName()||null}(i);if(null!=s&&s!==e){if("ResourceURL"===s&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${s} (see ${Ob})`)}return s===e}var ly=class{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{let s=(new window.DOMParser).parseFromString(Zp(e),"text/html").body;return null===s?this.inertDocumentHelper.getInertBodyElement(e):(s.removeChild(s.firstChild),s)}catch{return null}}},cy=class{constructor(e){this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(e){let s=this.inertDocument.createElement("template");return s.innerHTML=Zp(e),s}},nA=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function l_(i){return(i=String(i)).match(nA)?i:"unsafe:"+i}function ds(i){let e={};for(let s of i.split(","))e[s]=!0;return e}function Ku(...i){let e={};for(let s of i)for(let r in s)s.hasOwnProperty(r)&&(e[r]=!0);return e}var rp,t1=ds("area,br,col,hr,img,wbr"),n1=ds("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),i1=ds("rp,rt"),iA=Ku(i1,n1),db=Ku(t1,Ku(n1,ds("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Ku(i1,ds("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),iA),r1=ds("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),lA=Ku(r1,ds("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ds("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),cA=ds("script,style,template"),uy=class{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let s=e.firstChild,r=!0;for(;s;)if(s.nodeType===Node.ELEMENT_NODE?r=this.startElement(s):s.nodeType===Node.TEXT_NODE?this.chars(s.nodeValue):this.sanitizedSomething=!0,r&&s.firstChild)s=s.firstChild;else for(;s;){s.nodeType===Node.ELEMENT_NODE&&this.endElement(s);let c=this.checkClobberedElement(s,s.nextSibling);if(c){s=c;break}s=this.checkClobberedElement(s,s.parentNode)}return this.buf.join("")}startElement(e){let s=e.nodeName.toLowerCase();if(!db.hasOwnProperty(s))return this.sanitizedSomething=!0,!cA.hasOwnProperty(s);this.buf.push("<"),this.buf.push(s);let r=e.attributes;for(let c=0;c<r.length;c++){let o=r.item(c),y=o.name,x=y.toLowerCase();if(!lA.hasOwnProperty(x)){this.sanitizedSomething=!0;continue}let I=o.value;r1[x]&&(I=l_(I)),this.buf.push(" ",y,'="',pb(I),'"')}return this.buf.push(">"),!0}endElement(e){let s=e.nodeName.toLowerCase();db.hasOwnProperty(s)&&!t1.hasOwnProperty(s)&&(this.buf.push("</"),this.buf.push(s),this.buf.push(">"))}chars(e){this.buf.push(pb(e))}checkClobberedElement(e,s){if(s&&(e.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return s}},uA=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,hA=/([^\#-~ |!])/g;function pb(i){return i.replace(/&/g,"&amp;").replace(uA,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(hA,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c_(i,e){let s=null;try{rp=rp||function(i){let e=new cy(i);return function(){try{return!!(new window.DOMParser).parseFromString(Zp(""),"text/html")}catch{return!1}}()?new ly(e):e}(i);let r=e?String(e):"";s=rp.getInertBodyElement(r);let c=5,o=r;do{if(0===c)throw new Error("Failed to sanitize html because the input is unstable");c--,r=o,o=s.innerHTML,s=rp.getInertBodyElement(r)}while(r!==o);return Zp((new uy).sanitizeChildren(fb(s)||s))}finally{if(s){let r=fb(s)||s;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function fb(i){return"content"in i&&function(i){return i.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===i.nodeName}(i)?i.content:null}var no=function(i){return i[i.NONE=0]="NONE",i[i.HTML=1]="HTML",i[i.STYLE=2]="STYLE",i[i.SCRIPT=3]="SCRIPT",i[i.URL=4]="URL",i[i.RESOURCE_URL=5]="RESOURCE_URL",i}(no||{});function o1(i){let e=function(){let i=Jt();return i&&i[ec].sanitizer}();return e?hb(e.sanitize(no.HTML,i)||""):Qa(i,"HTML")?hb(ko(i)):c_(Rw(),kp(i))}var gA=(i,e,s)=>null;function u_(i,e,s=!1){return gA(i,e,s)}var hy=class{},Mp=class{},dy=class{resolveComponentFactory(e){throw function(i){let e=Error(`No component factory found for ${Pi(i)}.`);return e.ngComponent=i,e}(e)}},Ys=(()=>{let e=class{},i=e;return e.NULL=new dy,i})();function vA(){return hc(dr(),Jt())}function hc(i,e){return new ps(Ar(i,e))}var ps=(()=>{let e=class{constructor(r){this.nativeElement=r}},i=e;return e.__NG_ELEMENT_ID__=vA,i})();function xA(i){return i instanceof ps?i.nativeElement:i}var Ga=class{},h_=(()=>{let e=class{constructor(){this.destroyNode=null}},i=e;return e.__NG_ELEMENT_ID__=()=>function(){let i=Jt(),s=qs(dr().index,i);return(Hs(s)?s:i)[Gn]}(),i})(),wA=(()=>{let e=class{},i=e;return e.\u0275prov=Be({token:e,providedIn:"root",factory:()=>null}),i})(),oc=class{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}},MA=new oc("17.0.2"),kg={};function d_(i){let e=Hi(null);try{return i()}finally{Hi(e)}}function s1(i){return!!p_(i)&&(Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i)}function p_(i){return null!==i&&("function"==typeof i||"object"==typeof i)}var py=class{constructor(){}supports(e){return s1(e)}create(e){return new fy(e)}},IA=(i,e)=>e,fy=class{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||IA}forEachItem(e){let s;for(s=this._itHead;null!==s;s=s._next)e(s)}forEachOperation(e){let s=this._itHead,r=this._removalsHead,c=0,o=null;for(;s||r;){let y=!r||s&&s.currentIndex<mb(r,c,o)?s:r,x=mb(y,c,o),I=y.currentIndex;if(y===r)c--,r=r._nextRemoved;else if(s=s._next,null==y.previousIndex)c++;else{o||(o=[]);let A=x-c,L=I-c;if(A!=L){for(let re=0;re<A;re++){let le=re<o.length?o[re]:o[re]=0,ve=le+re;L<=ve&&ve<A&&(o[re]=le+1)}o[y.previousIndex]=L-A}}x!==I&&e(y,x,I)}}forEachPreviousItem(e){let s;for(s=this._previousItHead;null!==s;s=s._nextPrevious)e(s)}forEachAddedItem(e){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)e(s)}forEachMovedItem(e){let s;for(s=this._movesHead;null!==s;s=s._nextMoved)e(s)}forEachRemovedItem(e){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)e(s)}forEachIdentityChange(e){let s;for(s=this._identityChangesHead;null!==s;s=s._nextIdentityChange)e(s)}diff(e){if(null==e&&(e=[]),!s1(e))throw new He(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let c,o,y,s=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let x=0;x<this.length;x++)o=e[x],y=this._trackByFn(x,o),null!==s&&Object.is(s.trackById,y)?(r&&(s=this._verifyReinsertion(s,o,y,x)),Object.is(s.item,o)||this._addIdentityChange(s,o)):(s=this._mismatch(s,o,y,x),r=!0),s=s._next}else c=0,function(i,e){if(Array.isArray(i))for(let s=0;s<i.length;s++)e(i[s]);else{let r,s=i[Symbol.iterator]();for(;!(r=s.next()).done;)e(r.value)}}(e,x=>{y=this._trackByFn(c,x),null!==s&&Object.is(s.trackById,y)?(r&&(s=this._verifyReinsertion(s,x,y,c)),Object.is(s.item,x)||this._addIdentityChange(s,x)):(s=this._mismatch(s,x,y,c),r=!0),s=s._next,c++}),this.length=c;return this._truncate(s),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,s,r,c){let o;return null===e?o=this._itTail:(o=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,s)||this._addIdentityChange(e,s),this._reinsertAfter(e,o,c)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,c))?(Object.is(e.item,s)||this._addIdentityChange(e,s),this._moveAfter(e,o,c)):e=this._addAfter(new my(s,r),o,c),e}_verifyReinsertion(e,s,r,c){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==o?e=this._reinsertAfter(o,e._prev,c):e.currentIndex!=c&&(e.currentIndex=c,this._addToMoves(e,c)),e}_truncate(e){for(;null!==e;){let s=e._next;this._addToRemovals(this._unlink(e)),e=s}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,s,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);let c=e._prevRemoved,o=e._nextRemoved;return null===c?this._removalsHead=o:c._nextRemoved=o,null===o?this._removalsTail=c:o._prevRemoved=c,this._insertAfter(e,s,r),this._addToMoves(e,r),e}_moveAfter(e,s,r){return this._unlink(e),this._insertAfter(e,s,r),this._addToMoves(e,r),e}_addAfter(e,s,r){return this._insertAfter(e,s,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,s,r){let c=null===s?this._itHead:s._next;return e._next=c,e._prev=s,null===c?this._itTail=e:c._prev=e,null===s?this._itHead=e:s._next=e,null===this._linkedRecords&&(this._linkedRecords=new Ep),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);let s=e._prev,r=e._next;return null===s?this._itHead=r:s._next=r,null===r?this._itTail=s:r._prev=s,e}_addToMoves(e,s){return e.previousIndex===s||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Ep),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,s){return e.item=s,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}},my=class{constructor(e,s){this.item=e,this.trackById=s,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},gy=class{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,s){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===s||s<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){let s=e._prevDup,r=e._nextDup;return null===s?this._head=r:s._nextDup=r,null===r?this._tail=s:r._prevDup=s,null===this._head}},Ep=class{constructor(){this.map=new Map}put(e){let s=e.trackById,r=this.map.get(s);r||(r=new gy,this.map.set(s,r)),r.add(e)}get(e,s){let c=this.map.get(e);return c?c.get(e,s):null}remove(e){let s=e.trackById;return this.map.get(s).remove(e)&&this.map.delete(s),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}};function mb(i,e,s){let r=i.previousIndex;if(null===r)return r;let c=0;return s&&r<s.length&&(c=s[r]),r+e+c}var yy=class{constructor(){}supports(e){return e instanceof Map||p_(e)}create(){return new _y}},_y=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let s;for(s=this._mapHead;null!==s;s=s._next)e(s)}forEachPreviousItem(e){let s;for(s=this._previousMapHead;null!==s;s=s._nextPrevious)e(s)}forEachChangedItem(e){let s;for(s=this._changesHead;null!==s;s=s._nextChanged)e(s)}forEachAddedItem(e){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)e(s)}forEachRemovedItem(e){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)e(s)}diff(e){if(e){if(!(e instanceof Map||p_(e)))throw new He(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let s=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,c)=>{if(s&&s.key===c)this._maybeAddToChanges(s,r),this._appendAfter=s,s=s._next;else{let o=this._getOrCreateRecordForKey(c,r);s=this._insertBeforeOrAppend(s,o)}}),s){s._prev&&(s._prev._next=null),this._removalsHead=s;for(let r=s;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,s){if(e){let r=e._prev;return s._next=e,s._prev=r,e._prev=s,r&&(r._next=s),e===this._mapHead&&(this._mapHead=s),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=s,s._prev=this._appendAfter):this._mapHead=s,this._appendAfter=s,null}_getOrCreateRecordForKey(e,s){if(this._records.has(e)){let c=this._records.get(e);this._maybeAddToChanges(c,s);let o=c._prev,y=c._next;return o&&(o._next=y),y&&(y._prev=o),c._next=null,c._prev=null,c}let r=new vy(e);return this._records.set(e,r),r.currentValue=s,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,s){Object.is(s,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=s,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,s){e instanceof Map?e.forEach(s):Object.keys(e).forEach(r=>s(e[r],r))}},vy=class{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function gb(){return new qp([new py])}var qp=(()=>{let e=class{constructor(r){this.factories=r}static create(r,c){if(null!=c){let o=c.factories.slice();r=r.concat(o)}return new e(r)}static extend(r){return{provide:e,useFactory:c=>e.create(r,c||gb()),deps:[[e,new Cw,new Xy]]}}find(r){let c=this.factories.find(o=>o.supports(r));if(null!=c)return c;throw new He(901,!1)}},i=e;return e.\u0275prov=Be({token:e,providedIn:"root",factory:gb}),i})();function yb(){return new f_([new yy])}var f_=(()=>{let e=class{constructor(r){this.factories=r}static create(r,c){if(c){let o=c.factories.slice();r=r.concat(o)}return new e(r)}static extend(r){return{provide:e,useFactory:c=>e.create(r,c||yb()),deps:[[e,new Cw,new Xy]]}}find(r){let c=this.factories.find(o=>o.supports(r));if(c)return c;throw new He(901,!1)}},i=e;return e.\u0275prov=Be({token:e,providedIn:"root",factory:yb}),i})();function Ip(i,e,s,r,c=!1){for(;null!==s;){let o=e[s.index];null!==o&&r.push(Po(o)),eo(o)&&DA(o,r);let y=s.type;if(8&y)Ip(i,e,s.child,r);else if(32&y){let I,x=r_(s,e);for(;I=x();)r.push(I)}else if(16&y){let x=qw(e,s);if(Array.isArray(x))r.push(...x);else{let I=o_(e[Ao]);Ip(I[At],I,x,r,!0)}}s=c?s.projectionNext:s.next}return r}function DA(i,e){for(let s=cr;s<i.length;s++){let r=i[s],c=r[At].firstChild;null!==c&&Ip(r[At],r,c,e)}i[Ua]!==i[hs]&&e.push(i[Ua])}var a1=[];var AA={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{zp(i.lView)},consumerOnSignalRead(){this.lView[ja]=this}};function Lg(i){return i.ngOriginalError}var us=class{constructor(){this._console=console}handleError(e){let s=this._findOriginalError(e);this._console.error("ERROR",e),s&&this._console.error("ORIGINAL ERROR",s)}_findOriginalError(e){let s=e&&Lg(e);for(;s&&Lg(s);)s=Lg(s);return s||null}},kA=new Pt("",{providedIn:"root",factory:()=>!1}),io={};function ft(i){c1(fi(),Jt(),Ka()+i,!1)}function c1(i,e,s,r){if(!r)if(3==(3&e[Tt])){let o=i.preOrderCheckHooks;null!==o&&ap(e,o,s)}else{let o=i.preOrderHooks;null!==o&&lp(e,o,0,s)}Va(s)}function Ke(i,e=$t.Default){let s=Jt();return null===s?Le(i,e):ww(dr(),s,Xi(i),e)}function Wp(i,e,s,r,c,o,y,x,I,A,L){let G=e.blueprint.slice();return G[hs]=c,G[Tt]=140|r,(null!==A||i&&2048&i[Tt])&&(G[Tt]|=2048),nw(G),G[ei]=G[cc]=i,G[Xr]=s,G[ec]=y||i&&i[ec],G[Gn]=x||i&&i[Gn],G[Jl]=I||i&&i[Jl]||null,G[to]=o,G[Np]=MT++,G[Gg]=L,G[Wb]=A,G[Ao]=2==e.type?i[Ao]:G,G}function Qu(i,e,s,r,c){let o=i.data[e];if(null===o)o=function(i,e,s,r,c){let o=ow(),y=Vy(),I=i.data[e]=function(i,e,s,r,c,o){let x=0;return null!==jt.skipHydrationRootTNode&&(x|=128),{type:s,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:x,providerIndexes:0,value:c,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?o:o&&o.parent,s,e,r,c);return null===i.firstChild&&(i.firstChild=I),null!==o&&(y?null==o.child&&null!==I.parent&&(o.child=I):null===o.next&&(o.next=I,I.prev=o)),I}(i,e,s,r,c),jt.lFrame.inI18n&&(o.flags|=32);else if(64&o.type){o.type=s,o.value=r,o.attrs=c;let y=function(){let i=jt.lFrame,e=i.currentTNode;return i.isParent?e:e.parent}();o.injectorIndex=null===y?-1:y.injectorIndex}return Ya(o,!0),o}function u1(i,e,s,r){if(0===s)return-1;let c=e.length;for(let o=0;o<s;o++)e.push(r),i.blueprint.push(r),i.data.push(null);return c}function h1(i,e,s,r,c){let o=Ka(),y=2&r;try{Va(-1),y&&e.length>Jr&&c1(i,e,Jr,!1),Do(y?2:0,c),s(r,c)}finally{Va(o),Do(y?3:1,c)}}function m_(i,e,s){if(jy(e)){let r=Hi(null);try{let o=e.directiveEnd;for(let y=e.directiveStart;y<o;y++){let x=i.data[y];x.contentQueries&&x.contentQueries(1,s[y],y)}}finally{Hi(r)}}}function g_(i,e,s){!rw()||(function(i,e,s,r){let c=s.directiveStart,o=s.directiveEnd;Rp(s)&&function(i,e,s){let r=Ar(e,i),c=d1(s),y=16;s.signals?y=4096:s.onPush&&(y=64);let x=Yp(i,Wp(i,c,null,y,r,e,null,i[ec].rendererFactory.createRenderer(r,s),null,null,null));i[e.index]=x}(e,s,i.data[c+s.componentOffset]),i.firstCreatePass||_p(s,e),Gs(r,e);let y=s.initialInputs;for(let x=c;x<o;x++){let I=i.data[x],A=Ha(e,i,x,s);Gs(A,e),null!==y&&n2(0,x-c,A,I,0,y),uc(I)&&(qs(s.index,e)[Xr]=Ha(e,i,x,s))}}(i,e,s,Ar(s,e)),64==(64&s.flags)&&m1(i,e,s))}function y_(i,e,s=Ar){let r=e.localNames;if(null!==r){let c=e.index+1;for(let o=0;o<r.length;o+=2){let y=r[o+1],x=-1===y?s(e,i):i[y];i[c++]=x}}}function d1(i){let e=i.tView;return null===e||e.incompleteFirstPass?i.tView=__(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):e}function __(i,e,s,r,c,o,y,x,I,A,L){let G=Jr+r,re=G+c,le=function(i,e){let s=[];for(let r=0;r<e;r++)s.push(r<i?null:io);return s}(G,re),ve="function"==typeof A?A():A;return le[At]={type:i,blueprint:le,template:s,queries:null,viewQuery:x,declTNode:e,data:le.slice().fill(null,G),bindingStartIndex:G,expandoStartIndex:re,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:I,consts:ve,incompleteFirstPass:!1,ssrId:L}}var zA=i=>null;function _b(i,e,s,r){for(let c in i)if(i.hasOwnProperty(c)){s=null===s?{}:s;let o=i[c];null===r?vb(s,e,c,o):r.hasOwnProperty(c)&&vb(s,e,r[c],o)}return s}function vb(i,e,s,r){i.hasOwnProperty(s)?i[s].push(e,r):i[s]=[e,r]}function p1(i,e,s,r,c,o,y,x){let L,I=Ar(e,s),A=e.inputs;!x&&null!=A&&(L=A[r])?(x_(i,s,L,r,c),Rp(e)&&function(i,e){let s=qs(e,i);16&s[Tt]||(s[Tt]|=64)}(s,e.index)):3&e.type&&(r=function(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(r),c=null!=y?y(c,e.value||"",r):c,o.setProperty(I,r,c))}function v_(i,e,s,r){if(rw()){let y,x,c=null===r?null:{"":-1},o=function(i,e){let s=i.directiveRegistry,r=null,c=null;if(s)for(let o=0;o<s.length;o++){let y=s[o];if(WC(e,y.selectors,!1))if(r||(r=[]),uc(y))if(null!==y.findHostDirectiveDefs){let x=[];c=c||new Map,y.findHostDirectiveDefs(y,x,c),r.unshift(...x,y),xy(i,e,x.length)}else r.unshift(y),xy(i,e,0);else c=c||new Map,y.findHostDirectiveDefs?.(y,r,c),r.push(y)}return null===r?null:[r,c]}(i,s);null===o?y=x=null:[y,x]=o,null!==y&&f1(i,e,s,y,c,x),c&&function(i,e,s){if(e){let r=i.localNames=[];for(let c=0;c<e.length;c+=2){let o=s[e[c+1]];if(null==o)throw new He(-301,!1);r.push(e[c],o)}}}(s,r,c)}s.mergedAttrs=By(s.mergedAttrs,s.attrs)}function f1(i,e,s,r,c,o){for(let A=0;A<r.length;A++)Yg(_p(s,e),i,r[A].type);!function(i,e,s){i.flags|=1,i.directiveStart=e,i.directiveEnd=e+s,i.providerIndexes=e}(s,i.data.length,r.length);for(let A=0;A<r.length;A++){let L=r[A];L.providersResolver&&L.providersResolver(L)}let y=!1,x=!1,I=u1(i,e,r.length,null);for(let A=0;A<r.length;A++){let L=r[A];s.mergedAttrs=By(s.mergedAttrs,L.hostAttrs),XA(i,s,e,I,L),KA(I,L,c),null!==L.contentQueries&&(s.flags|=4),(null!==L.hostBindings||null!==L.hostAttrs||0!==L.hostVars)&&(s.flags|=64);let G=L.type.prototype;!y&&(G.ngOnChanges||G.ngOnInit||G.ngDoCheck)&&((i.preOrderHooks??(i.preOrderHooks=[])).push(s.index),y=!0),!x&&(G.ngOnChanges||G.ngDoCheck)&&((i.preOrderCheckHooks??(i.preOrderCheckHooks=[])).push(s.index),x=!0),I++}!function(i,e,s){let c=e.directiveEnd,o=i.data,y=e.attrs,x=[],I=null,A=null;for(let L=e.directiveStart;L<c;L++){let G=o[L],re=s?s.get(G):null,ve=re?re.outputs:null;I=_b(G.inputs,L,I,re?re.inputs:null),A=_b(G.outputs,L,A,ve);let Ie=null===I||null===y||Vb(e)?null:i2(I,L,y);x.push(Ie)}null!==I&&(I.hasOwnProperty("class")&&(e.flags|=8),I.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=x,e.inputs=I,e.outputs=A}(i,s,o)}function m1(i,e,s){let r=s.directiveStart,c=s.directiveEnd,o=s.index,y=jt.lFrame.currentDirectiveIndex;try{Va(o);for(let x=r;x<c;x++){let I=i.data[x],A=e[x];qg(x),(null!==I.hostBindings||0!==I.hostVars||null!==I.hostAttrs)&&qA(I,A)}}finally{Va(-1),qg(y)}}function qA(i,e){null!==i.hostBindings&&i.hostBindings(1,e)}function xy(i,e,s){e.componentOffset=s,(i.components??(i.components=[])).push(e.index)}function KA(i,e,s){if(s){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)s[e.exportAs[r]]=i;uc(e)&&(s[""]=i)}}function XA(i,e,s,r,c){i.data[r]=c;let o=c.factory||(c.factory=nc(c.type)),y=new $a(o,uc(c),Ke);i.blueprint[r]=y,s[r]=y,function(i,e,s,r,c){let o=c.hostBindings;if(o){let y=i.hostBindingOpCodes;null===y&&(y=i.hostBindingOpCodes=[]);let x=~e.index;(function(i){let e=i.length;for(;e>0;){let s=i[--e];if("number"==typeof s&&s<0)return s}return 0})(y)!=x&&y.push(x),y.push(s,r,o)}}(i,e,r,u1(i,s,c.hostVars,io),c)}function n2(i,e,s,r,c,o){let y=o[e];if(null!==y)for(let x=0;x<y.length;)g1(r,s,y[x++],y[x++],y[x++])}function g1(i,e,s,r,c){let o=Hi(null);try{let y=i.inputTransforms;null!==y&&y.hasOwnProperty(r)&&(c=y[r].call(e,c)),null!==i.setInput?i.setInput(e,c,s,r):e[r]=c}finally{Hi(o)}}function i2(i,e,s){let r=null,c=0;for(;c<s.length;){let o=s[c];if(0!==o)if(5!==o){if("number"==typeof o)break;if(i.hasOwnProperty(o)){null===r&&(r=[]);let y=i[o];for(let x=0;x<y.length;x+=2)if(y[x]===e){r.push(o,y[x+1],s[c+1]);break}}c+=2}else c+=2;else c+=4}return r}function y1(i,e,s,r){return[i,!0,!1,e,null,r,!1,s,null,null,null]}function _1(i,e){let s=i.contentQueries;if(null!==s){let r=Hi(null);try{for(let c=0;c<s.length;c+=2){let y=s[c+1];if(-1!==y){let x=i.data[y];Gy(s[c]),x.contentQueries(2,e[y],y)}}}finally{Hi(r)}}}function Yp(i,e){return i[Bu]?i[nb][Qr]=e:i[Bu]=e,i[nb]=e,e}function by(i,e,s){Gy(0);let r=Hi(null);try{e(i,s)}finally{Hi(r)}}function v1(i){return i[zu]||(i[zu]=[])}function x1(i){return i.cleanup||(i.cleanup=[])}function b1(i,e){let s=i[Jl],r=s?s.get(us,null):null;r&&r.handleError(e)}function x_(i,e,s,r,c){for(let o=0;o<s.length;){let y=s[o++],x=s[o++];g1(i.data[y],e[y],r,x,c)}}function w1(i,e,s,r){let c=e[Tt];if(256==(256&c))return;e[ec].inlineEffectRunner?.flush(),Zy(e);let y=null,x=null;(function(i){return 2!==i.type})(i)&&(x=function(i){return i[ja]??function(i){let e=a1.pop()??Object.create(AA);return e.lView=i,e}(i)}(e),y=function(i){return i&&(i.nextProducerIndex=0),Hi(i)}(x));try{nw(e),function(i){jt.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==s&&h1(i,e,s,2,r);let I=3==(3&c);if(I){let G=i.preOrderCheckHooks;null!==G&&ap(e,G,null)}else{let G=i.preOrderHooks;null!==G&&lp(e,G,0,null),Cg(e,0)}if(function(i){for(let e=jw(i);null!==e;e=Uw(e)){if(!e[Kb])continue;let s=e[tc];for(let r=0;r<s.length;r++){fS(s[r])}}}(e),M1(e,0),null!==i.contentQueries&&_1(i,e),I){let G=i.contentCheckHooks;null!==G&&ap(e,G)}else{let G=i.contentHooks;null!==G&&lp(e,G,1),Cg(e,1)}!function(i,e){let s=i.hostBindingOpCodes;if(null!==s)try{for(let r=0;r<s.length;r++){let c=s[r];if(c<0)Va(~c);else{let o=c,y=s[++r],x=s[++r];DS(y,o),x(2,e[o])}}}finally{Va(-1)}}(i,e);let A=i.components;null!==A&&D1(e,A,0);let L=i.viewQuery;if(null!==L&&by(2,L,r),I){let G=i.viewCheckHooks;null!==G&&ap(e,G)}else{let G=i.viewHooks;null!==G&&lp(e,G,2),Cg(e,2)}if(!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),e[Dg]){for(let G of e[Dg])G();e[Dg]=null}e[Tt]&=-73}catch(I){throw zp(e),I}finally{null!==x&&(function(i,e){if(Hi(e),i&&void 0!==i.producerNode&&void 0!==i.producerIndexOfThis&&void 0!==i.producerLastReadVersion){if(hg(i))for(let s=i.nextProducerIndex;s<i.producerNode.length;s++)ug(i.producerNode[s],i.producerIndexOfThis[s]);for(;i.producerNode.length>i.nextProducerIndex;)i.producerNode.pop(),i.producerLastReadVersion.pop(),i.producerIndexOfThis.pop()}}(x,y),function(i){i.lView[ja]!==i&&(i.lView=null,a1.push(i))}(x)),qy()}}function M1(i,e){for(let s=jw(i);null!==s;s=Uw(s)){s[Zg]=!1;for(let r=cr;r<s.length;r++)E1(s[r],e)}}function u2(i,e,s){E1(qs(e,i),s)}function E1(i,e){!Uy(i)||I1(i,e)}function I1(i,e){let r=i[At],c=i[Tt],o=i[ja],y=!!(0===e&&16&c);if(y||(y=!!(64&c&&0===e)),y||(y=!!(1024&c)),y||(y=!(!o?.dirty||!cg(o))),o&&(o.dirty=!1),i[Tt]&=-9217,y)w1(r,i,r.template,i[Xr]);else if(8192&c){M1(i,1);let x=r.components;null!==x&&D1(i,x,1)}}function D1(i,e,s){for(let r=0;r<e.length;r++)u2(i,e[r],s)}function b_(i){for(;i;){i[Tt]|=64;let e=o_(i);if(oS(i)&&!e)return i;i=e}return null}var Za=class{get rootNodes(){let e=this._lView,s=e[At];return Ip(s,e,s.firstChild,[])}constructor(e,s,r=!0){this._lView=e,this._cdRefInjectingView=s,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Xr]}set context(e){this._lView[Xr]=e}get destroyed(){return 256==(256&this._lView[Tt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[ei];if(eo(e)){let s=e[8],r=s?s.indexOf(this):-1;r>-1&&(ty(e,r),vp(s,r))}this._attachedToViewContainer=!1}Gw(this._lView[At],this._lView)}onDestroy(e){!function(i,e){if(256==(256&i[Tt]))throw new He(911,!1);null===i[Ou]&&(i[Ou]=[]),i[Ou].push(e)}(this._lView,e)}markForCheck(){b_(this._cdRefInjectingView||this._lView)}detach(){this._lView[Tt]&=-129}reattach(){iw(this._lView),this._lView[Tt]|=128}detectChanges(){!function(i,e,s,r=!0){let c=e[ec],o=c.rendererFactory,y=c.afterRenderEventManager;o.begin?.(),y?.begin();try{w1(i,e,i.template,s),function(i){let e=0;for(;9216&i[Tt]||i[ja]?.dirty;){if(100===e)throw new He(103,!1);e++,I1(i,1)}}(e)}catch(I){throw r&&b1(e,I),I}finally{o.end?.(),c.inlineEffectRunner?.flush(),y?.end()}}(this._lView[At],this._lView,this.context,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new He(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(i,e){Yu(i,e,e[Gn],2,null,null)}(this._lView[At],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new He(902,!1);this._appRef=e}},ki=(()=>{let e=class{},i=e;return e.__NG_ELEMENT_ID__=h2,i})();function h2(i){return function(i,e,s){if(Rp(i)&&!s){let r=qs(i.index,e);return new Za(r,r)}return 47&i.type?new Za(e[Ao],e):null}(dr(),Jt(),16==(16&i))}function Og(i){return e=>{setTimeout(i,void 0,e)}}var Mt=class extends Ct{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,s,r){let c=e,o=s||(()=>null),y=r;if(e&&"object"==typeof e){let I=e;c=I.next?.bind(I),o=I.error?.bind(I),y=I.complete?.bind(I)}this.__isAsync&&(o=Og(o),c&&(c=Og(c)),y&&(y=Og(y)));let x=super.subscribe({next:c,error:o,complete:y});return e instanceof di&&e.add(x),x}};function xb(...i){}var wn=class{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Mt(!1),this.onMicrotaskEmpty=new Mt(!1),this.onStable=new Mt(!1),this.onError=new Mt(!1),typeof Zone>"u")throw new He(908,!1);Zone.assertZonePatched();let c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!r&&s,c.shouldCoalesceRunChangeDetection=r,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function(){let i="function"==typeof bi.requestAnimationFrame,e=bi[i?"requestAnimationFrame":"setTimeout"],s=bi[i?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&s){let r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);let c=s[Zone.__symbol__("OriginalDelegate")];c&&(s=c)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:s}}().nativeRequestAnimationFrame,function(i){let e=()=>{!function(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(bi,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,My(i),i.isCheckStableRunning=!0,w_(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),My(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,r,c,o,y,x)=>{if(function(i){return!(!Array.isArray(i)||1!==i.length)&&!0===i[0].data?.__ignore_ng_zone__}(x))return s.invokeTask(c,o,y,x);try{return bb(i),s.invokeTask(c,o,y,x)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||i.shouldCoalesceRunChangeDetection)&&e(),wb(i)}},onInvoke:(s,r,c,o,y,x,I)=>{try{return bb(i),s.invoke(c,o,y,x,I)}finally{i.shouldCoalesceRunChangeDetection&&e(),wb(i)}},onHasTask:(s,r,c,o)=>{s.hasTask(c,o),r===c&&("microTask"==o.change?(i._hasPendingMicrotasks=o.microTask,My(i),w_(i)):"macroTask"==o.change&&(i.hasPendingMacrotasks=o.macroTask))},onHandleError:(s,r,c,o)=>(s.handleError(c,o),i.runOutsideAngular(()=>i.onError.emit(o)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!wn.isInAngularZone())throw new He(909,!1)}static assertNotInAngularZone(){if(wn.isInAngularZone())throw new He(909,!1)}run(e,s,r){return this._inner.run(e,s,r)}runTask(e,s,r,c){let o=this._inner,y=o.scheduleEventTask("NgZoneEvent: "+c,e,f2,xb,xb);try{return o.runTask(y,s,r)}finally{o.cancelTask(y)}}runGuarded(e,s,r){return this._inner.runGuarded(e,s,r)}runOutsideAngular(e){return this._outer.run(e)}},f2={};function w_(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function My(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function bb(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function wb(i){i._nesting--,w_(i)}var Ey=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Mt,this.onMicrotaskEmpty=new Mt,this.onStable=new Mt,this.onError=new Mt}run(e,s,r){return e.apply(s,r)}runGuarded(e,s,r){return e.apply(s,r)}runOutsideAngular(e){return e()}runTask(e,s,r,c){return e.apply(s,r)}},C1=new Pt("",{providedIn:"root",factory:S1});function S1(){let i=Ln(wn),e=!0;return Pu(new In(c=>{e=i.isStable&&!i.hasPendingMacrotasks&&!i.hasPendingMicrotasks,i.runOutsideAngular(()=>{c.next(e),c.complete()})}),new In(c=>{let o;i.runOutsideAngular(()=>{o=i.onStable.subscribe(()=>{wn.assertNotInAngularZone(),queueMicrotask(()=>{!e&&!i.hasPendingMacrotasks&&!i.hasPendingMicrotasks&&(e=!0,c.next(!0))})})});let y=i.onUnstable.subscribe(()=>{wn.assertInAngularZone(),e&&(e=!1,i.runOutsideAngular(()=>{c.next(!1)}))});return()=>{o.unsubscribe(),y.unsubscribe()}}).pipe(ep()))}var _2=(()=>{let e=class{constructor(){this.renderDepth=0,this.handler=null,this.internalCallbacks=[]}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth){for(let r of this.internalCallbacks)r();this.internalCallbacks.length=0,this.handler?.execute()}}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}},i=e;return e.\u0275prov=Be({token:e,providedIn:"root",factory:()=>new e}),i})();function v2(i,e){let s=qs(e,i),r=s[At];!function(i,e){for(let s=e.length;s<i.blueprint.length;s++)e.push(i.blueprint[s])}(r,s);let c=s[hs];null!==c&&null===s[Gg]&&(s[Gg]=u_(c,s[Jl])),M_(r,s,s[Xr])}function M_(i,e,s){Zy(e);try{let r=i.viewQuery;null!==r&&by(1,r,s);let c=i.template;null!==c&&h1(i,e,c,1,s),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&_1(i,e),i.staticViewQueries&&by(2,i.viewQuery,s);let o=i.components;null!==o&&function(i,e){for(let s=0;s<e.length;s++)v2(i,e[s])}(e,o)}catch(r){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),r}finally{e[Tt]&=-5,qy()}}function Dp(i,e,s){let r=s?i.styles:null,c=s?i.classes:null,o=0;if(null!==e)for(let y=0;y<e.length;y++){let x=e[y];"number"==typeof x?o=x:1==o?c=jg(c,x):2==o&&(r=jg(r,x+": "+e[++y]+";"))}s?i.styles=r:i.stylesWithoutHost=r,s?i.classes=c:i.classesWithoutHost=c}var Iy=class extends Ys{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let s=Xl(e);return new Cp(s,this.ngModule)}};function Mb(i){let e=[];for(let s in i)i.hasOwnProperty(s)&&e.push({propName:i[s],templateName:s});return e}var Dy=class{constructor(e,s){this.injector=e,this.parentInjector=s}get(e,s,r){r=Lp(r);let c=this.injector.get(e,kg,r);return c!==kg||s===kg?c:this.parentInjector.get(e,s,r)}},Cp=class extends Mp{get inputs(){let e=this.componentDef,s=e.inputTransforms,r=Mb(e.inputs);if(null!==s)for(let c of r)s.hasOwnProperty(c.propName)&&(c.transform=s[c.propName]);return r}get outputs(){return Mb(this.componentDef.outputs)}constructor(e,s){super(),this.componentDef=e,this.ngModule=s,this.componentType=e.type,this.selector=function(i){return i.map(QC).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!s}create(e,s,r,c){let o=(c=c||this.ngModule)instanceof as?c:c?.injector;o&&null!==this.componentDef.getStandaloneInjector&&(o=this.componentDef.getStandaloneInjector(o)||o);let y=o?new Dy(e,o):e,x=y.get(Ga,null);if(null===x)throw new He(407,!1);let L={rendererFactory:x,sanitizer:y.get(wA,null),inlineEffectRunner:null,afterRenderEventManager:y.get(_2,null)},G=x.createRenderer(null,this.componentDef),re=this.componentDef.selectors[0][0]||"div",le=r?function(i,e,s,r){let o=r.get(kA,!1)||s===To.ShadowDom,y=i.selectRootElement(e,o);return function(i){zA(i)}(y),y}(G,r,this.componentDef.encapsulation,y):$w(G,re,function(i){let e=i.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(re)),je=this.componentDef.signals?4608:this.componentDef.onPush?576:528,Ae=null;null!==le&&(Ae=u_(le,y,!0));let ot,ln,yt=__(0,null,null,1,0,null,null,null,null,null,null),rt=Wp(null,yt,null,je,null,null,L,G,y,null,Ae);Zy(rt);try{let nn,kt=this.componentDef,Cn=null;kt.findHostDirectiveDefs?(nn=[],Cn=new Map,kt.findHostDirectiveDefs(kt,nn,Cn),nn.push(kt)):nn=[kt];let jn=function(i,e){let s=i[At],r=Jr;return i[r]=e,Qu(s,r,2,"#host",null)}(rt,le),Pn=function(i,e,s,r,c,o,y){let x=c[At];!function(i,e,s,r){for(let c of i)e.mergedAttrs=By(e.mergedAttrs,c.hostAttrs);null!==e.mergedAttrs&&(Dp(e,e.mergedAttrs,!0),null!==s&&Yw(r,s,e))}(r,i,e,y);let I=null;null!==e&&(I=u_(e,c[Jl]));let A=o.rendererFactory.createRenderer(e,s),L=16;s.signals?L=4096:s.onPush&&(L=64);let G=Wp(c,d1(s),null,L,c[i.index],i,o,A,null,null,I);return x.firstCreatePass&&xy(x,i,r.length-1),Yp(c,G),c[i.index]=G}(jn,le,kt,nn,rt,L,G);ln=tw(yt,Jr),le&&function(i,e,s,r){if(r)Hg(i,s,["ng-version",MA.full]);else{let{attrs:c,classes:o}=function(i){let e=[],s=[],r=1,c=2;for(;r<i.length;){let o=i[r];if("string"==typeof o)2===c?""!==o&&e.push(o,i[++r]):8===c&&s.push(o);else{if(!Yr(c))break;c=o}r++}return{attrs:e,classes:s}}(e.selectors[0]);c&&Hg(i,s,c),o&&o.length>0&&Ww(i,s,o.join(" "))}}(G,kt,le,r),void 0!==s&&function(i,e,s){let r=i.projection=[];for(let c=0;c<e.length;c++){let o=s[c];r.push(null!=o?Array.from(o):null)}}(ln,this.ngContentSelectors,s),ot=function(i,e,s,r,c,o){let y=dr(),x=c[At],I=Ar(y,c);f1(x,c,y,s,null,r);for(let L=0;L<s.length;L++)Gs(Ha(c,x,y.directiveStart+L,y),c);m1(x,c,y),I&&Gs(I,c);let A=Ha(c,x,y.directiveStart+y.componentOffset,y);if(i[Xr]=c[Xr]=A,null!==o)for(let L of o)L(A,e);return m_(x,y,i),A}(Pn,kt,nn,Cn,rt,[T2]),M_(yt,rt,null)}finally{qy()}return new Cy(this.componentType,ot,hc(ln,rt),rt,ln)}},Cy=class extends hy{constructor(e,s,r,c,o){super(),this.location=r,this._rootLView=c,this._tNode=o,this.previousInputValues=null,this.instance=s,this.hostView=this.changeDetectorRef=new Za(c,void 0,!1),this.componentType=e}setInput(e,s){let c,r=this._tNode.inputs;if(null!==r&&(c=r[e])){if(this.previousInputValues??(this.previousInputValues=new Map),this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),s))return;let o=this._rootLView;x_(o[At],o,c,e,s),this.previousInputValues.set(e,s),b_(qs(this._tNode.index,o))}}get injector(){return new Ba(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function T2(){let i=dr();Up(Jt()[At],i)}function E_(i,e,s){return i[e]=s}function Zs(i,e,s){return!Object.is(i[e],s)&&(i[e]=s,!0)}function mi(i,e,s,r){let c=Jt();return Zs(c,Hy(),e)&&(fi(),function(i,e,s,r,c,o){let y=Ar(i,e);!function(i,e,s,r,c,o,y){if(null==o)i.removeAttribute(e,c,s);else{let x=null==y?kp(o):y(o,r||"",c);i.setAttribute(e,c,x,s)}}(e[Gn],y,o,i.value,s,r,c)}(Wy(),c,i,e,s,r)),mi}function T1(i,e,s,r){return Zs(i,Hy(),s)?e+kp(s)+r:io}function op(i,e){return i<<17|e<<2}function qa(i){return i>>17&32767}function Sy(i){return 2|i}function sc(i){return(131068&i)>>2}function Ng(i,e){return-131069&i|e<<2}function Ty(i){return 1|i}function Eb(i,e,s,r,c){let o=i[s+1],y=null===e,x=r?qa(o):sc(o),I=!1;for(;0!==x&&(!1===I||y);){let L=i[x+1];F2(i[x],e)&&(I=!0,i[x+1]=r?Ty(L):Sy(L)),x=r?qa(L):sc(L)}I&&(i[s+1]=r?Sy(o):Ty(o))}function F2(i,e){return null===i||null==e||(Array.isArray(i)?i[1]:i)===e||!(!Array.isArray(i)||"string"!=typeof e)&&Wu(i,e)>=0}var Kr={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function z2(i){return i.substring(Kr.key,Kr.keyEnd)}function A1(i,e){let s=Kr.textEnd;return s===e?-1:(e=Kr.keyEnd=function(i,e,s){for(;e<s&&i.charCodeAt(e)>32;)e++;return e}(i,Kr.key=e,s),P1(i,e,s))}function P1(i,e,s){for(;e<s&&i.charCodeAt(e)<=32;)e++;return e}function at(i,e,s){let r=Jt();return Zs(r,Hy(),e)&&p1(fi(),Wy(),r,i,e,r[Gn],s,!1),at}function Ay(i,e,s,r,c){let y=c?"class":"style";x_(i,s,e.inputs[y],y,r)}function wi(i,e){return function(i,e,s,r){let c=Jt(),o=fi(),y=aw(2);o.firstUpdatePass&&L1(o,i,y,true),e!==io&&Zs(c,y,e)&&O1(o,o.data[Ka()],c,c[Gn],i,c[y+1]=function(i,e){return null==i||""===i||"object"==typeof i&&(i=Pi(ko(i))),i}(e),true,y)}(i,e),wi}function I_(i){!function(i,e,s,r){let c=fi(),o=aw(2);c.firstUpdatePass&&L1(c,null,o,r);let y=Jt();if(s!==io&&Zs(y,o,s)){let x=c.data[Ka()];if(N1(x,r)&&!k1(c,o)){let I=x.classesWithoutHost;null!==I&&(s=jg(I,s||"")),Ay(c,x,y,s,r)}else!function(i,e,s,r,c,o,y,x){c===io&&(c=lr);let I=0,A=0,L=0<c.length?c[0]:null,G=0<o.length?o[0]:null;for(;null!==L||null!==G;){let Ie,re=I<c.length?c[I+1]:void 0,le=A<o.length?o[A+1]:void 0,ve=null;L===G?(I+=2,A+=2,re!==le&&(ve=G,Ie=le)):null===G||null!==L&&L<G?(I+=2,ve=L):(A+=2,ve=G,Ie=le),null!==ve&&O1(i,e,s,r,ve,Ie,true,x),L=I<c.length?c[I]:null,G=A<o.length?o[A]:null}}(c,x,y,y[Gn],y[o+1],y[o+1]=function(i,e,s){if(null==s||""===s)return lr;let r=[],c=ko(s);if(Array.isArray(c))for(let o=0;o<c.length;o++)i(r,c[o],!0);else if("object"==typeof c)for(let o in c)c.hasOwnProperty(o)&&i(r,o,c[o]);else"string"==typeof c&&e(r,c);return r}(i,e,s),0,o)}}(K2,V2,i,!0)}function V2(i,e){for(let s=function(i){return function(i){Kr.key=0,Kr.keyEnd=0,Kr.value=0,Kr.valueEnd=0,Kr.textEnd=i.length}(i),A1(i,P1(i,0,Kr.textEnd))}(e);s>=0;s=A1(e,s))Qy(i,z2(e),!0)}function k1(i,e){return e>=i.expandoStartIndex}function L1(i,e,s,r){let c=i.data;if(null===c[s+1]){let o=c[Ka()],y=k1(i,s);N1(o,r)&&null===e&&!y&&(e=!1),e=function(i,e,s,r){let c=function(i){let e=jt.lFrame.currentDirectiveIndex;return-1===e?null:i[e]}(i),o=r?e.residualClasses:e.residualStyles;if(null===c)0===(r?e.classBindings:e.styleBindings)&&(s=Uu(s=Rg(null,i,e,s,r),e.attrs,r),o=null);else{let y=e.directiveStylingLast;if(-1===y||i[y]!==c)if(s=Rg(c,i,e,s,r),null===o){let I=function(i,e,s){let r=s?e.classBindings:e.styleBindings;if(0!==sc(r))return i[qa(r)]}(i,e,r);void 0!==I&&Array.isArray(I)&&(I=Rg(null,i,e,I[1],r),I=Uu(I,e.attrs,r),function(i,e,s,r){i[qa(s?e.classBindings:e.styleBindings)]=r}(i,e,r,I))}else o=function(i,e,s){let r,c=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<c;o++)r=Uu(r,i[o].hostAttrs,s);return Uu(r,e.attrs,s)}(i,e,r)}return void 0!==o&&(r?e.residualClasses=o:e.residualStyles=o),s}(c,o,e,r),function(i,e,s,r,c,o){let y=o?e.classBindings:e.styleBindings,x=qa(y),I=sc(y);i[r]=s;let L,A=!1;if(Array.isArray(s)?(L=s[1],(null===L||Wu(s,L)>0)&&(A=!0)):L=s,c)if(0!==I){let re=qa(i[x+1]);i[r+1]=op(re,x),0!==re&&(i[re+1]=Ng(i[re+1],r)),i[x+1]=function(i,e){return 131071&i|e<<17}(i[x+1],r)}else i[r+1]=op(x,0),0!==x&&(i[x+1]=Ng(i[x+1],r)),x=r;else i[r+1]=op(I,0),0===x?x=r:i[I+1]=Ng(i[I+1],r),I=r;A&&(i[r+1]=Sy(i[r+1])),Eb(i,L,r,!0),Eb(i,L,r,!1),function(i,e,s,r,c){let o=c?i.residualClasses:i.residualStyles;null!=o&&"string"==typeof e&&Wu(o,e)>=0&&(s[r+1]=Ty(s[r+1]))}(e,L,i,r,o),y=op(x,I),o?e.classBindings=y:e.styleBindings=y}(c,o,e,s,y,r)}}function Rg(i,e,s,r,c){let o=null,y=s.directiveEnd,x=s.directiveStylingLast;for(-1===x?x=s.directiveStart:x++;x<y&&(o=e[x],r=Uu(r,o.hostAttrs,c),o!==i);)x++;return null!==i&&(s.directiveStylingLast=x),r}function Uu(i,e,s){let r=s?1:2,c=-1;if(null!==e)for(let o=0;o<e.length;o++){let y=e[o];"number"==typeof y?c=y:c===r&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),Qy(i,y,!!s||e[++o]))}return void 0===i?null:i}function K2(i,e,s){let r=String(e);""!==r&&!r.includes(" ")&&Qy(i,r,s)}function O1(i,e,s,r,c,o,y,x){if(!(3&e.type))return;let I=i.data,A=I[x+1],L=function(i){return 1==(1&i)}(A)?Ib(I,e,s,c,sc(A),y):void 0;Sp(L)||(Sp(o)||function(i){return 2==(2&i)}(A)&&(o=Ib(I,null,s,c,x,y)),function(i,e,s,r,c){if(e)c?i.addClass(s,r):i.removeClass(s,r);else{let o=-1===r.indexOf("-")?void 0:ls.DashCase;null==c?i.removeStyle(s,r,o):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),o|=ls.Important),i.setStyle(s,r,c,o))}}(r,y,ew(Ka(),s),c,o))}function Ib(i,e,s,r,c,o){let x,y=null===e;for(;c>0;){let I=i[c],A=Array.isArray(I),L=A?I[1]:I,G=null===L,re=s[c+1];re===io&&(re=G?lr:void 0);let le=G?Tg(re,r):L===r?re:void 0;if(A&&!Sp(le)&&(le=Tg(I,r)),Sp(le)&&(x=le,y))return x;let ve=i[c+1];c=y?qa(ve):sc(ve)}if(null!==e){let I=o?e.residualClasses:e.residualStyles;null!=I&&(x=Tg(I,r))}return x}function Sp(i){return void 0!==i}function N1(i,e){return 0!=(i.flags&(e?8:16))}function Cb(i,e){return!e||zw(i)}function tP(i,e,s,r=!0){let c=e[At];if(function(i,e,s,r){let c=cr+r,o=s.length;r>0&&(s[c-1][Qr]=e),r<o-cr?(e[Qr]=s[c],Dw(s,cr+r,e)):(s.push(e),e[Qr]=null),e[ei]=s;let y=e[qu];null!==y&&s!==y&&function(i,e){let s=i[tc];e[Ao]!==e[ei][ei][Ao]&&(i[Kb]=!0),null===s?i[tc]=[e]:s.push(e)}(y,e);let x=e[So];null!==x&&x.insertView(i),iw(e),e[Tt]|=128}(c,e,i,s),r){let o=ny(s,i),y=e[Gn],x=s_(y,i[Ua]);null!==x&&function(i,e,s,r,c,o){r[hs]=c,r[to]=e,Yu(i,r,s,1,c,o)}(c,i[to],y,e,x,o)}}var Ks=(()=>{let e=class{},i=e;return e.__NG_ELEMENT_ID__=nP,i})();function nP(){return F1(dr(),Jt())}var iP=Ks,R1=class extends iP{constructor(e,s,r){super(),this._lContainer=e,this._hostTNode=s,this._hostLView=r}get element(){return hc(this._hostTNode,this._hostLView)}get injector(){return new Ba(this._hostTNode,this._hostLView)}get parentInjector(){let e=Yy(this._hostTNode,this._hostLView);if(gw(e)){let s=gp(e,this._hostLView),r=mp(e);return new Ba(s[At].data[r+8],s)}return new Ba(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let s=Sb(this._lContainer);return null!==s&&s[e]||null}get length(){return this._lContainer.length-cr}createEmbeddedView(e,s,r){let c,o;"number"==typeof r?c=r:null!=r&&(c=r.index,o=r.injector);let x=e.createEmbeddedViewImpl(s||{},o,null);return this.insertImpl(x,c,Cb(this._hostTNode,null)),x}createComponent(e,s,r,c,o){let x,y=e&&!function(i){return"function"==typeof i}(e);if(y)x=s;else{let ve=s||{};x=ve.index,r=ve.injector,c=ve.projectableNodes,o=ve.environmentInjector||ve.ngModuleRef}let I=y?e:new Cp(Xl(e)),A=r||this.parentInjector;if(!o&&null==I.ngModule){let Ie=(y?A:this.parentInjector).get(as,null);Ie&&(o=Ie)}Xl(I.componentType??{});let le=I.create(A,c,null,o);return this.insertImpl(le.hostView,x,Cb(this._hostTNode,null)),le}insert(e,s){return this.insertImpl(e,s,!0)}insertImpl(e,s,r){let c=e._lView;if(function(i){return eo(i[ei])}(c)){let x=this.indexOf(e);if(-1!==x)this.detach(x);else{let I=c[ei],A=new R1(I,I[to],I[ei]);A.detach(A.indexOf(e))}}let o=this._adjustIndex(s),y=this._lContainer;return tP(y,c,o,r),e.attachToViewContainerRef(),Dw(Fg(y),o,e),e}move(e,s){return this.insert(e,s)}indexOf(e){let s=Sb(this._lContainer);return null!==s?s.indexOf(e):-1}remove(e){let s=this._adjustIndex(e,-1),r=ty(this._lContainer,s);r&&(vp(Fg(this._lContainer),s),Gw(r[At],r))}detach(e){let s=this._adjustIndex(e,-1),r=ty(this._lContainer,s);return r&&null!=vp(Fg(this._lContainer),s)?new Za(r):null}_adjustIndex(e,s=0){return e??this.length+s}};function Sb(i){return i[8]}function Fg(i){return i[8]||(i[8]=[])}function F1(i,e){let s,r=e[i.index];return eo(r)?s=r:(s=y1(r,e,null,i),e[i.index]=s,Yp(e,s)),oP(s,e,i,r),new R1(s,i,e)}var oP=function(i,e,s,r){if(i[Ua])return;let c;c=8&s.type?Po(r):function(i,e){let s=i[Gn],r=s.createComment(""),c=Ar(e,i);return wp(s,s_(s,c),r,function(i,e){return i.nextSibling(e)}(s,c),!1),r}(e,s),i[Ua]=c},sP=(i,e,s)=>!1;function un(i,e,s,r,c,o,y,x){let I=Jt(),A=fi(),L=i+Jr,G=A.firstCreatePass?function(i,e,s,r,c,o,y,x,I){let A=e.consts,L=Qu(e,i,4,y||null,ic(A,x));v_(e,s,L,ic(A,I)),Up(e,L);let G=L.tView=__(2,L,r,c,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,A,null);return null!==e.queries&&(e.queries.template(e,L),G.queries=e.queries.embeddedTView(L)),L}(L,A,I,e,s,r,c,o,y):A.data[L];Ya(G,!1);let re=uP(A,I,G,i);Bp()&&Gp(A,I,re,G),Gs(re,I);let le=y1(re,I,re,G);return I[L]=le,Yp(I,le),function(i,e,s){sP(i,e,s)}(le,G,I),Fp(G)&&g_(A,I,G),null!=y&&y_(I,G,x),un}var uP=function(i,e,s,r){return jp(!0),e[Gn].createComment("")};function dt(i,e,s,r){let c=Jt(),o=fi(),y=Jr+i,x=c[Gn],I=o.firstCreatePass?function(i,e,s,r,c,o){let y=e.consts,I=Qu(e,i,2,r,ic(y,c));return v_(e,s,I,ic(y,o)),null!==I.attrs&&Dp(I,I.attrs,!1),null!==I.mergedAttrs&&Dp(I,I.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,I),I}(y,o,c,e,s,r):o.data[y],A=pP(o,c,I,x,e,i);c[y]=A;let L=Fp(I);return Ya(I,!0),Yw(x,A,I),32!=(32&I.flags)&&Bp()&&Gp(o,c,A,I),0===jt.lFrame.elementDepthCount&&Gs(A,c),jt.lFrame.elementDepthCount++,L&&(g_(o,c,I),m_(o,I,c)),null!==r&&y_(c,I),dt}function pt(){let i=dr();Vy()?sw():(i=i.parent,Ya(i,!1));let e=i;(function(i){return jt.skipHydrationRootTNode===i})(e)&&(jt.skipHydrationRootTNode=null),jt.lFrame.elementDepthCount--;let s=fi();return s.firstCreatePass&&(Up(s,i),jy(i)&&s.queries.elementEnd(i)),null!=e.classesWithoutHost&&function(i){return 0!=(8&i.flags)}(e)&&Ay(s,e,Jt(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(i){return 0!=(16&i.flags)}(e)&&Ay(s,e,Jt(),e.stylesWithoutHost,!1),pt}function fr(i,e,s,r){return dt(i,e,s,r),pt(),fr}var pP=(i,e,s,r,c,o)=>(jp(!0),$w(r,c,jt.lFrame.currentNamespace));function ro(i,e,s){let r=Jt(),c=fi(),o=i+Jr,y=c.firstCreatePass?function(i,e,s,r,c){let o=e.consts,y=ic(o,r),x=Qu(e,i,8,"ng-container",y);return null!==y&&Dp(x,y,!0),v_(e,s,x,ic(o,c)),null!==e.queries&&e.queries.elementStart(e,x),x}(o,c,r,e,s):c.data[o];Ya(y,!0);let x=mP(c,r,y,i);return r[o]=x,Bp()&&Gp(c,r,x,y),Gs(x,r),Fp(y)&&(g_(c,r,y),m_(c,y,r)),null!=s&&y_(r,y),ro}function oo(){let i=dr(),e=fi();return Vy()?sw():(i=i.parent,Ya(i,!1)),e.firstCreatePass&&(Up(e,i),jy(i)&&e.queries.elementEnd(i)),oo}var mP=(i,e,s,r)=>(jp(!0),function(i,e){return i.createComment(function(i){return i.replace(vT,e=>e.replace(xT,"\u200b$1\u200b"))}(e))}(e[Gn],""));function hn(){return Jt()}var Tp="en-US";function Kp(i){return!!i&&"function"==typeof i.then}function D_(i){return!!i&&"function"==typeof i.subscribe}function Ot(i,e,s,r){let c=Jt(),o=fi(),y=dr();return function(i,e,s,r,c,o,y){let x=Fp(r),A=i.firstCreatePass&&x1(i),L=e[Xr],G=v1(e),re=!0;if(3&r.type||y){let Ie=Ar(r,e),je=y?y(Ie):Ie,Ae=G.length,yt=y?ot=>y(Po(ot[r.index])):r.index,rt=null;if(!y&&x&&(rt=function(i,e,s,r){let c=i.cleanup;if(null!=c)for(let o=0;o<c.length-1;o+=2){let y=c[o];if(y===s&&c[o+1]===r){let x=e[zu],I=c[o+2];return x.length>I?x[I]:null}"string"==typeof y&&(o+=2)}return null}(i,e,c,r.index)),null!==rt)(rt.__ngLastListenerFn__||rt).__ngNextListenerFn__=o,rt.__ngLastListenerFn__=o,re=!1;else{o=Ab(r,e,L,o,!1);let ot=s.listen(je,c,o);G.push(o,ot),A&&A.push(c,yt,Ae,Ae+1)}}else o=Ab(r,e,L,o,!1);let ve,le=r.outputs;if(re&&null!==le&&(ve=le[c])){let Ie=ve.length;if(Ie)for(let je=0;je<Ie;je+=2){let ln=e[ve[je]][ve[je+1]].subscribe(o),kt=G.length;G.push(o,ln),A&&A.push(c,r.index,kt,-(kt+1))}}}(o,c,c[Gn],y,i,e,r),Ot}function Tb(i,e,s,r){try{return Do(6,e,s),!1!==s(r)}catch(c){return b1(i,c),!1}finally{Do(7,e,s)}}function Ab(i,e,s,r,c){return function o(y){if(y===Function)return r;b_(i.componentOffset>-1?qs(i.index,e):e);let I=Tb(e,s,r,y),A=o.__ngNextListenerFn__;for(;A;)I=Tb(e,s,A,y)&&I,A=A.__ngNextListenerFn__;return c&&!1===I&&y.preventDefault(),I}}function ct(i=1){return function(i){return(jt.lFrame.contextLView=function(i,e){for(;i>0;)e=e[cc],i--;return e}(i,jt.lFrame.contextLView))[Xr]}(i)}function C_(i,e,s){return z1(i,"",e,"",s),C_}function z1(i,e,s,r,c){let o=Jt(),y=T1(o,e,s,r);return y!==io&&p1(fi(),Wy(),o,i,y,o[Gn],c,!1),z1}function Lo(i,e=""){let s=Jt(),r=fi(),c=i+Jr,o=r.firstCreatePass?Qu(r,c,1,e,null):r.data[c],y=bP(r,s,o,e,i);s[c]=y,Bp()&&Gp(r,s,y,o),Ya(o,!1)}var bP=(i,e,s,r,c)=>(jp(!0),function(i,e){return i.createText(e)}(e[Gn],r));function Xu(i){return Qp("",i,""),Xu}function Qp(i,e,s){let r=Jt(),c=T1(r,i,e,s);return c!==io&&function(i,e,s){let r=ew(e,i);!function(i,e,s){i.setValue(e,s)}(i[Gn],r,s)}(r,Ka(),c),Qp}function Py(i,e,s,r,c){if(i=Xi(i),Array.isArray(i))for(let o=0;o<i.length;o++)Py(i[o],e,s,r,c);else{let o=fi(),y=Jt(),x=dr(),I=rc(i)?i:Xi(i.provide),A=Lw(i),L=1048575&x.providerIndexes,G=x.directiveStart,re=x.providerIndexes>>20;if(rc(i)||!i.multi){let le=new $a(A,c,Ke),ve=Bg(I,e,c?L:L+re,G);-1===ve?(Yg(_p(x,y),o,I),zg(o,i,e.length),e.push(I),x.directiveStart++,x.directiveEnd++,c&&(x.providerIndexes+=1048576),s.push(le),y.push(le)):(s[ve]=le,y[ve]=le)}else{let le=Bg(I,e,L+re,G),ve=Bg(I,e,L,L+re),je=ve>=0&&s[ve];if(c&&!je||!c&&!(le>=0&&s[le])){Yg(_p(x,y),o,I);let Ae=function(i,e,s,r,c){let o=new $a(i,s,Ke);return o.multi=[],o.index=e,o.componentProviders=0,B1(o,c,r&&!s),o}(c?EP:MP,s.length,c,r,A);!c&&je&&(s[ve].providerFactory=Ae),zg(o,i,e.length,0),e.push(I),x.directiveStart++,x.directiveEnd++,c&&(x.providerIndexes+=1048576),s.push(Ae),y.push(Ae)}else zg(o,i,le>-1?le:ve,B1(s[c?ve:le],A,!c&&r));!c&&r&&je&&s[ve].componentProviders++}}}function zg(i,e,s,r){let c=rc(e),o=function(i){return!!i.useClass}(e);if(c||o){let I=(o?Xi(e.useClass):e).prototype.ngOnDestroy;if(I){let A=i.destroyHooks||(i.destroyHooks=[]);if(!c&&e.multi){let L=A.indexOf(s);-1===L?A.push(s,[r,I]):A[L+1].push(r,I)}else A.push(s,I)}}}function B1(i,e,s){return s&&i.componentProviders++,i.multi.push(e)-1}function Bg(i,e,s,r){for(let c=s;c<r;c++)if(e[c]===i)return c;return-1}function MP(i,e,s,r){return ky(this.multi,[])}function EP(i,e,s,r){let o,c=this.multi;if(this.providerFactory){let y=this.providerFactory.componentProviders,x=Ha(s,s[At],this.providerFactory.index,r);o=x.slice(0,y),ky(c,o);for(let I=y;I<x.length;I++)o.push(x[I])}else o=[],ky(c,o);return o}function ky(i,e){for(let s=0;s<i.length;s++)e.push((0,i[s])());return e}function Xp(i,e=[]){return s=>{s.providersResolver=(r,c)=>function(i,e,s){let r=fi();if(r.firstCreatePass){let c=uc(i);Py(s,r.data,r.blueprint,c,!0),Py(e,r.data,r.blueprint,c,!1)}}(r,c?c(i):i,e)}}var ac=class{},Ly=class{},Ap=class extends ac{constructor(e,s,r){super(),this._parent=s,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Iy(this);let c=function(i,e){let s=i[DC]||null;return s}(e);this._bootstrapComponents=function(i){return i instanceof Function?i():i}(c.bootstrap),this._r3Injector=Ow(e,s,[{provide:ac,useValue:this},{provide:Ys,useValue:this.componentFactoryResolver},...r],Pi(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},Oy=class extends Ly{constructor(e){super(),this.moduleType=e}create(e){return new Ap(this.moduleType,e,[])}};function V1(i,e){let s=i[e];return s===io?void 0:s}function fs(i,e){let r,s=fi(),c=i+Jr;s.firstCreatePass?(r=function(i,e){if(e)for(let s=e.length-1;s>=0;s--){let r=e[s];if(i===r.name)return r}}(e,s.pipeRegistry),s.data[c]=r,r.onDestroy&&(s.destroyHooks??(s.destroyHooks=[])).push(c,r.onDestroy)):r=s.data[c];let o=r.factory||(r.factory=nc(r.type)),x=Tr(Ke);try{let I=yp(!1),A=o();return yp(I),function(i,e,s,r){s>=i.data.length&&(i.data[s]=null,i.blueprint[s]=null),e[s]=r}(s,Jt(),c,A),A}finally{Tr(x)}}function ms(i,e,s){let r=i+Jr,c=Jt(),o=function(i,e){return i[e]}(c,r);return function(i,e){return i[At].data[e].pure}(c,r)?function(i,e,s,r,c,o){let y=e+s;return Zs(i,y,c)?E_(i,y+1,o?r.call(o,c):r(c)):V1(i,y+1)}(c,$y(),e,o.transform,s,o):o.transform(s)}function PP(){return this._results[Symbol.iterator]()}var Vu=class{get changes(){return this._changes||(this._changes=new Mt)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;let s=Vu.prototype;s[Symbol.iterator]||(s[Symbol.iterator]=PP)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,s){return this._results.reduce(e,s)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,s){this.dirty=!1;let r=function(i){return i.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function(i,e,s){if(i.length!==e.length)return!1;for(let r=0;r<i.length;r++){let c=i[r],o=e[r];if(s&&(c=s(c),o=s(o)),o!==c)return!1}return!0}(this._results,r,s))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}},Wa=(()=>{let e=class{},i=e;return e.__NG_ELEMENT_ID__=OP,i})(),kP=Wa,LP=class extends kP{constructor(e,s,r){super(),this._declarationLView=e,this._declarationTContainer=s,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,s){return this.createEmbeddedViewImpl(e,s)}createEmbeddedViewImpl(e,s,r){let c=function(i,e,s,r){let c=e.tView,x=Wp(i,c,s,4096&i[Tt]?4096:16,null,e,null,null,null,r?.injector??null,r?.dehydratedView??null);x[qu]=i[e.index];let A=i[So];return null!==A&&(x[So]=A.createEmbeddedView(c)),M_(c,x,s),x}(this._declarationLView,this._declarationTContainer,e,{injector:s,dehydratedView:r});return new Za(c)}};function OP(){return S_(dr(),Jt())}function S_(i,e){return 4&i.type?new LP(e,i,hc(i,e)):null}var $u=class{constructor(e){this.queryList=e,this.matches=null}clone(){return new $u(this.queryList)}setDirty(){this.queryList.setDirty()}},Hu=class{constructor(e=[]){this.queries=e}createEmbeddedView(e){let s=e.queries;if(null!==s){let r=null!==e.contentQueries?e.contentQueries[0]:s.length,c=[];for(let o=0;o<r;o++){let y=s.getByIndex(o);c.push(this.queries[y.indexInDeclarationView].clone())}return new Hu(c)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let s=0;s<this.queries.length;s++)null!==H1(e,s).matches&&this.queries[s].setDirty()}},Ny=class{constructor(e,s,r=null){this.predicate=e,this.flags=s,this.read=r}},Gu=class{constructor(e=[]){this.queries=e}elementStart(e,s){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,s)}elementEnd(e){for(let s=0;s<this.queries.length;s++)this.queries[s].elementEnd(e)}embeddedTView(e){let s=null;for(let r=0;r<this.length;r++){let c=null!==s?s.length:0,o=this.getByIndex(r).embeddedTView(e,c);o&&(o.indexInDeclarationView=r,null!==s?s.push(o):s=[o])}return null!==s?new Gu(s):null}template(e,s){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,s)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},Zu=class{constructor(e,s=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=s}elementStart(e,s){this.isApplyingToNode(s)&&this.matchTNode(e,s)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,s){this.elementStart(e,s)}embeddedTView(e,s){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,s),new Zu(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){let s=this._declarationNodeIndex,r=e.parent;for(;null!==r&&8&r.type&&r.index!==s;)r=r.parent;return s===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,s){let r=this.metadata.predicate;if(Array.isArray(r))for(let c=0;c<r.length;c++){let o=r[c];this.matchTNodeWithReadOption(e,s,NP(s,o)),this.matchTNodeWithReadOption(e,s,cp(s,e,o,!1,!1))}else r===Wa?4&s.type&&this.matchTNodeWithReadOption(e,s,-1):this.matchTNodeWithReadOption(e,s,cp(s,e,r,!1,!1))}matchTNodeWithReadOption(e,s,r){if(null!==r){let c=this.metadata.read;if(null!==c)if(c===ps||c===Ks||c===Wa&&4&s.type)this.addMatch(s.index,-2);else{let o=cp(s,e,c,!1,!1);null!==o&&this.addMatch(s.index,o)}else this.addMatch(s.index,r)}}addMatch(e,s){null===this.matches?this.matches=[e,s]:this.matches.push(e,s)}};function NP(i,e){let s=i.localNames;if(null!==s)for(let r=0;r<s.length;r+=2)if(s[r]===e)return s[r+1];return null}function FP(i,e,s,r){return-1===s?function(i,e){return 11&i.type?hc(i,e):4&i.type?S_(i,e):null}(e,i):-2===s?function(i,e,s){return s===ps?hc(e,i):s===Wa?S_(e,i):s===Ks?F1(e,i):void 0}(i,e,r):Ha(i,i[At],s,e)}function $1(i,e,s,r){let c=e[So].queries[r];if(null===c.matches){let o=i.data,y=s.matches,x=[];for(let I=0;I<y.length;I+=2){let A=y[I];x.push(A<0?null:FP(e,o[A],y[I+1],s.metadata.read))}c.matches=x}return c.matches}function Ry(i,e,s,r){let c=i.queries.getByIndex(s),o=c.matches;if(null!==o){let y=$1(i,e,c,s);for(let x=0;x<o.length;x+=2){let I=o[x];if(I>0)r.push(y[x/2]);else{let A=o[x+1],L=e[-I];for(let G=cr;G<L.length;G++){let re=L[G];re[qu]===re[ei]&&Ry(re[At],re,A,r)}if(null!==L[tc]){let G=L[tc];for(let re=0;re<G.length;re++){let le=G[re];Ry(le[At],le,A,r)}}}}}return r}function Xa(i){let e=Jt(),s=fi(),r=lw();Gy(r+1);let c=H1(s,r);if(i.dirty&&function(i){return 4==(4&i[Tt])}(e)===(2==(2&c.metadata.flags))){if(null===c.matches)i.reset([]);else{let o=c.crossesNgTemplate?Ry(s,e,r,[]):$1(s,e,c,r);i.reset(o,xA),i.notifyOnChanges()}return!0}return!1}function Ja(i,e,s){let r=fi();r.firstCreatePass&&(function(i,e,s){null===i.queries&&(i.queries=new Gu),i.queries.track(new Zu(e,-1))}(r,new Ny(i,e,s)),2==(2&e)&&(r.staticViewQueries=!0)),function(i,e,s){let r=new Vu(4==(4&s));(function(i,e,s,r){let c=v1(e);c.push(s),i.firstCreatePass&&x1(i).push(r,c.length-1)})(i,e,r,r.destroy),null===e[So]&&(e[So]=new Hu),e[So].queries.push(new $u(r))}(r,Jt(),e)}function el(){return function(i,e){return i[So].queries[e].queryList}(Jt(),lw())}function H1(i,e){return i.queries.getByIndex(e)}var A_,$P=new Pt("Application Initializer"),G1=(()=>{let e=class{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,c)=>{this.resolve=r,this.reject=c}),this.appInits=Ln($P,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let r=[];for(let o of this.appInits){let y=o();if(Kp(y))r.push(y);else if(D_(y)){let x=new Promise((I,A)=>{y.subscribe({complete:I,error:A})});r.push(x)}}let c=()=>{this.done=!0,this.resolve()};Promise.all(r).then(()=>{c()}).catch(o=>{this.reject(o)}),0===r.length&&c(),this.initialized=!0}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),Ju=new Pt("LocaleId",{providedIn:"root",factory:()=>Ln(Ju,$t.Optional|$t.SkipSelf)||typeof $localize<"u"&&$localize.locale||Tp}),Jp=(()=>{let e=class{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new rs(!1)}add(){this.hasPendingTasks.next(!0);let r=this.taskId++;return this.pendingTasks.add(r),r}remove(r){this.pendingTasks.delete(r),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),T_=new Pt(""),eh=new Pt(""),ef=(()=>{let e=class{constructor(r,c,o){this._ngZone=r,this.registry=c,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,A_||(function(i){A_=i}(o),o.addToWindow(c)),this._watchAngularEvents(),r.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{wn.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let r=this._callbacks.pop();clearTimeout(r.timeoutId),r.doneCb(this._didWork)}this._didWork=!1});else{let r=this.getPendingTasks();this._callbacks=this._callbacks.filter(c=>!c.updateCb||!c.updateCb(r)||(clearTimeout(c.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(r=>({source:r.source,creationLocation:r.creationLocation,data:r.data})):[]}addCallback(r,c,o){let y=-1;c&&c>0&&(y=setTimeout(()=>{this._callbacks=this._callbacks.filter(x=>x.timeoutId!==y),r(this._didWork,this.getPendingTasks())},c)),this._callbacks.push({doneCb:r,timeoutId:y,updateCb:o})}whenStable(r,c,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(r,c,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(r){this.registry.registerApplication(r,this)}unregisterApplication(r){this.registry.unregisterApplication(r)}findProviders(r,c,o){return[]}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(wn),Le(tf),Le(eh))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),tf=(()=>{let e=class{constructor(){this._applications=new Map}registerApplication(r,c){this._applications.set(r,c)}unregisterApplication(r){this._applications.delete(r)}unregisterAllApplications(){this._applications.clear()}getTestability(r){return this._applications.get(r)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(r,c=!0){return A_?.findTestabilityInTree(this,r,c)??null}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"platform"}),i})(),Nu=null,Z1=new Pt("AllowMultipleToken"),q1=new Pt("PlatformDestroyListeners"),W1=new Pt("appBootstrapListener");function P_(i,e,s=[]){let r=`Platform: ${e}`,c=new Pt(r);return(o=[])=>{let y=Y1();if(!y||y.injector.get(Z1,!1)){let x=[...s,...o,{provide:c,useValue:!0}];i?i(x):function(i){if(Nu&&!Nu.get(Z1,!1))throw new He(400,!1);Nu=i;let e=i.get(K1);(function(i){i.get(t_,null)?.forEach(s=>s())})(i)}(function(i=[],e){return pr.create({name:e,providers:[{provide:$p,useValue:"platform"},{provide:q1,useValue:new Set([()=>Nu=null])},...i]})}(x,r))}return function(i){let e=Y1();if(!e)throw new He(401,!1);return e}()}}function Y1(){return Nu?.get(K1)??null}var K1=(()=>{let e=class{constructor(r){this._injector=r,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(r,c){let o=function(i="zone.js",e){return"noop"===i?new Ey:"zone.js"===i?new wn(e):i}(c?.ngZone,function(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}({eventCoalescing:c?.ngZoneEventCoalescing,runCoalescing:c?.ngZoneRunCoalescing}));return o.run(()=>{let y=function(i,e,s){return new Ap(i,e,s)}(r.moduleType,this.injector,[{provide:wn,useFactory:()=>o},{provide:Vp,multi:!0,useFactory:()=>{let e=Ln(rk,{optional:!0});return()=>e.initialize()}},{provide:X1,useFactory:ik},{provide:C1,useFactory:S1}]),x=y.injector.get(us,null);return o.runOutsideAngular(()=>{let I=o.onError.subscribe({next:A=>{x.handleError(A)}});y.onDestroy(()=>{dp(this._modules,y),I.unsubscribe()})}),function(i,e,s){try{let r=s();return Kp(r)?r.catch(c=>{throw e.runOutsideAngular(()=>i.handleError(c)),c}):r}catch(r){throw e.runOutsideAngular(()=>i.handleError(r)),r}}(x,o,()=>{let I=y.injector.get(G1);return I.runInitializers(),I.donePromise.then(()=>(function(i){(function(i,e){null==i&&function(i,e,s,r){throw new Error(`ASSERTION ERROR: ${i} [Expected=> null != ${e} <=Actual]`)}(e,i)})(i,"Expected localeId to be defined"),"string"==typeof i&&i.toLowerCase().replace(/_/g,"-")}(y.injector.get(Ju,Tp)||Tp),this._moduleDoBootstrap(y),y))})})}bootstrapModule(r,c=[]){let o=Q1({},c);return function(i,e,s){let r=new Oy(s);return Promise.resolve(r)}(0,0,r).then(y=>this.bootstrapModuleFactory(y,o))}_moduleDoBootstrap(r){let c=r.injector.get(so);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(o=>c.bootstrap(o));else{if(!r.instance.ngDoBootstrap)throw new He(-403,!1);r.instance.ngDoBootstrap(c)}this._modules.push(r)}onDestroy(r){this._destroyListeners.push(r)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new He(404,!1);this._modules.slice().forEach(c=>c.destroy()),this._destroyListeners.forEach(c=>c());let r=this._injector.get(q1,null);r&&(r.forEach(c=>c()),r.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(pr))},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"platform"}),i})();function Q1(i,e){return Array.isArray(e)?e.reduce(Q1,i):{...i,...e}}var so=(()=>{let e=class{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ln(X1),this.zoneIsStable=Ln(C1),this.componentTypes=[],this.components=[],this.isStable=Ln(Jp).hasPendingTasks.pipe(ss(r=>r?Hl(!1):this.zoneIsStable),function(i,e=Vl){return i=i??xC,Xt((s,r)=>{let c,o=!0;s.subscribe(an(r,y=>{let x=e(y);(o||!i(c,x))&&(o=!1,c=x,r.next(y))}))})}(),ep()),this._injector=Ln(as)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(r,c){let x,o=r instanceof Mp;if(!this._injector.get(G1).done)throw!o&&function(i){Xl(i)||Hb(i)||Gb(i)}(r),new He(405,!1);x=o?r:this._injector.get(Ys).resolveComponentFactory(r),this.componentTypes.push(x.componentType);let I=function(i){return i.isBoundToModule}(x)?void 0:this._injector.get(ac),L=x.create(pr.NULL,[],c||x.selector,I),G=L.location.nativeElement,re=L.injector.get(T_,null);return re?.registerApplication(G),L.onDestroy(()=>{this.detachView(L.hostView),dp(this.components,L),re?.unregisterApplication(G)}),this._loadComponent(L),L}tick(){if(this._runningTick)throw new He(101,!1);try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1}}attachView(r){let c=r;this._views.push(c),c.attachToAppRef(this)}detachView(r){let c=r;dp(this._views,c),c.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r);let c=this._injector.get(W1,[]);[...this._bootstrapListeners,...c].forEach(o=>o(r))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(r=>r()),this._views.slice().forEach(r=>r.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(r){return this._destroyListeners.push(r),()=>dp(this._destroyListeners,r)}destroy(){if(this._destroyed)throw new He(406,!1);let r=this._injector;r.destroy&&!r.destroyed&&r.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})();function dp(i,e){let s=i.indexOf(e);s>-1&&i.splice(s,1)}var X1=new Pt("",{providedIn:"root",factory:()=>Ln(us).handleError.bind(void 0)});function ik(){let i=Ln(wn),e=Ln(us);return s=>i.runOutsideAngular(()=>e.handleError(s))}var rk=(()=>{let e=class{constructor(){this.zone=Ln(wn),this.applicationRef=Ln(so)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),J1=P_(null,"core",[]),eM=(()=>{let e=class{constructor(r){}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(so))},e.\u0275mod=hr({type:e}),e.\u0275inj=ur({}),i})(),L_=null;function rf(){return L_}var nf=class{},Li=new Pt("DocumentToken");function of(i,e){e=encodeURIComponent(e);for(let s of i.split(";")){let r=s.indexOf("="),[c,o]=-1==r?[s,""]:[s.slice(0,r),s.slice(r+1)];if(c.trim()===e)return decodeURIComponent(o)}return null}var k_=/\s+/,tM=[],sf=(()=>{let e=class{constructor(r,c,o,y){this._iterableDiffers=r,this._keyValueDiffers=c,this._ngEl=o,this._renderer=y,this.initialClasses=tM,this.stateMap=new Map}set klass(r){this.initialClasses=null!=r?r.trim().split(k_):tM}set ngClass(r){this.rawClass="string"==typeof r?r.trim().split(k_):r}ngDoCheck(){for(let c of this.initialClasses)this._updateState(c,!0);let r=this.rawClass;if(Array.isArray(r)||r instanceof Set)for(let c of r)this._updateState(c,!0);else if(null!=r)for(let c of Object.keys(r))this._updateState(c,Boolean(r[c]));this._applyStateDiff()}_updateState(r,c){let o=this.stateMap.get(r);void 0!==o?(o.enabled!==c&&(o.changed=!0,o.enabled=c),o.touched=!0):this.stateMap.set(r,{enabled:c,changed:!0,touched:!0})}_applyStateDiff(){for(let r of this.stateMap){let c=r[0],o=r[1];o.changed?(this._toggleClass(c,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(c,!1),this.stateMap.delete(c)),o.touched=!1}}_toggleClass(r,c){(r=r.trim()).length>0&&r.split(k_).forEach(o=>{c?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(qp),Ke(f_),Ke(ps),Ke(h_))},e.\u0275dir=lc({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),i})(),O_=class{constructor(e,s,r,c){this.$implicit=e,this.ngForOf=s,this.index=r,this.count=c}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}},pc=(()=>{let e=class{set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}constructor(r,c,o){this._viewContainer=r,this._template=c,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let r=this._ngForOf;!this._differ&&r&&(this._differ=this._differs.find(r).create(this.ngForTrackBy))}if(this._differ){let r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){let c=this._viewContainer;r.forEachOperation((o,y,x)=>{if(null==o.previousIndex)c.createEmbeddedView(this._template,new O_(o.item,this._ngForOf,-1,-1),null===x?void 0:x);else if(null==x)c.remove(null===y?void 0:y);else if(null!==y){let I=c.get(y);c.move(I,x),nM(I,o)}});for(let o=0,y=c.length;o<y;o++){let I=c.get(o).context;I.index=o,I.count=y,I.ngForOf=this._ngForOf}r.forEachIdentityChange(o=>{nM(c.get(o.currentIndex),o)})}static ngTemplateContextGuard(r,c){return!0}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(Ks),Ke(Wa),Ke(qp))},e.\u0275dir=lc({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),i})();function nM(i,e){i.context.$implicit=e.item}var Bn=(()=>{let e=class{constructor(r,c){this._viewContainer=r,this._context=new N_,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=c}set ngIf(r){this._context.$implicit=this._context.ngIf=r,this._updateView()}set ngIfThen(r){iM("ngIfThen",r),this._thenTemplateRef=r,this._thenViewRef=null,this._updateView()}set ngIfElse(r){iM("ngIfElse",r),this._elseTemplateRef=r,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(r,c){return!0}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(Ks),Ke(Wa))},e.\u0275dir=lc({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),i})(),N_=class{constructor(){this.$implicit=null,this.ngIf=null}};function iM(i,e){if(e&&!e.createEmbeddedView)throw new Error(`${i} must be a TemplateRef, but received '${Pi(e)}'.`)}var R_=class{createSubscription(e,s){return d_(()=>e.subscribe({next:s,error:r=>{throw r}}))}dispose(e){d_(()=>e.unsubscribe())}},F_=class{createSubscription(e,s){return e.then(s,r=>{throw r})}dispose(e){}},lk=new F_,ck=new R_,oM=(()=>{let e=class{constructor(r){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=r}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(r){return this._obj?r!==this._obj?(this._dispose(),this.transform(r)):this._latestValue:(r&&this._subscribe(r),this._latestValue)}_subscribe(r){this._obj=r,this._strategy=this._selectStrategy(r),this._subscription=this._strategy.createSubscription(r,c=>this._updateLatestValue(r,c))}_selectStrategy(r){if(Kp(r))return lk;if(D_(r))return ck;throw new He(2100,!1)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(r,c){r===this._obj&&(this._latestValue=c,this._ref.markForCheck())}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(ki,16))},e.\u0275pipe=$b({name:"async",type:e,pure:!1,standalone:!0}),i})(),af=(()=>{let e=class{},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275mod=hr({type:e}),e.\u0275inj=ur({}),i})();function z_(i){return"server"===i}var dc=class{},th=class{},cf=class{},ao=class{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?"string"==typeof e?this.lazyInit=()=>{this.headers=new Map,e.split("\n").forEach(s=>{let r=s.indexOf(":");if(r>0){let c=s.slice(0,r),o=c.toLowerCase(),y=s.slice(r+1).trim();this.maybeSetNormalizedName(c,o),this.headers.has(o)?this.headers.get(o).push(y):this.headers.set(o,[y])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((s,r)=>{this.setHeaderEntries(r,s)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([s,r])=>{this.setHeaderEntries(s,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let s=this.headers.get(e.toLowerCase());return s&&s.length>0?s[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,s){return this.clone({name:e,value:s,op:"a"})}set(e,s){return this.clone({name:e,value:s,op:"s"})}delete(e,s){return this.clone({name:e,value:s,op:"d"})}maybeSetNormalizedName(e,s){this.normalizedNames.has(s)||this.normalizedNames.set(s,e)}init(){this.lazyInit&&(this.lazyInit instanceof ao?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(s=>{this.headers.set(s,e.headers.get(s)),this.normalizedNames.set(s,e.normalizedNames.get(s))})}clone(e){let s=new ao;return s.lazyInit=this.lazyInit&&this.lazyInit instanceof ao?this.lazyInit:this,s.lazyUpdate=(this.lazyUpdate||[]).concat([e]),s}applyUpdate(e){let s=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,s);let c=("a"===e.op?this.headers.get(s):void 0)||[];c.push(...r),this.headers.set(s,c);break;case"d":let o=e.value;if(o){let y=this.headers.get(s);if(!y)return;y=y.filter(x=>-1===o.indexOf(x)),0===y.length?(this.headers.delete(s),this.normalizedNames.delete(s)):this.headers.set(s,y)}else this.headers.delete(s),this.normalizedNames.delete(s)}}setHeaderEntries(e,s){let r=(Array.isArray(s)?s:[s]).map(o=>o.toString()),c=e.toLowerCase();this.headers.set(c,r),this.maybeSetNormalizedName(e,c)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(s=>e(this.normalizedNames.get(s),this.headers.get(s)))}},j_=class{encodeKey(e){return aM(e)}encodeValue(e){return aM(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}},fk=/%(\d[a-f0-9])/gi,mk={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function aM(i){return encodeURIComponent(i).replace(fk,(e,s)=>mk[s]??e)}function lf(i){return`${i}`}var Oo=class{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new j_,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(i,e){let s=new Map;return i.length>0&&i.replace(/^\?/,"").split("&").forEach(c=>{let o=c.indexOf("="),[y,x]=-1==o?[e.decodeKey(c),""]:[e.decodeKey(c.slice(0,o)),e.decodeValue(c.slice(o+1))],I=s.get(y)||[];I.push(x),s.set(y,I)}),s}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(s=>{let r=e.fromObject[s],c=Array.isArray(r)?r.map(lf):[lf(r)];this.map.set(s,c)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let s=this.map.get(e);return s?s[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,s){return this.clone({param:e,value:s,op:"a"})}appendAll(e){let s=[];return Object.keys(e).forEach(r=>{let c=e[r];Array.isArray(c)?c.forEach(o=>{s.push({param:r,value:o,op:"a"})}):s.push({param:r,value:c,op:"a"})}),this.clone(s)}set(e,s){return this.clone({param:e,value:s,op:"s"})}delete(e,s){return this.clone({param:e,value:s,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let s=this.encoder.encodeKey(e);return this.map.get(e).map(r=>s+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>""!==e).join("&")}clone(e){let s=new Oo({encoder:this.encoder});return s.cloneFrom=this.cloneFrom||this,s.updates=(this.updates||[]).concat(e),s}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let s=("a"===e.op?this.map.get(e.param):void 0)||[];s.push(lf(e.value)),this.map.set(e.param,s);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let r=this.map.get(e.param)||[],c=r.indexOf(lf(e.value));-1!==c&&r.splice(c,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}},U_=class{constructor(){this.map=new Map}set(e,s){return this.map.set(e,s),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function lM(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer}function cM(i){return typeof Blob<"u"&&i instanceof Blob}function uM(i){return typeof FormData<"u"&&i instanceof FormData}var tl=class{constructor(e,s,r,c){let o;if(this.url=s,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(i){switch(i){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||c?(this.body=void 0!==r?r:null,o=c):o=r,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),this.transferCache=o.transferCache),this.headers||(this.headers=new ao),this.context||(this.context=new U_),this.params){let y=this.params.toString();if(0===y.length)this.urlWithParams=s;else{let x=s.indexOf("?");this.urlWithParams=s+(-1===x?"?":x<s.length-1?"&":"")+y}}else this.params=new Oo,this.urlWithParams=s}serializeBody(){return null===this.body?null:lM(this.body)||cM(this.body)||uM(this.body)||function(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Oo?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||uM(this.body)?null:cM(this.body)?this.body.type||null:lM(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Oo?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){let s=e.method||this.method,r=e.url||this.url,c=e.responseType||this.responseType,o=void 0!==e.body?e.body:this.body,y=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,x=void 0!==e.reportProgress?e.reportProgress:this.reportProgress,I=e.headers||this.headers,A=e.params||this.params,L=e.context??this.context;return void 0!==e.setHeaders&&(I=Object.keys(e.setHeaders).reduce((G,re)=>G.set(re,e.setHeaders[re]),I)),e.setParams&&(A=Object.keys(e.setParams).reduce((G,re)=>G.set(re,e.setParams[re]),A)),new tl(s,r,o,{params:A,headers:I,context:L,reportProgress:x,responseType:c,withCredentials:y})}},fc=function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i}(fc||{}),nh=class{constructor(e,s=200,r="OK"){this.headers=e.headers||new ao,this.status=void 0!==e.status?e.status:s,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},ih=class extends nh{constructor(e={}){super(e),this.type=fc.ResponseHeader}clone(e={}){return new ih({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},mc=class extends nh{constructor(e={}){super(e),this.type=fc.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new mc({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},uf=class extends nh{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}};function B_(i,e){return{body:e,headers:i.headers,context:i.context,observe:i.observe,params:i.params,reportProgress:i.reportProgress,responseType:i.responseType,withCredentials:i.withCredentials,transferCache:i.transferCache}}var V_=(()=>{let e=class{constructor(r){this.handler=r}request(r,c,o={}){let y;if(r instanceof tl)y=r;else{let A,L;A=o.headers instanceof ao?o.headers:new ao(o.headers),o.params&&(L=o.params instanceof Oo?o.params:new Oo({fromObject:o.params})),y=new tl(r,c,void 0!==o.body?o.body:null,{headers:A,context:o.context,params:L,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let x=Hl(y).pipe(function(i,e){return Zt(e)?$s(i,e,1):$s(i,1)}(A=>this.handler.handle(A)));if(r instanceof tl||"events"===o.observe)return x;let I=x.pipe(function(i,e){return Xt((s,r)=>{let c=0;s.subscribe(an(r,o=>i.call(undefined,o,c++)&&r.next(o)))})}(A=>A instanceof mc));switch(o.observe||"body"){case"body":switch(y.responseType){case"arraybuffer":return I.pipe(Gi(A=>{if(null!==A.body&&!(A.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return A.body}));case"blob":return I.pipe(Gi(A=>{if(null!==A.body&&!(A.body instanceof Blob))throw new Error("Response is not a Blob.");return A.body}));case"text":return I.pipe(Gi(A=>{if(null!==A.body&&"string"!=typeof A.body)throw new Error("Response is not a string.");return A.body}));default:return I.pipe(Gi(A=>A.body))}case"response":return I;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(r,c={}){return this.request("DELETE",r,c)}get(r,c={}){return this.request("GET",r,c)}head(r,c={}){return this.request("HEAD",r,c)}jsonp(r,c){return this.request("JSONP",r,{params:(new Oo).append(c,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,c={}){return this.request("OPTIONS",r,c)}patch(r,c,o={}){return this.request("PATCH",r,B_(o,c))}post(r,c,o={}){return this.request("POST",r,B_(o,c))}put(r,c,o={}){return this.request("PUT",r,B_(o,c))}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(th))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})();function fM(i,e){return e(i)}function _k(i,e){return(s,r)=>e.intercept(s,{handle:c=>i(c,r)})}var xk=new Pt(""),$_=new Pt(""),bk=new Pt(""),wk=new Pt("");function Mk(){let i=null;return(e,s)=>{null===i&&(i=(Ln(xk,{optional:!0})??[]).reduceRight(_k,fM));let r=Ln(Jp),c=r.add();return i(e,s).pipe(Jd(()=>r.remove(c)))}}var hM=(()=>{let e=class extends th{constructor(r,c){super(),this.backend=r,this.injector=c,this.chain=null,this.pendingTasks=Ln(Jp);let o=Ln(wk,{optional:!0});this.backend=o??r}handle(r){if(null===this.chain){let o=Array.from(new Set([...this.injector.get($_),...this.injector.get(bk,[])]));this.chain=o.reduceRight((y,x)=>function(i,e,s){return(r,c)=>s.runInContext(()=>e(r,o=>i(o,c)))}(y,x,this.injector),fM)}let c=this.pendingTasks.add();return this.chain(r,o=>this.backend.handle(o)).pipe(Jd(()=>this.pendingTasks.remove(c)))}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(cf),Le(as))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),Ek=/^\)\]\}',?\n/,dM=(()=>{let e=class{constructor(r){this.xhrFactory=r}handle(r){if("JSONP"===r.method)throw new He(-2800,!1);let c=this.xhrFactory;return(c.\u0275loadImpl?os(c.\u0275loadImpl()):Hl(null)).pipe(ss(()=>new In(y=>{let x=c.build();if(x.open(r.method,r.urlWithParams),r.withCredentials&&(x.withCredentials=!0),r.headers.forEach((je,Ae)=>x.setRequestHeader(je,Ae.join(","))),r.headers.has("Accept")||x.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let je=r.detectContentTypeHeader();null!==je&&x.setRequestHeader("Content-Type",je)}if(r.responseType){let je=r.responseType.toLowerCase();x.responseType="json"!==je?je:"text"}let I=r.serializeBody(),A=null,L=()=>{if(null!==A)return A;let je=x.statusText||"OK",Ae=new ao(x.getAllResponseHeaders()),yt=function(i){return"responseURL"in i&&i.responseURL?i.responseURL:/^X-Request-URL:/m.test(i.getAllResponseHeaders())?i.getResponseHeader("X-Request-URL"):null}(x)||r.url;return A=new ih({headers:Ae,status:x.status,statusText:je,url:yt}),A},G=()=>{let{headers:je,status:Ae,statusText:yt,url:rt}=L(),ot=null;204!==Ae&&(ot=typeof x.response>"u"?x.responseText:x.response),0===Ae&&(Ae=ot?200:0);let ln=Ae>=200&&Ae<300;if("json"===r.responseType&&"string"==typeof ot){let kt=ot;ot=ot.replace(Ek,"");try{ot=""!==ot?JSON.parse(ot):null}catch(nn){ot=kt,ln&&(ln=!1,ot={error:nn,text:ot})}}ln?(y.next(new mc({body:ot,headers:je,status:Ae,statusText:yt,url:rt||void 0})),y.complete()):y.error(new uf({error:ot,headers:je,status:Ae,statusText:yt,url:rt||void 0}))},re=je=>{let{url:Ae}=L(),yt=new uf({error:je,status:x.status||0,statusText:x.statusText||"Unknown Error",url:Ae||void 0});y.error(yt)},le=!1,ve=je=>{le||(y.next(L()),le=!0);let Ae={type:fc.DownloadProgress,loaded:je.loaded};je.lengthComputable&&(Ae.total=je.total),"text"===r.responseType&&!!x.responseText&&(Ae.partialText=x.responseText),y.next(Ae)},Ie=je=>{let Ae={type:fc.UploadProgress,loaded:je.loaded};je.lengthComputable&&(Ae.total=je.total),y.next(Ae)};return x.addEventListener("load",G),x.addEventListener("error",re),x.addEventListener("timeout",re),x.addEventListener("abort",re),r.reportProgress&&(x.addEventListener("progress",ve),null!==I&&x.upload&&x.upload.addEventListener("progress",Ie)),x.send(I),y.next({type:fc.Sent}),()=>{x.removeEventListener("error",re),x.removeEventListener("abort",re),x.removeEventListener("load",G),x.removeEventListener("timeout",re),r.reportProgress&&(x.removeEventListener("progress",ve),null!==I&&x.upload&&x.upload.removeEventListener("progress",Ie)),x.readyState!==x.DONE&&x.abort()}})))}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(dc))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),mM=new Pt("XSRF_ENABLED"),Ck=new Pt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Tk=new Pt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"}),hf=class{},Ak=(()=>{let e=class{constructor(r,c,o){this.doc=r,this.platform=c,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=of(r,this.cookieName),this.lastCookieString=r),this.lastToken}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Li),Le(Ws),Le(Ck))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})();function Pk(i,e){let s=i.url.toLowerCase();if(!Ln(mM)||"GET"===i.method||"HEAD"===i.method||s.startsWith("http://")||s.startsWith("https://"))return e(i);let r=Ln(hf).getToken(),c=Ln(Tk);return null!=r&&!i.headers.has(c)&&(i=i.clone({headers:i.headers.set(c,r)})),e(i)}var gM=function(i){return i[i.Interceptors=0]="Interceptors",i[i.LegacyInterceptors=1]="LegacyInterceptors",i[i.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",i[i.NoXsrfProtection=3]="NoXsrfProtection",i[i.JsonpSupport=4]="JsonpSupport",i[i.RequestsMadeViaParent=5]="RequestsMadeViaParent",i[i.Fetch=6]="Fetch",i}(gM||{});function Lk(...i){let e=[V_,dM,hM,{provide:th,useExisting:hM},{provide:cf,useExisting:dM},{provide:$_,useValue:Pk,multi:!0},{provide:mM,useValue:!0},{provide:hf,useClass:Ak}];for(let s of i)e.push(...s.\u0275providers);return function(i){return{"\u0275providers":i}}(e)}var df,pM=new Pt("LEGACY_INTERCEPTOR_FN"),yM=(()=>{let e=class{},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275mod=hr({type:e}),e.\u0275inj=ur({providers:[Lk(function(i,e){return{"\u0275kind":i,"\u0275providers":e}}(gM.LegacyInterceptors,[{provide:pM,useFactory:Mk},{provide:$_,useExisting:pM,multi:!0}]))]}),i})(),Z_=class extends nf{constructor(){super(...arguments),this.supportsDOMEvents=!0}},oh=class extends Z_{static makeCurrent(){!function(i){L_||(L_=i)}(new oh)}onAndCancel(e,s,r){return e.addEventListener(s,r),()=>{e.removeEventListener(s,r)}}dispatchEvent(e,s){e.dispatchEvent(s)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,s){return(s=s||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,s){return"window"===s?window:"document"===s?e:"body"===s?e.body:null}getBaseHref(e){let s=(rh=rh||document.querySelector("base"))?rh.getAttribute("href"):null;return null==s?null:function(i){(df=df||document.createElement("a")).setAttribute("href",i);let e=df.pathname;return"/"===e.charAt(0)?e:`/${e}`}(s)}resetBaseElement(){rh=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return of(document.cookie,e)}},rh=null,Bk=(()=>{let e=class{build(){return new XMLHttpRequest}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),W_=new Pt("EventManagerPlugins"),xM=(()=>{let e=class{constructor(r,c){this._zone=c,this._eventNameToPlugin=new Map,r.forEach(o=>{o.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,c,o){return this._findPluginFor(c).addEventListener(r,c,o)}getZone(){return this._zone}_findPluginFor(r){let c=this._eventNameToPlugin.get(r);if(c)return c;if(c=this._plugins.find(y=>y.supports(r)),!c)throw new He(5101,!1);return this._eventNameToPlugin.set(r,c),c}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(W_),Le(wn))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),pf=class{constructor(e){this._doc=e}},H_="ng-app-id",bM=(()=>{let e=class{constructor(r,c,o,y={}){this.doc=r,this.appId=c,this.nonce=o,this.platformId=y,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=z_(y),this.resetHostNodes()}addStyles(r){for(let c of r)1===this.changeUsageCount(c,1)&&this.onStyleAdded(c)}removeStyles(r){for(let c of r)this.changeUsageCount(c,-1)<=0&&this.onStyleRemoved(c)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(c=>c.remove()),r.clear());for(let c of this.getAllStyles())this.onStyleRemoved(c);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let c of this.getAllStyles())this.addStyleToHost(r,c)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let c of this.hostNodes)this.addStyleToHost(c,r)}onStyleRemoved(r){let c=this.styleRef;c.get(r)?.elements?.forEach(o=>o.remove()),c.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${H_}="${this.appId}"]`);if(r?.length){let c=new Map;return r.forEach(o=>{null!=o.textContent&&c.set(o.textContent,o)}),c}return null}changeUsageCount(r,c){let o=this.styleRef;if(o.has(r)){let y=o.get(r);return y.usage+=c,y.usage}return o.set(r,{usage:c,elements:[]}),c}getStyleElement(r,c){let o=this.styleNodesInDOM,y=o?.get(c);if(y?.parentNode===r)return o.delete(c),y.removeAttribute(H_),y;{let x=this.doc.createElement("style");return this.nonce&&x.setAttribute("nonce",this.nonce),x.textContent=c,this.platformIsServer&&x.setAttribute(H_,this.appId),r.appendChild(x),x}}addStyleToHost(r,c){let o=this.getStyleElement(r,c),y=this.styleRef,x=y.get(c)?.elements;x?x.push(o):y.set(c,{elements:[o],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Li),Le(Hp),Le(i_,8),Le(Ws))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),G_={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},K_=/%COMP%/g,$k=new Pt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!0});function MM(i,e){return e.map(s=>s.replace(K_,i))}var ff=(()=>{let e=class{constructor(r,c,o,y,x,I,A,L=null){this.eventManager=r,this.sharedStylesHost=c,this.appId=o,this.removeStylesOnCompDestroy=y,this.doc=x,this.platformId=I,this.ngZone=A,this.nonce=L,this.rendererByCompId=new Map,this.platformIsServer=z_(I),this.defaultRenderer=new sh(r,x,A,this.platformIsServer)}createRenderer(r,c){if(!r||!c)return this.defaultRenderer;this.platformIsServer&&c.encapsulation===To.ShadowDom&&(c={...c,encapsulation:To.Emulated});let o=this.getOrCreateRenderer(r,c);return o instanceof mf?o.applyToHost(r):o instanceof ah&&o.applyStyles(),o}getOrCreateRenderer(r,c){let o=this.rendererByCompId,y=o.get(c.id);if(!y){let x=this.doc,I=this.ngZone,A=this.eventManager,L=this.sharedStylesHost,G=this.removeStylesOnCompDestroy,re=this.platformIsServer;switch(c.encapsulation){case To.Emulated:y=new mf(A,L,c,this.appId,G,x,I,re);break;case To.ShadowDom:return new Y_(A,L,r,c,x,I,this.nonce,re);default:y=new ah(A,L,c,G,x,I,re)}o.set(c.id,y)}return y}ngOnDestroy(){this.rendererByCompId.clear()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(xM),Le(bM),Le(Hp),Le($k),Le(Li),Le(Ws),Le(wn),Le(i_))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),sh=class{constructor(e,s,r,c){this.eventManager=e,this.doc=s,this.ngZone=r,this.platformIsServer=c,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,s){return s?this.doc.createElementNS(G_[s]||s,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,s){(_M(e)?e.content:e).appendChild(s)}insertBefore(e,s,r){e&&(_M(e)?e.content:e).insertBefore(s,r)}removeChild(e,s){e&&e.removeChild(s)}selectRootElement(e,s){let r="string"==typeof e?this.doc.querySelector(e):e;if(!r)throw new He(-5104,!1);return s||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,s,r,c){if(c){s=c+":"+s;let o=G_[c];o?e.setAttributeNS(o,s,r):e.setAttribute(s,r)}else e.setAttribute(s,r)}removeAttribute(e,s,r){if(r){let c=G_[r];c?e.removeAttributeNS(c,s):e.removeAttribute(`${r}:${s}`)}else e.removeAttribute(s)}addClass(e,s){e.classList.add(s)}removeClass(e,s){e.classList.remove(s)}setStyle(e,s,r,c){c&(ls.DashCase|ls.Important)?e.style.setProperty(s,r,c&ls.Important?"important":""):e.style[s]=r}removeStyle(e,s,r){r&ls.DashCase?e.style.removeProperty(s):e.style[s]=""}setProperty(e,s,r){e[s]=r}setValue(e,s){e.nodeValue=s}listen(e,s,r){if("string"==typeof e&&!(e=rf().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${s}`);return this.eventManager.addEventListener(e,s,this.decoratePreventDefault(r))}decoratePreventDefault(e){return s=>{if("__ngUnwrap__"===s)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(s)):e(s))&&s.preventDefault()}}};function _M(i){return"TEMPLATE"===i.tagName&&void 0!==i.content}var X_,Y_=class extends sh{constructor(e,s,r,c,o,y,x,I){super(e,o,y,I),this.sharedStylesHost=s,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let A=MM(c.id,c.styles);for(let L of A){let G=document.createElement("style");x&&G.setAttribute("nonce",x),G.textContent=L,this.shadowRoot.appendChild(G)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,s){return super.appendChild(this.nodeOrShadowRoot(e),s)}insertBefore(e,s,r){return super.insertBefore(this.nodeOrShadowRoot(e),s,r)}removeChild(e,s){return super.removeChild(this.nodeOrShadowRoot(e),s)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},ah=class extends sh{constructor(e,s,r,c,o,y,x,I){super(e,o,y,x),this.sharedStylesHost=s,this.removeStylesOnCompDestroy=c,this.styles=I?MM(I,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){!this.removeStylesOnCompDestroy||this.sharedStylesHost.removeStyles(this.styles)}},mf=class extends ah{constructor(e,s,r,c,o,y,x,I){let A=c+"-"+r.id;super(e,s,r,o,y,x,I,A),this.contentAttr=function(i){return"_ngcontent-%COMP%".replace(K_,i)}(A),this.hostAttr=function(i){return"_nghost-%COMP%".replace(K_,i)}(A)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,s){let r=super.createElement(e,s);return super.setAttribute(r,this.contentAttr,""),r}},Zk=(()=>{let e=class extends pf{constructor(r){super(r)}supports(r){return!0}addEventListener(r,c,o){return r.addEventListener(c,o,!1),()=>this.removeEventListener(r,c,o)}removeEventListener(r,c,o){return r.removeEventListener(c,o)}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Li))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),vM=["alt","control","meta","shift"],qk={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Wk={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},Yk=(()=>{let e=class extends pf{constructor(r){super(r)}supports(r){return null!=e.parseEventName(r)}addEventListener(r,c,o){let y=e.parseEventName(c),x=e.eventCallback(y.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>rf().onAndCancel(r,y.domEventName,x))}static parseEventName(r){let c=r.toLowerCase().split("."),o=c.shift();if(0===c.length||"keydown"!==o&&"keyup"!==o)return null;let y=e._normalizeKey(c.pop()),x="",I=c.indexOf("code");if(I>-1&&(c.splice(I,1),x="code."),vM.forEach(L=>{let G=c.indexOf(L);G>-1&&(c.splice(G,1),x+=L+".")}),x+=y,0!=c.length||0===y.length)return null;let A={};return A.domEventName=o,A.fullKey=x,A}static matchEventFullKeyCode(r,c){let o=qk[r.key]||r.key,y="";return c.indexOf("code.")>-1&&(o=r.code,y="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),vM.forEach(x=>{x!==o&&(0,Wk[x])(r)&&(y+=x+".")}),y+=o,y===c)}static eventCallback(r,c,o){return y=>{e.matchEventFullKeyCode(y,r)&&o.runGuarded(()=>c(y))}}static _normalizeKey(r){return"esc"===r?"escape":r}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Li))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),Jk=[{provide:Ws,useValue:"browser"},{provide:t_,useValue:function(){oh.makeCurrent()},multi:!0},{provide:Li,useFactory:function(){return function(i){ey=i}(document),document},deps:[]}],EM=P_(J1,"browser",Jk),eL=new Pt(""),tL=[{provide:eh,useClass:class{addToWindow(e){bi.getAngularTestability=(r,c=!0)=>{let o=e.findTestabilityInTree(r,c);if(null==o)throw new He(5103,!1);return o},bi.getAllAngularTestabilities=()=>e.getAllTestabilities(),bi.getAllAngularRootElements=()=>e.getAllRootElements(),bi.frameworkStabilizers||(bi.frameworkStabilizers=[]),bi.frameworkStabilizers.push(r=>{let c=bi.getAllAngularTestabilities(),o=c.length,y=!1,x=function(I){y=y||I,o--,0==o&&r(y)};c.forEach(I=>{I.whenStable(x)})})}findTestabilityInTree(e,s,r){return null==s?null:e.getTestability(s)??(r?rf().isShadowRoot(s)?this.findTestabilityInTree(e,s.host,!0):this.findTestabilityInTree(e,s.parentElement,!0):null)}},deps:[]},{provide:T_,useClass:ef,deps:[wn,tf,eh]},{provide:ef,useClass:ef,deps:[wn,tf,eh]}],nL=[{provide:$p,useValue:"root"},{provide:us,useFactory:function(){return new us},deps:[]},{provide:W_,useClass:Zk,multi:!0,deps:[Li,wn,Ws]},{provide:W_,useClass:Yk,multi:!0,deps:[Li]},ff,bM,xM,{provide:Ga,useExisting:ff},{provide:dc,useClass:Bk,deps:[]},[]],IM=(()=>{let e=class{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:Hp,useValue:r.appId}]}}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(eL,12))},e.\u0275mod=hr({type:e}),e.\u0275inj=ur({providers:[...nL,...tL],imports:[af,eM]}),i})(),Q_=(()=>{let e=class{},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:function(c){let o=null;return o=c?new(c||e):Le(DM),o},providedIn:"root"}),i})(),DM=(()=>{let e=class extends Q_{constructor(r){super(),this._doc=r}sanitize(r,c){if(null==c)return null;switch(r){case no.NONE:return c;case no.HTML:return Qa(c,"HTML")?ko(c):c_(this._doc,String(c)).toString();case no.STYLE:return Qa(c,"Style")?ko(c):c;case no.SCRIPT:if(Qa(c,"Script"))return ko(c);throw new He(5200,!1);case no.URL:return Qa(c,"URL")?ko(c):l_(String(c));case no.RESOURCE_URL:if(Qa(c,"ResourceURL"))return ko(c);throw new He(5201,!1);default:throw new He(5202,!1)}}bypassSecurityTrustHtml(r){return function(i){return new iy(i)}(r)}bypassSecurityTrustStyle(r){return function(i){return new ry(i)}(r)}bypassSecurityTrustScript(r){return function(i){return new oy(i)}(r)}bypassSecurityTrustUrl(r){return function(i){return new sy(i)}(r)}bypassSecurityTrustResourceUrl(r){return function(i){return new ay(i)}(r)}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Li))},e.\u0275prov=Be({token:e,factory:function(c){let o=null;return o=c?new c:function(i){return new DM(i.get(Li))}(Le(pr)),o},providedIn:"root"}),i})(),gf={schedule(i,e){let s=setTimeout(i,e);return()=>clearTimeout(s)},scheduleBeforeRender(i){if(typeof window>"u")return gf.schedule(i,0);if(typeof window.requestAnimationFrame>"u")return gf.schedule(i,16);let e=window.requestAnimationFrame(i);return()=>window.cancelAnimationFrame(e)}};function pL(i,e,s){let r=s;return function(i){return!!i&&i.nodeType===Node.ELEMENT_NODE}(i)&&e.some((c,o)=>!("*"===c||!function(i,e){if(!X_){let s=Element.prototype;X_=s.matches||s.matchesSelector||s.mozMatchesSelector||s.msMatchesSelector||s.oMatchesSelector||s.webkitMatchesSelector}return i.nodeType===Node.ELEMENT_NODE&&X_.call(i,e)}(i,c)||(r=o,0))),r}var J_=class{constructor(e,s){this.componentFactory=s.get(Ys).resolveComponentFactory(e)}create(e){return new ev(this.componentFactory,e)}},ev=class{constructor(e,s){this.componentFactory=e,this.injector=s,this.eventEmitters=new Cr(1),this.events=this.eventEmitters.pipe(ss(r=>Pu(...r))),this.componentRef=null,this.viewChangeDetectorRef=null,this.inputChanges=null,this.hasInputChanges=!1,this.implementsOnChanges=!1,this.scheduledChangeDetectionFn=null,this.scheduledDestroyFn=null,this.initialInputValues=new Map,this.unchangedInputs=new Set(this.componentFactory.inputs.map(({propName:r})=>r)),this.ngZone=this.injector.get(wn),this.elementZone=typeof Zone>"u"?null:this.ngZone.run(()=>Zone.current)}connect(e){this.runInZone(()=>{if(null!==this.scheduledDestroyFn)return this.scheduledDestroyFn(),void(this.scheduledDestroyFn=null);null===this.componentRef&&this.initializeComponent(e)})}disconnect(){this.runInZone(()=>{null===this.componentRef||null!==this.scheduledDestroyFn||(this.scheduledDestroyFn=gf.schedule(()=>{null!==this.componentRef&&(this.componentRef.destroy(),this.componentRef=null,this.viewChangeDetectorRef=null)},10))})}getInputValue(e){return this.runInZone(()=>null===this.componentRef?this.initialInputValues.get(e):this.componentRef.instance[e])}setInputValue(e,s,r){this.runInZone(()=>{r&&(s=r.call(this.componentRef?.instance,s)),null!==this.componentRef?function(i,e){return i===e||i!=i&&e!=e}(s,this.getInputValue(e))&&(void 0!==s||!this.unchangedInputs.has(e))||(this.recordInputChange(e,s),this.unchangedInputs.delete(e),this.hasInputChanges=!0,this.componentRef.instance[e]=s,this.scheduleDetectChanges()):this.initialInputValues.set(e,s)})}initializeComponent(e){let s=pr.create({providers:[],parent:this.injector}),r=function(i,e){let s=i.childNodes,r=e.map(()=>[]),c=-1;e.some((o,y)=>"*"===o&&(c=y,!0));for(let o=0,y=s.length;o<y;++o){let x=s[o],I=pL(x,e,c);-1!==I&&r[I].push(x)}return r}(e,this.componentFactory.ngContentSelectors);this.componentRef=this.componentFactory.create(s,r,e),this.viewChangeDetectorRef=this.componentRef.injector.get(ki),this.implementsOnChanges=function(i){return"function"==typeof i}(this.componentRef.instance.ngOnChanges),this.initializeInputs(),this.initializeOutputs(this.componentRef),this.detectChanges(),this.injector.get(so).attachView(this.componentRef.hostView)}initializeInputs(){this.componentFactory.inputs.forEach(({propName:e,transform:s})=>{this.initialInputValues.has(e)&&this.setInputValue(e,this.initialInputValues.get(e),s)}),this.initialInputValues.clear()}initializeOutputs(e){let s=this.componentFactory.outputs.map(({propName:r,templateName:c})=>e.instance[r].pipe(Gi(y=>({name:c,value:y}))));this.eventEmitters.next(s)}callNgOnChanges(e){if(!this.implementsOnChanges||null===this.inputChanges)return;let s=this.inputChanges;this.inputChanges=null,e.instance.ngOnChanges(s)}markViewForCheck(e){this.hasInputChanges&&(this.hasInputChanges=!1,e.markForCheck())}scheduleDetectChanges(){this.scheduledChangeDetectionFn||(this.scheduledChangeDetectionFn=gf.scheduleBeforeRender(()=>{this.scheduledChangeDetectionFn=null,this.detectChanges()}))}recordInputChange(e,s){if(!this.implementsOnChanges)return;null===this.inputChanges&&(this.inputChanges={});let r=this.inputChanges[e];if(r)return void(r.currentValue=s);let c=this.unchangedInputs.has(e),o=c?void 0:this.getInputValue(e);this.inputChanges[e]=new ju(o,s,c)}detectChanges(){null!==this.componentRef&&(this.callNgOnChanges(this.componentRef),this.markViewForCheck(this.viewChangeDetectorRef),this.componentRef.changeDetectorRef.detectChanges())}runInZone(e){return this.elementZone&&Zone.current!==this.elementZone?this.ngZone.run(e):e()}},tv=class extends HTMLElement{constructor(){super(...arguments),this.ngElementEventsSubscription=null}};var No="*";function yf(i,e){return{type:7,name:i,definitions:e,options:{}}}function gc(i,e=null){return{type:4,styles:e,timings:i}}function lo(i){return{type:6,styles:i,offset:null}}function TM(i,e,s){return{type:0,name:i,styles:e,options:s}}function yc(i,e,s=null){return{type:1,expr:i,animation:e,options:s}}var Qs=class{constructor(e=0,s=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+s}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let s="start"==e?this._onStartFns:this._onDoneFns;s.forEach(r=>r()),s.length=0}},lh=class{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let s=0,r=0,c=0,o=this.players.length;0==o?queueMicrotask(()=>this._onFinish()):this.players.forEach(y=>{y.onDone(()=>{++s==o&&this._onFinish()}),y.onDestroy(()=>{++r==o&&this._onDestroy()}),y.onStart(()=>{++c==o&&this._onStart()})}),this.totalTime=this.players.reduce((y,x)=>Math.max(y,x.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let s=e*this.totalTime;this.players.forEach(r=>{let c=r.totalTime?Math.min(1,s/r.totalTime):1;r.setPosition(c)})}getPosition(){let e=this.players.reduce((s,r)=>null===s||r.totalTime>s.totalTime?r:s,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let s="start"==e?this._onStartFns:this._onDoneFns;s.forEach(r=>r()),s.length=0}};function AM(i){return new He(3e3,!1)}function Xs(i){switch(i.length){case 0:return new Qs;case 1:return i[0];default:return new lh(i)}}function HM(i,e,s=new Map,r=new Map){let c=[],o=[],y=-1,x=null;if(e.forEach(I=>{let A=I.get("offset"),L=A==y,G=L&&x||new Map;I.forEach((re,le)=>{let ve=le,Ie=re;if("offset"!==le)switch(ve=i.normalizePropertyName(ve,c),Ie){case"!":Ie=s.get(le);break;case No:Ie=r.get(le);break;default:Ie=i.normalizeStyleValue(le,ve,Ie,c)}G.set(ve,Ie)}),L||o.push(G),x=G,y=A}),c.length)throw new He(3502,!1);return o}function wv(i,e,s,r){switch(e){case"start":i.onStart(()=>r(s&&nv(s,"start",i)));break;case"done":i.onDone(()=>r(s&&nv(s,"done",i)));break;case"destroy":i.onDestroy(()=>r(s&&nv(s,"destroy",i)))}}function nv(i,e,s){let o=Mv(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,s.totalTime??i.totalTime,!!s.disabled),y=i._data;return null!=y&&(o._data=y),o}function Mv(i,e,s,r,c="",o=0,y){return{element:i,triggerName:e,fromState:s,toState:r,phaseName:c,totalTime:o,disabled:!!y}}function yr(i,e,s){let r=i.get(e);return r||i.set(e,r=s),r}function PM(i){let e=i.indexOf(":");return[i.substring(1,e),i.slice(e+1)]}var ZL=(()=>typeof document>"u"?null:document.documentElement)();function Ev(i){let e=i.parentNode||i.host||null;return e===ZL?null:e}var nl=null,kM=!1;function GM(i,e){for(;e;){if(e===i)return!0;e=Ev(e)}return!1}function ZM(i,e,s){if(s)return Array.from(i.querySelectorAll(e));let r=i.querySelector(e);return r?[r]:[]}var Iv=(()=>{let e=class{validateStyleProperty(r){return function(i){nl||(nl=(typeof document<"u"?document.body:null)||{},kM=!!nl.style&&"WebkitAppearance"in nl.style);let e=!0;return nl.style&&!function(i){return"ebkit"==i.substring(1,6)}(i)&&(e=i in nl.style,!e&&kM&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in nl.style)),e}(r)}matchesElement(r,c){return!1}containsElement(r,c){return GM(r,c)}getParentElement(r){return Ev(r)}query(r,c,o){return ZM(r,c,o)}computeStyle(r,c,o){return o||""}animate(r,c,o,y,x,I=[],A){return new Qs(o,y)}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),gh=(()=>{let e=class{},i=e;return e.NOOP=new Iv,i})(),ol=class{},KL=1e3,WM="ng-enter",lv="ng-leave",vf="ng-trigger",Ef=".ng-trigger",LM="ng-animating",cv=".ng-animating";function gs(i){if("number"==typeof i)return i;let e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:uv(parseFloat(e[1]),e[2])}function uv(i,e){return"s"===e?i*KL:i}function If(i,e,s){return i.hasOwnProperty("duration")?i:function(i,e,s){let c,o=0,y="";if("string"==typeof i){let x=i.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===x)return e.push(AM()),{duration:0,delay:0,easing:""};c=uv(parseFloat(x[1]),x[2]);let I=x[3];null!=I&&(o=uv(parseFloat(I),x[4]));let A=x[5];A&&(y=A)}else c=i;if(!s){let x=!1,I=e.length;c<0&&(e.push(new He(3100,!1)),x=!0),o<0&&(e.push(new He(3101,!1)),x=!0),x&&e.splice(I,0,AM())}return{duration:c,delay:o,easing:y}}(i,e,s)}function yh(i,e={}){return Object.keys(i).forEach(s=>{e[s]=i[s]}),e}function YM(i){let e=new Map;return Object.keys(i).forEach(s=>{e.set(s,i[s])}),e}function vc(i,e=new Map,s){if(s)for(let[r,c]of s)e.set(r,c);for(let[r,c]of i)e.set(r,c);return e}function Ro(i,e,s){e.forEach((r,c)=>{let o=Dv(c);s&&!s.has(c)&&s.set(c,i.style[o]),i.style[o]=r})}function rl(i,e){e.forEach((s,r)=>{let c=Dv(r);i.style[c]=""})}function ch(i){return Array.isArray(i)?1==i.length?i[0]:function(i,e=null){return{type:2,steps:i,options:e}}(i):i}var hv=new RegExp("{{\\s*(.+?)\\s*}}","g");function KM(i){let e=[];if("string"==typeof i){let s;for(;s=hv.exec(i);)e.push(s[1]);hv.lastIndex=0}return e}function hh(i,e,s){let r=i.toString(),c=r.replace(hv,(o,y)=>{let x=e[y];return null==x&&(s.push(new He(3003,!1)),x=""),x.toString()});return c==r?i:c}function Df(i){let e=[],s=i.next();for(;!s.done;)e.push(s.value),s=i.next();return e}var tO=/-+([a-z0-9])/g;function Dv(i){return i.replace(tO,(...e)=>e[1].toUpperCase())}function gr(i,e,s){switch(e.type){case 7:return i.visitTrigger(e,s);case 0:return i.visitState(e,s);case 1:return i.visitTransition(e,s);case 2:return i.visitSequence(e,s);case 3:return i.visitGroup(e,s);case 4:return i.visitAnimate(e,s);case 5:return i.visitKeyframes(e,s);case 6:return i.visitStyle(e,s);case 8:return i.visitReference(e,s);case 9:return i.visitAnimateChild(e,s);case 10:return i.visitAnimateRef(e,s);case 11:return i.visitQuery(e,s);case 12:return i.visitStagger(e,s);default:throw new He(3004,!1)}}function QM(i,e){return window.getComputedStyle(i)[e]}var rO=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Cf=class extends ol{normalizePropertyName(e,s){return Dv(e)}normalizeStyleValue(e,s,r,c){let o="",y=r.toString().trim();if(rO.has(s)&&0!==r&&"0"!==r)if("number"==typeof r)o="px";else{let x=r.match(/^[+-]?[\d\.]+([a-z]*)$/);x&&0==x[1].length&&c.push(new He(3005,!1))}return y+o}},Sf="*";function oO(i,e){let s=[];return"string"==typeof i?i.split(/\s*,\s*/).forEach(r=>function(i,e,s){if(":"==i[0]){let I=function(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(s,r)=>parseFloat(r)>parseFloat(s);case":decrement":return(s,r)=>parseFloat(r)<parseFloat(s);default:return e.push(new He(3016,!1)),"* => *"}}(i,s);if("function"==typeof I)return void e.push(I);i=I}let r=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return s.push(new He(3015,!1)),e;let c=r[1],o=r[2],y=r[3];e.push(OM(c,y)),"<"==o[0]&&!(c==Sf&&y==Sf)&&e.push(OM(y,c))}(r,s,e)):s.push(i),s}var xf=new Set(["true","1"]),bf=new Set(["false","0"]);function OM(i,e){let s=xf.has(i)||bf.has(i),r=xf.has(e)||bf.has(e);return(c,o)=>{let y=i==Sf||i==c,x=e==Sf||e==o;return!y&&s&&"boolean"==typeof c&&(y=c?xf.has(i):bf.has(i)),!x&&r&&"boolean"==typeof o&&(x=o?xf.has(e):bf.has(e)),y&&x}}var lO=new RegExp("s*:selfs*,?","g");function JM(i,e,s,r){return new dv(i).build(e,s,r)}var dv=class{constructor(e){this._driver=e}build(e,s,r){let c=new pv(s);return this._resetContextStyleTimingState(c),gr(this,ch(e),c)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,s){let r=s.queryCount=0,c=s.depCount=0,o=[],y=[];return"@"==e.name.charAt(0)&&s.errors.push(new He(3006,!1)),e.definitions.forEach(x=>{if(this._resetContextStyleTimingState(s),0==x.type){let I=x,A=I.name;A.toString().split(/\s*,\s*/).forEach(L=>{I.name=L,o.push(this.visitState(I,s))}),I.name=A}else if(1==x.type){let I=this.visitTransition(x,s);r+=I.queryCount,c+=I.depCount,y.push(I)}else s.errors.push(new He(3007,!1))}),{type:7,name:e.name,states:o,transitions:y,queryCount:r,depCount:c,options:null}}visitState(e,s){let r=this.visitStyle(e.styles,s),c=e.options&&e.options.params||null;if(r.containsDynamicStyles){let o=new Set,y=c||{};r.styles.forEach(x=>{x instanceof Map&&x.forEach(I=>{KM(I).forEach(A=>{y.hasOwnProperty(A)||o.add(A)})})}),o.size&&(Df(o.values()),s.errors.push(new He(3008,!1)))}return{type:0,name:e.name,style:r,options:c?{params:c}:null}}visitTransition(e,s){s.queryCount=0,s.depCount=0;let r=gr(this,ch(e.animation),s);return{type:1,matchers:oO(e.expr,s.errors),animation:r,queryCount:s.queryCount,depCount:s.depCount,options:il(e.options)}}visitSequence(e,s){return{type:2,steps:e.steps.map(r=>gr(this,r,s)),options:il(e.options)}}visitGroup(e,s){let r=s.currentTime,c=0,o=e.steps.map(y=>{s.currentTime=r;let x=gr(this,y,s);return c=Math.max(c,s.currentTime),x});return s.currentTime=c,{type:3,steps:o,options:il(e.options)}}visitAnimate(e,s){let r=function(i,e){if(i.hasOwnProperty("duration"))return i;if("number"==typeof i)return iv(If(i,e).duration,0,"");let s=i;if(s.split(/\s+/).some(o=>"{"==o.charAt(0)&&"{"==o.charAt(1))){let o=iv(0,0,"");return o.dynamic=!0,o.strValue=s,o}let c=If(s,e);return iv(c.duration,c.delay,c.easing)}(e.timings,s.errors);s.currentAnimateTimings=r;let c,o=e.styles?e.styles:lo({});if(5==o.type)c=this.visitKeyframes(o,s);else{let y=e.styles,x=!1;if(!y){x=!0;let A={};r.easing&&(A.easing=r.easing),y=lo(A)}s.currentTime+=r.duration+r.delay;let I=this.visitStyle(y,s);I.isEmptyStep=x,c=I}return s.currentAnimateTimings=null,{type:4,timings:r,style:c,options:null}}visitStyle(e,s){let r=this._makeStyleAst(e,s);return this._validateStyleAst(r,s),r}_makeStyleAst(e,s){let r=[],c=Array.isArray(e.styles)?e.styles:[e.styles];for(let x of c)"string"==typeof x?x===No?r.push(x):s.errors.push(new He(3002,!1)):r.push(YM(x));let o=!1,y=null;return r.forEach(x=>{if(x instanceof Map&&(x.has("easing")&&(y=x.get("easing"),x.delete("easing")),!o))for(let I of x.values())if(I.toString().indexOf("{{")>=0){o=!0;break}}),{type:6,styles:r,easing:y,offset:e.offset,containsDynamicStyles:o,options:null}}_validateStyleAst(e,s){let r=s.currentAnimateTimings,c=s.currentTime,o=s.currentTime;r&&o>0&&(o-=r.duration+r.delay),e.styles.forEach(y=>{"string"!=typeof y&&y.forEach((x,I)=>{let A=s.collectedStyles.get(s.currentQuerySelector),L=A.get(I),G=!0;L&&(o!=c&&o>=L.startTime&&c<=L.endTime&&(s.errors.push(new He(3010,!1)),G=!1),o=L.startTime),G&&A.set(I,{startTime:o,endTime:c}),s.options&&function(i,e,s){let r=e.params||{},c=KM(i);c.length&&c.forEach(o=>{r.hasOwnProperty(o)||s.push(new He(3001,!1))})}(x,s.options,s.errors)})})}visitKeyframes(e,s){let r={type:5,styles:[],options:null};if(!s.currentAnimateTimings)return s.errors.push(new He(3011,!1)),r;let o=0,y=[],x=!1,I=!1,A=0,L=e.steps.map(Ae=>{let yt=this._makeStyleAst(Ae,s),rt=null!=yt.offset?yt.offset:function(i){if("string"==typeof i)return null;let e=null;if(Array.isArray(i))i.forEach(s=>{if(s instanceof Map&&s.has("offset")){let r=s;e=parseFloat(r.get("offset")),r.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let s=i;e=parseFloat(s.get("offset")),s.delete("offset")}return e}(yt.styles),ot=0;return null!=rt&&(o++,ot=yt.offset=rt),I=I||ot<0||ot>1,x=x||ot<A,A=ot,y.push(ot),yt});I&&s.errors.push(new He(3012,!1)),x&&s.errors.push(new He(3200,!1));let G=e.steps.length,re=0;o>0&&o<G?s.errors.push(new He(3202,!1)):0==o&&(re=1/(G-1));let le=G-1,ve=s.currentTime,Ie=s.currentAnimateTimings,je=Ie.duration;return L.forEach((Ae,yt)=>{let rt=re>0?yt==le?1:re*yt:y[yt],ot=rt*je;s.currentTime=ve+Ie.delay+ot,Ie.duration=ot,this._validateStyleAst(Ae,s),Ae.offset=rt,r.styles.push(Ae)}),r}visitReference(e,s){return{type:8,animation:gr(this,ch(e.animation),s),options:il(e.options)}}visitAnimateChild(e,s){return s.depCount++,{type:9,options:il(e.options)}}visitAnimateRef(e,s){return{type:10,animation:this.visitReference(e.animation,s),options:il(e.options)}}visitQuery(e,s){let r=s.currentQuerySelector,c=e.options||{};s.queryCount++,s.currentQuery=e;let[o,y]=function(i){let e=!!i.split(/\s*,\s*/).find(s=>":self"==s);return e&&(i=i.replace(lO,"")),i=i.replace(/@\*/g,Ef).replace(/@\w+/g,s=>Ef+"-"+s.slice(1)).replace(/:animating/g,cv),[i,e]}(e.selector);s.currentQuerySelector=r.length?r+" "+o:o,yr(s.collectedStyles,s.currentQuerySelector,new Map);let x=gr(this,ch(e.animation),s);return s.currentQuery=null,s.currentQuerySelector=r,{type:11,selector:o,limit:c.limit||0,optional:!!c.optional,includeSelf:y,animation:x,originalSelector:e.selector,options:il(e.options)}}visitStagger(e,s){s.currentQuery||s.errors.push(new He(3013,!1));let r="full"===e.timings?{duration:0,delay:0,easing:"full"}:If(e.timings,s.errors,!0);return{type:12,animation:gr(this,ch(e.animation),s),timings:r,options:null}}},pv=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function il(i){return i?(i=yh(i)).params&&(i.params=function(i){return i?yh(i):null}(i.params)):i={},i}function iv(i,e,s){return{duration:i,delay:e,easing:s}}function Cv(i,e,s,r,c,o,y=null,x=!1){return{type:1,element:i,keyframes:e,preStyleProps:s,postStyleProps:r,duration:c,delay:o,totalTime:c+o,easing:y,subTimeline:x}}var dh=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,s){let r=this._map.get(e);r||this._map.set(e,r=[]),r.push(...s)}has(e){return this._map.has(e)}clear(){this._map.clear()}},mO=new RegExp(":enter","g"),yO=new RegExp(":leave","g");function eE(i,e,s,r,c,o=new Map,y=new Map,x,I,A=[]){return(new fv).buildKeyframes(i,e,s,r,c,o,y,x,I,A)}var fv=class{buildKeyframes(e,s,r,c,o,y,x,I,A,L=[]){A=A||new dh;let G=new ph(e,s,A,c,o,L,[]);G.options=I;let re=I.delay?gs(I.delay):0;G.currentTimeline.delayNextStep(re),G.currentTimeline.setStyles([y],null,G.errors,I),gr(this,r,G);let le=G.timelines.filter(ve=>ve.containsAnimation());if(le.length&&x.size){let ve;for(let Ie=le.length-1;Ie>=0;Ie--){let je=le[Ie];if(je.element===s){ve=je;break}}ve&&!ve.allowOnlyTimelineStyles()&&ve.setStyles([x],null,G.errors,I)}return le.length?le.map(ve=>ve.buildKeyframes()):[Cv(s,[],[],[],0,re,"",!1)]}visitTrigger(e,s){}visitState(e,s){}visitTransition(e,s){}visitAnimateChild(e,s){let r=s.subInstructions.get(s.element);if(r){let c=s.createSubContext(e.options),o=s.currentTimeline.currentTime,y=this._visitSubInstructions(r,c,c.options);o!=y&&s.transformIntoNewTimeline(y)}s.previousNode=e}visitAnimateRef(e,s){let r=s.createSubContext(e.options);r.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],s,r),this.visitReference(e.animation,r),s.transformIntoNewTimeline(r.currentTimeline.currentTime),s.previousNode=e}_applyAnimationRefDelays(e,s,r){for(let c of e){let o=c?.delay;if(o){let y="number"==typeof o?o:gs(hh(o,c?.params??{},s.errors));r.delayNextStep(y)}}}_visitSubInstructions(e,s,r){let o=s.currentTimeline.currentTime,y=null!=r.duration?gs(r.duration):null,x=null!=r.delay?gs(r.delay):null;return 0!==y&&e.forEach(I=>{let A=s.appendInstructionToTimeline(I,y,x);o=Math.max(o,A.duration+A.delay)}),o}visitReference(e,s){s.updateOptions(e.options,!0),gr(this,e.animation,s),s.previousNode=e}visitSequence(e,s){let r=s.subContextCount,c=s,o=e.options;if(o&&(o.params||o.delay)&&(c=s.createSubContext(o),c.transformIntoNewTimeline(),null!=o.delay)){6==c.previousNode.type&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=Tf);let y=gs(o.delay);c.delayNextStep(y)}e.steps.length&&(e.steps.forEach(y=>gr(this,y,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>r&&c.transformIntoNewTimeline()),s.previousNode=e}visitGroup(e,s){let r=[],c=s.currentTimeline.currentTime,o=e.options&&e.options.delay?gs(e.options.delay):0;e.steps.forEach(y=>{let x=s.createSubContext(e.options);o&&x.delayNextStep(o),gr(this,y,x),c=Math.max(c,x.currentTimeline.currentTime),r.push(x.currentTimeline)}),r.forEach(y=>s.currentTimeline.mergeTimelineCollectedStyles(y)),s.transformIntoNewTimeline(c),s.previousNode=e}_visitTiming(e,s){if(e.dynamic){let r=e.strValue;return If(s.params?hh(r,s.params,s.errors):r,s.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,s){let r=s.currentAnimateTimings=this._visitTiming(e.timings,s),c=s.currentTimeline;r.delay&&(s.incrementTime(r.delay),c.snapshotCurrentStyles());let o=e.style;5==o.type?this.visitKeyframes(o,s):(s.incrementTime(r.duration),this.visitStyle(o,s),c.applyStylesToKeyframe()),s.currentAnimateTimings=null,s.previousNode=e}visitStyle(e,s){let r=s.currentTimeline,c=s.currentAnimateTimings;!c&&r.hasCurrentStyleProperties()&&r.forwardFrame();let o=c&&c.easing||e.easing;e.isEmptyStep?r.applyEmptyStep(o):r.setStyles(e.styles,o,s.errors,s.options),s.previousNode=e}visitKeyframes(e,s){let r=s.currentAnimateTimings,c=s.currentTimeline.duration,o=r.duration,x=s.createSubContext().currentTimeline;x.easing=r.easing,e.styles.forEach(I=>{x.forwardTime((I.offset||0)*o),x.setStyles(I.styles,I.easing,s.errors,s.options),x.applyStylesToKeyframe()}),s.currentTimeline.mergeTimelineCollectedStyles(x),s.transformIntoNewTimeline(c+o),s.previousNode=e}visitQuery(e,s){let r=s.currentTimeline.currentTime,c=e.options||{},o=c.delay?gs(c.delay):0;o&&(6===s.previousNode.type||0==r&&s.currentTimeline.hasCurrentStyleProperties())&&(s.currentTimeline.snapshotCurrentStyles(),s.previousNode=Tf);let y=r,x=s.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!c.optional,s.errors);s.currentQueryTotal=x.length;let I=null;x.forEach((A,L)=>{s.currentQueryIndex=L;let G=s.createSubContext(e.options,A);o&&G.delayNextStep(o),A===s.element&&(I=G.currentTimeline),gr(this,e.animation,G),G.currentTimeline.applyStylesToKeyframe(),y=Math.max(y,G.currentTimeline.currentTime)}),s.currentQueryIndex=0,s.currentQueryTotal=0,s.transformIntoNewTimeline(y),I&&(s.currentTimeline.mergeTimelineCollectedStyles(I),s.currentTimeline.snapshotCurrentStyles()),s.previousNode=e}visitStagger(e,s){let r=s.parentContext,c=s.currentTimeline,o=e.timings,y=Math.abs(o.duration),x=y*(s.currentQueryTotal-1),I=y*s.currentQueryIndex;switch(o.duration<0?"reverse":o.easing){case"reverse":I=x-I;break;case"full":I=r.currentStaggerTime}let L=s.currentTimeline;I&&L.delayNextStep(I);let G=L.currentTime;gr(this,e.animation,s),s.previousNode=e,r.currentStaggerTime=c.currentTime-G+(c.startTime-r.currentTimeline.startTime)}},Tf={},ph=class{constructor(e,s,r,c,o,y,x,I){this._driver=e,this.element=s,this.subInstructions=r,this._enterClassName=c,this._leaveClassName=o,this.errors=y,this.timelines=x,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Tf,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=I||new xc(this._driver,s,0),x.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,s){if(!e)return;let r=e,c=this.options;null!=r.duration&&(c.duration=gs(r.duration)),null!=r.delay&&(c.delay=gs(r.delay));let o=r.params;if(o){let y=c.params;y||(y=this.options.params={}),Object.keys(o).forEach(x=>{(!s||!y.hasOwnProperty(x))&&(y[x]=hh(o[x],y,this.errors))})}}_copyOptions(){let e={};if(this.options){let s=this.options.params;if(s){let r=e.params={};Object.keys(s).forEach(c=>{r[c]=s[c]})}}return e}createSubContext(e=null,s,r){let c=s||this.element,o=new ph(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,r||0));return o.previousNode=this.previousNode,o.currentAnimateTimings=this.currentAnimateTimings,o.options=this._copyOptions(),o.updateOptions(e),o.currentQueryIndex=this.currentQueryIndex,o.currentQueryTotal=this.currentQueryTotal,o.parentContext=this,this.subContextCount++,o}transformIntoNewTimeline(e){return this.previousNode=Tf,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,s,r){let c={duration:s??e.duration,delay:this.currentTimeline.currentTime+(r??0)+e.delay,easing:""},o=new mv(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,c,e.stretchStartingKeyframe);return this.timelines.push(o),c}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,s,r,c,o,y){let x=[];if(c&&x.push(this.element),e.length>0){e=(e=e.replace(mO,"."+this._enterClassName)).replace(yO,"."+this._leaveClassName);let A=this._driver.query(this.element,e,1!=r);0!==r&&(A=r<0?A.slice(A.length+r,A.length):A.slice(0,r)),x.push(...A)}return!o&&0==x.length&&y.push(new He(3014,!1)),x}},xc=class{constructor(e,s,r,c){this._driver=e,this.element=s,this.startTime=r,this._elementTimelineStylesLookup=c,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(s),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(s,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let s=1===this._keyframes.size&&this._pendingStyles.size;this.duration||s?(this.forwardTime(this.currentTime+e),s&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,s){return this.applyStylesToKeyframe(),new xc(this._driver,e,s||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,s){this._localTimelineStyles.set(e,s),this._globalTimelineStyles.set(e,s),this._styleSummary.set(e,{time:this.currentTime,value:s})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[s,r]of this._globalTimelineStyles)this._backFill.set(s,r||No),this._currentKeyframe.set(s,No);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,s,r,c){s&&this._previousKeyframe.set("easing",s);let o=c&&c.params||{},y=function(i,e){let r,s=new Map;return i.forEach(c=>{if("*"===c){r=r||e.keys();for(let o of r)s.set(o,No)}else vc(c,s)}),s}(e,this._globalTimelineStyles);for(let[x,I]of y){let A=hh(I,o,r);this._pendingStyles.set(x,A),this._localTimelineStyles.has(x)||this._backFill.set(x,this._globalTimelineStyles.get(x)??No),this._updateStyle(x,A)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,s)=>{this._currentKeyframe.set(s,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,s)=>{this._currentKeyframe.has(s)||this._currentKeyframe.set(s,e)}))}snapshotCurrentStyles(){for(let[e,s]of this._localTimelineStyles)this._pendingStyles.set(e,s),this._updateStyle(e,s)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let s in this._currentKeyframe)e.push(s);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((s,r)=>{let c=this._styleSummary.get(r);(!c||s.time>c.time)&&this._updateStyle(r,s.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,s=new Set,r=1===this._keyframes.size&&0===this.duration,c=[];this._keyframes.forEach((x,I)=>{let A=vc(x,new Map,this._backFill);A.forEach((L,G)=>{"!"===L?e.add(G):L===No&&s.add(G)}),r||A.set("offset",I/this.duration),c.push(A)});let o=e.size?Df(e.values()):[],y=s.size?Df(s.values()):[];if(r){let x=c[0],I=new Map(x);x.set("offset",0),I.set("offset",1),c=[x,I]}return Cv(this.element,c,o,y,this.duration,this.startTime,this.easing,!1)}},mv=class extends xc{constructor(e,s,r,c,o,y,x=!1){super(e,s,y.delay),this.keyframes=r,this.preStyleProps=c,this.postStyleProps=o,this._stretchStartingKeyframe=x,this.timings={duration:y.duration,delay:y.delay,easing:y.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:s,duration:r,easing:c}=this.timings;if(this._stretchStartingKeyframe&&s){let o=[],y=r+s,x=s/y,I=vc(e[0]);I.set("offset",0),o.push(I);let A=vc(e[0]);A.set("offset",RM(x)),o.push(A);let L=e.length-1;for(let G=1;G<=L;G++){let re=vc(e[G]),le=re.get("offset");re.set("offset",RM((s+le*r)/y)),o.push(re)}r=y,s=0,c="",e=o}return Cv(this.element,e,this.preStyleProps,this.postStyleProps,r,s,c,!0)}};function RM(i,e=3){let s=Math.pow(10,e-1);return Math.round(i*s)/s}function FM(i,e,s,r,c,o,y,x,I,A,L,G,re){return{type:0,element:i,triggerName:e,isRemovalTransition:c,fromState:s,fromStyles:o,toState:r,toStyles:y,timelines:x,queriedElements:I,preStyleProps:A,postStyleProps:L,totalTime:G,errors:re}}var rv={},Af=class{constructor(e,s,r){this._triggerName=e,this.ast=s,this._stateStyles=r}match(e,s,r,c){return function(i,e,s,r,c){return i.some(o=>o(e,s,r,c))}(this.ast.matchers,e,s,r,c)}buildStyles(e,s,r){let c=this._stateStyles.get("*");return void 0!==e&&(c=this._stateStyles.get(e?.toString())||c),c?c.buildStyles(s,r):new Map}build(e,s,r,c,o,y,x,I,A,L){let G=[],re=this.ast.options&&this.ast.options.params||rv,ve=this.buildStyles(r,x&&x.params||rv,G),Ie=I&&I.params||rv,je=this.buildStyles(c,Ie,G),Ae=new Set,yt=new Map,rt=new Map,ot="void"===c,ln={params:xO(Ie,re),delay:this.ast.options?.delay},kt=L?[]:eE(e,s,this.ast.animation,o,y,ve,je,ln,A,G),nn=0;if(kt.forEach(jn=>{nn=Math.max(jn.duration+jn.delay,nn)}),G.length)return FM(s,this._triggerName,r,c,ot,ve,je,[],[],yt,rt,nn,G);kt.forEach(jn=>{let Pn=jn.element,Lr=yr(yt,Pn,new Set);jn.preStyleProps.forEach(si=>Lr.add(si));let Mi=yr(rt,Pn,new Set);jn.postStyleProps.forEach(si=>Mi.add(si)),Pn!==s&&Ae.add(Pn)});let Cn=Df(Ae.values());return FM(s,this._triggerName,r,c,ot,ve,je,kt,Cn,yt,rt,nn)}};function xO(i,e){let s=yh(e);for(let r in i)i.hasOwnProperty(r)&&null!=i[r]&&(s[r]=i[r]);return s}var gv=class{constructor(e,s,r){this.styles=e,this.defaultParams=s,this.normalizer=r}buildStyles(e,s){let r=new Map,c=yh(this.defaultParams);return Object.keys(e).forEach(o=>{let y=e[o];null!==y&&(c[o]=y)}),this.styles.styles.forEach(o=>{"string"!=typeof o&&o.forEach((y,x)=>{y&&(y=hh(y,c,s));let I=this.normalizer.normalizePropertyName(x,s);y=this.normalizer.normalizeStyleValue(x,I,y,s),r.set(x,y)})}),r}},yv=class{constructor(e,s,r){this.name=e,this.ast=s,this._normalizer=r,this.transitionFactories=[],this.states=new Map,s.states.forEach(c=>{this.states.set(c.name,new gv(c.style,c.options&&c.options.params||{},r))}),zM(this.states,"true","1"),zM(this.states,"false","0"),s.transitions.forEach(c=>{this.transitionFactories.push(new Af(e,c,this.states))}),this.fallbackTransition=function(i,e,s){return new Af(i,{type:1,animation:{type:2,steps:[],options:null},matchers:[(y,x)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,s,r,c){return this.transitionFactories.find(y=>y.match(e,s,r,c))||null}matchStyles(e,s,r){return this.fallbackTransition.buildStyles(e,s,r)}};function zM(i,e,s){i.has(e)?i.has(s)||i.set(s,i.get(e)):i.has(s)&&i.set(e,i.get(s))}var MO=new dh,_v=class{constructor(e,s,r){this.bodyNode=e,this._driver=s,this._normalizer=r,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,s){let r=[],o=JM(this._driver,s,r,[]);if(r.length)throw new He(3503,!1);this._animations.set(e,o)}_buildPlayer(e,s,r){let c=e.element,o=HM(this._normalizer,e.keyframes,s,r);return this._driver.animate(c,o,e.duration,e.delay,e.easing,[],!0)}create(e,s,r={}){let y,c=[],o=this._animations.get(e),x=new Map;if(o?(y=eE(this._driver,s,o,WM,lv,new Map,new Map,r,MO,c),y.forEach(L=>{let G=yr(x,L.element,new Map);L.postStyleProps.forEach(re=>G.set(re,null))})):(c.push(new He(3300,!1)),y=[]),c.length)throw new He(3504,!1);x.forEach((L,G)=>{L.forEach((re,le)=>{L.set(le,this._driver.computeStyle(G,le,No))})});let A=Xs(y.map(L=>{let G=x.get(L.element);return this._buildPlayer(L,new Map,G)}));return this._playersById.set(e,A),A.onDestroy(()=>this.destroy(e)),this.players.push(A),A}destroy(e){let s=this._getPlayer(e);s.destroy(),this._playersById.delete(e);let r=this.players.indexOf(s);r>=0&&this.players.splice(r,1)}_getPlayer(e){let s=this._playersById.get(e);if(!s)throw new He(3301,!1);return s}listen(e,s,r,c){let o=Mv(s,"","","");return wv(this._getPlayer(e),r,o,c),()=>{}}command(e,s,r,c){if("register"==r)return void this.register(e,c[0]);if("create"==r)return void this.create(e,s,c[0]||{});let o=this._getPlayer(e);switch(r){case"play":o.play();break;case"pause":o.pause();break;case"reset":o.reset();break;case"restart":o.restart();break;case"finish":o.finish();break;case"init":o.init();break;case"setPosition":o.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(e)}}},BM="ng-animate-queued",ov="ng-animate-disabled",SO=[],tE={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},TO={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},co="__ng_removed",fh=class{get params(){return this.options.params}constructor(e,s=""){this.namespaceId=s;let r=e&&e.hasOwnProperty("value");if(this.value=function(i){return i??null}(r?e.value:e),r){let o=yh(e);delete o.value,this.options=o}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let s=e.params;if(s){let r=this.options.params;Object.keys(s).forEach(c=>{null==r[c]&&(r[c]=s[c])})}}},uh="void",sv=new fh(uh),vv=class{constructor(e,s,r){this.id=e,this.hostElement=s,this._engine=r,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Pr(s,this._hostClassName)}listen(e,s,r,c){if(!this._triggers.has(s))throw new He(3302,!1);if(null==r||0==r.length)throw new He(3303,!1);if(!function(i){return"start"==i||"done"==i}(r))throw new He(3400,!1);let o=yr(this._elementListeners,e,[]),y={name:s,phase:r,callback:c};o.push(y);let x=yr(this._engine.statesByElement,e,new Map);return x.has(s)||(Pr(e,vf),Pr(e,vf+"-"+s),x.set(s,sv)),()=>{this._engine.afterFlush(()=>{let I=o.indexOf(y);I>=0&&o.splice(I,1),this._triggers.has(s)||x.delete(s)})}}register(e,s){return!this._triggers.has(e)&&(this._triggers.set(e,s),!0)}_getTrigger(e){let s=this._triggers.get(e);if(!s)throw new He(3401,!1);return s}trigger(e,s,r,c=!0){let o=this._getTrigger(s),y=new mh(this.id,s,e),x=this._engine.statesByElement.get(e);x||(Pr(e,vf),Pr(e,vf+"-"+s),this._engine.statesByElement.set(e,x=new Map));let I=x.get(s),A=new fh(r,this.id);if(!(r&&r.hasOwnProperty("value"))&&I&&A.absorbOptions(I.options),x.set(s,A),I||(I=sv),A.value!==uh&&I.value===A.value){if(!function(i,e){let s=Object.keys(i),r=Object.keys(e);if(s.length!=r.length)return!1;for(let c=0;c<s.length;c++){let o=s[c];if(!e.hasOwnProperty(o)||i[o]!==e[o])return!1}return!0}(I.params,A.params)){let Ie=[],je=o.matchStyles(I.value,I.params,Ie),Ae=o.matchStyles(A.value,A.params,Ie);Ie.length?this._engine.reportError(Ie):this._engine.afterFlush(()=>{rl(e,je),Ro(e,Ae)})}return}let re=yr(this._engine.playersByElement,e,[]);re.forEach(Ie=>{Ie.namespaceId==this.id&&Ie.triggerName==s&&Ie.queued&&Ie.destroy()});let le=o.matchTransition(I.value,A.value,e,A.params),ve=!1;if(!le){if(!c)return;le=o.fallbackTransition,ve=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:s,transition:le,fromState:I,toState:A,player:y,isFallbackTransition:ve}),ve||(Pr(e,BM),y.onStart(()=>{_c(e,BM)})),y.onDone(()=>{let Ie=this.players.indexOf(y);Ie>=0&&this.players.splice(Ie,1);let je=this._engine.playersByElement.get(e);if(je){let Ae=je.indexOf(y);Ae>=0&&je.splice(Ae,1)}}),this.players.push(y),re.push(y),y}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(s=>s.delete(e)),this._elementListeners.forEach((s,r)=>{this._elementListeners.set(r,s.filter(c=>c.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let s=this._engine.playersByElement.get(e);s&&(s.forEach(r=>r.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,s){let r=this._engine.driver.query(e,Ef,!0);r.forEach(c=>{if(c[co])return;let o=this._engine.fetchNamespacesByElement(c);o.size?o.forEach(y=>y.triggerLeaveAnimation(c,s,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>r.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(e,s,r,c){let o=this._engine.statesByElement.get(e),y=new Map;if(o){let x=[];if(o.forEach((I,A)=>{if(y.set(A,I.value),this._triggers.has(A)){let L=this.trigger(e,A,uh,c);L&&x.push(L)}}),x.length)return this._engine.markElementAsRemoved(this.id,e,!0,s,y),r&&Xs(x).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let s=this._elementListeners.get(e),r=this._engine.statesByElement.get(e);if(s&&r){let c=new Set;s.forEach(o=>{let y=o.name;if(c.has(y))return;c.add(y);let I=this._triggers.get(y).fallbackTransition,A=r.get(y)||sv,L=new fh(uh),G=new mh(this.id,y,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:y,transition:I,fromState:A,toState:L,player:G,isFallbackTransition:!0})})}}removeNode(e,s){let r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,s),this.triggerLeaveAnimation(e,s,!0))return;let c=!1;if(r.totalAnimations){let o=r.players.length?r.playersByQueriedElement.get(e):[];if(o&&o.length)c=!0;else{let y=e;for(;y=y.parentNode;)if(r.statesByElement.get(y)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(e),c)r.markElementAsRemoved(this.id,e,!1,s);else{let o=e[co];(!o||o===tE)&&(r.afterFlush(()=>this.clearElementCache(e)),r.destroyInnerAnimations(e),r._onRemovalComplete(e,s))}}insertNode(e,s){Pr(e,this._hostClassName)}drainQueuedTransitions(e){let s=[];return this._queue.forEach(r=>{let c=r.player;if(c.destroyed)return;let o=r.element,y=this._elementListeners.get(o);y&&y.forEach(x=>{if(x.name==r.triggerName){let I=Mv(o,r.triggerName,r.fromState.value,r.toState.value);I._data=e,wv(r.player,x.phase,I,x.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):s.push(r)}),this._queue=[],s.sort((r,c)=>{let o=r.transition.ast.depCount,y=c.transition.ast.depCount;return 0==o||0==y?o-y:this._engine.driver.containsElement(r.element,c.element)?1:-1})}destroy(e){this.players.forEach(s=>s.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},xv=class{_onRemovalComplete(e,s){this.onRemovalComplete(e,s)}constructor(e,s,r){this.bodyNode=e,this.driver=s,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(c,o)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(s=>{s.players.forEach(r=>{r.queued&&e.push(r)})}),e}createNamespace(e,s){let r=new vv(e,s,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,s)?this._balanceNamespaceList(r,s):(this.newHostElements.set(s,r),this.collectEnterElement(s)),this._namespaceLookup[e]=r}_balanceNamespaceList(e,s){let r=this._namespaceList,c=this.namespacesByHostElement;if(r.length-1>=0){let y=!1,x=this.driver.getParentElement(s);for(;x;){let I=c.get(x);if(I){let A=r.indexOf(I);r.splice(A+1,0,e),y=!0;break}x=this.driver.getParentElement(x)}y||r.unshift(e)}else r.push(e);return c.set(s,e),e}register(e,s){let r=this._namespaceLookup[e];return r||(r=this.createNamespace(e,s)),r}registerTrigger(e,s,r){let c=this._namespaceLookup[e];c&&c.register(s,r)&&this.totalAnimations++}destroy(e,s){!e||(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let r=this._fetchNamespace(e);this.namespacesByHostElement.delete(r.hostElement);let c=this._namespaceList.indexOf(r);c>=0&&this._namespaceList.splice(c,1),r.destroy(s),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let s=new Set,r=this.statesByElement.get(e);if(r)for(let c of r.values())if(c.namespaceId){let o=this._fetchNamespace(c.namespaceId);o&&s.add(o)}return s}trigger(e,s,r,c){if(wf(s)){let o=this._fetchNamespace(e);if(o)return o.trigger(s,r,c),!0}return!1}insertNode(e,s,r,c){if(!wf(s))return;let o=s[co];if(o&&o.setForRemoval){o.setForRemoval=!1,o.setForMove=!0;let y=this.collectedLeaveElements.indexOf(s);y>=0&&this.collectedLeaveElements.splice(y,1)}if(e){let y=this._fetchNamespace(e);y&&y.insertNode(s,r)}c&&this.collectEnterElement(s)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,s){s?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Pr(e,ov)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),_c(e,ov))}removeNode(e,s,r){if(wf(s)){let c=e?this._fetchNamespace(e):null;c?c.removeNode(s,r):this.markElementAsRemoved(e,s,!1,r);let o=this.namespacesByHostElement.get(s);o&&o.id!==e&&o.removeNode(s,r)}else this._onRemovalComplete(s,r)}markElementAsRemoved(e,s,r,c,o){this.collectedLeaveElements.push(s),s[co]={namespaceId:e,setForRemoval:c,hasAnimation:r,removedBeforeQueried:!1,previousTriggersValues:o}}listen(e,s,r,c,o){return wf(s)?this._fetchNamespace(e).listen(s,r,c,o):()=>{}}_buildInstruction(e,s,r,c,o){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,r,c,e.fromState.options,e.toState.options,s,o)}destroyInnerAnimations(e){let s=this.driver.query(e,Ef,!0);s.forEach(r=>this.destroyActiveAnimationsForElement(r)),0!=this.playersByQueriedElement.size&&(s=this.driver.query(e,cv,!0),s.forEach(r=>this.finishActiveQueriedAnimationOnElement(r)))}destroyActiveAnimationsForElement(e){let s=this.playersByElement.get(e);s&&s.forEach(r=>{r.queued?r.markedForDestroy=!0:r.destroy()})}finishActiveQueriedAnimationOnElement(e){let s=this.playersByQueriedElement.get(e);s&&s.forEach(r=>r.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Xs(this.players).onDone(()=>e());e()})}processLeaveNode(e){let s=e[co];if(s&&s.setForRemoval){if(e[co]=tE,s.namespaceId){this.destroyInnerAnimations(e);let r=this._fetchNamespace(s.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,s.setForRemoval)}e.classList?.contains(ov)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(e=-1){let s=[];if(this.newHostElements.size&&(this.newHostElements.forEach((r,c)=>this._balanceNamespaceList(r,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let r=0;r<this.collectedEnterElements.length;r++)Pr(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let r=[];try{s=this._flushAnimations(r,e)}finally{for(let c=0;c<r.length;c++)r[c]()}}else for(let r=0;r<this.collectedLeaveElements.length;r++)this.processLeaveNode(this.collectedLeaveElements[r]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(r=>r()),this._flushFns=[],this._whenQuietFns.length){let r=this._whenQuietFns;this._whenQuietFns=[],s.length?Xs(s).onDone(()=>{r.forEach(c=>c())}):r.forEach(c=>c())}}reportError(e){throw new He(3402,!1)}_flushAnimations(e,s){let r=new dh,c=[],o=new Map,y=[],x=new Map,I=new Map,A=new Map,L=new Set;this.disabledNodes.forEach(Ge=>{L.add(Ge);let Xe=this.driver.query(Ge,".ng-animate-queued",!0);for(let Je=0;Je<Xe.length;Je++)L.add(Xe[Je])});let G=this.bodyNode,re=Array.from(this.statesByElement.keys()),le=VM(re,this.collectedEnterElements),ve=new Map,Ie=0;le.forEach((Ge,Xe)=>{let Je=WM+Ie++;ve.set(Xe,Je),Ge.forEach(Et=>Pr(Et,Je))});let je=[],Ae=new Set,yt=new Set;for(let Ge=0;Ge<this.collectedLeaveElements.length;Ge++){let Xe=this.collectedLeaveElements[Ge],Je=Xe[co];Je&&Je.setForRemoval&&(je.push(Xe),Ae.add(Xe),Je.hasAnimation?this.driver.query(Xe,".ng-star-inserted",!0).forEach(Et=>Ae.add(Et)):yt.add(Xe))}let rt=new Map,ot=VM(re,Array.from(Ae));ot.forEach((Ge,Xe)=>{let Je=lv+Ie++;rt.set(Xe,Je),Ge.forEach(Et=>Pr(Et,Je))}),e.push(()=>{le.forEach((Ge,Xe)=>{let Je=ve.get(Xe);Ge.forEach(Et=>_c(Et,Je))}),ot.forEach((Ge,Xe)=>{let Je=rt.get(Xe);Ge.forEach(Et=>_c(Et,Je))}),je.forEach(Ge=>{this.processLeaveNode(Ge)})});let ln=[],kt=[];for(let Ge=this._namespaceList.length-1;Ge>=0;Ge--)this._namespaceList[Ge].drainQueuedTransitions(s).forEach(Je=>{let Et=Je.player,fn=Je.element;if(ln.push(Et),this.collectedEnterElements.length){let qt=fn[co];if(qt&&qt.setForMove){if(qt.previousTriggersValues&&qt.previousTriggersValues.has(Je.triggerName)){let Ei=qt.previousTriggersValues.get(Je.triggerName),Zn=this.statesByElement.get(Je.element);if(Zn&&Zn.has(Je.triggerName)){let Ii=Zn.get(Je.triggerName);Ii.value=Ei,Zn.set(Je.triggerName,Ii)}}return void Et.destroy()}}let ti=!G||!this.driver.containsElement(G,fn),On=rt.get(fn),Un=ve.get(fn),Ht=this._buildInstruction(Je,r,Un,On,ti);if(Ht.errors&&Ht.errors.length)return void kt.push(Ht);if(ti)return Et.onStart(()=>rl(fn,Ht.fromStyles)),Et.onDestroy(()=>Ro(fn,Ht.toStyles)),void c.push(Et);if(Je.isFallbackTransition)return Et.onStart(()=>rl(fn,Ht.fromStyles)),Et.onDestroy(()=>Ro(fn,Ht.toStyles)),void c.push(Et);let er=[];Ht.timelines.forEach(qt=>{qt.stretchStartingKeyframe=!0,this.disabledNodes.has(qt.element)||er.push(qt)}),Ht.timelines=er,r.append(fn,Ht.timelines),y.push({instruction:Ht,player:Et,element:fn}),Ht.queriedElements.forEach(qt=>yr(x,qt,[]).push(Et)),Ht.preStyleProps.forEach((qt,Ei)=>{if(qt.size){let Zn=I.get(Ei);Zn||I.set(Ei,Zn=new Set),qt.forEach((Ii,ni)=>Zn.add(ni))}}),Ht.postStyleProps.forEach((qt,Ei)=>{let Zn=A.get(Ei);Zn||A.set(Ei,Zn=new Set),qt.forEach((Ii,ni)=>Zn.add(ni))})});if(kt.length){let Ge=[];kt.forEach(Xe=>{Ge.push(new He(3505,!1))}),ln.forEach(Xe=>Xe.destroy()),this.reportError(Ge)}let nn=new Map,Cn=new Map;y.forEach(Ge=>{let Xe=Ge.element;r.has(Xe)&&(Cn.set(Xe,Xe),this._beforeAnimationBuild(Ge.player.namespaceId,Ge.instruction,nn))}),c.forEach(Ge=>{let Xe=Ge.element;this._getPreviousPlayers(Xe,!1,Ge.namespaceId,Ge.triggerName,null).forEach(Et=>{yr(nn,Xe,[]).push(Et),Et.destroy()})});let jn=je.filter(Ge=>$M(Ge,I,A)),Pn=new Map;UM(Pn,this.driver,yt,A,No).forEach(Ge=>{$M(Ge,I,A)&&jn.push(Ge)});let Mi=new Map;le.forEach((Ge,Xe)=>{UM(Mi,this.driver,new Set(Ge),I,"!")}),jn.forEach(Ge=>{let Xe=Pn.get(Ge),Je=Mi.get(Ge);Pn.set(Ge,new Map([...Xe?.entries()??[],...Je?.entries()??[]]))});let si=[],st=[],Zi={};y.forEach(Ge=>{let{element:Xe,player:Je,instruction:Et}=Ge;if(r.has(Xe)){if(L.has(Xe))return Je.onDestroy(()=>Ro(Xe,Et.toStyles)),Je.disabled=!0,Je.overrideTotalTime(Et.totalTime),void c.push(Je);let fn=Zi;if(Cn.size>1){let On=Xe,Un=[];for(;On=On.parentNode;){let Ht=Cn.get(On);if(Ht){fn=Ht;break}Un.push(On)}Un.forEach(Ht=>Cn.set(Ht,fn))}let ti=this._buildAnimation(Je.namespaceId,Et,nn,o,Mi,Pn);if(Je.setRealPlayer(ti),fn===Zi)si.push(Je);else{let On=this.playersByElement.get(fn);On&&On.length&&(Je.parentPlayer=Xs(On)),c.push(Je)}}else rl(Xe,Et.fromStyles),Je.onDestroy(()=>Ro(Xe,Et.toStyles)),st.push(Je),L.has(Xe)&&c.push(Je)}),st.forEach(Ge=>{let Xe=o.get(Ge.element);if(Xe&&Xe.length){let Je=Xs(Xe);Ge.setRealPlayer(Je)}}),c.forEach(Ge=>{Ge.parentPlayer?Ge.syncPlayerEvents(Ge.parentPlayer):Ge.destroy()});for(let Ge=0;Ge<je.length;Ge++){let Xe=je[Ge],Je=Xe[co];if(_c(Xe,lv),Je&&Je.hasAnimation)continue;let Et=[];if(x.size){let ti=x.get(Xe);ti&&ti.length&&Et.push(...ti);let On=this.driver.query(Xe,cv,!0);for(let Un=0;Un<On.length;Un++){let Ht=x.get(On[Un]);Ht&&Ht.length&&Et.push(...Ht)}}let fn=Et.filter(ti=>!ti.destroyed);fn.length?LO(this,Xe,fn):this.processLeaveNode(Xe)}return je.length=0,si.forEach(Ge=>{this.players.push(Ge),Ge.onDone(()=>{Ge.destroy();let Xe=this.players.indexOf(Ge);this.players.splice(Xe,1)}),Ge.play()}),si}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,s,r,c,o){let y=[];if(s){let x=this.playersByQueriedElement.get(e);x&&(y=x)}else{let x=this.playersByElement.get(e);if(x){let I=!o||o==uh;x.forEach(A=>{A.queued||!I&&A.triggerName!=c||y.push(A)})}}return(r||c)&&(y=y.filter(x=>!(r&&r!=x.namespaceId||c&&c!=x.triggerName))),y}_beforeAnimationBuild(e,s,r){let o=s.element,y=s.isRemovalTransition?void 0:e,x=s.isRemovalTransition?void 0:s.triggerName;for(let I of s.timelines){let A=I.element,L=A!==o,G=yr(r,A,[]);this._getPreviousPlayers(A,L,y,x,s.toState).forEach(le=>{let ve=le.getRealPlayer();ve.beforeDestroy&&ve.beforeDestroy(),le.destroy(),G.push(le)})}rl(o,s.fromStyles)}_buildAnimation(e,s,r,c,o,y){let x=s.triggerName,I=s.element,A=[],L=new Set,G=new Set,re=s.timelines.map(ve=>{let Ie=ve.element;L.add(Ie);let je=Ie[co];if(je&&je.removedBeforeQueried)return new Qs(ve.duration,ve.delay);let Ae=Ie!==I,yt=function(i){let e=[];return nE(i,e),e}((r.get(Ie)||SO).map(nn=>nn.getRealPlayer())).filter(nn=>!!nn.element&&nn.element===Ie),rt=o.get(Ie),ot=y.get(Ie),ln=HM(this._normalizer,ve.keyframes,rt,ot),kt=this._buildPlayer(ve,ln,yt);if(ve.subTimeline&&c&&G.add(Ie),Ae){let nn=new mh(e,x,Ie);nn.setRealPlayer(kt),A.push(nn)}return kt});A.forEach(ve=>{yr(this.playersByQueriedElement,ve.element,[]).push(ve),ve.onDone(()=>function(i,e,s){let r=i.get(e);if(r){if(r.length){let c=r.indexOf(s);r.splice(c,1)}0==r.length&&i.delete(e)}return r}(this.playersByQueriedElement,ve.element,ve))}),L.forEach(ve=>Pr(ve,LM));let le=Xs(re);return le.onDestroy(()=>{L.forEach(ve=>_c(ve,LM)),Ro(I,s.toStyles)}),G.forEach(ve=>{yr(c,ve,[]).push(le)}),le}_buildPlayer(e,s,r){return s.length>0?this.driver.animate(e.element,s,e.duration,e.delay,e.easing,r):new Qs(e.duration,e.delay)}},mh=class{constructor(e,s,r){this.namespaceId=e,this.triggerName=s,this.element=r,this._player=new Qs,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((s,r)=>{s.forEach(c=>wv(e,r,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let s=this._player;s.triggerCallback&&e.onStart(()=>s.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,s){yr(this._queuedCallbacks,e,[]).push(s)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let s=this._player;s.triggerCallback&&s.triggerCallback(e)}};function wf(i){return i&&1===i.nodeType}function jM(i,e){let s=i.style.display;return i.style.display=e??"none",s}function UM(i,e,s,r,c){let o=[];s.forEach(I=>o.push(jM(I)));let y=[];r.forEach((I,A)=>{let L=new Map;I.forEach(G=>{let re=e.computeStyle(A,G,c);L.set(G,re),(!re||0==re.length)&&(A[co]=TO,y.push(A))}),i.set(A,L)});let x=0;return s.forEach(I=>jM(I,o[x++])),y}function VM(i,e){let s=new Map;if(i.forEach(x=>s.set(x,[])),0==e.length)return s;let c=new Set(e),o=new Map;function y(x){if(!x)return 1;let I=o.get(x);if(I)return I;let A=x.parentNode;return I=s.has(A)?A:c.has(A)?1:y(A),o.set(x,I),I}return e.forEach(x=>{let I=y(x);1!==I&&s.get(I).push(x)}),s}function Pr(i,e){i.classList?.add(e)}function _c(i,e){i.classList?.remove(e)}function LO(i,e,s){Xs(s).onDone(()=>i.processLeaveNode(e))}function nE(i,e){for(let s=0;s<i.length;s++){let r=i[s];r instanceof lh?nE(r.players,e):e.push(r)}}function $M(i,e,s){let r=s.get(i);if(!r)return!1;let c=e.get(i);return c?r.forEach(o=>c.add(o)):e.set(i,r),s.delete(i),!0}var bc=class{constructor(e,s,r){this._driver=s,this._normalizer=r,this._triggerCache={},this.onRemovalComplete=(c,o)=>{},this._transitionEngine=new xv(e.body,s,r),this._timelineEngine=new _v(e.body,s,r),this._transitionEngine.onRemovalComplete=(c,o)=>this.onRemovalComplete(c,o)}registerTrigger(e,s,r,c,o){let y=e+"-"+c,x=this._triggerCache[y];if(!x){let I=[],L=JM(this._driver,o,I,[]);if(I.length)throw new He(3404,!1);x=function(i,e,s){return new yv(i,e,s)}(c,L,this._normalizer),this._triggerCache[y]=x}this._transitionEngine.registerTrigger(s,c,x)}register(e,s){this._transitionEngine.register(e,s)}destroy(e,s){this._transitionEngine.destroy(e,s)}onInsert(e,s,r,c){this._transitionEngine.insertNode(e,s,r,c)}onRemove(e,s,r){this._transitionEngine.removeNode(e,s,r)}disableAnimations(e,s){this._transitionEngine.markElementAsDisabled(e,s)}process(e,s,r,c){if("@"==r.charAt(0)){let[o,y]=PM(r);this._timelineEngine.command(o,s,y,c)}else this._transitionEngine.trigger(e,s,r,c)}listen(e,s,r,c,o){if("@"==r.charAt(0)){let[y,x]=PM(r);return this._timelineEngine.listen(y,s,x,o)}return this._transitionEngine.listen(e,s,r,c,o)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}},FO=(()=>{let e=class{constructor(r,c,o){this._element=r,this._startStyles=c,this._endStyles=o,this._state=0;let y=e.initialStylesByElement.get(r);y||e.initialStylesByElement.set(r,y=new Map),this._initialStyles=y}start(){this._state<1&&(this._startStyles&&Ro(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Ro(this._element,this._initialStyles),this._endStyles&&(Ro(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(rl(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(rl(this._element,this._endStyles),this._endStyles=null),Ro(this._element,this._initialStyles),this._state=3)}},i=e;return e.initialStylesByElement=new WeakMap,i})();function av(i){let e=null;return i.forEach((s,r)=>{(function(i){return"display"===i||"position"===i})(r)&&(e=e||new Map,e.set(r,s))}),e}var Pf=class{constructor(e,s,r,c){this.element=e,this.keyframes=s,this.options=r,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let s=()=>this._onFinish();this.domPlayer.addEventListener("finish",s),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",s)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let s=[];return e.forEach(r=>{s.push(Object.fromEntries(r))}),s}_triggerWebAnimation(e,s,r){return e.animate(this._convertKeyframesToObject(s),r)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((r,c)=>{"offset"!==c&&e.set(c,this._finished?r:QM(this.element,c))}),this.currentSnapshot=e}triggerCallback(e){let s="start"===e?this._onStartFns:this._onDoneFns;s.forEach(r=>r()),s.length=0}},kf=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,s){return!1}containsElement(e,s){return GM(e,s)}getParentElement(e){return Ev(e)}query(e,s,r){return ZM(e,s,r)}computeStyle(e,s,r){return window.getComputedStyle(e)[s]}animate(e,s,r,c,o,y=[]){let I={duration:r,delay:c,fill:0==c?"both":"forwards"};o&&(I.easing=o);let A=new Map,L=y.filter(le=>le instanceof Pf);(function(i,e){return 0===i||0===e})(r,c)&&L.forEach(le=>{le.currentSnapshot.forEach((ve,Ie)=>A.set(Ie,ve))});let G=function(i){return i.length?i[0]instanceof Map?i:i.map(e=>YM(e)):[]}(s).map(le=>vc(le));G=function(i,e,s){if(s.size&&e.length){let r=e[0],c=[];if(s.forEach((o,y)=>{r.has(y)||c.push(y),r.set(y,o)}),c.length)for(let o=1;o<e.length;o++){let y=e[o];c.forEach(x=>y.set(x,QM(i,x)))}}return e}(e,G,A);let re=function(i,e){let s=null,r=null;return Array.isArray(e)&&e.length?(s=av(e[0]),e.length>1&&(r=av(e[e.length-1]))):e instanceof Map&&(s=av(e)),s||r?new FO(i,s,r):null}(e,G);return new Pf(e,G,I,re)}},iE="@.disabled",Lf=class{constructor(e,s,r,c){this.namespaceId=e,this.delegate=s,this.engine=r,this._onDestroy=c,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,s){return this.delegate.createElement(e,s)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,s){this.delegate.appendChild(e,s),this.engine.onInsert(this.namespaceId,s,e,!1)}insertBefore(e,s,r,c=!0){this.delegate.insertBefore(e,s,r),this.engine.onInsert(this.namespaceId,s,e,c)}removeChild(e,s,r){this.engine.onRemove(this.namespaceId,s,this.delegate)}selectRootElement(e,s){return this.delegate.selectRootElement(e,s)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,s,r,c){this.delegate.setAttribute(e,s,r,c)}removeAttribute(e,s,r){this.delegate.removeAttribute(e,s,r)}addClass(e,s){this.delegate.addClass(e,s)}removeClass(e,s){this.delegate.removeClass(e,s)}setStyle(e,s,r,c){this.delegate.setStyle(e,s,r,c)}removeStyle(e,s,r){this.delegate.removeStyle(e,s,r)}setProperty(e,s,r){"@"==s.charAt(0)&&s==iE?this.disableAnimations(e,!!r):this.delegate.setProperty(e,s,r)}setValue(e,s){this.delegate.setValue(e,s)}listen(e,s,r){return this.delegate.listen(e,s,r)}disableAnimations(e,s){this.engine.disableAnimations(e,s)}},bv=class extends Lf{constructor(e,s,r,c,o){super(s,r,c,o),this.factory=e,this.namespaceId=s}setProperty(e,s,r){"@"==s.charAt(0)?"."==s.charAt(1)&&s==iE?this.disableAnimations(e,r=void 0===r||!!r):this.engine.process(this.namespaceId,e,s.slice(1),r):this.delegate.setProperty(e,s,r)}listen(e,s,r){if("@"==s.charAt(0)){let c=function(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}(e),o=s.slice(1),y="";return"@"!=o.charAt(0)&&([o,y]=function(i){let e=i.indexOf(".");return[i.substring(0,e),i.slice(e+1)]}(o)),this.engine.listen(this.namespaceId,c,o,y,x=>{this.factory.scheduleListenerCallback(x._data||-1,r,x)})}return this.delegate.listen(e,s,r)}},Of=class{constructor(e,s,r){this.delegate=e,this.engine=s,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,s.onRemovalComplete=(c,o)=>{let y=o?.parentNode(c);y&&o.removeChild(y,c)}}createRenderer(e,s){let c=this.delegate.createRenderer(e,s);if(!e||!s?.data?.animation){let A=this._rendererCache,L=A.get(c);return L||(L=new Lf("",c,this.engine,()=>A.delete(c)),A.set(c,L)),L}let o=s.id,y=s.id+"-"+this._currentId;this._currentId++,this.engine.register(y,e);let x=A=>{Array.isArray(A)?A.forEach(x):this.engine.registerTrigger(o,y,e,A.name,A)};return s.data.animation.forEach(x),new bv(this,y,c,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,s,r){if(e>=0&&e<this._microtaskId)return void this._zone.run(()=>s(r));let c=this._animationCallbacksBuffer;0==c.length&&queueMicrotask(()=>{this._zone.run(()=>{c.forEach(o=>{let[y,x]=o;y(x)}),this._animationCallbacksBuffer=[]})}),c.push([s,r])}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}},VO=(()=>{let e=class extends bc{constructor(r,c,o,y){super(r,c,o)}ngOnDestroy(){this.flush()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Li),Le(gh),Le(ol),Le(so))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),oE=[{provide:ol,useFactory:function(){return new Cf}},{provide:bc,useClass:VO},{provide:Ga,useFactory:function(i,e,s){return new Of(i,e,s)},deps:[ff,bc,wn]}],rE=[{provide:gh,useFactory:()=>new kf},{provide:n_,useValue:"BrowserAnimations"},...oE],GO=[{provide:gh,useClass:Iv},{provide:n_,useValue:"NoopAnimations"},...oE],sE=(()=>{let e=class{static withConfig(r){return{ngModule:e,providers:r.disableAnimations?GO:rE}}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275mod=hr({type:e}),e.\u0275inj=ur({providers:rE,imports:[IM]}),i})();function ZO(i,e){if(1&i&&(ro(0),fr(1,"div",8),oo()),2&i){let s=e.$implicit;ft(1),at("innerHTML",s,o1)}}function qO(i,e){if(1&i){let s=hn();dt(0,"div",1)(1,"div",2),un(2,ZO,2,1,"ng-container",3),pt(),dt(3,"div",4)(4,"div",5)(5,"div",6)(6,"button",7),Ot("click",function(){return en(s),tn(ct().toggleOpen())}),pt()()()()()}if(2&i){let s=ct();wi("var-compact",s.compact)("var-open",s.open),ft(2),at("ngForOf",s.attributions)}}var aE=(()=>{let e=class{constructor(r,c){this._cd=r,this._sanitizer=c,this.attributions=[],this._listeners=new Map([[["resize"],this._setIsCompact.bind(this)],[["styledata","sourcedata","terrain"],this._updateAttribution.bind(this)]]),this._compactBreakpoint=640,this._linkRegex=/<a .+?<\/a>/gi}ngOnChanges(r){let c=r.map?.previousValue,o=r.map?.currentValue;for(let[y,x]of this._listeners){for(let I of y)c?.off(I,x),o?.on(I,x);o&&x()}}ngOnDestroy(){if(this.map)for(let[r,c]of this._listeners)for(let o of r)this.map.off(o,c)}toggleOpen(){this.open=!this.open,this._cd.detectChanges()}_setIsCompact(){let r=this.map.getCanvasContainer().offsetWidth<=this._compactBreakpoint;this.compact!==r&&(this.compact=r,this._cd.detectChanges())}_updateAttribution(r){this._shouldUpdateAttribution(r)&&(this.attributions=Object.values(this.map?.style?.sourceCaches??{}).filter(o=>o.used||o.usedForTerrain).map(o=>o.getSource().attribution).map(o=>this._sanitizer.sanitize(no.HTML,o??null)).filter(o=>!!o).flatMap(o=>this._splitAttribution(o)).filter((o,y,x)=>x.indexOf(o)===y).sort(this._sortAttributionItems),this._cd.detectChanges())}_splitAttribution(r){return r?.length?r.match(this._linkRegex)??[`<span>${r}</span>`]:[]}_shouldUpdateAttribution(r){return null==r||"metadata"===r.sourceDataType||"style"===r.dataType||"terrain"===r.dataType}_sortAttributionItems(r,c){let o=r.toUpperCase().includes("SBB"),y=c.toUpperCase().includes("SBB");return o&&!y?-1:!o&&y?1:r.localeCompare(c)}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(ki),Ke(Q_))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-attribution"]],inputs:{map:"map"},features:[pi],decls:1,vars:1,consts:[["class","attribution-wrapper","aria-hidden","true",3,"var-compact","var-open",4,"ngIf"],["aria-hidden","true",1,"attribution-wrapper"],[1,"attribution-text"],[4,"ngFor","ngForOf"],[1,"attribution-button"],[1,"map-control-container"],[1,"map-control-button-wrapper"],["type","button",1,"map-control-button",3,"click"],[1,"attribution-item",3,"innerHTML"]],template:function(c,o){1&c&&un(0,qO,7,5,"div",0),2&c&&at("ngIf",o.map)},dependencies:[pc,Bn],styles:['button[_ngcontent-%COMP%]{display:block;width:100%;background-color:inherit;border:0;padding:0}.map-control-container[_ngcontent-%COMP%]{margin:16px;background:#fff;box-shadow:0 0 8px rgba(0,0,0,.1);border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]{margin:6px}}.map-control-button-wrapper[_ngcontent-%COMP%]{line-height:36px;padding:6px;width:48px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{line-height:26px;padding:3px;width:32px}}.map-control-button-wrapper[_ngcontent-%COMP%]{pointer-events:none;border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{border-radius:16px}}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active, .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible){background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active   .map-control-button[_ngcontent-%COMP%], .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible)   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}@media(hover: hover){.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover{background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}}@media(forced-colors: active){.map-control-container[_ngcontent-%COMP%]{forced-color-adjust:none}}.map-control-button[_ngcontent-%COMP%]{background-color:#212121;cursor:pointer;height:36px;pointer-events:auto;text-align:center;mask:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNIDE3Ljg1NDY4LDEzLjc4NTkzNiBDIDE3LjcyMzQ0OCwxNS4zMzI4MDggMTcuMTc1LDE2LjUzNzQ4OCAxNi4yMDkzODQsMTcuNCBjIC0wLjk2NTY0LDAuODUzMTI4IC0yLjI1LDEuMjc5NjggLTMuODUzMTI4LDEuMjc5NjggLTEuOTUsMCAtMy40NTQ3MDQsLTAuNjQ2ODcyIC00LjUxNDA2NCwtMS45NDA2MTYgLTAuOSwtMS4wODc1MTIgLTEuMzUsLTIuNDkzNzQ0IC0xLjM1LC00LjIxODc0NCAwLC0xLjg0Njg3MiAwLjU0ODQyNCwtMy4zMzc1MTIgMS42NDUyOTYsLTQuNDcxODcyIDEuMTA2MjU2LC0xLjEzNDM4NCAyLjU1OTM4NCwtMS43MDE1NzYgNC4zNTkzODQsLTEuNzAxNTc2IDEuNDYyNTEyLDAgMi42NzY1NzYsMC4zNjU2NCAzLjY0MjE5MiwxLjA5Njg3MiAwLjk2NTYxNiwwLjczMTI1NiAxLjUwNDY4LDEuNzAxNTc2IDEuNjE3MTkyLDIuOTEwOTM2IEggMTUuODQzNzQ0IEMgMTUuNjY1NjE2LDkuNTc2NTUyIDE1LjI4MTI1Niw4Ljk3NjU1MiAxNC42OTA2MTYsOC41NTQ2OCAxNC4xLDguMTMyODA4IDEzLjM1LDcuOTIxODcyIDEyLjQ0MDYxNiw3LjkyMTg3MiBjIC0xLjQxNTYxNiwwIC0yLjQ3OTY4LDAuNTM5MDY0IC0zLjE5MjE2OCwxLjYxNzE5MiAtMC41NTMxMjgsMC44MjUgLTAuODI5NzA0LDEuODE0MDY0IC0wLjgyOTcwNCwyLjk2NzE5MiAwLDEuNDE1NjE2IDAuMzYwOTM2LDIuNTM1OTM2IDEuMDgyODA4LDMuMzYwOTM2IDAuNzIxODk2LDAuODI1IDEuNzAxNTc2LDEuMjM3NDg4IDIuOTM5MDY0LDEuMjM3NDg4IDIuMDgxMjU2LDAgMy4yNTMxMjgsLTEuMTA2MjMyIDMuNTE1NjQsLTMuMzE4NzQ0IHogTSAxMi42Mzc0ODgsMS43NjI1IGMgMS45MjE4OTYsMCAzLjc0NTMyLDAuNTI5Njg3MiA1LjQ3MDMyLDEuNTg5MDUyIDEuNzI1LDEuMDU5Mzg0IDMuMDQyMTkyLDIuNDg0Mzg0IDMuOTUxNTc2LDQuMjc1IDAuNzc4MTA0LDEuNTQ2ODk2IDEuMTY3MTY4LDMuMTc4MTI4IDEuMTY3MTY4LDQuODkzNzY4IDAsMi4wMjUgLTAuNTI1LDMuOSAtMS41NzUsNS42MjUgLTEuMDUsMS43MTU2MTYgLTIuNDc1LDMuMDMyODA4IC00LjI3NSwzLjk1MTU1MiAtMS41Mzc0ODgsMC43ODc1MTIgLTMuMTY0MDQsMS4xODEyNTYgLTQuODc5NjgsMS4xODEyNTYgLTIuMDA2MjU2LDAgLTMuODcxODcyLC0wLjUyNSAtNS41OTY4NzIsLTEuNTc1IC0xLjcyNSwtMS4wNSAtMy4wNDY4NzIsLTIuNDc5NjggLTMuOTY1NjE2LC00LjI4OTA2NCBDIDIuMTQ2ODc0NCwxNS44NzY1NTIgMS43NTMxMjU2LDE0LjI1IDEuNzUzMTI1NiwxMi41MzQzODQgMS43NTMxMjU2LDEwLjUgMi4yNzgxMjU2LDguNjE1NjE2IDMuMzI4MTI4LDYuODgxMjU2IDQuMzY4NzQ0LDUuMTg0Mzg0IDUuODAzMTI4LDMuODY3MTkyIDcuNjMxMjU2LDIuOTI5NjggOS4xNTkzODQsMi4xNTE1NjE2IDEwLjgyODEyOCwxLjc2MjUgMTIuNjM3NDg4LDEuNzYyNSBaIG0gLTAuMjM5MDQsMS41MDQ2OTIgYyAtMS42NDA2NCwwIC0zLjE5MjE5MiwwLjQ1NDY4IC00LjY1NDcwNCwxLjM2NDA2NCAtMS40NzE4NzIsMC45MDkzNiAtMi41OTY4NzIsMi4xMzc0ODggLTMuMzc1LDMuNjg0MzYgLTAuNjY1NjE2LDEuMzIxODcyIC0wLjk5ODQyNCwyLjcyMzQ0OCAtMC45OTg0MjQsNC4yMDQ3MDQgMCwxLjczNDM2IDAuNDUsMy4zNDY4NzIgMS4zNSw0LjgzNzQ4OCAwLjksMS40ODEyNTYgMi4xMTg3NDQsMi42MjAzMiAzLjY1NjIzMiwzLjQxNzE5MiAxLjI5Mzc2OCwwLjY2NTYxNiAyLjY2NzE5MiwwLjk5ODQ0OCA0LjEyMDMyLDAuOTk4NDQ4IDEuNzE1NjQsMCAzLjMwNDY4LC0wLjQ1NDcwNCA0Ljc2NzE5MiwtMS4zNjQwNjQgMS40NTMxMjgsLTAuOTA5Mzg0IDIuNTY4NzQ0LC0yLjE0MjE5MiAzLjM0Njg3MiwtMy42OTg0NDggMC42NjU2MTYsLTEuMzIxODcyIDAuOTk4NDQ4LC0yLjcxNDA2NCAwLjk5ODQ0OCwtNC4xNzY1NTIgMCwtMS43NDM3NjggLTAuNDQ1MzIsLTMuMzY1NjQgLTEuMzM1OTM2LC00Ljg2NTY0IC0wLjg4MTI1NiwtMS40NjI0ODggLTIuMDkwNjQsLTIuNTkyMTkyIC0zLjYyODEyOCwtMy4zODkwNjQgLTEuMjg0Mzg0LC0wLjY3NSAtMi43LC0xLjAxMjQ4OCAtNC4yNDY4NzIsLTEuMDEyNDg4IHoiIGZpbGw9IiM3Njc2NzYiIHN0cm9rZT0ibm9uZSIgLz4KPC9zdmc+") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNIDE3Ljg1NDY4LDEzLjc4NTkzNiBDIDE3LjcyMzQ0OCwxNS4zMzI4MDggMTcuMTc1LDE2LjUzNzQ4OCAxNi4yMDkzODQsMTcuNCBjIC0wLjk2NTY0LDAuODUzMTI4IC0yLjI1LDEuMjc5NjggLTMuODUzMTI4LDEuMjc5NjggLTEuOTUsMCAtMy40NTQ3MDQsLTAuNjQ2ODcyIC00LjUxNDA2NCwtMS45NDA2MTYgLTAuOSwtMS4wODc1MTIgLTEuMzUsLTIuNDkzNzQ0IC0xLjM1LC00LjIxODc0NCAwLC0xLjg0Njg3MiAwLjU0ODQyNCwtMy4zMzc1MTIgMS42NDUyOTYsLTQuNDcxODcyIDEuMTA2MjU2LC0xLjEzNDM4NCAyLjU1OTM4NCwtMS43MDE1NzYgNC4zNTkzODQsLTEuNzAxNTc2IDEuNDYyNTEyLDAgMi42NzY1NzYsMC4zNjU2NCAzLjY0MjE5MiwxLjA5Njg3MiAwLjk2NTYxNiwwLjczMTI1NiAxLjUwNDY4LDEuNzAxNTc2IDEuNjE3MTkyLDIuOTEwOTM2IEggMTUuODQzNzQ0IEMgMTUuNjY1NjE2LDkuNTc2NTUyIDE1LjI4MTI1Niw4Ljk3NjU1MiAxNC42OTA2MTYsOC41NTQ2OCAxNC4xLDguMTMyODA4IDEzLjM1LDcuOTIxODcyIDEyLjQ0MDYxNiw3LjkyMTg3MiBjIC0xLjQxNTYxNiwwIC0yLjQ3OTY4LDAuNTM5MDY0IC0zLjE5MjE2OCwxLjYxNzE5MiAtMC41NTMxMjgsMC44MjUgLTAuODI5NzA0LDEuODE0MDY0IC0wLjgyOTcwNCwyLjk2NzE5MiAwLDEuNDE1NjE2IDAuMzYwOTM2LDIuNTM1OTM2IDEuMDgyODA4LDMuMzYwOTM2IDAuNzIxODk2LDAuODI1IDEuNzAxNTc2LDEuMjM3NDg4IDIuOTM5MDY0LDEuMjM3NDg4IDIuMDgxMjU2LDAgMy4yNTMxMjgsLTEuMTA2MjMyIDMuNTE1NjQsLTMuMzE4NzQ0IHogTSAxMi42Mzc0ODgsMS43NjI1IGMgMS45MjE4OTYsMCAzLjc0NTMyLDAuNTI5Njg3MiA1LjQ3MDMyLDEuNTg5MDUyIDEuNzI1LDEuMDU5Mzg0IDMuMDQyMTkyLDIuNDg0Mzg0IDMuOTUxNTc2LDQuMjc1IDAuNzc4MTA0LDEuNTQ2ODk2IDEuMTY3MTY4LDMuMTc4MTI4IDEuMTY3MTY4LDQuODkzNzY4IDAsMi4wMjUgLTAuNTI1LDMuOSAtMS41NzUsNS42MjUgLTEuMDUsMS43MTU2MTYgLTIuNDc1LDMuMDMyODA4IC00LjI3NSwzLjk1MTU1MiAtMS41Mzc0ODgsMC43ODc1MTIgLTMuMTY0MDQsMS4xODEyNTYgLTQuODc5NjgsMS4xODEyNTYgLTIuMDA2MjU2LDAgLTMuODcxODcyLC0wLjUyNSAtNS41OTY4NzIsLTEuNTc1IC0xLjcyNSwtMS4wNSAtMy4wNDY4NzIsLTIuNDc5NjggLTMuOTY1NjE2LC00LjI4OTA2NCBDIDIuMTQ2ODc0NCwxNS44NzY1NTIgMS43NTMxMjU2LDE0LjI1IDEuNzUzMTI1NiwxMi41MzQzODQgMS43NTMxMjU2LDEwLjUgMi4yNzgxMjU2LDguNjE1NjE2IDMuMzI4MTI4LDYuODgxMjU2IDQuMzY4NzQ0LDUuMTg0Mzg0IDUuODAzMTI4LDMuODY3MTkyIDcuNjMxMjU2LDIuOTI5NjggOS4xNTkzODQsMi4xNTE1NjE2IDEwLjgyODEyOCwxLjc2MjUgMTIuNjM3NDg4LDEuNzYyNSBaIG0gLTAuMjM5MDQsMS41MDQ2OTIgYyAtMS42NDA2NCwwIC0zLjE5MjE5MiwwLjQ1NDY4IC00LjY1NDcwNCwxLjM2NDA2NCAtMS40NzE4NzIsMC45MDkzNiAtMi41OTY4NzIsMi4xMzc0ODggLTMuMzc1LDMuNjg0MzYgLTAuNjY1NjE2LDEuMzIxODcyIC0wLjk5ODQyNCwyLjcyMzQ0OCAtMC45OTg0MjQsNC4yMDQ3MDQgMCwxLjczNDM2IDAuNDUsMy4zNDY4NzIgMS4zNSw0LjgzNzQ4OCAwLjksMS40ODEyNTYgMi4xMTg3NDQsMi42MjAzMiAzLjY1NjIzMiwzLjQxNzE5MiAxLjI5Mzc2OCwwLjY2NTYxNiAyLjY2NzE5MiwwLjk5ODQ0OCA0LjEyMDMyLDAuOTk4NDQ4IDEuNzE1NjQsMCAzLjMwNDY4LC0wLjQ1NDcwNCA0Ljc2NzE5MiwtMS4zNjQwNjQgMS40NTMxMjgsLTAuOTA5Mzg0IDIuNTY4NzQ0LC0yLjE0MjE5MiAzLjM0Njg3MiwtMy42OTg0NDggMC42NjU2MTYsLTEuMzIxODcyIDAuOTk4NDQ4LC0yLjcxNDA2NCAwLjk5ODQ0OCwtNC4xNzY1NTIgMCwtMS43NDM3NjggLTAuNDQ1MzIsLTMuMzY1NjQgLTEuMzM1OTM2LC00Ljg2NTY0IC0wLjg4MTI1NiwtMS40NjI0ODggLTIuMDkwNjQsLTIuNTkyMTkyIC0zLjYyODEyOCwtMy4zODkwNjQgLTEuMjg0Mzg0LC0wLjY3NSAtMi43LC0xLjAxMjQ4OCAtNC4yNDY4NzIsLTEuMDEyNDg4IHoiIGZpbGw9IiM3Njc2NzYiIHN0cm9rZT0ibm9uZSIgLz4KPC9zdmc+") center no-repeat}.map-control-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:#fff}@media(hover: hover){.map-control-button[_ngcontent-%COMP%]:not([disabled]):hover{background-color:#fff}}.map-control-button[_ngcontent-%COMP%]:disabled{cursor:default;background-color:#e5e5e5}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{height:26px}}.attribution-wrapper[_ngcontent-%COMP%]{display:flex;align-items:flex-end;background:rgba(255,255,255,.75)}.attribution-wrapper[_ngcontent-%COMP%]   .attribution-text[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding:0 5px;font-size:12px;justify-content:flex-end;align-self:center;align-items:center;column-gap:.5em}.attribution-wrapper[_ngcontent-%COMP%]   .attribution-text[_ngcontent-%COMP%]   .attribution-item[_ngcontent-%COMP%]{text-align:right}.attribution-wrapper[_ngcontent-%COMP%]   .attribution-button[_ngcontent-%COMP%]{display:none}.attribution-wrapper.var-compact[_ngcontent-%COMP%]{background:none}.attribution-wrapper.var-compact[_ngcontent-%COMP%]   .map-control-container[_ngcontent-%COMP%]{margin:6px}.attribution-wrapper.var-compact[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{line-height:26px;padding:3px;width:32px;border-radius:16px}.attribution-wrapper.var-compact[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{mask-size:12px;-webkit-mask-size:12px;height:26px}.attribution-wrapper.var-compact[_ngcontent-%COMP%]   .attribution-button[_ngcontent-%COMP%]{display:block}.attribution-wrapper.var-compact[_ngcontent-%COMP%]   .attribution-text[_ngcontent-%COMP%]{display:none}.attribution-wrapper.var-compact.var-open[_ngcontent-%COMP%]{background:rgba(255,255,255,.75)}.attribution-wrapper.var-compact.var-open[_ngcontent-%COMP%]   .attribution-text[_ngcontent-%COMP%]{padding-left:12px;min-height:34px;display:flex}.attribution-wrapper.var-compact.var-open[_ngcontent-%COMP%]   .map-control-container[_ngcontent-%COMP%]{background:none;box-shadow:none}.attribution-wrapper.var-compact.var-open[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{mask:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBkPSJNNiwxNy45OTk3IEwxOCw1Ljk5OTcgTTE4LDE3Ljk5OTcgTDYsNS45OTk3Ii8+PC9zdmc+Cg==") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBkPSJNNiwxNy45OTk3IEwxOCw1Ljk5OTcgTTE4LDE3Ljk5OTcgTDYsNS45OTk3Ii8+PC9zdmc+Cg==") center no-repeat}'],changeDetection:0}),i})(),gi=(()=>{let e=class{constructor(r){this._locale=r,this._i18n={de:{close:"Schliessen",touchOverlay:{tip:"Benutzen Sie 2 Finger um die Karte zu bedienen."},a4a:{visualFunction:"Visuelle Funktion, nicht f\xfcr Screenreader gedacht.",zoomIn:"Kartenausschnitt vergr\xf6ssern.",zoomOut:"Kartenausschnitt verkleinern.",selectFloor:"Stockwerk [0] anzeigen.",unselectFloor:"Stockwerk [0] abw\xe4hlen.",basemapSwitch:"Kartentyp \xe4ndern.",homeButton:"Default Zoom",geolocateButton:"Meinen Standort anzeigen"}},fr:{close:"Fermer",touchOverlay:{tip:"Utilisez deux doigts pour consulter la carte."},a4a:{visualFunction:"Fonction visuelle, non destin\xe9e aux lecteurs d'\xe9cran.",zoomIn:"Zoomer.",zoomOut:"D\xe9zoomer.",selectFloor:"Afficher l'\xe9tage [0].",unselectFloor:"D\xe9s\xe9lectionner l'\xe9tage [0].",basemapSwitch:"Changer le type de la carte.",homeButton:"Zoom par d\xe9faut",geolocateButton:"Afficher ma position"}},it:{close:"Chiudere",touchOverlay:{tip:"Utilizzate due dita per muovervi nella mappa."},a4a:{visualFunction:"Funzione visiva, non destinata ai lettori di schermo.",zoomIn:"Ingrandire la sezione della mappa.",zoomOut:"Ridurre la sezione della mappa.",selectFloor:"Mostra il piano [0].",unselectFloor:"Deselezionare il piano [0].",basemapSwitch:"Cambiare il tipo di mappa",homeButton:"Zoom di default",geolocateButton:"Mostra la mia posizione"}},en:{close:"Close",touchOverlay:{tip:"Use two fingers to operate the map."},a4a:{visualFunction:"Visual function, not intended for screen readers.",zoomIn:"Zoom in on map.",zoomOut:"Zoom out on map.",selectFloor:"Select floor [0].",unselectFloor:"Unselect floor [0].",basemapSwitch:"Change the map type",homeButton:"Default Zoom",geolocateButton:"Show my location"}}},this.language=r?.split("-")[0]??"de"}getText(r){return`${this.language}.${r}`.split(".").reduce((o,y)=>o&&o[y],this._i18n)}getTextWithParams(r,...c){let o=this.getText(r);return c.forEach((y,x)=>o=o.replace(`[${x}]`,y)),o}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Ju))},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})();function YO(i,e){if(1&i){let s=hn();dt(0,"div",1)(1,"div",2)(2,"button",3),Ot("click",function(){return en(s),tn(ct().doToggleBasemap())}),pt()()()}if(2&i){let s=ct();wi("small-buttons",s.showSmallButtons),ft(2),mi("aria-label",s.basemapSwitchLabel)}}var lE=(()=>{let e=class{constructor(r){this._i18n=r,this.toggleBasemap=new Mt}ngOnInit(){this.basemapSwitchLabel=`${this._i18n.getText("a4a.visualFunction")} ${this._i18n.getText("a4a.basemapSwitch")}`}doToggleBasemap(){this.toggleBasemap.next()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(gi))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-basemap-switch"]],inputs:{map:"map",showSmallButtons:"showSmallButtons"},outputs:{toggleBasemap:"toggleBasemap"},decls:1,vars:1,consts:[["class","map-control-container",3,"small-buttons",4,"ngIf"],[1,"map-control-container"],[1,"map-control-button-wrapper"],["type","button",1,"map-control-button",3,"click"]],template:function(c,o){1&c&&un(0,YO,3,3,"div",0),2&c&&at("ngIf",o.map)},dependencies:[Bn],styles:['button[_ngcontent-%COMP%]{display:block;width:100%;background-color:inherit;border:0;padding:0}.map-control-container[_ngcontent-%COMP%]{margin:16px;background:#fff;box-shadow:0 0 8px rgba(0,0,0,.1);border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]{margin:6px}}.map-control-button-wrapper[_ngcontent-%COMP%]{line-height:36px;padding:6px;width:48px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{line-height:26px;padding:3px;width:32px}}.map-control-button-wrapper[_ngcontent-%COMP%]{pointer-events:none;border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{border-radius:16px}}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active, .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible){background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active   .map-control-button[_ngcontent-%COMP%], .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible)   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}@media(hover: hover){.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover{background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}}@media(forced-colors: active){.map-control-container[_ngcontent-%COMP%]{forced-color-adjust:none}}.map-control-button[_ngcontent-%COMP%]{background-color:#212121;cursor:pointer;height:36px;pointer-events:auto;text-align:center;mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIGQ9Ik0xMiwxNi42MDYyIEwyLjM5NCwxMC4wMDAyIEwxMiwzLjM5MzIgTDIxLjYwNiwxMC4wMDAyIEwxMiwxNi42MDYyIFogTTUuMzAxOCwxMi4wMDAyIEwyLjM5MzgsMTQuMDAwMiBMMTEuOTk5OCwyMC42MDYyIEwyMS42MDY4LDE0LjAwMDIgTDE4LjY5NzgsMTIuMDAwMiIvPjwvc3ZnPg==") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIGQ9Ik0xMiwxNi42MDYyIEwyLjM5NCwxMC4wMDAyIEwxMiwzLjM5MzIgTDIxLjYwNiwxMC4wMDAyIEwxMiwxNi42MDYyIFogTTUuMzAxOCwxMi4wMDAyIEwyLjM5MzgsMTQuMDAwMiBMMTEuOTk5OCwyMC42MDYyIEwyMS42MDY4LDE0LjAwMDIgTDE4LjY5NzgsMTIuMDAwMiIvPjwvc3ZnPg==") center no-repeat}.map-control-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:#fff}@media(hover: hover){.map-control-button[_ngcontent-%COMP%]:not([disabled]):hover{background-color:#fff}}.map-control-button[_ngcontent-%COMP%]:disabled{cursor:default;background-color:#e5e5e5}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{height:26px}}'],changeDetection:0}),i})(),Nf=[[5.7349,45.6755],[10.6677,47.9163]],Rf="journey-pois-source",wc="rokas-marker-source",uo="rokas-route-source",Sv="rokas-station-hover-source",Ff="rokas-walk-source",_h="rokas-zone-source",Mc="service_points",Ec="journey-pois",Tv="rokas-marker-cluster",Bf=class extends Cr{constructor(e,s,r){super(1),this._mapInstance=e,this._mapEventUtils=s,this._layers=r,this._attachEvent()}complete(){super.complete(),this._subscription?.unsubscribe()}_attachEvent(){let e=new Ct;this._subscription=e.pipe(Wr(200)).subscribe(s=>{let r=this._mapEventUtils.queryFeaturesByLayerIds(this._mapInstance,[s.point.x,s.point.y],this._layers);!r.length||(r=this._mapEventUtils.filterFeaturesByPriority(r),this.next({clickPoint:{x:s.point.x,y:s.point.y},clickLngLat:{lng:s.lngLat.lng,lat:s.lngLat.lat},features:[...r]}))}),this._mapInstance.on("click",s=>e.next(s))}},Fo=class extends Cr{constructor(e,s,r,c){super(1),this._mapInstance=e,this._mapEventUtils=s,this._layers=r,this._routeUtilsService=c,this._layers.size&&this._attachEvent()}complete(){super.complete(),this._subscription?.unsubscribe()}_attachEvent(){let e=this._getMouseMovedSubject(),s={hoveredFeatures:[]};this._mapInstance.on("mousemove",r=>{e.next({mapEvent:Fo._eventToMapEventData(r),hoverState:s})})}_getMouseMovedSubject(){let e=new Ct;return this._subscription=e.pipe(za(25)).subscribe(s=>{this._onHoverChanged(s)}),e}_onHoverChanged(e){let s=e.mapEvent,r=e.hoverState,c={x:s.point.x,y:s.point.y},o={lng:s.lngLat.lng,lat:s.lngLat.lat},y=this._mapEventUtils.queryFeaturesByLayerIds(this._mapInstance,[c.x,c.y],this._layers),x=this._mapEventUtils.filterFeaturesByPriority(y);this._routeUtilsService.filterRouteFeatures(x).map(re=>this._routeUtilsService.findRelatedRoutes(re,this._mapInstance,"visibleOnly")).forEach(re=>x.push(...re));let I=[],A=[],L=[];for(let re of r.hoveredFeatures)x.some(le=>Fo._featureEventDataEquals(re,le))?I.push(re):A.push(re);if(A.length){let re=Fo._eventToHoverChangeEventData(c,o,A,!1);this._setFeatureHoverState(re.features,!1),this.next(re)}L.push(...x.filter(re=>!I.some(le=>Fo._featureEventDataEquals(le,re)))),this._setFeatureHoverState(L,!0);let G=[...I,...L];if(G.length){let re=Fo._eventToHoverChangeEventData(c,o,G,!0);this.next(re)}r.hoveredFeatures=G}_setFeatureHoverState(e,s){e.forEach(r=>this._mapEventUtils.setFeatureState(r,this._mapInstance,{hover:s}))}static _eventToMapEventData(e){return{point:e.point,lngLat:e.lngLat}}static _eventToHoverChangeEventData(e,s,r,c){return{eventPoint:e,eventLngLat:s,hover:c,leave:!c,features:[...r]}}static _featureEventDataEquals(e,s){return e.layer.id===s.layer.id&&e.source===s.source&&e.sourceLayer===s.sourceLayer&&e.id===s.id}},jf=class{constructor(e,s){this._mapInstance=e,this._layerIds=s,this._subject=new Ct,this._layerIds.length&&(this._subscription=this._subject.pipe(za(25)).subscribe(r=>this._updateCursorStyle(r)),this._mouseEventListener=r=>this._subject.next(r.point.clone()),this._layerIds.forEach(r=>{this._mapInstance.on("mouseenter",r,this._mouseEventListener),this._mapInstance.on("mouseleave",r,this._mouseEventListener)}))}complete(){this._subject.complete(),this._subscription?.unsubscribe(),this._layerIds.forEach(e=>{this._mapInstance.off("mouseenter",e,this._mouseEventListener),this._mapInstance.off("mouseleave",e,this._mouseEventListener)})}_updateCursorStyle(e){let r=this._mapInstance.queryRenderedFeatures(e,{layers:this._layerIds})?.length;this._mapInstance.getCanvas().style.cursor=r?"pointer":""}},Js=(()=>{let e=class{queryFeaturesByLayerIds(r,c,o){return r.queryRenderedFeatures(c,{layers:[...o.keys()]}).map(y=>e._toFeatureEventData(y,o.get(y.layer.id)))}queryVisibleFeaturesByFilter(r,c,o,y){return r.queryRenderedFeatures(void 0,{layers:o,filter:y}).map(x=>e._toFeatureEventData(x,c))}queryFeatureSourceByFilter(r,c,o){let y=e._getSourceMapping(c);if(!y)throw new Error("Missing source mapping for feature type: "+c);return r.querySourceFeatures(y,o?{sourceLayer:"ignored",filter:o}:void 0).map(x=>{let I=e._toFeatureEventData(x,c);return I.source||(I.source=y),I})}setFeatureState(r,c,o){if(!r.source)throw new Error(`Missing source id in feature: ${r}`);r.state={...c.getFeatureState(r),...o},c.setFeatureState(r,r.state)}queryFeaturesByProperty(r,c,o){return r.queryRenderedFeatures(void 0,{layers:[...c.keys()]}).filter(o).map(y=>e._toFeatureEventData(y,c.get(y.layer.id)))}filterFeaturesByPriority(r){if(!r||!r.length)return r;let c=r.filter(y=>y.geometry.type.includes("Point")),o=r.filter(y=>y.geometry.type.includes("Line"));return c.length?r=c:o.length&&(r=o),r}static _toFeatureEventData(r,c){return{featureDataType:c,geometry:r.geometry,...r,toJSON:()=>{throw new Error("not implemented")}}}static _getSourceMapping(r){switch(r){case"MARKER":return wc;case"ROUTE":return uo;case"ZONE":return _h;default:return}}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),Ic=(()=>{let e=class{getSelectedSbbMarker(){return this._selectedSbbMarker}getSelectedPoi(){return this._selectedPoi}selectSbbMarker(r){this._selectedPoi=void 0,this._selectedSbbMarker=r}selectPoi(r){this._selectedSbbMarker=void 0,this._selectedPoi=r}deselectSbbMarker(){this._selectedSbbMarker=void 0}deselectPoi(){this._selectedPoi=void 0}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),gE=zl(sl(),1);function Vf(i){return!!i&&"mapCenter"in i&&"zoomLevel"in i}var kr=i=>({type:"FeatureCollection",features:i}),Ji=kr([]),$f=(()=>{let e=class{moveMap(r,c){Vf(c)?this._centerMap(r,c.mapCenter,c.zoomLevel):r.fitBounds(c.boundingBox,{padding:c.padding})}pan(r,c){r.panBy([100*-("west"===c?1:"east"===c?-1:0),100*-("north"===c?1:"south"===c?-1:0)],{duration:300})}convertToLngLatLike(r){return r.coordinates}addMissingImage(r,c,o){r.loadImage(o,(y,x)=>this._imageLoadedCallback(r,c,y,x))}verifySources(r,c){for(let o of c){let y=r.getSource(o);if(!y)throw new Error(`${y} was not found in style definition!`)}}updatePoiVisibility(r,c){let o=[Ec,"journey-pois-hover","journey-pois-selected"],y=c?.categories?.length;y&&o.forEach(x=>{r.setFilter(x,["in","subCategory",...c.categories])}),o.forEach(x=>{r.setLayoutProperty(x,"visibility",y?"visible":"none")})}_imageLoadedCallback(r,c,o,y){o?console.error(o):r.addImage(c,y,{pixelRatio:2})}_centerMap(r,c,o){let y={};if(o&&r.getZoom()!==o&&(y.zoom=o),c){let x=r.getCenter(),I=gE.LngLat.convert(c);x.distanceTo(I)>1&&(y.center=I)}Object.keys(y).length&&r.flyTo(y)}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),Hf=(()=>{let e=class{updateRoute(r,c,o=Ji,y=[],x){r.getSource(uo).setData(o),r.removeFeatureState({source:uo}),o.features?.length&&r.once("idle",()=>c.initSelectedState(r,o.features,"ROUTE")),this.handleLegSelection(r,y,x)}handleLegSelection(r,c,o){this._handleStopovers(c,r,o),this._setNotSelectedLegs(r,o)}_setNotSelectedLegs(r,c){r.once("idle",()=>{r.querySourceFeatures(uo,{sourceLayer:"ignored",filter:["has","legId"]}).forEach(o=>{o.source=uo,r.setFeatureState(o,{"not-selected":!(!c||o.properties.legId===c)})})})}_handleStopovers(r,c,o){let y=c.getSource("rokas-stopover-source");if(y){let x=this._groupByLegId(r),I=o&&x.has(o)?x.get(o):[];y.setData(kr(I))}}_groupByLegId(r){let o=((i,e)=>i.reduce((s,r)=>({...s,[e(r)]:[...s[e(r)]||[],r]}),{}))(r.filter(y=>y.properties?.legId),y=>y.properties.legId);return new Map(Object.entries(o))}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),ea=i=>!!i.getStyle().sources[Ff],Dc=(()=>{let e=class{constructor(r){this._mapRouteService=r}updateRoutes(r,c,o=[Ji],y=[]){o.forEach((x,I)=>{let A=x.id??`jmc-generated-${I+1}`,L=y.find(G=>G.id===x.id);for(let G of x.features){G.properties[zo]=A,G.properties[al]=x.isSelected;let re=L?.routeColor;re&&(G.properties[xE]=re)}}),this._mapRouteService.updateRoute(r,c,kr(o.flatMap(x=>x.features)))}getRouteMarkers(r,c){return r?.map(o=>{let y=c?.find(I=>I.id===o.id&&!!o.id)?.midpointMarkerConfiguration,x=o.features.find(I=>"midpoint"===I?.properties.type)?.geometry;if(y&&x)return{...y,id:`route-${o.id}-midpoint-marker`,position:x.coordinates}}).filter(o=>!!o)}getRouteLayerIds(r){return ea(r)?this.generateRouteLayerIds(r,"rokas-route"):this.generateRouteLayerIds(r,"rokas-route-halo-shadow")}generateRouteLayerIds(r,c){let o=[c];for(let y=0;y<5;y++)o.push(`${c}-gen${y}`);return o}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Hf))},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),zo="routeId",xE="lineColor",Gf=(()=>{let e=class{constructor(r,c){this._mapEventUtils=r,this._mapRoutesService=c}filterRouteFeatures(r){return r.filter(c=>!!c.properties[zo])}findRelatedRoutes(r,c,o){let y=this._createRelatedRoutesFilter(r);if("visibleOnly"===o){let x=this._mapRoutesService.getRouteLayerIds(c);return this._mapEventUtils.queryVisibleFeaturesByFilter(c,"ROUTE",x,y)}return this._mapEventUtils.queryFeatureSourceByFilter(c,"ROUTE",y)}setRelatedRouteFeaturesSelection(r,c,o){if(!c.properties[zo])return;let y=this.findRelatedRoutes(c,r,"all");if(y.length)for(let x of y)this._mapEventUtils.setFeatureState(x,r,{selected:o})}_createRelatedRoutesFilter(r){return["all",["==",zo,r.properties[zo]],["!=","$id",r.id??-1]]}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Js),Le(Dc))},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),al="isSelected",Zf=(()=>{let e=class{constructor(r,c,o){this._routeUtilsService=r,this._mapEventUtils=c,this._markerOrPoiSelectionStateService=o,this._touchedZoneIds=new Set}initialize(r,c,o){this._mapInstance=r,this._layersTypes=c,this._selectionModes=o,this._attachMapMoveEvent()}complete(){this._subscription?.unsubscribe()}toggleSelection(r){let c=new Map;for(let o of r){let y=!o.state.selected;this._setFeatureSelection(o,y),"ZONE"===o.featureDataType?this._touchedZoneIds.add(Number(o.id)):"ROUTE"===o.featureDataType?c.set(o,o.state.selected):"POI"===o.featureDataType&&this._selectPoi(y,o)}c.size&&(this._lastRouteEventData=c)}_selectPoi(r,c){r?this._markerOrPoiSelectionStateService.selectPoi({id:c.properties.sbbId}):this._markerOrPoiSelectionStateService.deselectPoi()}initSelectedState(r,c,o){if("ROUTE"===o){let y=c.filter(x=>x.properties[al]);y.forEach(x=>{this._routeUtilsService.setRelatedRouteFeaturesSelection(r,x,!0)}),this._lastRouteEventData=new Map(y.map(x=>[x,!0]))}"ZONE"===o&&(this._touchedZoneIds=new Set,this._mapEventUtils.queryFeatureSourceByFilter(r,"ZONE",["==",al,!0]).forEach(x=>this._mapEventUtils.setFeatureState(x,r,{selected:!0})))}findSelectedFeatures(){return{features:this._mapEventUtils.queryFeaturesByProperty(this._mapInstance,this._layersTypes,r=>r.state.selected)}}_setFeatureSelection(r,c){"single"===this._selectionModes.get(r.featureDataType)&&this._mapInstance.removeFeatureState({source:r.source,sourceLayer:r.sourceLayer}),this._mapEventUtils.setFeatureState(r,this._mapInstance,{selected:c}),this._routeUtilsService.setRelatedRouteFeaturesSelection(this._mapInstance,r,c)}_attachMapMoveEvent(){this.complete();let r=new Ct;this._subscription=r.pipe(za(100)).subscribe(()=>{let c=this._mapInstance;this._lastRouteEventData?.forEach((y,x)=>{this._routeUtilsService.setRelatedRouteFeaturesSelection(c,x,y)}),this._mapEventUtils.queryFeatureSourceByFilter(c,"ZONE",["all",["==",al,!0],["!in","$id",...this._touchedZoneIds]]).forEach(y=>this._mapEventUtils.setFeatureState(y,c,{selected:!0}))}),this._mapInstance.on("move",()=>r.next(void 0))}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Gf),Le(Js),Le(Ic))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),qf=function(i){return i.NEUTRAL="NEUTRAL",i.INFORMATION="INFO",i.DELAY="DELAY",i.WARNING="MISSED-CONNECTION",i.REPLACEMENTBUS="REPLACEMENTBUS",i.CONSTRUCTION="CONSTRUCTION",i.DISRUPTION="DISRUPTION",i.REGIONDISRUPTION="REGION-DISRUPTION",i.WALK="WALK",i.BICYCLE="BICYCLE",i.BICYCLEPARKING="BIKE-PROFILE-SIGN-PARKING",i.RAIL="ZUG",i.TRAM="TRAM",i.BUS="BUS",i.PLAIN="FLUGZEUG",i.BOAT="SCHIFF",i.METRO="METRO",i.COG="ZAHNRADBAHN",i.FUNICULAR="STANDSEILBAHN",i.CABLEWAY="LUFTSEILBAHN",i.GONDOLALIFT="GONDELBAHN",i.CHAIRLIFT="SESSELLIFT",i.SKILIFT="SKILIFT",i.PARKANDRAIL="PARK-AND-RAIL",i.CARPROFILESIGNPARKING="CAR-PROFILE-SIGN-PARKING",i.CUSTOM="CUSTOM",i}(qf||{}),wE=(()=>{let e=class{convertToFeature(r){return r.marker_type="sbb-marker",{geometry:{type:"Point",coordinates:r.position},type:"Feature",properties:{...r}}}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),Wf=(()=>{let e=class{updateConfigs(r){this._popup=r}get popup(){return this._popup}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),Cc=(()=>{let e=class{constructor(r,c,o){this._markerConverter=r,this._mapService=c,this._mapConfigService=o,this.markerCategoryMappings=new Map}initStyleData(r){this.markerCategoryMappings.clear(),this.sources=[wc],this.markerLayers=["sbb-marker"],this.markerLayersSelected=["sbb-marker-selected"];let c=(r.getStyle().metadata??{})["rokas:markerCategoryMapping"]??[];for(let o of c)this.sources.push(o.source),this.markerLayers.push(o.layer),this.markerLayersSelected.push(o.layerSelected),this.markerCategoryMappings.set(o.category,o)}get allMarkerAndClusterLayers(){return[Tv,...this.allMarkerLayers]}get allMarkerLayers(){return[...this.markerLayers,...this.markerLayersSelected]}updateMarkers(r,c,o,y){this._verifyMarkers(c),o||this.unselectFeature(r),this.addMissingImages(r,c,"dark"===y);let x=new Map;for(let I of c??[]){let L=this.markerCategoryMappings.get(I.category)?.source??wc;x.has(L)||x.set(L,[]),x.get(L)?.push(this._markerConverter.convertToFeature(I))}for(let I of this.sources){let A={...Ji};A.features=x.get(I)??[],r.getSource(I).setData(A)}}_getPrimaryMarkerSource(r){return r.getSource(wc)}onClusterClicked(r,c){this._zoomToCluster(r,c.properties?.cluster_id,this._mapService.convertToLngLatLike(c.geometry))}_zoomToCluster(r,c,o,y=[0,0]){this._getPrimaryMarkerSource(r).getClusterExpansionZoom(c,(x,I)=>{I&&this._easeTo(r,o,{zoom:I+.1,offset:y})})}onMarkerClicked(r,c,o){let y=c.properties?.id;if(y&&y!==o)return this._selectFeature(r,y),this._flyToMarker(c.geometry,r),y;this.unselectFeature(r)}_flyToMarker(r,c){"Point"===r?.type&&this._easeTo(c,this._mapService.convertToLngLatLike(r))}selectMarker(r,c){this._selectFeature(r,c.id);let o=r.queryRenderedFeatures(r.project(c.position),{layers:this.allMarkerLayers,filter:["in","id",c.id]});if(o&&o.length)this._easeTo(r,c.position);else{let y=this._queryClusterAtPosition(r,c.position);y?this._zoomUntilMarkerVisible(r,y,c):(r.once("moveend",()=>{y=this._queryClusterAtPosition(r,c.position),y&&setTimeout(()=>this._zoomUntilMarkerVisible(r,y,c),250)}),this._easeTo(r,c.position))}}_easeTo(r,c,o={}){r.easeTo({center:c,offset:this._getSelectedMarkerOffset(r),...o})}_getSelectedMarkerOffset(r){let c=0;return this._mapConfigService.popup&&(c=-(r.getContainer().clientHeight/6+15)),[0,c]}_queryClusterAtPosition(r,c){let o=r.project(c),x=r.queryRenderedFeatures([[o.x-25,o.y-25],[o.x+25,o.y+25]],{layers:[Tv]});return x?.length?x[0]:void 0}_zoomUntilMarkerVisible(r,c,o,y=[]){let x=c.properties?.cluster_id;this._getPrimaryMarkerSource(r).getClusterChildren(x,(I,A)=>{if(!y.length)for(let L of A??[])L.id===o.id?(y.push(!0),this._zoomToCluster(r,x,o.position,this._getSelectedMarkerOffset(r))):!0===L.properties?.cluster&&this._zoomUntilMarkerVisible(r,L,o,y)})}unselectFeature(r){this._selectFeature(r,void 0)}_selectFeature(r,c){let o=c??"";for(let y=0;y<this.markerLayers.length;y++)r.setFilter(this.markerLayers[y],this._createMarkerFilter(o,!1)),r.setFilter(this.markerLayersSelected[y],this._createMarkerFilter(o,!0))}_createMarkerFilter(r,c=!0){return["all",["!has","point_count"],[c?"in":"!in","id",r]]}addMissingImages(r,c,o){let y=new Map;(c??[]).filter(x=>x.originalCategory??x.category===qf.CUSTOM).forEach(x=>{x.originalCategory=x.category;let I=this._buildImageName(x);x.category=I,o?(y.set(`sbb-marker_dark-inactive-black_${I}`,x.icon),y.set(`sbb-marker_dark-active-red_${I}`,x.iconSelected)):(y.set(`sbb-marker_bright-inactive-black_${I}`,x.icon),y.set(`sbb-marker_bright-active-red_${I}`,x.iconSelected))});for(let[x,I]of y)r.hasImage(x)||this._mapService.addMissingImage(r,x,I)}_buildImageName(r){let c=this._simpleHash(`${r.icon}${r.iconSelected}`);return`${this._convertToImageName(r.icon)}_${this._convertToImageName(r.iconSelected)}_${c}`}_convertToImageName(r){return r.substring(r.lastIndexOf("/")+1,r.lastIndexOf("."))}_simpleHash(r){return Math.abs(r.split("").reduce((c,o)=>(c<<5)-c+o.charCodeAt(0)|0,0))}_verifyMarkers(r){let c=(r??[]).filter(o=>o.category===qf.CUSTOM).find(o=>!o.icon||!o.iconSelected);if(c)throw new Error(`Marker with id ${c.id} and category CUSTOM is missing the required 'icon' or 'iconSelected' definition.`)}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(wE),Le($f),Le(Wf))},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),uN=["rokas-walk-from","rokas-walk-to"],hN=["rokas-route-transfer-ending","rokas-route-stopover-circle"],Ov="osm_points",Nv="sbb_id",IE=(()=>{let e=class{registerStationUpdater(r){let c=this._extractStationLayers(r);if(!c)throw new Error("Could not extract stationLayers.");r.loaded()?this._updateStationSource(r,c):r.once("idle",()=>this._updateStationSource(r,c));let o=()=>r.once("idle",()=>this._updateStationSource(r,c));return r.on("moveend",o),o}deregisterStationUpdater(r,c){c&&r.off("moveend",c)}_updateStationSource(r,c){let o=r.queryRenderedFeatures(void 0,{layers:c}).map(this._mapToFeature);o.push(...this._getRouteEndpoints(r)),r.removeFeatureState({source:Sv}),r.getSource(Sv).setData(kr(o))}_getRouteEndpoints(r){let c=r.queryRenderedFeatures(void 0,{layers:ea(r)?uN:hN}).filter(o=>Nv in o.properties).map(this._mapToFeature);return c.length?c.map(o=>r.querySourceFeatures("base",{sourceLayer:Ov,filter:["in",Nv,String(o.properties[Nv])]}).map(y=>({...this._mapToFeature(y),geometry:o.geometry})).pop()).filter(o=>o):[]}_extractStationLayers(r){return r.getStyle().layers?.filter(c=>{let o="source-layer"in c?c["source-layer"]:void 0,y=c.id;return o&&(o===Ov&&y!==Ov||"poi"===o&&y.startsWith("station_ship"))}).map(c=>c.id)}_mapToFeature(r){return{type:r.type,properties:r.properties,geometry:r.geometry}}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),CE=(()=>{let e=class{updateZones(r,c,o=Ji){r.getSource(_h).setData(o),r.removeFeatureState({source:_h}),o?.features?.length&&r.once("idle",()=>{c.initSelectedState(r,o.features,"ZONE")})}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})();function fN(i,e){if(1&i){let s=hn();ro(0),dt(1,"div",4),Ot("click",function(){let o=en(s).index;return tn(ct().onIndexClicked(o))}),pt(),oo()}if(2&i){let s=e.index,r=ct();ft(1),wi("active",s===r.index)}}var mN=()=>[],Yf=(()=>{let e=class{constructor(){this.indexClicked=new Mt}hasPrevious(){return this.index>0}hasNext(){return this.index+1<this.size}onIndexClicked(r){r!==this.index&&(this.index=r,this.indexClicked.next(r))}onPreviousClicked(){this.hasPrevious()&&this.indexClicked.next(--this.index)}onNextClicked(){this.hasNext()&&this.indexClicked.next(++this.index)}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275cmp=Dn({type:e,selectors:[["sbb-overlay-paginator"]],inputs:{index:"index",size:"size"},outputs:{indexClicked:"indexClicked"},decls:4,vars:6,consts:[[1,"rokas-paginator"],[1,"rokas-paginator-item","var-previous",3,"click"],[4,"ngFor","ngForOf"],[1,"rokas-paginator-item","var-next",3,"click"],[1,"rokas-paginator-item","var-index",3,"click"]],template:function(c,o){1&c&&(dt(0,"div",0)(1,"div",1),Ot("click",function(){return o.onPreviousClicked()}),pt(),un(2,fN,2,2,"ng-container",2),dt(3,"div",3),Ot("click",function(){return o.onNextClicked()}),pt()()),2&c&&(ft(1),wi("disabled",!o.hasPrevious()),ft(1),at("ngForOf",function(i,e,s){let r=$y()+5,c=Jt();return c[r]===io?E_(c,r,e()):function(i,e){return i[e]}(c,r)}(0,mN).constructor(o.size)),ft(1),wi("disabled",!o.hasNext()))},dependencies:[pc],styles:['.rokas-paginator[_ngcontent-%COMP%]{display:flex;justify-content:center;height:24px}.rokas-paginator-item[_ngcontent-%COMP%]{cursor:pointer;background-color:#000;width:24px}.rokas-paginator-item.var-next[_ngcontent-%COMP%]{mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cG9seWxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBwb2ludHM9IjggNCAxNiAxMiA4IDIwIi8+PC9zdmc+") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cG9seWxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBwb2ludHM9IjggNCAxNiAxMiA4IDIwIi8+PC9zdmc+") center no-repeat}.rokas-paginator-item.var-previous[_ngcontent-%COMP%]{mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cG9seWxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBwb2ludHM9IjE2IDIwIDggMTIgMTYgNCIvPjwvc3ZnPg==") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cG9seWxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBwb2ludHM9IjE2IDIwIDggMTIgMTYgNCIvPjwvc3ZnPg==") center no-repeat}.rokas-paginator-item.var-index[_ngcontent-%COMP%]{mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==") center no-repeat}.rokas-paginator-item.var-index.active[_ngcontent-%COMP%]{mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI0IiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0iIzAwMCIvPjwvc3ZnPg==") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI0IiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0iIzAwMCIvPjwvc3ZnPg==") center no-repeat}.rokas-paginator-item.disabled[_ngcontent-%COMP%]{cursor:not-allowed;background-color:#e5e5e5}'],changeDetection:0}),i})(),Kf=(()=>{let e=class{constructor(r,c){this._viewContainerRef=r,this._document=c}ngOnChanges(r){r.sbbTemplateOutlet?(this._removeOldTemplate(),"string"==typeof this.sbbTemplateOutlet?this._setupHtmlTemplate(this.sbbTemplateOutlet):this.sbbTemplateOutlet&&this._setupNgTemplate(this.sbbTemplateOutlet)):this._viewRef&&r.sbbTemplateOutletContext?.currentValue&&(this._viewRef.context=this.sbbTemplateOutletContext)}get _nativeElement(){return this._viewContainerRef?.element.nativeElement}_setupNgTemplate(r){this._viewRef=this._viewContainerRef.createEmbeddedView(r,this.sbbTemplateOutletContext)}_setupHtmlTemplate(r){let c=this._document.getElementById(r).content,o=()=>{this._htmlContent=c.cloneNode(!0),this._nativeElement?.replaceChildren(this._htmlContent)};o(),this._htmlTemplateObserver=new MutationObserver(o),this._htmlTemplateObserver.observe(c,{attributes:!0,childList:!0,subtree:!0,characterData:!0})}_removeOldTemplate(){this._viewRef&&(this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._viewRef)),this._viewRef=void 0),this._htmlContent&&(this._nativeElement?.replaceChildren(),this._htmlContent=void 0),this._htmlTemplateObserver?.disconnect()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(Ks),Ke(Li))},e.\u0275dir=lc({type:e,selectors:[["","sbbTemplateOutlet",""]],inputs:{sbbTemplateOutlet:"sbbTemplateOutlet",sbbTemplateOutletContext:"sbbTemplateOutletContext"},features:[pi]}),i})(),gN=["container"];function yN(i,e){if(1&i){let s=hn();dt(0,"sbb-overlay-paginator",6),Ot("indexClicked",function(c){return en(s),tn(ct(2).onIndexSelected(c))}),pt()}if(2&i){let s=ct(2);at("index",s.templateContextIndex)("size",s.templateContextSize)}}function _N(i,e){if(1&i){let s=hn();ro(0),dt(1,"div",1,2)(3,"button",3),Ot("click",function(){return en(s),tn(ct().closeClicked.emit())}),pt(),un(4,yN,1,2,"sbb-overlay-paginator",4),fr(5,"div",5),pt(),oo()}if(2&i){let s=ct();ft(1),at("@showHideTrigger",void 0),ft(2),mi("aria-label",s.closeLabel),ft(1),at("ngIf",s.showPaginator()),ft(1),at("sbbTemplateOutlet",s.template)("sbbTemplateOutletContext",s.getTemplateContext())}}var Qf=(()=>{let e=class{set container(r){let c=r?.nativeElement;c&&(c.removeEventListener("mouseenter",this._mouseEnter),c.removeEventListener("mouseleave",this._mouseLeave),c.addEventListener("mouseenter",this._mouseEnter),c.addEventListener("mouseleave",this._mouseLeave))}constructor(r){this._i18n=r,this.withPaginator=!1,this.closeClicked=new Mt,this.mouseEvent=new Mt,this.templateContextIndex=0,this.templateContextSize=1,this._mouseEnter=()=>this.mouseEvent.next("enter"),this._mouseLeave=()=>this.mouseEvent.next("leave")}ngOnInit(){this.closeLabel=this._i18n.getText("close")}ngOnChanges(r){r.templateContext?.currentValue&&(this.templateContextIndex=0,this.templateContextSize=Array.isArray(this.templateContext)?this.templateContext.length:1)}getTemplateContext(){return{$implicit:(Array.isArray(this.templateContext)&&this.withPaginator?this.templateContext[this.templateContextIndex]:this.templateContext)??{}}}onIndexSelected(r){this.templateContextIndex=r}showPaginator(){return this.withPaginator&&this.templateContextSize>1&&"string"!=typeof this.template}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(gi))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-teaser"]],viewQuery:function(c,o){if(1&c&&Ja(gN,5),2&c){let y;Xa(y=el())&&(o.container=y.first)}},inputs:{rendered:"rendered",templateContext:"templateContext",template:"template",withPaginator:"withPaginator"},outputs:{closeClicked:"closeClicked",mouseEvent:"mouseEvent"},features:[pi],decls:1,vars:1,consts:[[4,"ngIf"],[1,"teaser-container"],["container",""],["type","button","data-testid","close-button",1,"close",3,"click"],[3,"index","size","indexClicked",4,"ngIf"],[3,"sbbTemplateOutlet","sbbTemplateOutletContext"],[3,"index","size","indexClicked"]],template:function(c,o){1&c&&un(0,_N,6,5,"ng-container",0),2&c&&at("ngIf",o.rendered)},dependencies:[Bn,Yf,Kf],styles:['.teaser-container[_ngcontent-%COMP%]{z-index:99;position:absolute;left:0;margin:16px;height:calc(100% - 32px);overflow-y:auto;padding:1rem;background-color:#fff;box-shadow:0 0 8px rgba(0,0,0,.1);border-radius:8px;width:calc(100% - 32px)}@media all and (min-width: 40.1875em){.teaser-container[_ngcontent-%COMP%]{width:20rem;max-width:calc(100% - 96px);top:0}}.teaser-container[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{z-index:101;position:absolute;top:5px;right:5px;height:24px;width:24px;cursor:pointer;padding:0;border:none;background:#212121 none;mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIGQ9Ik02LDE3Ljk5OTcgTDE4LDUuOTk5NyBNMTgsMTcuOTk5NyBMNiw1Ljk5OTciLz4KPC9zdmc+") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIGQ9Ik02LDE3Ljk5OTcgTDE4LDUuOTk5NyBNMTgsMTcuOTk5NyBMNiw1Ljk5OTciLz4KPC9zdmc+") center no-repeat}.teaser-container[_ngcontent-%COMP%]   sbb-overlay-paginator[_ngcontent-%COMP%]{position:absolute;top:5px;left:0;right:0;z-index:100}'],data:{animation:[yf("showHideTrigger",[yc(":enter",[lo({transform:"translateX(-100%)"}),gc("500ms",lo({transform:"translateX(0%)"}))]),yc(":leave",[gc("500ms",lo({transform:"translateX(-100%)"}))])])]},changeDetection:0}),i})(),PE=zl(sl(),1),vN=["popupContent"];function xN(i,e){if(1&i){let s=hn();dt(0,"sbb-overlay-paginator",4),Ot("indexClicked",function(c){return en(s),tn(ct(2).onIndexSelected(c))}),pt()}if(2&i){let s=ct(2);at("index",s.templateContextIndex)("size",s.templateContextSize)}}function bN(i,e){if(1&i&&(ro(0),dt(1,"div",null,1),fr(3,"div",2),un(4,xN,1,2,"sbb-overlay-paginator",3),pt(),oo()),2&i){let s=ct();ft(3),at("sbbTemplateOutlet",s.template)("sbbTemplateOutletContext",s.getTemplateContext()),ft(1),at("ngIf",s.showPaginator())}}var Xf=(()=>{let e=class{set content(r){let c=null==this._popupContent&&null!=r;this._popupContent=r,c&&this._showPopup()}constructor(r,c){this._i18n=r,this._cd=c,this.withPaginator=!1,this.closeClicked=new Mt,this.mouseEvent=new Mt,this._options={closeOnClick:!1,className:"rokas"},this.templateContextIndex=0,this.templateContextSize=1,this._mouseEnter=()=>this.mouseEvent.next("enter"),this._mouseLeave=()=>this.mouseEvent.next("leave")}ngOnChanges(r){r.templateContext?.currentValue&&(this.templateContextIndex=0,this.templateContextSize=Array.isArray(this.templateContext)?this.templateContext.length:1),this._cd.detectChanges(),this._showPopup()}ngOnDestroy(){this._popup?.remove()}getTemplateContext(){return{$implicit:(Array.isArray(this.templateContext)&&this.withPaginator?this.templateContext[this.templateContextIndex]:this.templateContext)??{}}}showPaginator(){return this.withPaginator&&this.templateContextSize>1&&"string"!=typeof this.template}_showPopup(){if(!this.templateContext||!this._popupContent)return this._popup?.remove(),void(this._popup=void 0);this._popup||this._initPopup(),this._popup?.setOffset(this.offset),this.position&&this._popup?.setLngLat(this.position),this._registerEventListeners(this._popup?.getElement())}_registerEventListeners(r){!r||(r.removeEventListener("mouseenter",this._mouseEnter),r.removeEventListener("mouseleave",this._mouseLeave),r.addEventListener("mouseenter",this._mouseEnter),r.addEventListener("mouseleave",this._mouseLeave))}_initPopup(){let r=this._options;this.additionalClassName&&(r.className=r.className+` ${this.additionalClassName}`),this._popup=new PE.Popup(r).setDOMContent(this._popupContent.nativeElement).addTo(this.map);try{this._popup._closeButton.ariaLabel=this._i18n.getText("close")}catch(c){console.warn("Cannot modify label of _popup close button: ",c)}this._popup.on("close",()=>{this._popup=void 0,this.closeClicked.emit()})}onIndexSelected(r){this.templateContextIndex=r,this._cd.detectChanges()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(gi),Ke(ki))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-popup"]],viewQuery:function(c,o){if(1&c&&Ja(vN,5),2&c){let y;Xa(y=el())&&(o.content=y.first)}},inputs:{rendered:"rendered",map:"map",template:"template",templateContext:"templateContext",position:"position",offset:"offset",additionalClassName:"additionalClassName",withPaginator:"withPaginator"},outputs:{closeClicked:"closeClicked",mouseEvent:"mouseEvent"},features:[pi],decls:1,vars:1,consts:[[4,"ngIf"],["popupContent",""],[3,"sbbTemplateOutlet","sbbTemplateOutletContext"],[3,"index","size","indexClicked",4,"ngIf"],[3,"index","size","indexClicked"]],template:function(c,o){1&c&&un(0,bN,5,3,"ng-container",0),2&c&&at("ngIf",o.rendered)},dependencies:[Bn,Yf,Kf],styles:['.maplibregl-popup.rokas{max-width:400px !important;max-height:75%;z-index:3}@media all and (max-width: 40.1775em){.maplibregl-popup.rokas{max-width:100% !important;transform:none !important;left:10px;bottom:10px;right:10px;top:unset}}.maplibregl-popup.rokas .maplibregl-popup-content{font-family:"SBBWeb Roman","Helvetica Neue",Helvetica,Arial,sans-serif;box-shadow:0 0 20px rgba(0,0,0,.25);border-radius:8px;overflow-y:auto}.maplibregl-popup.rokas .maplibregl-popup-content>div{padding:24px}@media all and (max-width: 40.1775em){.maplibregl-popup.rokas .maplibregl-popup-content{width:100%}}.maplibregl-popup.rokas .maplibregl-popup-content sbb-overlay-paginator{display:block;margin-top:12px;margin-bottom:-24px}@media all and (max-width: 40.1775em){.maplibregl-popup.rokas .maplibregl-popup-tip{display:none}}.maplibregl-popup.rokas .maplibregl-popup-close-button{background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBkPSJNNiwxNy45OTk3IEwxOCw1Ljk5OTcgTTE4LDE3Ljk5OTcgTDYsNS45OTk3Ii8+PC9zdmc+Cg==");background-color:#fff;font-size:0;height:24px;width:24px;margin-top:10px;margin-right:10px}@media all and (min-width: 40.1875em){.maplibregl-popup.rokas.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0 !important}}@media all and (min-width: 40.1875em){.maplibregl-popup.rokas.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0 !important}}@media all and (min-width: 40.1875em){.maplibregl-popup.rokas.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0 !important}}@media all and (min-width: 40.1875em){.maplibregl-popup.rokas.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0 !important}}.maplibregl-popup.rokas.marker-details{margin-top:1rem}'],encapsulation:2,changeDetection:0}),i})();function wN(i,e){if(1&i){let s=hn();dt(0,"sbb-popup",2),Ot("closeClicked",function(){return en(s),tn(ct().onOverlayClosed())})("mouseEvent",function(c){return en(s),tn(ct().onOverlayMouseEvent(c))}),pt()}if(2&i){let s=ct();at("rendered",s.overlayVisible)("map",s.map)("template",s.overlayTemplate)("templateContext",s.overlayFeatures)("withPaginator",!0)("position",s.overlayPosition)}}function MN(i,e){if(1&i){let s=hn();dt(0,"sbb-teaser",3),Ot("closeClicked",function(){return en(s),tn(ct().onOverlayClosed())})("mouseEvent",function(c){return en(s),tn(ct().onOverlayMouseEvent(c))}),pt()}if(2&i){let s=ct();at("rendered",s.overlayVisible)("template",s.overlayTemplate)("templateContext",s.overlayFeatures)("withPaginator",!0)}}var Jf=(()=>{let e=class{constructor(r,c,o,y,x,I,A){this._mapStationService=r,this._mapRoutesService=c,this._mapMarkerService=o,this._routeUtilsService=y,this._mapEventUtils=x,this._cd=I,this.mapSelectionEventService=A,this.featureSelectionsChange=new Mt,this.featuresClick=new Mt,this.featuresHoverChange=new Mt,this.overlayVisible=!1,this.overlayFeatures=[],this.overlayHasMouseFocus=!1,this._destroyed=new Ct,this._watchOnLayers=new Map}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._mapCursorStyleEvent?.complete(),this._featuresHoverEvent?.complete(),this._featuresClickEvent?.complete(),this.mapSelectionEventService?.complete()}ngOnChanges(r){this.updateListener()}updateListener(){if(this.listenerOptions&&this.map){this._watchOnLayers.clear(),this.listenerOptions.MARKER?.watch&&this._updateWatchOnLayers(this._mapMarkerService.allMarkerAndClusterLayers,"MARKER"),this.listenerOptions.ROUTE?.watch&&this._updateWatchOnLayers(this._mapRoutesService.getRouteLayerIds(this.map),"ROUTE"),this.listenerOptions.STATION?.watch?(this._updateWatchOnLayers(["rokas-station-hover"],"STATION"),this._mapStationService.deregisterStationUpdater(this.map,this._stationListener),this._stationListener=this._mapStationService.registerStationUpdater(this.map)):this._mapStationService.deregisterStationUpdater(this.map,this._stationListener),this.listenerOptions.ZONE?.watch&&this._updateWatchOnLayers(["rokas-zone"],"ZONE"),this.listenerOptions.POI?.watch&&this._updateWatchOnLayers([Ec],"POI"),this._mapCursorStyleEvent?.complete(),this._mapCursorStyleEvent=new jf(this.map,[...this._watchOnLayers.keys()]);let r=this._listenerOptionsToSelectionModes();this.mapSelectionEventService?.complete(),this.mapSelectionEventService.initialize(this.map,this._watchOnLayers,r),this._featuresClickEvent||(this._featuresClickEvent=new Bf(this.map,this._mapEventUtils,this._watchOnLayers),this._featuresClickEvent.pipe(An(this._destroyed)).subscribe(c=>this._featureClicked(c))),this._featuresHoverEvent||(this._featuresHoverEvent=new Fo(this.map,this._mapEventUtils,this._watchOnLayers,this._routeUtilsService),this._featuresHoverEvent.pipe(An(this._destroyed)).subscribe(c=>this._featureHovered(c)))}}onOverlayMouseEvent(r){let c="leave"===r;c&&"hover"===this.overlayEventType&&(this.overlayVisible=!1,this._cd.detectChanges()),this.overlayHasMouseFocus=!c}_updateWatchOnLayers(r,c){r.forEach(o=>this._watchOnLayers.set(o,c))}_listenerOptionsToSelectionModes(){let r=new Map;return r.set("ROUTE",this.listenerOptions.ROUTE?.selectionMode??"single"),r.set("MARKER",this.listenerOptions.MARKER?.selectionMode??"single"),r.set("STATION",this.listenerOptions.STATION?.selectionMode??"single"),r.set("ZONE",this.listenerOptions.ZONE?.selectionMode??"multi"),r.set("POI",this.listenerOptions.POI?.selectionMode??"single"),r}selectOrDeselectProgrammatically({features:r,...c},o){let y=r.filter(this._getIsSelectedPredicate(!o));y.length&&this._featureClicked({features:y,clickPoint:{x:0,y:0},...c})}_getIsSelectedPredicate(r){return c=>r?c.state.selected:!c.state.selected}_featureClicked(r){this.mapSelectionEventService.toggleSelection(r.features);let c=this.mapSelectionEventService.findSelectedFeatures();this.featureSelectionsChange.next(c),this.featuresClick.next(r),this._updateOverlay(r.features,"click",r.clickLngLat,c)}_filterOverlayFeatures(r,c){let o=r.filter(y=>y.featureDataType===c);return"ROUTE"!==c?o:[...new Map(o.map(y=>[y.properties[zo],y])).values()]}_featureHovered(r){this.featuresHoverChange.next(r),r.hover?this._updateOverlay(r.features,"hover",r.eventLngLat):this.overlayVisible&&"hover"===this.overlayEventType&&(this.overlayTimeoutId=setTimeout(()=>{this.overlayHasMouseFocus||(this.overlayVisible=!1,this._cd.detectChanges())},1e3))}_updateOverlay(r,c,o,y){let x=r[0],I=x.featureDataType,A=this.listenerOptions[I],L="click"===c,G=L?A?.clickTemplate:A?.hoverTemplate,re=!L||this._anySelectedClickedFeatureHasSameTypeAsTopClickedFeature(r,I,y);G&&re?(clearTimeout(this.overlayTimeoutId),this.overlayVisible=!0,this.overlayEventType=c,this.overlayTemplate=G,this.overlayFeatures=this._filterOverlayFeatures(r,I),this.overlayIsPopup=A.popup,this.overlayPosition="Point"===x.geometry.type?x.geometry.coordinates:o):L&&(this.overlayVisible=!1),this._cd.detectChanges()}_anySelectedClickedFeatureHasSameTypeAsTopClickedFeature(r,c,o){let y=this._idsOfFeatureWithSameFeatureDataType(o?.features,c);return this._anyFeaturesWithSameId(r,y)}_idsOfFeatureWithSameFeatureDataType(r,c){return this._featuresWithSameFeatureDataType(r,c).map(o=>o.id)}_featuresWithSameFeatureDataType(r,c){return(r??[]).filter(o=>o.featureDataType===c)}_anyFeaturesWithSameId(r,c){return r.map(o=>o.id).some(o=>c.includes(o))}onOverlayClosed(){this.overlayVisible=!1,"click"===this.overlayEventType&&(this.mapSelectionEventService.toggleSelection(this.overlayFeatures),this.overlayFeatures=[],this.featureSelectionsChange.next(this.mapSelectionEventService.findSelectedFeatures())),this._cd.detectChanges()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(IE),Ke(Dc),Ke(Cc),Ke(Gf),Ke(Js),Ke(ki),Ke(Zf))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-feature-event-listener"]],inputs:{listenerOptions:"listenerOptions",map:"map",poiOptions:"poiOptions"},outputs:{featureSelectionsChange:"featureSelectionsChange",featuresClick:"featuresClick",featuresHoverChange:"featuresHoverChange"},features:[Xp([Zf]),pi],decls:2,vars:2,consts:[[3,"rendered","map","template","templateContext","withPaginator","position","closeClicked","mouseEvent",4,"ngIf"],[3,"rendered","template","templateContext","withPaginator","closeClicked","mouseEvent",4,"ngIf"],[3,"rendered","map","template","templateContext","withPaginator","position","closeClicked","mouseEvent"],[3,"rendered","template","templateContext","withPaginator","closeClicked","mouseEvent"]],template:function(c,o){1&c&&un(0,wN,1,6,"sbb-popup",0)(1,MN,1,4,"sbb-teaser",1),2&c&&(at("ngIf",o.overlayIsPopup),ft(1),at("ngIf",!o.overlayIsPopup))},dependencies:[Bn,Qf,Xf],encapsulation:2,changeDetection:0}),i})();function IN(i,e){if(1&i){let s=hn();dt(0,"div",1)(1,"div",2)(2,"button",3),Ot("click",function(){return en(s),tn(ct().onGeolocateButtonClicked())}),pt()()()}if(2&i){let s=ct();wi("small-buttons",s.showSmallButtons),ft(2),mi("aria-label",s.geolocateButtonLabel)}}var LE=(()=>{let e=class{constructor(r){this._i18n=r,this.geolocateButtonClicked=new Mt}ngOnInit(){this.geolocateButtonLabel=`${this._i18n.getText("a4a.visualFunction")} ${this._i18n.getText("a4a.geolocateButton")}`}onGeolocateButtonClicked(){this.geolocateButtonClicked.next()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(gi))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-geolocate-button"]],inputs:{map:"map",showSmallButtons:"showSmallButtons"},outputs:{geolocateButtonClicked:"geolocateButtonClicked"},decls:1,vars:1,consts:[["class","map-control-container",3,"small-buttons",4,"ngIf"],[1,"map-control-container"],[1,"map-control-button-wrapper"],["type","button",1,"map-control-button",3,"click"]],template:function(c,o){1&c&&un(0,IN,3,3,"div",0),2&c&&at("ngIf",o.map)},dependencies:[Bn],styles:['button[_ngcontent-%COMP%]{display:block;width:100%;background-color:inherit;border:0;padding:0}.map-control-container[_ngcontent-%COMP%]{margin:16px;background:#fff;box-shadow:0 0 8px rgba(0,0,0,.1);border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]{margin:6px}}.map-control-button-wrapper[_ngcontent-%COMP%]{line-height:36px;padding:6px;width:48px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{line-height:26px;padding:3px;width:32px}}.map-control-button-wrapper[_ngcontent-%COMP%]{pointer-events:none;border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{border-radius:16px}}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active, .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible){background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active   .map-control-button[_ngcontent-%COMP%], .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible)   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}@media(hover: hover){.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover{background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}}@media(forced-colors: active){.map-control-container[_ngcontent-%COMP%]{forced-color-adjust:none}}.map-control-button[_ngcontent-%COMP%]{background-color:#212121;cursor:pointer;height:36px;pointer-events:auto;text-align:center;mask:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIKICAgICAgICBkPSJNMjAuMTAwNyAzLjgzOTY2TDE5LjM4NDkgNS4yMjkwNEwxMS45NDQ5IDE5LjY3TDExLjAwMDQgMjEuNTAzM1YxOS40NDFWMTIuOTQxSDQuNTAwNDVIMi40Mzg2TDQuMjcxNDIgMTEuOTk2NkwxOC43MTE0IDQuNTU1NThMMjAuMTAwNyAzLjgzOTY2Wk02LjU2MjMgMTEuOTQxSDExLjUwMDRIMTIuMDAwNFYxMi40NDFWMTcuMzc4OEwxNy43ODAyIDYuMTYwNDJMNi41NjIzIDExLjk0MVoiCiAgICAgICAgZmlsbD0iYmxhY2siLz4KPC9zdmc+Cg==") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIKICAgICAgICBkPSJNMjAuMTAwNyAzLjgzOTY2TDE5LjM4NDkgNS4yMjkwNEwxMS45NDQ5IDE5LjY3TDExLjAwMDQgMjEuNTAzM1YxOS40NDFWMTIuOTQxSDQuNTAwNDVIMi40Mzg2TDQuMjcxNDIgMTEuOTk2NkwxOC43MTE0IDQuNTU1NThMMjAuMTAwNyAzLjgzOTY2Wk02LjU2MjMgMTEuOTQxSDExLjUwMDRIMTIuMDAwNFYxMi40NDFWMTcuMzc4OEwxNy43ODAyIDYuMTYwNDJMNi41NjIzIDExLjk0MVoiCiAgICAgICAgZmlsbD0iYmxhY2siLz4KPC9zdmc+Cg==") center no-repeat}.map-control-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:#fff}@media(hover: hover){.map-control-button[_ngcontent-%COMP%]:not([disabled]):hover{background-color:#fff}}.map-control-button[_ngcontent-%COMP%]:disabled{cursor:default;background-color:#e5e5e5}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{height:26px}}'],changeDetection:0}),i})();function CN(i,e){if(1&i){let s=hn();dt(0,"div",1)(1,"div",2)(2,"button",3),Ot("click",function(){return en(s),tn(ct().onHomeButtonClicked())}),pt()()()}if(2&i){let s=ct();wi("small-buttons",s.showSmallButtons),ft(2),mi("aria-label",s.homeButtonLabel)}}var OE=(()=>{let e=class{constructor(r){this._i18n=r,this.homeButtonClicked=new Mt}ngOnInit(){this.homeButtonLabel=`${this._i18n.getText("a4a.visualFunction")} ${this._i18n.getText("a4a.homeButton")}`}onHomeButtonClicked(){this.homeButtonClicked.next()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(gi))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-home-button"]],inputs:{map:"map",showSmallButtons:"showSmallButtons"},outputs:{homeButtonClicked:"homeButtonClicked"},decls:1,vars:1,consts:[["class","map-control-container",3,"small-buttons",4,"ngIf"],[1,"map-control-container"],[1,"map-control-button-wrapper"],["type","button",1,"map-control-button",3,"click"]],template:function(c,o){1&c&&un(0,CN,3,3,"div",0),2&c&&at("ngIf",o.map)},dependencies:[Bn],styles:['button[_ngcontent-%COMP%]{display:block;width:100%;background-color:inherit;border:0;padding:0}.map-control-container[_ngcontent-%COMP%]{margin:16px;background:#fff;box-shadow:0 0 8px rgba(0,0,0,.1);border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]{margin:6px}}.map-control-button-wrapper[_ngcontent-%COMP%]{line-height:36px;padding:6px;width:48px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{line-height:26px;padding:3px;width:32px}}.map-control-button-wrapper[_ngcontent-%COMP%]{pointer-events:none;border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{border-radius:16px}}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active, .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible){background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active   .map-control-button[_ngcontent-%COMP%], .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible)   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}@media(hover: hover){.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover{background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}}@media(forced-colors: active){.map-control-container[_ngcontent-%COMP%]{forced-color-adjust:none}}.map-control-button[_ngcontent-%COMP%]{background-color:#212121;cursor:pointer;height:36px;pointer-events:auto;text-align:center;mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHBvaW50cz0iMTMuMzM3IDUuOTc2IDEyLjMyNCA3LjI4MyA4LjU2IDguMzA5IDcuODIgNy45MDkgNS4zOCA5LjcyMiA2LjQ4MyAxMC4xMDEgMy41OCAxMy4zMiAyLjUgMTcuMjc0IDQuNjQgMTYuNzMgNS41ODUgMTYuMTggNy44MjIgMTguMzIxIDEwLjk3OSAxNy45NjcgMTIuNzk4IDE1Ljk5OCAxNC45NTEgMTguOTc2IDE2LjUyNSAxNS42MzggMjAuMTg5IDE2LjU5NSAxOS45NTcgMTQuNTkyIDIxLjUgMTQuNjMxIDIxLjM0MiAxMS4zNjIgMTkuOTk5IDEwLjMzNiAxOS41NjMgMTEuMTYzIDE3Ljc4NyAxMC42MjcgMTguNDUgOC42NTEgMTQuNzMzIDcuMjA4Ii8+Cjwvc3ZnPgo=") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8cG9seWdvbiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHBvaW50cz0iMTMuMzM3IDUuOTc2IDEyLjMyNCA3LjI4MyA4LjU2IDguMzA5IDcuODIgNy45MDkgNS4zOCA5LjcyMiA2LjQ4MyAxMC4xMDEgMy41OCAxMy4zMiAyLjUgMTcuMjc0IDQuNjQgMTYuNzMgNS41ODUgMTYuMTggNy44MjIgMTguMzIxIDEwLjk3OSAxNy45NjcgMTIuNzk4IDE1Ljk5OCAxNC45NTEgMTguOTc2IDE2LjUyNSAxNS42MzggMjAuMTg5IDE2LjU5NSAxOS45NTcgMTQuNTkyIDIxLjUgMTQuNjMxIDIxLjM0MiAxMS4zNjIgMTkuOTk5IDEwLjMzNiAxOS41NjMgMTEuMTYzIDE3Ljc4NyAxMC42MjcgMTguNDUgOC42NTEgMTQuNzMzIDcuMjA4Ii8+Cjwvc3ZnPgo=") center no-repeat}.map-control-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:#fff}@media(hover: hover){.map-control-button[_ngcontent-%COMP%]:not([disabled]):hover{background-color:#fff}}.map-control-button[_ngcontent-%COMP%]:disabled{cursor:default;background-color:#e5e5e5}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{height:26px}}'],changeDetection:0}),i})(),NE=(()=>{let e=class{constructor(){this.feature={},this.switchLevel=new Mt}onClick(){this.switchLevel?.emit(this.feature.destinationLevel)}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275cmp=Dn({type:e,selectors:[["sbb-leit-poi"]],inputs:{feature:"feature"},outputs:{switchLevel:"switchLevel"},decls:11,vars:5,consts:[[1,"poi_container",3,"click"],[1,"poi_icon"],[1,"poi_icon","stroke"],[1,"poi_icon","travel_destination_level"]],template:function(c,o){1&c&&(dt(0,"div",0),Ot("click",function(){return o.onClick()}),dt(1,"div",1),Lo(2,"\xa0"),pt(),dt(3,"div",2),Lo(4,"\xa0"),pt(),dt(5,"div",3),Lo(6),pt(),dt(7,"div",2),Lo(8,"\xa0"),pt(),dt(9,"div",1),Lo(10,"\xa0"),pt()()),2&c&&(ft(1),I_("travel_type_"+o.feature.travelType),ft(5),Xu(o.feature.destinationLevel),ft(3),I_("travel_direction_"+o.feature.travelDirection))},styles:['.poi_container{display:flex;width:100px;height:23px;text-align:center;vertical-align:middle;background-color:#fff}.poi_icon{background-color:#fff;background-position:center;background-repeat:no-repeat;color:#000;font-size:1.1em;width:33%}.travel_destination_level{font-size:1.1em;font-weight:normal}.stroke{background-color:#d8d8d8;height:28px;margin-top:-2px;width:1px}.travel_type_lift{background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxNCIgdmlld0JveD0iMCAwIDE3IDE1IiB3aWR0aD0iMTciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEuMTc3MSwxNC4wMzEzTDEwLjI4MTMsMTQuMDMxM0wxMC4yODEzLDAuOTY4OEwxLjE3NzEsMC45Njg4TDEuMTc3MSwxNC4wMzEzWk0xMi4zNjI1LDIuNzUwMkwxNC4wNDE2LDEuMDcwMkwxNS43MjA3LDIuNzUwMk0xNS43MjA5LDEyLjI1MDZMMTQuMDQxNywxMy45Mjk3TDEyLjM2MjYsMTIuMjUwNk02LjUyMDQsMy4xNDZDNi41MjA0LDMuNTgzIDYuMTY1OCwzLjkzNzcgNS43Mjg4LDMuOTM3N0M1LjI5MTgsMy45Mzc3IDQuOTM3MSwzLjU4MyA0LjkzNzEsMy4xNDZDNC45MzcxLDIuNzA4MiA1LjI5MTgsMi4zNTQzIDUuNzI4OCwyLjM1NDNDNi4xNjU4LDIuMzU0MyA2LjUyMDQsMi43MDgyIDYuNTIwNCwzLjE0NlpNNy4zMTIxLDkuNDc4OUw3LjMxMjEsNS41MjA2TDQuMTQ1NCw1LjUyMDZMNC4xNDU0LDkuNDc4OUw0LjkzNzEsOS40Nzg5TDQuOTM3MSwxMi42NDU2TDYuNTIwNCwxMi42NDU2TDYuNTIwNCw5LjQ3ODlMNy4zMTIxLDkuNDc4OVoiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+");background-size:90% 100%}.travel_type_ramp{background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxNCIgdmlld0JveD0iMCAwIDE3IDE1IiB3aWR0aD0iMTciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTMuMzU0MiwxMy4wMjA4TDE2LjAyMDgsOS4wNjI1TDE2LjAyMDgsMTMuMDIwOEwzLjM1NDIsMTMuMDIwOFpNMi41NjI1LDguMjcwOEwyLjU2MjUsMTMuNDE2N000LjkzNzUsMTIuNTI2TDQuOTM3NSw5Ljg1NDJMNC4xNDU4LDguMjcwOE00LjE0NTgsNC4zMTI1TDQuMTQ1OCw4LjI3MDhMMi41NjI1LDguMjcwOEwyLjU2MjUsNC4zMTI1TTAuOTc5Miw3Ljg3NUwwLjk3OTIsNS44OTU4TDIuNTYyNSw0LjMxMjVMNC4xNDU4LDQuMzEyNUw0LjkzNzUsNS44OTU4TDYuMTI1LDcuNDc5Mk0zLjM1NDIsMi43MjkyQzIuOTMyMiwyLjcyOTIgMi41NjI1LDIuMzU5NSAyLjU2MjUsMS45Mzc1QzIuNTYyNSwxLjUxNTUgMi45MzIyLDEuMTQ1OCAzLjM1NDIsMS4xNDU4QzMuNzc2MSwxLjE0NTggNC4xNDU4LDEuNTE1NSA0LjE0NTgsMS45Mzc1QzQuMTQ1OCwyLjM1OTUgMy43NzYxLDIuNzI5MiAzLjM1NDIsMi43MjkyWiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjEiLz48L3N2Zz4=");background-size:90% 100%}.travel_type_stairs{background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE4IiB3aWR0aD0iMTciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTAuNTgzMywxNi4wMjA4TDQuMTQ1OCwxNi4wMjA4TDQuMTQ1OCwxMy42NDU4TDcuMzEyNSwxMy42NDU4TDcuMzEyNSwxMS4yNzA4TDEwLjQ3OTIsMTEuMjcwOEwxMC40NzkyLDguODk1OEwxMy42NDU4LDguODk1OEwxMy42NDU4LDYuNTIwOEwxNi40MTY3LDYuNTIwOE01LjcyOTIsOC4xMDQyTDUuNzI5MiwxMC40NzkyTDQuOTM3NSwxMy42NDU4TTguMTA0MiwxMS4yNzA4TDguMTA0Miw5LjI5MTdMNy4zMTI1LDguMTA0Mk03LjMxMjUsNC4xNDU4TDcuMzEyNSw4LjEwNDJMNS43MjkyLDguMTA0Mkw1LjcyOTIsNC4xMjkyTTQuMTQ1OCw3LjcwODNMNC4xNDU4LDUuNzI5Mkw1LjcyOTIsNC4xNDU4TDcuMzEyNSw0LjE0NThMOC4xMDQyLDUuNzI5Mkw5LjI5MTcsNy4zMTI1TTYuNTIwOCwyLjU2MjVDNi4wOTg5LDIuNTYyNSA1LjcyOTIsMi4xOTI4IDUuNzI5MiwxLjc3MDhDNS43MjkyLDEuMzQ4OSA2LjA5ODksMC45NzkyIDYuNTIwOCwwLjk3OTJDNi45NDI4LDAuOTc5MiA3LjMxMjUsMS4zNDg5IDcuMzEyNSwxLjc3MDhDNy4zMTI1LDIuMTkyOCA2Ljk0MjgsMi41NjI1IDYuNTIwOCwyLjU2MjVaIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS13aWR0aD0iMSIvPjwvc3ZnPg==");background-size:90% 100%}.travel_type_default,.travel_type_escalator{background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDIxIDE3IiB3aWR0aD0iMjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcuOTk3NiwyQzcuOTk3NiwyLjU1MiA3LjU0OTYsMyA2Ljk5NzYsM0M2LjQ0NTYsMyA1Ljk5NzYsMi41NTIgNS45OTc2LDJDNS45OTc2LDEuNDQ3IDYuNDQ1NiwxIDYuOTk3NiwxQzcuNTQ5NiwxIDcuOTk3NiwxLjQ0NyA3Ljk5NzYsMlpNMTcuNSwyTDE0LjUsMkMxMy43NzksMiAxMy4wOTQsMi4zMTEgMTIuNjE5LDIuODU0TDYuMzY1LDEwTDMuNSwxMEMyLjEyMiwxMCAxLDExLjEyMSAxLDEyLjVDMSwxMy44NzggMi4xMjIsMTUgMy41LDE1TDcuNSwxNUM4LjIyMSwxNSA4LjkwNywxNC42ODkgOS4zODEsMTQuMTQ2TDE1LjYzNCw3TDE3LjUsN0MxOC44NzksNyAyMCw1Ljg3OCAyMCw0LjVDMjAsMy4xMjIgMTguODc5LDIgMTcuNSwyWk01Ljk5ODEsOS45OTk1TDUuOTk4MSw0Ljk5OTVMNy45OTgxLDQuOTk5NUw3Ljk5ODEsOC4xMzM1IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS13aWR0aD0iMSIvPjwvc3ZnPg==");background-size:90% 100%}.travel_direction_downstairs{background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSI3IiB2aWV3Qm94PSIwIDAgMTQgOCIgd2lkdGg9IjE0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xLjEzODQsMC41MjQ3bDUuODU2LDUuOTI1bDUuODU2LC01LjkyMiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjEiLz48L3N2Zz4=");background-size:40% 100%}.travel_direction_default,.travel_direction_upstairs{background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSI3IiB2aWV3Qm94PSIwIDAgMTQgOCIgd2lkdGg9IjE0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xMi44NjE2LDYuNDc1M2wtNS44NTYsLTUuOTI1bC01Ljg1Niw1LjkyMiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjEiLz48L3N2Zz4=");background-size:40% 100%}.maplibregl-popup.leit-poi-popup .maplibregl-popup-tip{padding:0;height:0;display:none}.maplibregl-popup.leit-poi-popup .maplibregl-popup-content{border-radius:25px;padding:6px;border:1px solid #000;cursor:pointer}.maplibregl-popup.leit-poi-popup-hidden{display:none !important}'],encapsulation:2,changeDetection:0}),i})(),FE=zl(sl(),1),RE=(()=>{let e=class{constructor(r,c){this._componentRef=r,this._popup=c,this._destroySub=new Ct}get destroyed(){return this._destroySub}get switchLevel(){return this._componentRef.instance.switchLevel}get visible(){return!this._popup.getElement().className.includes(e._hiddenClassName)}toggleHidden(){this._popup.toggleClassName(e._hiddenClassName)}destroy(){this._destroySub.next(),this._destroySub.complete(),this._popup.remove(),this._componentRef.destroy()}},i=e;return e._hiddenClassName="leit-poi-popup-hidden",i})(),zE=(()=>{let e=class{constructor(r,c,o){this._componentFactoryResolver=r,this._appRef=c,this._injector=o,this._componentFactory=this._componentFactoryResolver.resolveComponentFactory(NE)}createMapLeitPoi(r,c){let o=this._componentFactory.create(this._injector);this._appRef.attachView(o.hostView),o.instance.feature=c,o.changeDetectorRef.detectChanges();let x=new FE.Popup(e._popupOptions).setDOMContent(this._getNativeElement(o)).addTo(r);return x.setLngLat(c.location),x.addClassName(e._popupClassName),x.setOffset([(this._isEast(c.placement)?1:-1)*e._xOffset,this._isNorth(c.placement)?0:e._yOffset]),new RE(o,x)}_getNativeElement(r){return r.hostView.rootNodes[0]}_isNorth(r){return"northwest"===r||"northeast"===r}_isEast(r){return"southeast"===r||"northeast"===r}},i=e;return e._popupOptions={closeOnClick:!1,closeButton:!1},e._popupClassName="leit-poi-popup",e._xOffset=57,e._yOffset=37,e.\u0275fac=function(c){return new(c||e)(Le(Ys),Le(so),Le(pr))},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),Sc=(()=>{let e=class{constructor(r){this._mapLeitPoiCreator=r,this.levelSwitched=new Ct,this.destroyed=new Ct,this._leitPoiFeatures=[],this._mapLeitPois=[]}destroy(){this._removeMapLeitPois(),this.destroyed.next(),this.destroyed.complete()}processData(r,c=Ji,o){if(this._removeMapLeitPois(),c&&c.features?.length&&(this._leitPoiFeatures=c.features.filter(y=>!!y.properties?.step&&y.properties?.pathType===e._leitPoiPathType).map(y=>this._convertToLeitPoiFeature(y)).filter(y=>!!y),this._leitPoiFeatures.length)){this._registerMapZoomEvent(r);let y=c.features.some(L=>void 0!==L.properties?.legId),x=c.features.find(L=>!!L.properties?.step&&L.properties?.routeStartLevel&&(!y||L.properties?.legId===o)),I=x?Number(x.properties.routeStartLevel):e._defaultLevel,A=()=>{this.setCurrentLevel(r,I),this.levelSwitched.next(I)};r.loaded()?A():r.once("idle",A)}}setCurrentLevel(r,c){this._showLeitPoiByLevel(r,c)}_registerMapZoomEvent(r){this._mapZoomSubscription||(this._mapZoomSubscription=r.on("zoomend",()=>this._toggleMapLeitPoisVisibility(r.getZoom())))}_toggleMapLeitPoisVisibility(r){e._leitPoiMinMapZoom>=r?this._hideLeitPois():this._showLeitPois()}_showLeitPois(){this._mapLeitPois.filter(r=>!r.visible).forEach(r=>{r.toggleHidden()})}_hideLeitPois(){this._mapLeitPois.filter(r=>r.visible).forEach(r=>{r.toggleHidden()})}_showLeitPoiByLevel(r,c){this._removeMapLeitPois(),this._getFeaturesByLevel(c).forEach(o=>this._showLeitPoi(r,o)),this._toggleMapLeitPoisVisibility(r.getZoom())}_showLeitPoi(r,c){let o=this._mapLeitPoiCreator.createMapLeitPoi(r,c);this._mapLeitPois.push(o),o.switchLevel.pipe(An(o.destroyed)).subscribe(y=>{this._showLeitPoiByLevel(r,y),this.levelSwitched.next(y)})}_convertToLeitPoiFeature(r){try{if(r.properties)return{travelType:r.properties.travelType.toLowerCase(),travelDirection:r.properties.direction.toLowerCase(),placement:r.properties.placement.toLowerCase(),sourceLevel:Number(r.properties.sourceFloor),location:r.geometry.coordinates,destinationLevel:Number(r.properties.destinationFloor)}}catch(c){console.error("Failed to convert Feature to LeitPoiFeature:",r,c)}}_getFeaturesByLevel(r){return this._leitPoiFeatures.filter(c=>c.sourceLevel===r)}_removeMapLeitPois(){this._mapLeitPois.forEach(r=>r.destroy()),this._mapLeitPois.length=0}},i=e;return e._leitPoiPathType="leit_poi",e._defaultLevel=0,e._leitPoiMinMapZoom=15,e.\u0275fac=function(c){return new(c||e)(Le(zE))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),Tc=(()=>{let e=class{updateTransfer(r,c=Ji){this._getSource(r).setData(c),this._data=c}updateOutdoorWalkFloor(r,c){let o=this._data?.features??[];((i,e)=>i.some(s=>+s.properties.additionalFloor===e))(o,c)&&(this._data.features=function(i,e){return i.filter(s=>+s.properties.additionalFloor===e).map(({properties:s,...r})=>({...r,properties:{...s,floor:s.additionalFloor,additionalFloor:s.floor}}))}(o,c),this._getSource(r).setData(this._data))}_getSource(r){return r.getSource(ea(r)?Ff:uo)}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),Ac=(()=>{let e=class{constructor(){this._knownLayerTypes=["fill","fill-extrusion","line","symbol"],this._knownLvlLayerIds=[]}setMap(r){this._map=r,this.collectLvlLayers()}setLevelFilter(r){this._knownLvlLayerIds.forEach(c=>{try{let o=this._map.getFilter(c)??void 0,y=this._calculateLayerFilter(o,r);this._map.setFilter(c,y)}catch(o){console.error("Failed to set new layer filter",c,o)}}),this._setLayerVisibility("rokas_background_mask",void 0!==r&&r<0)}_calculateLayerFilter(r,c){if(!Array.isArray(r)||r.length<1)return null;let o=[];o.push(r[0]);let y=!1;return r.slice(1).forEach(x=>{if("string"==typeof x&&this._isFloorFilter(x))y=!0,o.push(x);else if(Array.isArray(x)){let I=!1,A=[x[0]];x.slice(1).forEach(L=>{let G=JSON.stringify(L);this._isCaseLvlFilter(G)?(I=!0,A.push(L)):this._isFloorFilter(G)?(I=!0,y=!0,A.push(L)):I?(I=!1,A.push(c)):A.push(L)}),o.push(A)}else y?(y=!1,o.push(c)):o.push(x)}),o}_isCaseLvlFilter(r){return r.startsWith('["case",["has","level"],["get","level"]')}_isFloorFilter(r){return-1!==r.indexOf("floor")}collectLvlLayers(){this._knownLvlLayerIds=[],this._map.getStyle().layers?.forEach(r=>{this._knownLayerTypes.includes(r.type)&&(r.id.endsWith("-lvl")||r.id.startsWith("rokas_indoor")||r.id.startsWith("geojson_walk")||r.id.startsWith("rokas-walk"))&&this._knownLvlLayerIds.push(r.id)})}_setLayerVisibility(r,c){this._map.getStyle().layers?.forEach(o=>{if(o.id.startsWith(r))try{this._map.getLayer(o.id).visibility=c?"visible":"none"}catch(y){console.error("Failed to set layer visibility",o.id,y)}})}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),$E=(()=>{let e=class{constructor(){this._levelsFeaturePropertyName="floor_liststring"}getVisibleLevels(r){let c=r.getStyle().sources;if(!c||!c[Mc])return console.error(`source '${Mc}' not found in map style.`),[];let y=r.querySourceFeatures(Mc).map(x=>this._extractLevels(x.properties));return this._flatten(y).sort((x,I)=>I-x)}_extractLevels(r){return r&&r[this._levelsFeaturePropertyName]?r[this._levelsFeaturePropertyName].split(",").map(c=>Number(c)):[]}_flatten(r){return Array.from(new Set([].concat(...r)))}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),Pc=(()=>{let e=class{get selectedLevel(){return this._selectedLevel.getValue()}_setSelectedLevel(r){(!r||this.availableLevels.includes(r)||r===this._defaultLevel)&&this._selectedLevel.next(r)}get availableLevels(){return this._availableLevels.getValue()}setAvailableLevels(r){this._availableLevels.next(r),this._updateIsLevelSwitchVisible()}get visibleLevels(){return this._visibleLevels.getValue()}constructor(r,c,o,y,x){this._mapLayerFilterService=r,this._i18n=c,this._queryMapFeaturesService=o,this._mapLeitPoiService=y,this._mapTransferService=x,this._destroyed=new Ct,this._defaultLevel=void 0,this._levelButtonMinMapZoom=15,this._selectedLevel=new rs(this._defaultLevel),this._availableLevels=new rs([]),this._visibleLevels=new rs([]),this._zoomChanged=new Ct,this._mapMoved=new Ct,this.selectedLevel$=this._selectedLevel.asObservable(),this.visibleLevels$=this._visibleLevels.asObservable(),this.changeDetectionEmitter=new Mt}_isVisibleInCurrentMapZoomLevel(){return this._map?.getZoom()>=this._levelButtonMinMapZoom}destroy(){this._destroyed.next(),this._destroyed.complete()}isVisible(){return this._isVisibleInCurrentMapZoomLevel()&&this.availableLevels.length>0}onInit(r){this._map=r,this._lastZoom=this._map.getZoom(),this._map.on("zoomend",()=>this._zoomChanged.next()),this._map.on("moveend",()=>this._mapMoved.next()),this._mapLayerFilterService.setMap(this._map),this._map.isSourceLoaded(Mc)?this._updateLevels():this._map.once("idle",()=>this._updateLevels()),this.changeDetectionEmitter.emit(),this._zoomChanged.pipe(An(this._destroyed)).subscribe(()=>{this._onZoomChanged()}),this._mapMoved.pipe(An(this._destroyed)).subscribe(()=>{this._updateLevels()}),this._mapLeitPoiService.levelSwitched.pipe(An(this._destroyed)).subscribe(c=>{this._setSelectedLevel(c)}),this._selectedLevel.pipe(An(this._destroyed)).subscribe(c=>{this._mapLayerFilterService.setLevelFilter(c),this._mapTransferService.updateOutdoorWalkFloor(this._map,c),this.changeDetectionEmitter.emit()}),this._setSelectedLevel(this._defaultLevel)}switchLevel(r){this._setSelectedLevel(r),this._mapLeitPoiService.setCurrentLevel(this._map,r)}_onZoomChanged(){this._updateIsLevelSwitchVisible(),(this._levelButtonMinMapZoom-this._lastZoom)*(this._levelButtonMinMapZoom-this._map.getZoom())<=0&&this.changeDetectionEmitter.emit(),this._setDefaultLevelIfNotVisible(),this._lastZoom=this._map.getZoom()}_updateIsLevelSwitchVisible(){this._isVisibleInCurrentMapZoomLevel()?this._visibleLevels.next(this.availableLevels):this._visibleLevels.next([])}_setDefaultLevelIfNotVisible(){!this.isVisible()&&this.selectedLevel!==this._defaultLevel&&(this.switchLevel(this._defaultLevel),this.changeDetectionEmitter.emit())}_updateLevels(){if(this._isVisibleInCurrentMapZoomLevel()){let r=this._queryMapFeaturesService.getVisibleLevels(this._map);this._updateLevelsIfChanged(r)}this._setDefaultLevelIfNotVisible()}_updateLevelsIfChanged(r){JSON.stringify(this.availableLevels)!==JSON.stringify(r)&&(this.setAvailableLevels(r),(!this.selectedLevel||-1===this.availableLevels.indexOf(this.selectedLevel))&&this.switchLevel(this._defaultLevel),this.changeDetectionEmitter.emit())}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Ac),Le(gi),Le($E),Le(Sc),Le(Tc))},e.\u0275prov=Be({token:e,factory:e.\u0275fac}),i})(),PN=(i,e)=>({"map-control-button-selected":i,"map-control-button":e});function kN(i,e){if(1&i){let s=hn();ro(0),dt(1,"div",3)(2,"button",4),Ot("click",function(){let o=en(s).$implicit;return tn(ct(2).switchLevel(o))}),Lo(3),pt()(),oo()}if(2&i){let s=e.$implicit,r=ct(2);ft(2),at("ngClass",function(i,e,s,r,c){return function(i,e,s,r,c,o,y){let x=e+s;return function(i,e,s,r){let c=Zs(i,e,s);return Zs(i,e+1,r)||c}(i,x,c,o)?E_(i,x+2,y?r.call(y,c,o):r(c,o)):V1(i,x+2)}(Jt(),$y(),i,e,s,r,c)}(3,PN,s===r.selectedLevel,s!==r.selectedLevel)),mi("aria-label",r.getLevelLabel(s,r.selectedLevel)),ft(1),Qp(" ",s," ")}}function LN(i,e){if(1&i&&(dt(0,"div",1),un(1,kN,4,6,"ng-container",2),pt()),2&i){let s=ct();wi("small-buttons",s.showSmallButtons),at("@fade",void 0),ft(1),at("ngForOf",s.visibleLevels)}}var GE=(()=>{let e=class{constructor(r,c,o){this._ref=r,this._i18n=c,this._levelSwitchService=o,this._destroyed=new Ct,this._levelSwitchService.changeDetectionEmitter.pipe(An(this._destroyed)).subscribe(()=>this._ref.detectChanges())}get selectedLevel(){return this._levelSwitchService.selectedLevel}get visibleLevels(){return this._levelSwitchService.visibleLevels}switchLevel(r){this._levelSwitchService.switchLevel(this.selectedLevel===r?void 0:r)}getLevelLabel(r,c){return`${this._i18n.getText("a4a.visualFunction")} ${this._i18n.getTextWithParams(r===c?"a4a.unselectFloor":"a4a.selectFloor",r)}`}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(ki),Ke(gi),Ke(Pc))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-level-switch"]],inputs:{map:"map",showSmallButtons:"showSmallButtons"},decls:1,vars:1,consts:[["class","map-control-container",3,"small-buttons",4,"ngIf"],[1,"map-control-container"],[4,"ngFor","ngForOf"],[1,"map-control-button-wrapper"],["type","button",3,"ngClass","click"]],template:function(c,o){1&c&&un(0,LN,2,4,"div",0),2&c&&at("ngIf",o.map&&o.visibleLevels.length)},dependencies:[sf,pc,Bn],styles:["button[_ngcontent-%COMP%]{display:block;width:100%;background-color:inherit;border:0;padding:0}.map-control-container[_ngcontent-%COMP%]{margin:16px;background:#fff;box-shadow:0 0 8px rgba(0,0,0,.1);border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]{margin:6px}}.map-control-button-wrapper[_ngcontent-%COMP%]{line-height:36px;padding:6px;width:48px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{line-height:26px;padding:3px;width:32px}}.map-control-button[_ngcontent-%COMP%], .map-control-button[_ngcontent-%COMP%]:hover, .map-control-button-selected[_ngcontent-%COMP%]{cursor:pointer;border-radius:8px;text-align:center;vertical-align:middle}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%], .map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-selected[_ngcontent-%COMP%]{border-radius:6px}}.map-control-button[_ngcontent-%COMP%]:hover, .map-control-button-selected[_ngcontent-%COMP%]:hover, .map-control-button-selected[_ngcontent-%COMP%]{background-color:#212121;color:#fff}.map-control-button-wrapper[_ngcontent-%COMP%]{border-bottom:1px solid #e5e5e5}.map-control-button-wrapper[_ngcontent-%COMP%]:first-child{border-radius:24px 24px 0 0}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]:first-child{border-radius:16px 16px 0 0}}.map-control-button-wrapper[_ngcontent-%COMP%]:first-child   .map-control-button[_ngcontent-%COMP%], .map-control-button-wrapper[_ngcontent-%COMP%]:first-child   .map-control-button-selected[_ngcontent-%COMP%]{border-radius:24px 24px 8px 8px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]:first-child   .map-control-button[_ngcontent-%COMP%], .map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]:first-child   .map-control-button-selected[_ngcontent-%COMP%]{border-radius:16px 16px 6px 6px}}.map-control-button-wrapper[_ngcontent-%COMP%]:last-child{border-radius:0 0 24px 24px;border-bottom-width:0}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]:last-child{border-radius:0 0 16px 16px}}.map-control-button-wrapper[_ngcontent-%COMP%]:last-child   .map-control-button[_ngcontent-%COMP%], .map-control-button-wrapper[_ngcontent-%COMP%]:last-child   .map-control-button-selected[_ngcontent-%COMP%]{border-radius:8px 8px 24px 24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]:last-child   .map-control-button[_ngcontent-%COMP%], .map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]:last-child   .map-control-button-selected[_ngcontent-%COMP%]{border-radius:6px 6px 16px 16px}}"],data:{animation:[yf("fade",[TM("in",lo({opacity:1})),yc(":enter",[lo({opacity:0}),gc(150)]),yc(":leave",gc(150,lo({opacity:0})))])]},changeDetection:0}),i})();function NN(i,e){if(1&i){let s=hn();dt(0,"sbb-teaser",2),Ot("closeClicked",function(){return en(s),tn(ct().closeClicked.next())}),pt()}if(2&i){let s=ct();at("rendered",s.shouldRender)("templateContext",s.selectedMarker)("template",s.template),mi("aria-live","polite")}}function RN(i,e){if(1&i){let s=hn();dt(0,"sbb-popup",3),Ot("closeClicked",function(){return en(s),tn(ct().closeClicked.next())}),pt()}if(2&i){let s=ct();at("rendered",s.shouldRender)("map",s.map)("templateContext",s.selectedMarker)("position",s.getLngLatLike(null==s.selectedMarker?null:s.selectedMarker.position))("offset",s.popupOffset)("template",s.template)("additionalClassName","marker-details")}}var ZE=(()=>{let e=class{constructor(r){this._mapMarkerService=r,this.closeClicked=new Mt,this.shouldRender=!1,this._defaultPopupOffset={right:[-15,-15],left:[15,-15],bottom:[0,-70],"bottom-left":[0,-70],"bottom-right":[0,-70],top:[0,-10],"top-left":[0,-10],"top-right":[0,-10]}}ngOnChanges(r){this.shouldRender=!!this.selectedMarker&&!!this.template,this.popupOffset=this.selectedMarker?this._mapMarkerService.markerCategoryMappings.get(this.selectedMarker.category)?.popupOffset??this._defaultPopupOffset:0}onEscapePressed(){this.selectedMarker&&this.closeClicked.next()}getLngLatLike(r){return r}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(Cc))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-marker-details"]],hostBindings:function(c,o){1&c&&Ot("keyup.escape",function(){return o.onEscapePressed()},0,Fw)},inputs:{selectedMarker:"selectedMarker",template:"template",popup:"popup",map:"map"},outputs:{closeClicked:"closeClicked"},features:[pi],decls:2,vars:2,consts:[[3,"rendered","templateContext","template","closeClicked",4,"ngIf"],[3,"rendered","map","templateContext","position","offset","template","additionalClassName","closeClicked",4,"ngIf"],[3,"rendered","templateContext","template","closeClicked"],[3,"rendered","map","templateContext","position","offset","template","additionalClassName","closeClicked"]],template:function(c,o){1&c&&un(0,NN,1,4,"sbb-teaser",0)(1,RN,1,7,"sbb-popup",1),2&c&&(at("ngIf",!o.popup),ft(1),at("ngIf",o.popup))},dependencies:[Bn,Qf,Xf],encapsulation:2,changeDetection:0}),i})();function zN(i,e){if(1&i){let s=hn();dt(0,"div",1)(1,"div",2)(2,"button",3),Ot("click",function(){return en(s),tn(ct().zoomIn())}),pt()(),dt(3,"div",4)(4,"button",3),Ot("click",function(){return en(s),tn(ct().zoomOut())}),pt()()()}if(2&i){let s=ct();wi("small-buttons",s.showSmallButtons),ft(1),mi("data-disabled",s.isMaxZoom),ft(1),mi("disabled",s.isMaxZoom?"":null)("aria-label",s.zoomInLabel),ft(1),mi("data-disabled",s.isMinZoom),ft(1),mi("disabled",s.isMinZoom?"":null)("aria-label",s.zoomOutLabel)}}var Fv,qE=(()=>{let e=class{constructor(r,c){this._cd=r,this._i18n=c,this._zoomChanged=new Ct,this._destroyed=new Ct}ngOnInit(){this._zoomChanged.pipe(An(this._destroyed)).subscribe(()=>{this._onZoomChanged()}),this.zoomInLabel=`${this._i18n.getText("a4a.visualFunction")} ${this._i18n.getText("a4a.zoomIn")}`,this.zoomOutLabel=`${this._i18n.getText("a4a.visualFunction")} ${this._i18n.getText("a4a.zoomOut")}`}ngOnChanges(r){r.map?.currentValue&&(this.map?.on("zoomend",()=>{this._zoomChanged.next(),this._cd.detectChanges()}),r.map.previousValue||this._setIsMinMaxZoom())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_onZoomChanged(){this._setIsMinMaxZoom()}_setIsMinMaxZoom(){this.isMinZoom=this.map?.getZoom()===this.map?.getMinZoom(),this.isMaxZoom=this.map?.getZoom()===this.map?.getMaxZoom()}zoomIn(){this.map?.zoomIn()}zoomOut(){this.map?.zoomOut()}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(ki),Ke(gi))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-zoom-controls"]],inputs:{map:"map",showSmallButtons:"showSmallButtons"},features:[pi],decls:1,vars:1,consts:[["class","map-control-container",3,"small-buttons",4,"ngIf"],[1,"map-control-container"],[1,"map-control-button-wrapper","var-plus"],["type","button",1,"map-control-button",3,"click"],[1,"map-control-button-wrapper","var-minus"]],template:function(c,o){1&c&&un(0,zN,5,8,"div",0),2&c&&at("ngIf",o.map)},dependencies:[Bn],styles:['button[_ngcontent-%COMP%]{display:block;width:100%;background-color:inherit;border:0;padding:0}.map-control-container[_ngcontent-%COMP%]{margin:16px;background:#fff;box-shadow:0 0 8px rgba(0,0,0,.1);border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]{margin:6px}}.map-control-button-wrapper[_ngcontent-%COMP%]{line-height:36px;padding:6px;width:48px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{line-height:26px;padding:3px;width:32px}}.map-control-button-wrapper[_ngcontent-%COMP%]{pointer-events:none;border-radius:24px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .map-control-button-wrapper[_ngcontent-%COMP%]{border-radius:16px}}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active, .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible){background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):active   .map-control-button[_ngcontent-%COMP%], .map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):has(:focus-visible)   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}@media(hover: hover){.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover{background-color:#212121;background-clip:content-box}.map-control-button-wrapper[_ngcontent-%COMP%]:not([data-disabled=true]):hover   .map-control-button[_ngcontent-%COMP%]{background-color:#fff}}@media(forced-colors: active){.map-control-container[_ngcontent-%COMP%]{forced-color-adjust:none}}.var-plus[_ngcontent-%COMP%]{position:relative;border-radius:24px 24px 12px 12px}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .var-plus[_ngcontent-%COMP%]{border-radius:16px 16px 8px 8px}}.var-plus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{background-color:#212121;cursor:pointer;height:36px;pointer-events:auto;text-align:center;mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIGQ9Ik0xMS41LDIwLjk5OTcgTDExLjUsMy45OTk3IE0yMCwxMi41MDAyIEwzLDEyLjUwMDIiLz48L3N2Zz4=") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIGQ9Ik0xMS41LDIwLjk5OTcgTDExLjUsMy45OTk3IE0yMCwxMi41MDAyIEwzLDEyLjUwMDIiLz48L3N2Zz4=") center no-repeat}.var-plus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:#fff}@media(hover: hover){.var-plus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]:not([disabled]):hover{background-color:#fff}}.var-plus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]:disabled{cursor:default;background-color:#e5e5e5}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .var-plus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{height:26px}}.var-plus[_ngcontent-%COMP%]::after{content:" ";display:block;position:absolute;height:1px;background:#e5e5e5;width:100%;left:0;bottom:-1px}.var-minus[_ngcontent-%COMP%]{border-radius:12px 12px 24px 24px}.var-minus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{background-color:#212121;cursor:pointer;height:36px;pointer-events:auto;text-align:center;mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48bGluZSB4MT0iMjAiIHgyPSIzIiB5MT0iMTIuNSIgeTI9IjEyLjUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIvPjwvc3ZnPg==") center no-repeat;-webkit-mask:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48bGluZSB4MT0iMjAiIHgyPSIzIiB5MT0iMTIuNSIgeTI9IjEyLjUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIvPjwvc3ZnPg==") center no-repeat}.var-minus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:#fff}@media(hover: hover){.var-minus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]:not([disabled]):hover{background-color:#fff}}.var-minus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]:disabled{cursor:default;background-color:#e5e5e5}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .var-minus[_ngcontent-%COMP%]   .map-control-button[_ngcontent-%COMP%]{height:26px}}@media all and (min-width: 40.1875em){.map-control-container.small-buttons[_ngcontent-%COMP%]   .var-minus[_ngcontent-%COMP%]{border-radius:8px 8px 16px 16px}}'],changeDetection:0}),i})(),rI=zl(sl(),1),ta=zl(sl(),1),jN={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},em=0,vh=!1,tm=class extends ta.Evented{constructor(e){super(),this.options=WE({},jN,e),function(i,e){["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"].forEach(s=>{!e[s]||(e[s]=e[s].bind(e))})}(0,this)}onAdd(e){return this._map=e,this._container=document.createElement("div"),function(i){void 0!==Fv||(void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(e=>{Fv="denied"!==e.state}):Fv=!!window.navigator.geolocation),i()}(this._setupUI),this._container}onRemove(e){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,em=0,vh=!1}_isOutOfMapMaxBounds(e){let s=this._map.getMaxBounds(),r=e.coords;return s&&(r.longitude<s.getWest()||r.longitude>s.getEast()||r.latitude<s.getSouth()||r.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR";break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR"}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new CustomEvent("outofmaxbounds",{detail:e})),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK";break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND"}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),(!this.options.trackUserLocation||"ACTIVE_LOCK"===this._watchState)&&this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new CustomEvent("geolocate",{detail:e})),this._finish()}}_updateCamera(e){let s=new ta.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,o=WE({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(r),o,{geolocateSource:!0})}_updateMarker(e){if(e){let s=new ta.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let e=this._map._container.clientHeight/2,s=this._map.unproject([0,e]),r=this._map.unproject([1,e]),c=s.distanceTo(r),o=Math.ceil(2*this._accuracy/c);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code)this._watchState="OFF",void 0!==this._geolocationWatchID&&this._clearWatch();else{if(3===e.code&&vh)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new CustomEvent("error",{detail:e})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(){this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.trackUserLocation&&(this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=document.createElement("div"),this._dotElement.classList.add("maplibregl-user-location-dot","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ta.Marker(this._dotElement),this._circleElement=document.createElement("div"),this._circleElement.classList.add("maplibregl-user-location-accuracy-circle","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ta.Marker({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{!e.geolocateSource&&"ACTIVE_LOCK"===this._watchState&&(!e.originalEvent||"resize"!==e.originalEvent.type)&&(this._watchState="BACKGROUND",this.fire(new Event("trackuserlocationend")))})}trigger(){if(!this._setup)return!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":em--,vh=!1,this._watchState="OFF",this.fire(new Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Event("trackuserlocationstart"))}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;++em>1?(e={maximumAge:6e5,timeout:0},vh=!0):(e=this.options.positionOptions,vh=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this.options.showUserLocation&&this._updateMarker(null)}};function WE(i,...e){for(let s of e)for(let r in s)i[r]=s[r];return i}var YE=i=>e=>e.pipe(function(i){return Xt((e,s)=>{let r=[];return e.subscribe(an(s,c=>r.push(c),()=>{s.next(r),s.complete()})),bn(i).subscribe(an(s,()=>{let c=r;r=[],s.next(c)},Zr)),()=>{r=null}})}(e.pipe(function(i,e=qr,s){let r=Gl(i,e);return function(i,e){return Xt((s,r)=>{let{leading:c=!0,trailing:o=!1}=e??{},y=!1,x=null,I=null,A=!1,L=()=>{I?.unsubscribe(),I=null,o&&(le(),A&&r.complete())},G=()=>{I=null,A&&r.complete()},re=ve=>I=bn(i()).subscribe(an(r,L,G)),le=()=>{if(y){y=!1;let ve=x;x=null,r.next(ve),!A&&re()}};s.subscribe(an(r,ve=>{y=!0,x=ve,(!I||I.closed)&&(c?le():re())},()=>{A=!0,(!(o&&y&&I)||I.closed)&&r.complete()}))})}(()=>r,s)}(i),Wr(i)))),XE=zl(sl(),1),nm=class{constructor(){this._state={panStart:{x:0,y:0},distanceStart:0},this._touchZoomFactor=.2,this._touchZoomThreshold=.01,this.touchStart=this.touchStart.bind(this),this.touchMove=this.touchMove.bind(this)}touchStart(e){if(2!==e.touches.length)return;let s=0,r=0;[].forEach.call(e.touches,c=>{s+=c.screenX,r+=c.screenY}),this._state.distanceStart=this.distance(e.touches[0],e.touches[1]),this._state.panStart.x=s/e.touches.length,this._state.panStart.y=r/e.touches.length}touchMove(e){2===e.touches.length&&(this._handleTouchPan(e),this._handleTouchZoom(e))}_handleTouchZoom(e){let s=this._state.distanceStart,r=this.distance(e.touches[0],e.touches[1]);this._state.distanceStart=r;let c=r/s;c=Math.min(Math.max(c,1e-6),1.999999),c=c>1+this._touchZoomThreshold?(c-1)*this._touchZoomFactor+1:c<1-this._touchZoomThreshold?1-(1-c)*this._touchZoomFactor:1,this._map?.setZoom(this._map.getZoom()*c)}_handleTouchPan(e){let s=0,r=0;[].forEach.call(e.touches,y=>{s+=y.screenX,r+=y.screenY});let c=s/e.touches.length-this._state.panStart.x,o=r/e.touches.length-this._state.panStart.y;this._state.panStart.x=s/e.touches.length,this._state.panStart.y=r/e.touches.length,this._map?.panBy([c/-1,o/-1],{animate:!1})}onAdd(e){return this._map=e,this._container=document.createElement("div"),this._map.getContainer().addEventListener("touchstart",this.touchStart,!1),this._map.getContainer().addEventListener("touchmove",this.touchMove,!1),this._container}onRemove(){this._map?.getContainer().removeEventListener("touchstart",this.touchStart),this._map?.getContainer().removeEventListener("touchmove",this.touchMove),this._map=void 0}distance(e,s){let c=e.screenY,y=s.screenY;return Math.sqrt(Math.pow(s.screenX-e.screenX,2)+Math.pow(y-c,2))}midpoint(e,s){return[(e.screenX+s.screenX)/2,(e.screenY+s.screenY)/2]}},im=(()=>{let e=class{getPoiSourceUrlByOptions(r,c){let[o,y]=r.split(".json"),x=o.replace("_integration","").replace("_preview","");return x=this._setEnvironment(x,c?.environment),x=this._setPreview(x,c?.includePreview),x+".json"+y}_setPreview(r,c){return c?r+"_preview":r}_setEnvironment(r,c){return"int"===c?r+"_integration":r}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),JE=(()=>{let e=class{constructor(r,c){this._http=r,this._urlService=c,this._controlLabels={de:{"NavigationControl.ZoomIn":"Hineinzoomen","NavigationControl.ZoomOut":"Rauszoomen"},fr:{"NavigationControl.ZoomIn":"Zoom avant","NavigationControl.ZoomOut":"D\xe9zoomer"},it:{"NavigationControl.ZoomIn":"Ingrandire","NavigationControl.ZoomOut":"Rimpicciolire"},en:{"NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out"}}}initializeMap(r,c,o,y,x,I,A,L){return this.fetchStyle(o,L).pipe(Gi(G=>this._createMap(G,r,y,c,x,I,A)))}_createMap(r,c,o,y,x,I,A){let L=new XE.Map(this._createOptions(r,c,o,x,I,A));return this._translateControlLabels(L,y),this._addControls(L,o.oneFingerPan),L.keyboard.disableRotation(),L.touchZoomRotate.disableRotation(),L}_createOptions(r,c,o,y,x,I){let A={style:r,container:c,minZoom:x?.minZoomLevel??1,maxZoom:x?.maxZoomLevel??23,maxBounds:x?.maxBounds,scrollZoom:o.scrollZoom,dragRotate:!1,touchPitch:!1,fadeDuration:10,interactive:!o.disableInteractions,attributionControl:!1};if(Vf(y))A.center=y.mapCenter,A.zoom=y.zoomLevel;else{let L,G;!function(i){return!!i&&"boundingBox"in i}(y)?I?(L=I,G=40):(L=Nf,G=0):(L=y.boundingBox,G=y.padding),A.bounds=L,A.fitBoundsOptions={padding:G}}return A}fetchStyle(r,c){return this._http.get(r).pipe(Gi(o=>{let y=o,x=y.sources[Rf];return x.url=this._urlService.getPoiSourceUrlByOptions(x.url,c),y}))}_translateControlLabels(r,c){r._locale=Object.assign({},r._locale,this._controlLabels[c])}_addControls(r,c){c||r.addControl(new nm)}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(V_),Le(im))},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),eI=(()=>{let e=class{constructor(r,c){this._mapRouteService=r,this._mapTransferService=c}updateJourney(r,c,o=Ji,y){let x=[],I=[],A=[];for(let L of o.features){let G=L.properties,re=G.type,le=G.pathType,ve=G.legId??"journey",Ie=y===ve||!y;G[zo]=ve,G[al]=Ie,"path"!==re||"transport"!==le&&"bee"!==le?"stopover"===re?I.push(L):"bbox"===re||A.push(L):x.push(L)}ea(r)?(this._mapRouteService.updateRoute(r,c,kr(x)),this._mapTransferService.updateTransfer(r,kr(A))):this._mapRouteService.updateRoute(r,c,kr(x.concat(A)),I,y)}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(Hf),Le(Tc))},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),tI=(()=>{let e=class{hideOverflowingLabels(r,c){if(c.disableInteractions){let o="map-viewport-line";this._addBorderSource(r,o);let y=10;this._addBlockerImage(r,y),this._addBlockerImageOnBorder(r,o,y)}}_addBorderSource(r,c){let o=r.getBounds();r.addSource(c,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[o._sw.lng,o._sw.lat],[o._sw.lng,o._ne.lat],[o._ne.lng,o._ne.lat],[o._ne.lng,o._sw.lat],[o._sw.lng,o._sw.lat]]}}})}_addBlockerImage(r,c){let o=new Uint8Array(c*c*4);r.addImage("pixel",{width:c,height:c,data:o})}_addBlockerImageOnBorder(r,c,o){r.addLayer({id:"map-viewport-line-symbols",type:"symbol",source:c,layout:{"icon-image":"pixel","symbol-placement":"line","symbol-spacing":o/2}})}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),nI=(()=>{let e=class{updateOptions(r,c){r.getStyle().layers?.forEach(o=>{if("line"===o.type&&o.id.includes("-track")){let y=o;c?this._updateLayerOptions(r,y,c):this._restoreLayerOptions(r,y)}})}_updateLayerOptions(r,c,o){this._backupLayerOptions(c),o.railNetworkColor&&r.setPaintProperty(c.id,"line-color",o.railNetworkColor)}_backupLayerOptions(r){let c=r.metadata??{};c.railNetworkDefaultLineColor||(c.railNetworkDefaultLineColor=(r.paint||{})["line-color"],r.metadata=c)}_restoreLayerOptions(r,c){let o=c.metadata??{};!o.railNetworkDefaultLineColor||(r.setPaintProperty(c.id,"line-color",o.railNetworkDefaultLineColor),delete o.railNetworkDefaultLineColor)}},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=Be({token:e,factory:e.\u0275fac,providedIn:"root"}),i})(),WN=["map"];function YN(i,e){if(1&i&&(fr(0,"sbb-zoom-controls",17),fs(1,"async")),2&i){let s=ct();at("map",ms(1,2,s.mapReady))("showSmallButtons",s.uiOptions.showSmallButtons)}}function KN(i,e){if(1&i){let s=hn();dt(0,"sbb-geolocate-button",18),Ot("geolocateButtonClicked",function(){return en(s),tn(ct().onGeolocateButtonClicked())}),fs(1,"async"),pt()}if(2&i){let s=ct();at("map",ms(1,2,s.mapReady))("showSmallButtons",s.uiOptions.showSmallButtons)}}function QN(i,e){if(1&i){let s=hn();dt(0,"sbb-basemap-switch",19),Ot("toggleBasemap",function(){return en(s),tn(ct().onToggleBasemap())}),fs(1,"async"),pt()}if(2&i){let s=ct();at("map",ms(1,2,s.mapReady))("showSmallButtons",s.uiOptions.showSmallButtons)}}function XN(i,e){if(1&i){let s=hn();dt(0,"sbb-home-button",20),Ot("homeButtonClicked",function(){return en(s),tn(ct().onHomeButtonClicked())}),fs(1,"async"),pt()}if(2&i){let s=ct();at("map",ms(1,2,s.mapReady))("showSmallButtons",s.uiOptions.showSmallButtons)}}function JN(i,e){if(1&i&&(fr(0,"sbb-level-switch",17),fs(1,"async")),2&i){let s=ct();at("map",ms(1,2,s.mapReady))("showSmallButtons",s.uiOptions.showSmallButtons)}}var oI=(()=>{let e=class{constructor(r,c,o,y,x,I,A,L,G,re,le,ve,Ie,je,Ae,yt,rt,ot,ln){this._mapInitService=r,this._mapConfigService=c,this._mapService=o,this._mapMarkerService=y,this._mapJourneyService=x,this._mapTransferService=I,this._mapRoutesService=A,this._mapRailNetworkLayerService=L,this._mapZoneService=G,this._mapLeitPoiService=re,this._mapLayerFilterService=le,this._mapOverflowingLabelService=ve,this._mapEventUtils=Ie,this._urlService=je,this._levelSwitchService=Ae,this._markerOrPoiSelectionStateService=yt,this._cd=rt,this._i18n=ot,this._host=ln,this.selectedMarkerIdChange=new Mt,this.selectedLevelChange=new Mt,this.selectedFeaturesChange=new Mt,this.featuresClick=new Mt,this.featuresHoverChange=new Mt,this.visibleLevelsChange=new Mt,this.zoomLevelsChange=new Mt,this.mapCenterChange=new Mt,this.mapReady=new Cr(1),this.mapBoundsChange=new Mt,this.touchEventCollector=new Ct,this.touchOverlayStyleClass="",this._defaultStyleOptions={url:"https://journey-maps-tiles.geocdn.sbb.ch/styles/{styleId}/style.json?api_key={apiKey}",aerialId:"aerial_sbb_ki_v2",brightId:"base_bright_v2_ki_v2",darkId:"base_dark_v2_ki_v2",mode:"bright"},this._defaultInteractionOptions={oneFingerPan:!1,scrollZoom:!0},this._defaultUIOptions={showSmallButtons:!1,levelSwitch:!0,zoomControls:!0,basemapSwitch:!0,homeButton:!1,geoLocation:!1},this._defaultHomeButtonOptions={boundingBox:Nf,padding:0},this._defaultMarkerOptions={popup:!1},this._zoomLevelDebouncer=new Ct,this._mapMovementDebouncer=new Ct,this._mapResized=new Ct,this._destroyed=new Ct,this._styleLoaded=new Cr(1),this._viewportDimensionsChanged=new Ct,this._mapStyleOptionsChanged=new Ct,this._isStyleLoaded=!1,this._isAerialSelected=!1,this._sbbGeolocateControl=new tm({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),this._styleOptions=this._defaultStyleOptions,this._interactionOptions=this._defaultInteractionOptions,this._uiOptions=this._defaultUIOptions,this._homeButtonOptions=this._defaultHomeButtonOptions,this._markerOptions=this._defaultMarkerOptions,this._host.nativeElement.moveNorth=this.moveNorth.bind(this),this._host.nativeElement.moveEast=this.moveEast.bind(this),this._host.nativeElement.moveSouth=this.moveSouth.bind(this),this._host.nativeElement.moveWest=this.moveWest.bind(this),this._host.nativeElement.zoomIn=this.zoomIn.bind(this),this._host.nativeElement.zoomOut=this.zoomOut.bind(this),this._host.nativeElement.unselectAll=this.unselectAll.bind(this),this._host.nativeElement.setSelectedPoi=this.setSelectedPoi.bind(this)}get styleOptions(){return this._styleOptions}set styleOptions(r){this._styleOptions={...this._defaultStyleOptions,...r}}get language(){return this._i18n.language}set language(r){if(null==r)throw new TypeError("language must not be null");if("de"!==(r=r.toLowerCase())&&"fr"!==r&&"it"!==r&&"en"!==r)throw new TypeError("Illegal value for language. Allowed values are de|fr|it|en.");this._i18n.language=r}get interactionOptions(){return this._interactionOptions}set interactionOptions(r){this._interactionOptions={...this._defaultInteractionOptions,...r}}get uiOptions(){return this._uiOptions}set uiOptions(r){this._uiOptions={...this._defaultUIOptions,...r}}get homeButtonOptions(){return this._homeButtonOptions}set homeButtonOptions(r){this._homeButtonOptions={...this._defaultHomeButtonOptions,...r}}get markerOptions(){return this._markerOptions}set markerOptions(r){this._markerOptions={...this._defaultMarkerOptions,...r}}get selectedMarkerId(){return this._markerOrPoiSelectionStateService.getSelectedSbbMarker()?.id}set selectedMarkerId(r){if(r){let c=this.markerOptions.markers?.find(o=>o.id===r);this.onMarkerSelected(c)}else this.selectedMarker&&this.onMarkerUnselected()}get selectedMarker(){return this._markerOrPoiSelectionStateService.getSelectedSbbMarker()}set selectedMarker(r){r&&(r.triggerEvent||void 0===r.triggerEvent)?this.selectedMarkerIdChange.emit(r.id):Promise.resolve().then(()=>this.selectedMarkerIdChange.emit(void 0)),r?r&&r.markerUrl?open(r.markerUrl,"_self"):(this._unselectPoi(),this._markerOrPoiSelectionStateService.selectSbbMarker(r)):this._markerOrPoiSelectionStateService.deselectSbbMarker()}get getMarkersBounds(){return this.markerOptions.zoomToMarkers?this.computeMarkersBounds(this.markerOptions.markers):void 0}onTouchStart(r){this.interactionOptions.oneFingerPan||this._map.dragPan.disable(),this.touchEventCollector.next(r)}onTouchEnd(r){this.touchOverlayStyleClass="",this._cd.detectChanges(),this.touchEventCollector.next(r)}moveNorth(){this._mapService.pan(this._map,"north")}moveEast(){this._mapService.pan(this._map,"east")}moveSouth(){this._mapService.pan(this._map,"south")}moveWest(){this._mapService.pan(this._map,"west")}zoomIn(){this._map?.zoomIn()}zoomOut(){this._map?.zoomOut()}unselectAll(r){r.includes("MARKER")&&this.onMarkerUnselected(),r.includes("POI")&&this._unselectPoi()}setSelectedPoi(r){r?this._selectOrDeselectPoi(r,!0):this._unselectPoi()}_unselectPoi(){let r=this._markerOrPoiSelectionStateService.getSelectedPoi();r&&this._selectOrDeselectPoi(r?.id,!1)}_selectOrDeselectPoi(r,c){if(r){let o=this._mapEventUtils.queryVisibleFeaturesByFilter(this._map,"POI",[Ec],["==","sbbId",r]);if(o.length){let y=o[0].geometry.coordinates;this._featureEventListenerComponent.selectOrDeselectProgrammatically({clickLngLat:{lng:y[0],lat:y[1]},features:o},c)}}}ngOnInit(){this._validateInputParameter(),this._setupSubjects(),this._executeWhenMapStyleLoaded(()=>{this._mapOverflowingLabelService.hideOverflowingLabels(this._map,this.interactionOptions)})}ngOnChanges(r){if(this._mapConfigService.updateConfigs(this.markerOptions.popup),r.markerOptions?.currentValue.markers!==r.markerOptions?.previousValue?.markers&&this._updateMarkers(),r.journeyMapsRoutingOption){let c=(i=>{let e=Object.entries(i).filter(([c,o])=>o),s=e.length;return 0===s||1===s&&(i.journey||i.routes||i.transfer)||2===s&&(i.journey&&i.journeyMetaInformation||i.routes&&i.routesMetaInformations)?[]:e.map(([c,o])=>c)})(this.journeyMapsRoutingOption??{});c.length?console.error("journeyMapsRoutingOption: Use only one of the following: 'transfer', 'journey', 'routes'. Received: "+c.map(o=>`'${o}'`).join(", ")):(this._haveRoutesMetaInformationsChanged(r)&&this._updateMarkers(),this._executeWhenMapStyleLoaded(()=>{let o=this._featureEventListenerComponent.mapSelectionEventService;this._mapJourneyService.updateJourney(this._map,o,void 0),this._mapTransferService.updateTransfer(this._map,void 0),this._mapRoutesService.updateRoutes(this._map,o,void 0),this._mapLeitPoiService.processData(this._map,void 0),(r.journeyMapsRoutingOption.currentValue?.journey||r.journeyMapsRoutingOption.currentValue?.journeyMetaInformation)&&this._updateJourney(),r.journeyMapsRoutingOption.currentValue?.transfer&&this._updateTransfer(),r.journeyMapsRoutingOption.currentValue?.routes&&this._updateRoutes()}))}(r.journeyMapsZones?.currentValue||r.journeyMapsZones?.previousValue)&&this._executeWhenMapStyleLoaded(()=>{this._updateZones()}),r.poiOptions&&this._executeWhenMapStyleLoaded(()=>{if(r.poiOptions.firstChange||r.poiOptions.previousValue?.environment===r.poiOptions.currentValue?.environment&&r.poiOptions.previousValue?.includePreview===r.poiOptions.currentValue?.includePreview)this._mapService.updatePoiVisibility(this._map,this.poiOptions);else{let x=this._map.getSource(Rf),I=this._urlService.getPoiSourceUrlByOptions(x.url,this.poiOptions);x.setUrl(I),this._map.once("styledata",()=>{this._mapService.updatePoiVisibility(this._map,this.poiOptions)})}}),this._isStyleLoaded&&(r.viewportDimensions&&!r.viewportDimensions.isFirstChange()&&this._viewportDimensionsChanged.next(),r.viewportBounds&&this._executeWhenMapStyleLoaded(()=>{this._map.setMinZoom(this.viewportBounds?.minZoomLevel??1).setMaxZoom(this.viewportBounds?.maxZoomLevel??23).setMaxBounds(this.viewportBounds?.maxBounds),this._zoomLevelDebouncer.next()}),JSON.stringify(r.styleOptions?.currentValue)!==JSON.stringify(r.styleOptions?.previousValue)&&this._mapStyleOptionsChanged.next(),void 0!==r.selectedLevel?.currentValue&&this._levelSwitchService.switchLevel(this.selectedLevel),r.uiOptions?.currentValue.levelSwitch!==r.uiOptions?.previousValue?.levelSwitch&&this._show2Dor3D())}ngAfterViewInit(){let r=this._getStyleUrl();this.touchOverlayText=this._i18n.getText("touchOverlay.tip"),this._mapInitService.initializeMap(this._mapElementRef.nativeElement,this._i18n.language,r,this.interactionOptions,this.viewportDimensions,this.viewportBounds,this.getMarkersBounds,this.poiOptions).subscribe(c=>{this._map=c,this._map.isStyleLoaded()?this._onStyleLoaded():this._map.on("styledata",()=>{this._onStyleLoaded()})}),this.touchEventCollector.pipe(YE(200),An(this._destroyed)).subscribe(c=>{let o=c.some(x=>2===x.touches.length),y=c.some(x=>"touchend"===x.type);!o&&!y&&!this.interactionOptions.oneFingerPan&&(this.touchOverlayStyleClass="is_visible",this._cd.detectChanges())}),this._setupResizeObserver()}ngOnDestroy(){this._observer?.disconnect(),this._map?.remove(),this._destroyed.next(),this._destroyed.complete(),this._mapLeitPoiService.destroy(),this._levelSwitchService.destroy()}onMarkerUnselected(){this.selectedMarker=void 0,this._mapMarkerService.unselectFeature(this._map),this._cd.detectChanges()}onMarkerSelected(r){r?.id!==this.selectedMarkerId&&(this.selectedMarker=r,this._mapMarkerService.selectMarker(this._map,r),this._cd.detectChanges())}computeMarkersBounds(r){let c=new rI.LngLatBounds;return r?.forEach(o=>{c.extend(o.position)}),c}onToggleBasemap(){this._isAerialSelected=!this._isAerialSelected,this._mapStyleOptionsChanged.next()}handleMarkerOrClusterClick(r){let c=r.filter(x=>this._mapMarkerService.allMarkerAndClusterLayers.includes(x.layer.id));if(!c.length)return;let o=0,y=c[0];for(;y.layer.id===c[++o]?.layer.id;)y.properties?.order<c[o].properties?.order&&(y=c[o]);if(y.properties?.cluster)this._mapMarkerService.onClusterClicked(this._map,y);else{let x=this._mapMarkerService.onMarkerClicked(this._map,y,this.selectedMarkerId);this.selectedMarker=this.markerOptions.markers?.find(I=>I.id===x&&!!x),this._cd.detectChanges()}}onHomeButtonClicked(){this._mapService.moveMap(this._map,this._homeButtonOptions)}onGeolocateButtonClicked(){this._sbbGeolocateControl.trigger()}_updateMarkers(){this.selectedMarker=this.markerOptions.markers?.find(r=>this.selectedMarkerId===r.id),this._executeWhenMapStyleLoaded(()=>{this._mapMarkerService.updateMarkers(this._map,this._getMarkers(),this.selectedMarker,this.styleOptions.mode),this._cd.detectChanges()})}_executeWhenMapStyleLoaded(r){this._isStyleLoaded?r():this._styleLoaded.pipe(Zl(1),function(i,e=qr){let s=Gl(500,e);return bg(()=>s)}()).subscribe(()=>r())}_getStyleUrl(){return this.styleOptions.url.replace("{styleId}",this._getStyleId()).replace("{apiKey}",this.apiKey)}_getStyleId(){return this._isAerialSelected?this.styleOptions.aerialId:"dark"===this.styleOptions.mode?this.styleOptions.darkId:this.styleOptions.brightId}_setupSubjects(){this._mapResized.pipe(Wr(500),An(this._destroyed)).subscribe(()=>this._map?.resize()),this._viewportDimensionsChanged.pipe(Wr(200),An(this._destroyed)).subscribe(()=>{this.viewportDimensions&&this._mapService.moveMap(this._map,this.viewportDimensions)}),this._mapStyleOptionsChanged.pipe(Wr(200),ss(()=>this._mapInitService.fetchStyle(this._getStyleUrl(),this.poiOptions)),An(this._destroyed)).subscribe(r=>{this._map.setStyle(r,{diff:!1}),this._map.once("styledata",()=>{this._featureEventListenerComponent.updateListener(),this._show2Dor3D(),this._mapMarkerService.updateMarkers(this._map,this._getMarkers(),this.selectedMarker,this.styleOptions.mode),this._mapLayerFilterService.collectLvlLayers(),this._levelSwitchService.switchLevel(this._levelSwitchService.selectedLevel),this.journeyMapsRoutingOption?.journey?this._updateJourney():this.journeyMapsRoutingOption?.transfer?this._updateTransfer():this.journeyMapsRoutingOption?.routes&&this._updateRoutes(),this.journeyMapsZones&&this._updateZones(),this.styleOptions.railNetwork&&this._mapRailNetworkLayerService.updateOptions(this._map,this.styleOptions.railNetwork)})}),this._zoomLevelDebouncer.pipe(Wr(200),An(this._destroyed)).subscribe(()=>this.zoomLevelsChange.emit(this._getZooomLevels())),this._mapMovementDebouncer.pipe(Wr(200),An(this._destroyed)).subscribe(()=>{this.mapCenterChange.emit(this._map.getCenter()),this.mapBoundsChange.emit(this._map.getBounds().toArray())}),this._levelSwitchService.selectedLevel$.pipe(An(this._destroyed)).subscribe(r=>{this.selectedLevelChange.emit(r),this._show2Dor3D()}),this._levelSwitchService.visibleLevels$.pipe(An(this._destroyed)).subscribe(r=>this.visibleLevelsChange.emit(r))}_onStyleLoaded(){this._isStyleLoaded||(this._mapMarkerService.initStyleData(this._map),this._levelSwitchService.onInit(this._map),this._map.resize(),this._mapService.verifySources(this._map,[uo,...this._mapMarkerService.sources]),this._map.on("zoomend",()=>this._zoomLevelDebouncer.next()),this._map.on("moveend",()=>this._mapMovementDebouncer.next()),this._zoomLevelDebouncer.next(),this._mapMovementDebouncer.next(),this._show2Dor3D(),this.styleOptions.railNetwork&&this._mapRailNetworkLayerService.updateOptions(this._map,this.styleOptions.railNetwork),this._map.addControl(this._sbbGeolocateControl),this._isStyleLoaded=!0,this._styleLoaded.next(),this.mapReady.next(this._map))}_getZooomLevels(){return{minZoom:this._map.getMinZoom(),maxZoom:this._map.getMaxZoom(),currentZoom:this._map.getZoom()}}_validateInputParameter(){if(!this.apiKey)throw new Error("Input parameter apiKey is mandatory")}_setupResizeObserver(){this._observer=new ResizeObserver(()=>this._mapResized.next()),this._observer.observe(this._mapElementRef.nativeElement)}_getMarkers(){return[...this.markerOptions.markers??[],...this._mapRoutesService.getRouteMarkers(this.journeyMapsRoutingOption?.routes,this.journeyMapsRoutingOption?.routesMetaInformations)??[]]}_haveRoutesMetaInformationsChanged(r){return r.journeyMapsRoutingOption?.currentValue?.routesMetaInformations?.length!==r.journeyMapsRoutingOption?.previousValue?.routesMetaInformations?.length||r.journeyMapsRoutingOption?.currentValue?.routesMetaInformations!==r.journeyMapsRoutingOption?.previousValue?.routesMetaInformations}_updateJourney(){this._mapJourneyService.updateJourney(this._map,this._featureEventListenerComponent.mapSelectionEventService,this.journeyMapsRoutingOption.journey,this.journeyMapsRoutingOption.journeyMetaInformation?.selectedLegId),this._mapLeitPoiService.processData(this._map,this.journeyMapsRoutingOption.journey,this.journeyMapsRoutingOption.journeyMetaInformation?.selectedLegId)}_updateTransfer(){this._mapTransferService.updateTransfer(this._map,this.journeyMapsRoutingOption.transfer),this._mapLeitPoiService.processData(this._map,this.journeyMapsRoutingOption.transfer)}_updateRoutes(){this._mapRoutesService.updateRoutes(this._map,this._featureEventListenerComponent.mapSelectionEventService,this.journeyMapsRoutingOption.routes,this.journeyMapsRoutingOption.routesMetaInformations)}_updateZones(){this._mapZoneService.updateZones(this._map,this._featureEventListenerComponent.mapSelectionEventService,this.journeyMapsZones)}_show2Dor3D(){if(this._isStyleLoaded){let r=void 0!==this._levelSwitchService.selectedLevel&&this.uiOptions.levelSwitch;this._setVisibility(this._map,"-2d",r?"none":"visible"),this._setVisibility(this._map,"-lvl",r?"visible":"none")}}_setVisibility(r,c,o){r.getStyle().layers?.filter(y=>y.id.endsWith(c)).forEach(y=>r.setLayoutProperty(y.id,"visibility",o))}},i=e;return e.\u0275fac=function(c){return new(c||e)(Ke(JE),Ke(Wf),Ke($f),Ke(Cc),Ke(eI),Ke(Tc),Ke(Dc),Ke(nI),Ke(CE),Ke(Sc),Ke(Ac),Ke(tI),Ke(Js),Ke(im),Ke(Pc),Ke(Ic),Ke(ki),Ke(gi),Ke(ps))},e.\u0275cmp=Dn({type:e,selectors:[["sbb-journey-maps"]],viewQuery:function(c,o){if(1&c&&(Ja(WN,5),Ja(Jf,5)),2&c){let y;Xa(y=el())&&(o._mapElementRef=y.first),Xa(y=el())&&(o._featureEventListenerComponent=y.first)}},inputs:{apiKey:"apiKey",journeyMapsRoutingOption:"journeyMapsRoutingOption",journeyMapsZones:"journeyMapsZones",markerDetailsTemplate:"markerDetailsTemplate",selectedLevel:"selectedLevel",listenerOptions:"listenerOptions",poiOptions:"poiOptions",viewportDimensions:"viewportDimensions",viewportBounds:"viewportBounds",styleOptions:"styleOptions",language:"language",interactionOptions:"interactionOptions",uiOptions:"uiOptions",homeButtonOptions:"homeButtonOptions",markerOptions:"markerOptions",selectedMarkerId:"selectedMarkerId"},outputs:{selectedMarkerIdChange:"selectedMarkerIdChange",selectedLevelChange:"selectedLevelChange",selectedFeaturesChange:"selectedFeaturesChange",featuresClick:"featuresClick",featuresHoverChange:"featuresHoverChange",visibleLevelsChange:"visibleLevelsChange",zoomLevelsChange:"zoomLevelsChange",mapCenterChange:"mapCenterChange",mapReady:"mapReady",mapBoundsChange:"mapBoundsChange"},features:[Xp([Pc,Ac,Sc,Ic]),pi],decls:22,vars:22,consts:[[1,"jmc-container",3,"lang"],[1,"map-container",3,"touchstart","touchend"],[1,"mod_map_container_mobile_overlay",2,"opacity","0",3,"ngClass"],[1,"mod_map_container_mobile_overlay_icon_wrapper"],[1,"mod_svgsprite_icon","mod_map_container_mobile_overlay_icon"],[1,"mod_map_container_mobile_overlay_text"],[3,"listenerOptions","poiOptions","map","featuresHoverChange","featuresClick","featureSelectionsChange"],[3,"selectedMarker","template","map","popup","closeClicked"],[1,"map-widgets"],[3,"map","showSmallButtons",4,"ngIf"],[3,"map","showSmallButtons","geolocateButtonClicked",4,"ngIf"],[3,"map","showSmallButtons","toggleBasemap",4,"ngIf"],[3,"map","showSmallButtons","homeButtonClicked",4,"ngIf"],[1,"map-attribution"],[3,"map"],[1,"map"],["map",""],[3,"map","showSmallButtons"],[3,"map","showSmallButtons","geolocateButtonClicked"],[3,"map","showSmallButtons","toggleBasemap"],[3,"map","showSmallButtons","homeButtonClicked"]],template:function(c,o){1&c&&(dt(0,"div",0)(1,"div",1),Ot("touchstart",function(x){return o.onTouchStart(x)})("touchend",function(x){return o.onTouchEnd(x)}),dt(2,"div",2)(3,"span",3),fr(4,"div",4),pt(),dt(5,"p",5),Lo(6),pt()(),dt(7,"sbb-feature-event-listener",6),Ot("featuresHoverChange",function(x){return o.featuresHoverChange.next(x)})("featuresClick",function(x){return o.featuresClick.next(x),o.handleMarkerOrClusterClick(x.features)})("featureSelectionsChange",function(x){return o.selectedFeaturesChange.next(x)}),fs(8,"async"),pt(),dt(9,"sbb-marker-details",7),Ot("closeClicked",function(){return o.onMarkerUnselected()}),fs(10,"async"),pt(),dt(11,"div",8),un(12,YN,2,4,"sbb-zoom-controls",9)(13,KN,2,4,"sbb-geolocate-button",10)(14,QN,2,4,"sbb-basemap-switch",11)(15,XN,2,4,"sbb-home-button",12)(16,JN,2,4,"sbb-level-switch",9),pt(),dt(17,"div",13),fr(18,"sbb-attribution",14),fs(19,"async"),pt(),fr(20,"div",15,16),pt()()),2&c&&(C_("lang",o.language),ft(2),at("ngClass",o.touchOverlayStyleClass),ft(4),Xu(o.touchOverlayText),ft(1),at("listenerOptions",o.listenerOptions)("poiOptions",o.poiOptions)("map",ms(8,16,o.mapReady)),ft(2),at("selectedMarker",o.selectedMarker)("template",o.markerDetailsTemplate)("map",ms(10,18,o.mapReady))("popup",o.markerOptions.popup),ft(3),at("ngIf",o.uiOptions.zoomControls),ft(1),at("ngIf",o.uiOptions.geoLocation),ft(1),at("ngIf",o.uiOptions.basemapSwitch),ft(1),at("ngIf",o.uiOptions.homeButton),ft(1),at("ngIf",o.uiOptions.levelSwitch),ft(2),at("map",ms(19,20,o.mapReady)))},dependencies:[sf,Bn,aE,GE,qE,lE,ZE,Jf,OE,LE,oM],styles:['[_nghost-%COMP%], .map[_ngcontent-%COMP%], .jmc-container[_ngcontent-%COMP%]{height:100%}.jmc-container[_ngcontent-%COMP%]{position:relative;z-index:0;display:flex;flex-direction:column;width:100%}.map-container[_ngcontent-%COMP%]{position:relative;min-height:100px;overflow:hidden;flex:1 0 auto}.map[_ngcontent-%COMP%]{position:absolute !important;top:0;left:0;width:100%}.mod_map_container_mobile_overlay[_ngcontent-%COMP%]{position:absolute;display:flex;flex-direction:column;flex-wrap:nowrap;align-items:center;justify-content:center;top:0;left:0;width:100%;height:100%;pointer-events:none;transition:opacity .3s ease-in-out;opacity:0 !important;background-color:rgba(0,0,0,.6);z-index:4}.mod_map_container_mobile_overlay.is_visible[_ngcontent-%COMP%]{opacity:.9999 !important}.mod_map_container_mobile_overlay_text[_ngcontent-%COMP%]{color:#fff;font-family:SBBWeb Bold,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:1.4em;line-height:1.4;text-align:center;padding:0 1.6em;margin-top:.66667em;text-shadow:0 .06667em .53333em rgba(0,0,0,.4)}.mod_map_container_mobile_overlay_icon_wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:4.26667em;height:4.26667em;background:#fff;border-radius:50%;box-shadow:0 .06667em .53333em rgba(0,0,0,.4)}div.mod_map_container_mobile_overlay_icon[_ngcontent-%COMP%]{width:3.3em;height:3.4em;background:center/100% no-repeat url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzc2NzY3NiI+PHBhdGggZD0iTTE0IDEzaC0xVjYuNWMwLS4zLS4yLS41LS41LS41cy0uNS4yLS41LjV2NmgtMXYtNmMwLS44LjctMS41IDEuNS0xLjVzMS41LjcgMS41IDEuNVYxM3oiPjwvcGF0aD48cGF0aCBkPSJNMTYuOSAyMUg5LjJsLS4xLS4yUzUuNyAxNSA1LjQgMTQuNWMtLjYtMS0uMy0xLjcuMS0yIC41LS42IDEuNS0uNiAyLjEtLjFMOSAxMy45VjcuNWMwLS44LjctMS41IDEuNS0xLjVzMS41LjcgMS41IDEuNVYxM2gtMVY3LjVjMC0uMy0uMi0uNS0uNS0uNXMtLjUuMi0uNS41djguOGwtMy4xLTMuMWMtLjItLjItLjUtLjItLjcgMC0uMS4xLS4zLjIuMS44LjMuNSAyLjkgNC45IDMuNiA2aDYuNWMuMi0uNS43LTEuOS43LTR2LTMuNWMtLjEtLjMtLjMtLjUtLjYtLjVzLS41LjItLjUuNWgtMWMwLS44LjctMS41IDEuNS0xLjVzMS41LjcgMS41IDEuNVYxNmMwIDMtLjkgNC43LTEgNC44bC0uMS4yeiI+PC9wYXRoPjxwYXRoIGQ9Ik0xNiAxM2gtMXYtMS41YzAtLjMtLjItLjUtLjUtLjVzLS41LjItLjUuNWgtMWMwLS44LjctMS41IDEuNS0xLjVzMS41LjcgMS41IDEuNVYxM3pNNy42IDkuNEM3LjIgOC44IDcgOC4yIDcgNy41IDcgNS43IDguMyA0LjMgMTAgNGMuNy0uNyAxLjYtMSAyLjUtMUMxNC40IDMgMTYgNC42IDE2IDYuNWMwIC43LS4yIDEuNC0uNiAxLjlsLS44LS41Yy4zLS40LjQtLjkuNC0xLjRDMTUgNS4xIDEzLjkgNCAxMi41IDRjLS43IDAtMS40LjMtMS45LjlsLS4xLjFoLS4yQzkgNS4xIDggNi4yIDggNy41YzAgLjUuMSAxIC40IDEuNGwtLjguNXoiPjwvcGF0aD48L3N2Zz4=")}.map-widgets[_ngcontent-%COMP%]{position:absolute;right:0;top:0;z-index:2}.map-attribution[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;z-index:2}'],changeDetection:0}),i})(),sI=(()=>{let e=class{},i=e;return e.\u0275fac=function(c){return new(c||e)},e.\u0275mod=hr({type:e}),e.\u0275inj=ur({imports:[af]}),i})(),aI=(()=>{let e=class{constructor(r){this._injector=r}ngDoBootstrap(r){let c=function(i,e){let s=function(i,e){return e.get(Ys).resolveComponentFactory(i).inputs}(i,e.injector),r=e.strategyFactory||new J_(i,e.injector),c=function(i){let e={};return i.forEach(({propName:s,templateName:r,transform:c})=>{e[function(i){return i.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}(r)]=[s,c]}),e}(s),y=class extends tv{get ngElementStrategy(){if(!this._ngElementStrategy){let I=this._ngElementStrategy=r.create(this.injector||e.injector);s.forEach(({propName:A,transform:L})=>{if(!this.hasOwnProperty(A))return;let G=this[A];delete this[A],I.setInputValue(A,G,L)})}return this._ngElementStrategy}constructor(I){super(),this.injector=I}attributeChangedCallback(I,A,L,G){let[re,le]=c[I];this.ngElementStrategy.setInputValue(re,L,le)}connectedCallback(){let I=!1;this.ngElementStrategy.events&&(this.subscribeToEvents(),I=!0),this.ngElementStrategy.connect(this),I||this.subscribeToEvents()}disconnectedCallback(){this._ngElementStrategy&&this._ngElementStrategy.disconnect(),this.ngElementEventsSubscription&&(this.ngElementEventsSubscription.unsubscribe(),this.ngElementEventsSubscription=null)}subscribeToEvents(){this.ngElementEventsSubscription=this.ngElementStrategy.events.subscribe(I=>{let A=new CustomEvent(I.name,{detail:I.value});this.dispatchEvent(A)})}},o=y;return y.observedAttributes=Object.keys(c),s.forEach(({propName:x,transform:I})=>{Object.defineProperty(o.prototype,x,{get(){return this.ngElementStrategy.getInputValue(x)},set(A){this.ngElementStrategy.setInputValue(x,A,I)},configurable:!0,enumerable:!0})}),o}(oI,{injector:this._injector});customElements.define("sbb-journey-maps-wc",c)}},i=e;return e.\u0275fac=function(c){return new(c||e)(Le(pr))},e.\u0275mod=hr({type:e}),e.\u0275inj=ur({imports:[yM,sE,sI]}),i})();EM().bootstrapModule(aI,{ngZone:"noop"}).catch(i=>console.error(i))})();
//# sourceMappingURL=bundle.min.js.map